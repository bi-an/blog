<!DOCTYPE html>
<html lang="en, zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bi-an.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="gdb 实现原理参考 链接。 在 vim &#x2F; emacs 中启动 gdb为什么在 Emacs&#x2F;vim 中运行 GDB？  统一环境：你可以在 Emacs 中同时查看源代码和调试信息 快捷键支持：使用 Emacs 的快捷键控制 GDB（如设置断点、单步执行） 图形化布局：支持多窗口显示，如断点列表、堆栈信息、变量值等 增强效率：无需离开编辑器即可完成调试任务  Vim 从 8.1">
<meta property="og:type" content="article">
<meta property="og:title" content="gdb 入门">
<meta property="og:url" content="https://bi-an.github.io/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="江南人物的博客">
<meta property="og:description" content="gdb 实现原理参考 链接。 在 vim &#x2F; emacs 中启动 gdb为什么在 Emacs&#x2F;vim 中运行 GDB？  统一环境：你可以在 Emacs 中同时查看源代码和调试信息 快捷键支持：使用 Emacs 的快捷键控制 GDB（如设置断点、单步执行） 图形化布局：支持多窗口显示，如断点列表、堆栈信息、变量值等 增强效率：无需离开编辑器即可完成调试任务  Vim 从 8.1">
<meta property="og:locale">
<meta property="article:published_time" content="2024-01-23T21:44:37.000Z">
<meta property="article:modified_time" content="2025-09-22T15:54:11.224Z">
<meta property="article:author" content="bi-an">
<meta property="article:tag" content="gdb">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bi-an.github.io/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en, zh_CN'
  };
</script>

  <title>gdb 入门 | 江南人物的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江南人物的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-resource">

    <a href="/blog/resources/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Resource</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          gdb 入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:44:37" itemprop="dateCreated datePublished" datetime="2024-01-23T21:44:37+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-22 15:54:11" itemprop="dateModified" datetime="2025-09-22T15:54:11+00:00">2025-09-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="gdb-实现原理"><a href="#gdb-实现原理" class="headerlink" title="gdb 实现原理"></a>gdb 实现原理</h2><p>参考 <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/bi-an-60-46">链接</a>。</p>
<h2 id="在-vim-emacs-中启动-gdb"><a href="#在-vim-emacs-中启动-gdb" class="headerlink" title="在 vim &#x2F; emacs 中启动 gdb"></a>在 vim &#x2F; emacs 中启动 gdb</h2><p>为什么在 Emacs&#x2F;vim 中运行 GDB？</p>
<ul>
<li>统一环境：你可以在 Emacs 中同时查看源代码和调试信息</li>
<li>快捷键支持：使用 Emacs 的快捷键控制 GDB（如设置断点、单步执行）</li>
<li>图形化布局：支持多窗口显示，如断点列表、堆栈信息、变量值等</li>
<li>增强效率：无需离开编辑器即可完成调试任务</li>
</ul>
<p>Vim 从 8.1 版本开始内置了一个叫做 Termdebug 的插件，它可以直接在 Vim 中运行 GDB，并显示调试信息。</p>
<p>✅ 步骤：<br>确保 Vim 版本 ≥ 8.1</p>
<p>编译你的程序（加上 -g 选项）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g my_program.c -o my_program</span><br></pre></td></tr></table></figure>

<p>在 Vim 中加载插件：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:packadd termdebug</span><br><span class="line">:Termdebug</span><br></pre></td></tr></table></figure>

<p>Vim 会打开一个新的窗口，显示 GDB 控制台，你可以在里面输入 GDB 命令。</p>
<p>📖 教程参考：<a target="_blank" rel="noopener" href="https://www.baeldung.com/linux/vim-gdb-integration">Baeldung 的 Vim-GDB 集成指南</a></p>
<h2 id="gdb-命令"><a href="#gdb-命令" class="headerlink" title="gdb 命令"></a>gdb 命令</h2><ul>
<li><p><code>thread apply [threadno] [all] args</code> - 将命令传递给一个或多个线程，参见 <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/DeveloperTools/gdb/gdb/gdb_5.html">链接</a>。<br>比如，<code>thread apply all continue</code> 表示将 <code>continue</code> 命令传递给所有线程，也就是让所有线程都继续运行。</p>
</li>
<li><p><code>rbreak</code> - Set a breakpoint for all functions matching REGEXP. 参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/zdl1016/article/details/8708077">链接</a>。</p>
<p>  e.g. <code>rbreak file.C:.*</code> - 给 file.C 的所有函数加上断点。</p>
</li>
<li><p><code>info</code></p>
<ul>
<li><code>info inferior</code> - 可以查看当前调试的进程的 PID。另外一种方法是在 gdb 命令行中直接调用 C 函数：<code>print (int)getpid()</code>。参考：<a target="_blank" rel="noopener" href="https://www.qiniu.com/qfans/qnso-36704270">链接</a>。</li>
<li><code>info source</code> - 当前调试的源文件路径。</li>
<li><code>info sources &lt;pattern&gt;</code> - 查询源文件路径</li>
<li><code>info proc</code> - <a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/Process-Information.html">当前进程信息</a>。<ul>
<li><code>info proc files</code> - 当前进程打开的文件（和文件描述符）。</li>
<li><code>info args</code> - 查看函数参数</li>
<li><code>info locals</code> - 查看局部变量。</li>
<li><code>info reg</code> 查看寄存器。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>常用寄存器：</p>
<table>
<thead>
<tr>
<th align="center">寄存器</th>
<th align="center">用途说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">rax</td>
<td align="center">函数返回值，乘除法运算</td>
</tr>
<tr>
<td align="center">rbx</td>
<td align="center">通用寄存器，常用于基址</td>
</tr>
<tr>
<td align="center">rcx</td>
<td align="center">循环计数器</td>
</tr>
<tr>
<td align="center">rdx</td>
<td align="center">I&#x2F;O 指针或中间数据</td>
</tr>
<tr>
<td align="center">rdi</td>
<td align="center">函数第一个参数</td>
</tr>
<tr>
<td align="center">rsi</td>
<td align="center">函数第二个参数</td>
</tr>
<tr>
<td align="center">rsp</td>
<td align="center">栈顶指针</td>
</tr>
<tr>
<td align="center">rbp</td>
<td align="center">栈底指针，栈帧基址</td>
</tr>
<tr>
<td align="center">rip</td>
<td align="center">当前执行指令地址</td>
</tr>
<tr>
<td align="center">eflags</td>
<td align="center">运算状态标志，如 ZF（零标志）、CF（进位标志）等</td>
</tr>
</tbody></table>
<p>gdb 的寄存器变量</p>
<p>x86（32 位）</p>
<table>
<thead>
<tr>
<th>$eax, $ebx, $ecx, $edx</th>
<th>通用寄存器</th>
</tr>
</thead>
<tbody><tr>
<td>$esi, $edi</td>
<td>源 &#x2F; 目标索引寄存器</td>
</tr>
<tr>
<td>$esp</td>
<td>栈顶指针（Stack Pointer）</td>
</tr>
<tr>
<td>$ebp</td>
<td>栈底指针（Base Pointer）</td>
</tr>
<tr>
<td>$eip</td>
<td>指令指针（下一条执行的指令地址）</td>
</tr>
<tr>
<td>$eflags</td>
<td>标志寄存器（保存条件标志）</td>
</tr>
</tbody></table>
<p>x86_64（64 位）</p>
<table>
<thead>
<tr>
<th align="center">寄存器</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$rax, $rbx, $rcx, $rdx</td>
<td align="center">通用寄存器（64 位）</td>
</tr>
<tr>
<td align="center">$rsi, $rdi</td>
<td align="center">参数寄存器</td>
</tr>
<tr>
<td align="center">$rsp</td>
<td align="center">栈顶指针</td>
</tr>
<tr>
<td align="center">$rbp</td>
<td align="center">栈底指针</td>
</tr>
<tr>
<td align="center">$rip</td>
<td align="center">指令指针</td>
</tr>
<tr>
<td align="center">$r8~$r15</td>
<td align="center">扩展通用寄存器</td>
</tr>
<tr>
<td align="center">$eflags</td>
<td align="center">标志寄存器</td>
</tr>
</tbody></table>
<ul>
<li><code>show</code><ul>
<li><code>show environment</code> 查看全局变量</li>
<li><code>set environment &lt;var&gt;=&lt;value&gt;</code> 设置环境变量</li>
</ul>
</li>
<li><code>attach</code> - 连接到正在运行的进程。与 <code>gdb -p</code> 效果相同。</li>
<li><code>detach</code> - 取消连接的进程。</li>
<li><code>handle &lt;signal&gt; print pass nostop</code> - 捕获信号（比如 <code>SIGSEGV</code>）并且忽略它。<code>handle &lt;signal nostop</code>。<ul>
<li><code>pass</code> 表示 gdb 会将捕获到的信号发回给被调试的进程。</li>
</ul>
</li>
<li><code>set</code> - 修改变量的值，比如 <code>set x=10</code>（或 <code>set var x=10</code>）将变量 <code>x</code> 的值改为 <code>10</code>。参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/yasi_xi/article/details/12784507">博客</a>。</li>
<li><code>show directories</code></li>
<li><code>print</code> - gdb 默认设置打印字符串的长度为 200；更改打印最大长度：<code>set print elements &lt;number-of-elements&gt;</code>，<code>0</code> 表示 unlimited.<br>    - 打印数组: <code>print arr[0]@3</code> ，其中 <code>@3</code> 表示打印 3 个元素。<br>    - 以十六进制打印：<code>p/x &lt;var&gt;</code></li>
<li><code>ptype &lt;variable name&gt;</code> - 打印变量类型。</li>
<li><code>finish</code> - 从函数中返回，并打印函数返回值（即使函数的 return 语句很复杂，也可以获取返回值）。</li>
<li><code>frame &lt;n&gt;</code> - 跳转到某个栈帧。</li>
<li><code>up</code> 跳转到上一个栈帧</li>
<li><code>x/FMT</code>: <code>x</code> 表示 <code>examine</code> ，查看内存。<ul>
<li><code>/i</code> 表示 <code>instruction</code> ，即查看汇编指令。</li>
<li><code>/g</code> 表示 <code>giant word</code> ，即每次查看 8 字节。<ul>
<li><code>x/g 0x400000</code> 查看地址 0x400000 处的 8 字节内容（以十六进制显示）</li>
<li><code>x/4g $rsp</code> 查看当前栈指针 <code>$rsp</code> 指向的连续 4 个 8 字节值（共 32 字节）</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">x&#x2F;g</td>
<td align="center">默认十六进制显示 8 字节内容</td>
</tr>
<tr>
<td align="center">x&#x2F;dg</td>
<td align="center">十进制显示 8 字节内容</td>
</tr>
<tr>
<td align="center">x&#x2F;ug</td>
<td align="center">无符号十进制显示 8 字节内容</td>
</tr>
<tr>
<td align="center">x&#x2F;tg</td>
<td align="center">二进制显示 8 字节内容</td>
</tr>
<tr>
<td align="center">x&#x2F;fg</td>
<td align="center">浮点数格式显示 8 字节内容（double）</td>
</tr>
</tbody></table>
<h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><p>见 <a target="_blank" rel="noopener" href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_set_environm.htm">链接</a></p>
<h2 id="断点"><a href="#断点" class="headerlink" title="断点"></a>断点</h2><p>添加断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">break file:line_no</span><br></pre></td></tr></table></figure>

<p>查看断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info break</span><br></pre></td></tr></table></figure>

<p>删除第 2 个断点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete 2</span><br></pre></td></tr></table></figure>


<h3 id="条件断点"><a href="#条件断点" class="headerlink" title="条件断点"></a>条件断点</h3><p>参考：<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/8255.html">博客</a>、<a target="_blank" rel="noopener" href="https://ftp.gnu.org/old-gnu/Manuals/gdb/html_node/gdb_28.html">文档</a>。</p>
<p><code>break ... if cond</code></p>
<h3 id="观察断点"><a href="#观察断点" class="headerlink" title="观察断点"></a>观察断点</h3><h3 id="捕捉断点"><a href="#捕捉断点" class="headerlink" title="捕捉断点"></a>捕捉断点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">try...catch</span><br></pre></td></tr></table></figure>

<h3 id="打印长度的限制"><a href="#打印长度的限制" class="headerlink" title="打印长度的限制"></a>打印长度的限制</h3><ul>
<li>Value sizes - 参考：<a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/Value-Sizes.html">文档</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> max-value-size bytes</span><br><span class="line"><span class="built_in">set</span> max-value-size unlimited</span><br></pre></td></tr></table></figure>

<ul>
<li><p>打印字符长度限制</p>
<p>gdb 默认设置打印字符串的长度为 200；更改打印最大长度：<code>set print elements</code></p>
</li>
</ul>
<h2 id="coredump"><a href="#coredump" class="headerlink" title="coredump"></a>coredump</h2><p>gdb 命令：<code>gcore</code>。</p>
<p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/core.5.html">Reference</a></p>
<h2 id="WSL-无法使用-gdb"><a href="#WSL-无法使用-gdb" class="headerlink" title="WSL 无法使用 gdb"></a>WSL 无法使用 gdb</h2><p>WSL 指 Windows 虚拟机。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/WSL/issues/8516">解决方法</a>：</p>
<p>安装 <a target="_blank" rel="noopener" href="https://launchpad.net/~ubuntu-support-team/+archive/ubuntu/gdb">PPA 的 daily build 版本</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-support-team/gdb</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install gdb</span><br></pre></td></tr></table></figure>

<h2 id="gdb-attach-权限报错"><a href="#gdb-attach-权限报错" class="headerlink" title="gdb attach 权限报错"></a>gdb attach 权限报错</h2><p>This is due to kernel hardening in Linux; you can disable this behavior by <code>echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</code> or by modifying it in <code>/etc/sysctl.d/10-ptrace.conf</code>.</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19215177/how-to-solve-ptrace-operation-not-permitted-when-trying-to-attach-gdb-to-a-pro">How to solve “ptrace operation not permitted” when trying to attach GDB to a process?</a></p>
<h2 id="gdb-debug-forks"><a href="#gdb-debug-forks" class="headerlink" title="gdb debug forks"></a>gdb debug forks</h2><p><a target="_blank" rel="noopener" href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Forks.html">Reference</a></p>
<p>By default, when a program forks, gdb will continue to debug the parent process and the child process will run unimpeded.</p>
<p>If you want to follow the child process instead of the parent process, use the command set <code>follow-fork-mode</code>.</p>
<p><code>set follow-fork-mode mode</code><br>Set the debugger response to a program call of <code>fork</code> or <code>vfork</code>. A call to fork or vfork creates a new process. The mode argument can be:<br><code>parent</code><br>The original process is debugged after a fork. The child process runs unimpeded. This is the default.<br><code>child</code><br>The new process is debugged after a fork. The parent process runs unimpeded.<br><code>ask</code><br>gdb 会提示让你选择 <code>parent</code> 还是 <code>child</code> 。</p>
<p><code>show follow-fork-mode</code><br>Display the current debugger response to a fork or vfork call.<br>On Linux, if you want to debug both the parent and child processes, use the command set detach-on-fork.</p>
<p><code>set detach-on-fork mode</code><br>Tells gdb whether to detach one of the processes after a fork, or retain debugger control over them both.<br><code>on</code><br>The child process (or parent process, depending on the value of follow-fork-mode) will be detached and allowed to run independently. This is the default.<br><code>off</code><br>Both processes will be held under the control of gdb. One process (child or parent, depending on the value of follow-fork-mode) is debugged as usual, while the other is held suspended.</p>
<p><code>show detach-on-fork</code><br>Show whether detach-on-fork mode is on&#x2F;off.</p>
<p>If you issue a run command to gdb after an exec call executes, the new target restarts. To restart the parent process, use the file command with the parent executable name as its argument. By default, after an exec call executes, gdb discards the symbols of the previous executable image. You can change this behaviour with the set follow-exec-mode command.</p>
<p>set follow-exec-mode mode<br>Set debugger response to a program call of exec. An exec call replaces the program image of a process.<br>follow-exec-mode can be:</p>
<p><code>new</code><br>gdb creates a new inferior and rebinds the process to this new inferior. The program the process was running before the exec call can be restarted afterwards by restarting the original inferior.<br>For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">(gdb) info inferior</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 2    &lt;null&gt;        prog2</span><br><span class="line">  1    &lt;null&gt;        prog1</span><br></pre></td></tr></table></figure>

<p><code>same</code><br>gdb keeps the process bound to the same inferior. The new executable image replaces the previous executable loaded in the inferior. Restarting the inferior after the exec call, with e.g., the run command, restarts the executable the process was running after the exec call. This is the default mode.<br>For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog2</span><br></pre></td></tr></table></figure>

<h2 id="Setting-Catchpoints"><a href="#Setting-Catchpoints" class="headerlink" title="Setting Catchpoints"></a>Setting Catchpoints</h2><p><a target="_blank" rel="noopener" href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Set-Catchpoints.html#Set-Catchpoints">Reference</a></p>
<h2 id="gdb-redirect-to-a-log-file"><a href="#gdb-redirect-to-a-log-file" class="headerlink" title="gdb redirect to a log file"></a>gdb redirect to a log file</h2><p>You need to enable logging:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set logging on</span><br><span class="line">Now GDB will log to ./gdb.txt. You can tell it which file to use:</span><br><span class="line"></span><br><span class="line">(gdb) set logging file my_god_object.log</span><br><span class="line">And you can examine the current logging configuration:</span><br><span class="line"></span><br><span class="line">(gdb) show logging</span><br></pre></td></tr></table></figure>

<p>更新：新版本 gdb 采用 <code>set logging enabled on</code> 。</p>
<p>记录输入的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set trace-commands on</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5941158/gdb-print-to-file-instead-of-stdout">Refercence</a></p>
<h2 id="权限限制"><a href="#权限限制" class="headerlink" title="权限限制"></a>权限限制</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/yama/ptrace_scope</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>Yama 是 Linux 内核中的一个 安全模块（LSM：Linux Security Module），专门用于加强进程间的访问控制，尤其是对 ptrace 系统调用的限制。<br>Yama 的主要目的是防止恶意程序通过 ptrace 附加到其他进程（包括 gdb, strace, pstack, gstack 等），从而窃取数据或注入代码。</p>
<table>
<thead>
<tr>
<th align="center">值</th>
<th align="center">模式名称</th>
<th align="center">含义说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">经典模式</td>
<td align="center">允许同一用户调试其权限范围内的任意进程（只要目标进程是 “可转储” 的）。适合开发环境。</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">受限模式（默认）</td>
<td align="center">只允许调试直接子进程，或拥有 CAP_SYS_PTRACE 权限的进程。更安全，适合大多数系统。</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">管理员模式</td>
<td align="center">只有 root 或具备 CAP_SYS_PTRACE 的进程可以使用 ptrace。适合高安全场景。</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">完全禁用</td>
<td align="center">所有进程（包括 root）都无法使用 ptrace。彻底禁止调试行为，适合极端安全需求。</td>
</tr>
</tbody></table>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/gdb/" rel="tag"># gdb</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2024/01/23/cpp/gcc%E5%85%A5%E9%97%A8/" rel="prev" title="gcc 入门">
      <i class="fa fa-chevron-left"></i> gcc 入门
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2024/01/23/misc/GNU-Introducation/" rel="next" title="GNU Introducation">
      GNU Introducation <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-text">gdb 实现原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-vim-emacs-%E4%B8%AD%E5%90%AF%E5%8A%A8-gdb"><span class="nav-text">在 vim &#x2F; emacs 中启动 gdb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-%E5%91%BD%E4%BB%A4"><span class="nav-text">gdb 命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%AD%E7%82%B9"><span class="nav-text">断点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%96%AD%E7%82%B9"><span class="nav-text">条件断点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E6%96%AD%E7%82%B9"><span class="nav-text">观察断点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%95%E6%8D%89%E6%96%AD%E7%82%B9"><span class="nav-text">捕捉断点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E9%95%BF%E5%BA%A6%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-text">打印长度的限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#coredump"><span class="nav-text">coredump</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WSL-%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8-gdb"><span class="nav-text">WSL 无法使用 gdb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-attach-%E6%9D%83%E9%99%90%E6%8A%A5%E9%94%99"><span class="nav-text">gdb attach 权限报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-debug-forks"><span class="nav-text">gdb debug forks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Setting-Catchpoints"><span class="nav-text">Setting Catchpoints</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gdb-redirect-to-a-log-file"><span class="nav-text">gdb redirect to a log file</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E9%99%90%E5%88%B6"><span class="nav-text">权限限制</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bi-an"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">bi-an</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">48</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bi-an" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bi-an" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ah_zzg@126.com" title="E-Mail → mailto:ah_zzg@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://cuda-doc.readthedocs.io/" title="https:&#x2F;&#x2F;cuda-doc.readthedocs.io" rel="noopener" target="_blank">CUDA中文手册</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://infiniband-doc.readthedocs.io/" title="https:&#x2F;&#x2F;infiniband-doc.readthedocs.io&#x2F;" rel="noopener" target="_blank">InfiniBand中文手册</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bi-an</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
