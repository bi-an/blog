---
title: 并发调试工具
date: 2025-11-26 10:32:15
categories:
tags:
---

## 常用 C++ 并发调试工具 ThreadSanitizer (TSan)

- LLVM/Clang 提供的运行时检测工具
  - 能精准捕获 数据竞争，输出冲突内存地址、访问栈回溯和涉及线程
- Helgrind (Valgrind 工具集)
  - 专门用于检测 死锁 和 锁误用
  - 通过监视线程对共享内存的访问来发现潜在冲突
- rr (Record and Replay Debugger)
  - 可以记录程序执行过程并重放
  - 适合调试 难以复现的并发 bug，如竞态条件和原子性问题
- Clang Static Analyzer
  - 静态分析工具，在编译阶段发现潜在的并发问题
  - 可检测未加锁访问共享变量、内存序错误等
- PVS-Studio
  - 商业静态分析工具
  - 能在 CI 流程中提前发现并发安全隐患

适用场景

- 数据竞争 (Data Race) → 使用 ThreadSanitizer
- 死锁 (Deadlock) → 使用 Helgrind
- 难复现的竞态条件 → 使用 rr

编译阶段预防 → 使用 Clang Static Analyzer / PVS-Studio

这些工具往往需要结合使用：例如 TSan + Helgrind + rr 的组合拳，可以覆盖运行时检测、死锁分析和重放调试
，从而大幅提升并发问题定位效率

| 工具                       | 语言/平台            | 主要功能             | 适用场景               |
| -------------------------- | -------------------- | -------------------- | ---------------------- |
| ThreadSanitizer            | C/C++ (Clang/LLVM)   | 数据竞争检测         | 运行时发现共享变量冲突 |
| Helgrind                   | C/C++ (Valgrind)     | 死锁检测、锁误用     | 多线程同步问题         |
| rr                         | C/C++ (Linux)        | 执行记录与重放       | 难复现的竞态条件       |
| Clang Static Analyzer      | C/C++                | 静态分析并发隐患     | 编译阶段预防           |
| PVS-Studio                 | C/C++                | 商业静态分析         | CI 流程集成            |
| **Oracle Thread Analyzer** | Java (Oracle 工具链) | 线程可视化、死锁检测 | Java 并发调试          |
