<!DOCTYPE html>
<html lang="en, zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bi-an.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Unix 权限涉及三个部分：** 用户 、 进程 、 文件 **。权限分为常用权限、SELinux 权限。manpage: man 2 stat 中搜索 “mode” 可以看到几种常用权限的详情。 用户和分组用户用 user ID 区分。多个用户可以划入同一个用户分组，一个用户可以同时属于不同的分组。这就是 UID（User ID）和 GID（Group ID）。 现在我将使用我的凭据登录到 sh">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux 权限管理">
<meta property="og:url" content="https://bi-an.github.io/blog/2025/08/16/os/Linux%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="江南人物的博客">
<meta property="og:description" content="Unix 权限涉及三个部分：** 用户 、 进程 、 文件 **。权限分为常用权限、SELinux 权限。manpage: man 2 stat 中搜索 “mode” 可以看到几种常用权限的详情。 用户和分组用户用 user ID 区分。多个用户可以划入同一个用户分组，一个用户可以同时属于不同的分组。这就是 UID（User ID）和 GID（Group ID）。 现在我将使用我的凭据登录到 sh">
<meta property="og:locale">
<meta property="article:published_time" content="2025-08-16T20:37:50.000Z">
<meta property="article:modified_time" content="2025-11-28T08:00:53.610Z">
<meta property="article:author" content="bi-an">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bi-an.github.io/blog/2025/08/16/os/Linux%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en, zh_CN'
  };
</script>

  <title>Linux 权限管理 | 江南人物的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江南人物的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2025/08/16/os/Linux%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux 权限管理
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-08-16 20:37:50" itemprop="dateCreated datePublished" datetime="2025-08-16T20:37:50+00:00">2025-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-11-28 08:00:53" itemprop="dateModified" datetime="2025-11-28T08:00:53+00:00">2025-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Unix 权限涉及三个部分：** 用户 <strong>、</strong> 进程 <strong>、</strong> 文件 **。<br>权限分为常用权限、SELinux 权限。<br>manpage: <code>man 2 stat</code> 中搜索 “mode” 可以看到几种常用权限的详情。</p>
<h2 id="用户和分组"><a href="#用户和分组" class="headerlink" title="用户和分组"></a>用户和分组</h2><p>用户用 user ID 区分。多个用户可以划入同一个用户分组，一个用户可以同时属于不同的分组。这就是 UID（User ID）和 GID（Group ID）。</p>
<p>现在我将使用我的凭据登录到 shell 并运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="variable">$LOGNAME</span> /etc/passwd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>rotem: x:1000:1000:rotem,,,:&#x2F;home&#x2F;rotem:&#x2F;bin&#x2F;bash</p>
</blockquote>
<p>您可以看到我的日志名 (rotem)、均为 1000 的 UID 和 GID，以及其他详细信息，例如我登录的 shell。</p>
<h2 id="进程的用户-ID-UID"><a href="#进程的用户-ID-UID" class="headerlink" title="进程的用户 ID (UID)"></a>进程的用户 ID (UID)</h2><p>每个进程都有一个所有者，并且每个进程都属于一个组。</p>
<p>进程有 3 种 UID：<code>real user ID</code>、<code>effective user ID</code>、<code>saved user ID</code>。其中还有一个 <code>set-user-ID</code> 的概念，这个概念和 <code>effective user ID</code> 紧密关联。</p>
<h3 id="实际用户-ID-RUID-Real-User-ID-5"><a href="#实际用户-ID-RUID-Real-User-ID-5" class="headerlink" title="实际用户 ID (RUID, Real User ID) [^5]"></a>实际用户 ID (RUID, Real User ID) [^5]</h3><p>在我们的 shell 中，我们现在将运行的每个进程都将继承我的用户帐户的权限，并将使用相同的 UID 和 GID 运行。</p>
<p>当您 <code>fork</code> 一个新进程时，该进程会继承父进程的 RUID。通常父级的 RUID 是你的 shell 并且它有当前登录用户的 UID。所以新进程有当前登录用户的 UID 的 RUID。通常这不会改变，只有 root 可以改变它。</p>
<p>举个例子，想想 init 进程派生了你的登录 shell。在 fork 期间，shell 将具有 root 的 RUID（因为 shell 的父级是 init）。但是，init 进程使用 <code>/etc/passwd</code> 将 shell 的 RUID 改成你的 UID. 因此，此后登录 shell 的 RUID 将是您的 UID，而不是 root。所以，我们可以说 RUID 是进程所有者的。</p>
<p>让我们运行一个简单的命令来检查它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sleep</span> 100 &amp; ps aux | grep <span class="string">&#x27;sleep&#x27;</span></span><br><span class="line">bi-an     3741  0.0  0.0  11252   928 pts/0    S    17:00   0:00 <span class="built_in">sleep</span> 100</span><br></pre></td></tr></table></figure>

<p>然后根据 <code>ps</code> 命令打印出的 PID (3741) ，查进程 UID 和 GID：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">stat</span> -c <span class="string">&quot;%u %g&quot;</span> /proc/3741</span><br><span class="line">1000 1000</span><br></pre></td></tr></table></figure>

<p>然而，系统判断一个进程对一个文件是否有权限时，要验证的 ID 是 effective user ID，而不是 real user ID。</p>
<h3 id="有效用户-ID（EUID-Effective-User-ID）"><a href="#有效用户-ID（EUID-Effective-User-ID）" class="headerlink" title="有效用户 ID（EUID, Effective User ID）"></a>有效用户 ID（EUID, Effective User ID）</h3><p>Linux 通常都不建议用户使用 root 权限去进行一般的处理，但是普通用户在做很多很多 services 相关的操作的时候，可能需要一个特殊的权限。为 了满足这样的要求，许多 services 相关的 executable 有一个标志，这就是 <code>set-user-ID bit</code>。当这个 <code>set-user-ID bit=ON</code> 的时候，这个 executable 被用 exec 启动之后的进程的 effective user ID 就是这个 executable 的 owner id，而并非 parent process real user id。如果 <code>set-user-ID bit=OFF</code> 的时候，这个被 exec 起来的进程的 effective user ID 应该是等于进程的 user ID 的。<br>我们以 ping 命令为例。</p>
<p>使用 <code>which</code> 命令搜索二进制位置，然后运行 <code>ls -la</code>：</p>
<blockquote>
<p>-rwsr-xr-x  1 root root   64424 Mar 10  2017  ping</p>
</blockquote>
<p>可以看到文件的所有者和组是 root. 这是因为该 <code>ping</code> 命令需要打开一个套接字，而 Linux 内核 root 为此需要特权。</p>
<p>但是，如果没有 root 特权，我如何使用 <code>ping</code>？</p>
<p>注意文件权限的所有者部分中的 “<code>s</code>” 字母而不是 “<code>x</code>”。</p>
<p>这是特定二进制可执行文件（如 <code>ping</code> 和 <code>sudo</code>）的特殊权限位，称为 <code>set-user-ID</code>。</p>
<p>这是 <code>EUID</code> 和 <code>EGID</code> 发挥作用。</p>
<p>将会发生的情况是，当执行设置了 setuid 的二进制文件 <code>ping</code> 时，该进程将其有效用户 ID (<code>EUID</code>) 从默认值 <code>RUID</code> 更改为此特殊二进制可执行文件的所有者，在本例中为 root。</p>
<p>这一切都是通过这个文件有这个简单的事实来完成的 <code>set-user-ID</code>。</p>
<p>内核通过查看进程的 <code>EUID</code> 来决定该进程是否具有特权。因为现在 <code>EUID</code> 指向 root，操作不会被内核拒绝。</p>
<p>注意：在最新的 Linux 版本中，ping 命令的输出看起来会有所不同，因为它们采用了 Linux Capabilities 方法而不是这种 setuid 方法（对于不熟悉的人）请阅读 <a href="TODO">此处</a>。</p>
<h4 id="set-user-ID"><a href="#set-user-ID" class="headerlink" title="set-user-ID"></a>set-user-ID</h4><p>参考 <a target="_blank" rel="noopener" href="https://www.gnu.org/software/coreutils/manual/html_node/Directory-Setuid-and-Setgid.html">链接 1</a> 。</p>
<p>Unix 包含另一个权限位，即该权限 <code>set-user-ID</code> 位。如果为可执行文件设置了该位，那么只要所有者以外的用户执行该文件，该用户就可以访问所有者的其他任何文件，从而获得所有者的所有文件读 &#x2F; 写 &#x2F; 执行特权！</p>
<p>这会导致运行该文件的任何人或进程都可以访问系统资源，就好像他们是该文件的所有者一样。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -l testfile</span><br><span class="line"> -rw-rw-r-- 1 rotem rotem 0 Nov  8 17:12 testfile</span><br></pre></td></tr></table></figure>

<p>为文件添加 <code>set-user-ID</code> 权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo <span class="built_in">chmod</span> u+s testfile</span><br><span class="line">$ <span class="built_in">ls</span> -l testfile</span><br><span class="line"> -rwSrw-r-- 1 rotem rotem 0 Nov  8 17:12 testfile</span><br></pre></td></tr></table></figure>

<p>说明：大写 <code>S</code> 表示，有 <code>set-user-ID</code> 权限，但是没有执行权限。</p>
<h4 id="set-group-ID"><a href="#set-group-ID" class="headerlink" title="set-group-ID"></a>set-group-ID</h4><p>阅读 Manual：<code>man 2 stat</code>。</p>
<blockquote>
<p>The set-group-ID bit (S_ISGID) has several special uses.<br>For a directory, it indicates that BSD semantics is to be used for that directory: files created there inherit their group ID from the directory, not from the effective group ID of the creating process, and directories created there will also get the S_ISGID bit set.</p>
</blockquote>
<p>如果目录具有设置组 ID（S_ISGID）：</p>
<ul>
<li>其下创建的文件将从其父目录的继承组 ID，而不能从创建其的进程中继承有效组 ID；</li>
<li>其下创建的子目录将继承设置组 ID 位（S_ISGID）。</li>
</ul>
<blockquote>
<p>For a file that does not have the group execution bit (S_IXGRP) set, the set-group-ID bit indicates mandatory file&#x2F;record locking.</p>
</blockquote>
<p>如果一个文件有 “设置组 ID（set-group-ID）” 但是没有 “组执行权限（S_IXGRP）”，也就说具有如下权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">% <span class="built_in">ls</span> -l a.txt</span><br><span class="line">-rw-r-Sr-- 1 username groupname 0 Feb 23 19:34 a.txt</span><br></pre></td></tr></table></figure>

<p>那么，此时 set-group-ID 位喻示强制文件 &#x2F; 记录锁。</p>
<p>TODO：强制文件 &#x2F; 记录锁是什么？<br><a target="_blank" rel="noopener" href="https://www.kernel.org/doc/Documentation/filesystems/mandatory-locking.txt">Mandatory File Locking</a><br><a target="_blank" rel="noopener" href="https://superuser.com/questions/968565/why-remove-group-execute-for-mandatory-file-lock">Why remove group execute for mandatory file lock?</a></p>
<h4 id="粘滞位："><a href="#粘滞位：" class="headerlink" title="粘滞位："></a>粘滞位：</h4><blockquote>
<p>The sticky bit (S_ISVTX) on a directory means that a file in that directory can be renamed or deleted only by the owner of the file, by the owner of the directory, and by a privileged process.</p>
</blockquote>
<p>大写 <code>T</code> 表示，有 restricted deletion flag or sticky bit（粘滞位），但是没有执行权限，<code>t</code> 权限只对目录有效，作用是保护目录项不能被其他用户删除。目录要同时具有 <code>x</code> 和 <code>s</code> 才能保证粘滞位有效。</p>
<h3 id="保存的用户-ID-SUID-Saved-User-ID"><a href="#保存的用户-ID-SUID-Saved-User-ID" class="headerlink" title="保存的用户 ID (SUID, Saved User ID)"></a>保存的用户 ID (SUID, Saved User ID)</h3><p>为什么要设置一个 saved set-user-ID 呢？它的意义是，它相当于是一个 buffer， 在 exec 启动进程之后，它会从 effective user ID 位拷贝信息到自己。</p>
<ul>
<li>对于非 root 用户，可以在未来使用 <code>setuid()</code> 来将 effective user ID 设置成为 real user ID 和 saved set-user-ID 中的任何一个。但是非 root 用户是不允许用 <code>setuid()</code> 把 effective user ID 设置成为任何第三个 user id。</li>
<li>对于 root 来说，就没有那么大的意义了。因为 root 调用 setuid() 的时候，将会设置所有的这三个 user ID 位。所以可以综合说，这三个位的设置为为了让 unprivilege user 可以获得两种不同的 permission 而设置的。</li>
</ul>
<p>《Unix 环境高级编程》的例子是，普通用户去执行一个 tip 进程，set-user-ID bit&#x3D;ON，执行起来的时候，进程可以有 uucp (executable owner) 的权限来写 lock 文件，也有当前普通用户的权限来写数据文件。在两种文件操作之间，使用 setuid() 来切换 effective user id。但是正是因为 setuid() 的限制，该进程无法获得更多的第三种用户的权限。</p>
<p>saved set-user-ID 是无法取出来的，是 kernel 来控制的。注意 saved set-user-ID 是进程中的 id，而 set-user-ID bit 则是文件上的权限。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>用户 ID:</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">决定特权</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">EUID</td>
<td align="center">✅ 是</td>
<td align="center">内核权限检查时使用</td>
</tr>
<tr>
<td align="center">RUID</td>
<td align="center">❌ 否</td>
<td align="center">表示谁启动了进程</td>
</tr>
<tr>
<td align="center">FSUID</td>
<td align="center">⚠️ 有时</td>
<td align="center">文件访问权限相关</td>
</tr>
<tr>
<td align="center">SUID</td>
<td align="center">⚠️ 有时</td>
<td align="center">用于权限恢复</td>
</tr>
</tbody></table>
<p>组 ID:</p>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">说明</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="center">EGID</td>
<td align="center">有效组 ID</td>
<td align="center">用于权限检查</td>
</tr>
<tr>
<td align="center">RGID</td>
<td align="center">实际组 ID</td>
<td align="center">表示谁启动了进程</td>
</tr>
<tr>
<td align="center">SGID</td>
<td align="center">保存组 ID</td>
<td align="center">用于权限恢复</td>
</tr>
<tr>
<td align="center">FSGID</td>
<td align="center">文件系统组 ID</td>
<td align="center">文件访问专用</td>
</tr>
</tbody></table>
<p>以上都是讨论用户 ID，如果没有特殊说明，以上的组 ID 和用户 ID 基本是类似的，只是作用对象为组。</p>
<h2 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h2><h3 id="符号形式的权限（Symbolic-permissions）"><a href="#符号形式的权限（Symbolic-permissions）" class="headerlink" title="符号形式的权限（Symbolic permissions）"></a>符号形式的权限（Symbolic permissions）</h3><p>符号形式表示文件权限有 5 种：<code>rwxst</code>。</p>
<ul>
<li><p><code>r</code>：可读。对文件来说，意味着能执行 <code>vim</code> 查看、<code>cat</code> 等。对目录来说，意味着能执行 <code>ls</code> 查看其下的文件列表。</p>
</li>
<li><p><code>w</code>：可写。对文件来说，意味着能执行 <code>vim</code> 等工具编辑并保存。对目录来说，意味着能够创建、删除文件或新的目录。</p>
</li>
<li><p><code>x</code>：可执行（文件） &#x2F; 可搜索（目录）。对文件来说，意味着可以执行。对目录来说，意味着能够 <code>cd</code> 进入该目录。</p>
</li>
</ul>
<blockquote>
<p>《UNIX 环境高级编程》P80 中如此描述：</p>
<p>读权限允许我们读目录，获得该目录中所有文件名的列表。当一个目录是我们要访问文件的路径名的一个组成部分时，对该目录的执行权限使我们可以通过该目录（也就是搜索该目录，寻找一个特定的文件名）。</p>
</blockquote>
<blockquote>
<p><code>ls 没有可搜索权限的目录 </code> 可以看到文件列表、文件类型，但是不能看到其他信息，比如文件权限、所有者、大小、修改时间等，因为这些信息保存在 inode 中，必须先 <code>cd</code> 进入该目录，才能读取这些信息。同样，<code>ls -R</code> 不能显示没有执行权限的目录下的子目录下的文件，因为这也必须先 <code>cd</code> 该目录，然后执行 <code>ls</code> 显示子目录的文件。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -lR mydir/</span><br><span class="line"> mydir/:</span><br><span class="line"> <span class="built_in">ls</span>: cannot access <span class="string">&#x27;mydir/dir2&#x27;</span>: Permission denied</span><br><span class="line"> <span class="built_in">ls</span>: cannot access <span class="string">&#x27;mydir/file2&#x27;</span>: Permission denied</span><br><span class="line"> total 0</span><br><span class="line"> d????????? ? ? ? ?            ? dir2</span><br><span class="line"> -????????? ? ? ? ?            ? file2</span><br><span class="line"> <span class="built_in">ls</span>: cannot open directory <span class="string">&#x27;mydir/dir2&#x27;</span>: Permission denied</span><br></pre></td></tr></table></figure>

<p>给目录递归恢复权限：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">chmod</span> -R u+X mydir/</span><br><span class="line">$ <span class="built_in">ls</span> -lR mydir/</span><br><span class="line"> mydir/:</span><br><span class="line"> total 4</span><br><span class="line"> drwxrwxr-x 3 rotem rotem 4096 Nov  9 10:02 dir2</span><br><span class="line"> -rwxrw-r-- 1 rotem rotem    0 Nov  9 10:03 file2</span><br><span class="line"></span><br><span class="line"> mydir/dir2:</span><br><span class="line"> total 8</span><br><span class="line"> -rwxrw-r-- 1 rotem rotem   10 Nov  8 22:55 1.txt</span><br><span class="line"> -rwxrw-r-- 1 rotem rotem    0 Nov  8 22:55 2.txt</span><br><span class="line"> drwxrwxr-x 2 rotem rotem 4096 Nov  9 10:05 dir3</span><br><span class="line"></span><br><span class="line"> mydir/dir2/dir3:</span><br><span class="line"> total 0</span><br><span class="line"> -rwxrw-r-- 1 rotem rotem 0 Nov  9 10:05 3.txt</span><br></pre></td></tr></table></figure>

<ul>
<li><code>s</code>：即 <code>set-user-ID</code> 权限，如果可执行文件有 <code>s</code> 权限属性，那么任意进程执行该文件时，将自动获得该文件所有者相同的所有权限。如果文件没有 <code>x</code> 权限，却有 <code>s</code> 权限，那么 <code>ls -l</code> 命令将该文件显示为大写的 <code>S</code>。文件只有同时具备 <code>s</code> 权限和 <code>x</code> 权限，才有意义，因为一个文件要应用 <code>set-user-ID</code> 属性，首先要保证其可执行。</li>
</ul>
<p>例如 <code>ping</code> 文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -l /bin/ping</span><br><span class="line"> -rwsr-xr-x 1 root root 44168 May  8  2014 /bin/ping</span><br></pre></td></tr></table></figure>

<p>由于设置了 <code>s</code> 权限，所以任何文件都能以 root 用户的身份运行，也就被内核允许打开套接字。</p>
<ul>
<li><p><code>t</code>：即 <code>restricted deletion flag or sticky bit</code>，称为 “粘滞位” 或 “限制删除标记”。仅仅对目录有效，对文件无效。在一个目录上设了 <code>t</code> 权限位后，（如 <code>/home</code>，权限为 <code>1777</code>) 任何的用户都能够在这个目录下创建文档，但只能删除自己创建的文档 (root 除外)，这就对任何用户能写的目录下的用户文档 启到了保护的作用。如果目录 &#x2F; 文件没有 <code>x</code> 权限，却有 <code>s</code> 权限，则 <code>ls -l</code> 命令将目录 &#x2F; 文件显示为大写的 <code>T</code>。目录只有同时具备 <code>t</code> 权限和 <code>x</code> 权限，才有意义，因为一个目录如果本来就不允许增删目录项（<code>x</code> 权限），删除其他用户的文件更无须提了。</p>
<ul>
<li>当一个目录设置了 <code>t</code> 权限时：<ul>
<li>所有用户都可以在该目录中创建文件（如果有写权限）</li>
<li>但只能删除自己创建的文件（当然要有写权限，否则也不能创建文件）</li>
<li><code>root</code> 用户除外，始终可以删除任何文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>例如：<code>/tmp</code> 和 <code>/var/tmp</code> 目录供所有用户暂时存取文件，亦即每位用户皆拥有完整的权限进入该目录，去浏览、删除和移动文件。</p>
<h3 id="数字形式的权限（Numeric-permissions）"><a href="#数字形式的权限（Numeric-permissions）" class="headerlink" title="数字形式的权限（Numeric permissions）"></a>数字形式的权限（Numeric permissions）</h3><p>可以用 4 位八进制数（0-7）表示这些文件权限，由 4、2、1 相加得到，0 表示所有权限都没有。</p>
<p>这 4 位的含义如下：</p>
<ul>
<li>第 1 bit：4 表示 set-user-ID，2 表示 set-group-ID，1 表示 restricted deletion or sticky 属性（粘滞位）；</li>
<li>第 2 bit：表示文件所有者的权限：可读（4）、可写（2）、可执行（1）；</li>
<li>第 3 bit：表示文件所属组的权限：可读（4）、可写（2）、可执行（1）；</li>
<li>第 4 bit：表示其他用户的权限：可读（4）、可写（2）、可执行（1）。</li>
</ul>
<p>以下是 <code>chmod</code> 的 man page 的说明 [^2]：</p>
<blockquote>
<p>A numeric mode is from one to  four  octal  digits  (0-7),  derived  by adding up the bits with values 4, 2, and 1.  Omitted digits are assumed to be leading zeros.  The first digit selects the set user ID  (4)  and set group ID (2) and restricted deletion or sticky (1) attributes.  The second digit selects permissions for the user who owns the  file:  read (4),  write  (2),  and  execute  (1); the third selects permissions for other users in the file’s group, with the same values; and  the  fourth for other users not in the file’s group, with the same values.</p>
</blockquote>
<h2 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h2><h3 id="ls-命令"><a href="#ls-命令" class="headerlink" title="ls 命令"></a><code>ls</code> 命令</h3><p><code>ls -l</code> 命令用于查看文件权限。</p>
<h3 id="chmod-命令"><a href="#chmod-命令" class="headerlink" title="chmod 命令"></a><code>chmod</code> 命令</h3><p><code>chmod</code> 命令用于改变文件权限。</p>
<p>基本用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> [OPTION]... MODE[,MODE]... FILE...</span><br><span class="line"><span class="built_in">chmod</span> [OPTION]... OCTAL-MODE FILE...</span><br><span class="line"><span class="built_in">chmod</span> [OPTION]... --reference=RFILE FILE...</span><br></pre></td></tr></table></figure>

<p>** 大写 <code>X</code> 参数 ** <a target="_blank" rel="noopener" href="https://www.franzoni.eu/chmod-and-the-capital-x/">^1</a>：</p>
<p>例如 <code>chmod u+X filename</code> 或 <code>chmod u-X filename</code>。</p>
<p>在 <code>chmod</code> 的 man page 中介绍如下：</p>
<blockquote>
<p>The  letters <code>rwxXst</code> select file mode bits for the affected users: read (<code>r</code>), write (<code>w</code>), execute (or search for directories) (<code>x</code>), <strong>execute&#x2F;search only if the file is a directory or<br>  already has execute permission for some user (<code>X</code>)</strong>, set user or group ID on execution (<code>s</code>), restricted deletion flag or sticky bit (<code>t</code>) [^2].</p>
</blockquote>
<p>加黑体的话很费解，但是又十分准确，解释如下：</p>
<ol>
<li><p>对所有目录赋予执行权限，这意味着可以执行 <code>cd</code>。</p>
</li>
<li><p>对所有文件，如果原来文件的 <code>ugo</code>（user &#x2F; group &#x2F; others）任意一个原先有执行权限，那么动作与小写 <code>-x</code> 参数相同；如果原先没有，那么忽略。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<blockquote>
<p>-rw-rw-r– 1 rotem rotem 0 Nov  9 10:55 file1<br>-rw-rw-r-x 1 rotem rotem 0 Nov  9 10:56 file2</p>
</blockquote>
<p>可以看到，原来 file1 的 <code>ugo</code> 都不具备执行权限，file2 的 others 具备执行权限。</p>
<ul>
<li>对 file1 执行 <code>X</code> 动作，将无效：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> u+X file1</span><br><span class="line"><span class="built_in">ls</span> -l file1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-rw-rw-r– 1 rotem rotem 0 Nov  9 10:55 file1</p>
</blockquote>
<ul>
<li>但是对 file2 执行 <code>X</code>，能够生效：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> u+X file2</span><br><span class="line"><span class="built_in">ls</span> -l file2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-rwxrw-r-x 1 rotem rotem 0 Nov  9 10:56 file2</p>
</blockquote>
<p>题外话：<code> chmod -R u-X mydir</code> 该命令无法递归执行，因为当执行完顶层目录的权限更改之后，已经没有权限 <code>cd</code> 顶层目录了，其他执行全部被停止。</p>
</li>
</ol>
<ul>
<li>getfacl&#x2F;setfacl</li>
<li>umask</li>
</ul>
<h2 id="SELinux-权限"><a href="#SELinux-权限" class="headerlink" title="SELinux 权限"></a>SELinux 权限</h2><p>SELinux 提供更为严格的访问控制。<br>可以用 <code>ls -Z</code> 查看文件的 SELinux 权限（安全上下文）。这部分将来另用一篇博客说明。暂时可以参考文献 [^3]。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[^2]: chmod 的 man page<br>[^3]:<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/73621cc7c222">https://www.jianshu.com/p/73621cc7c222</a><br>[^4]:<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/User_identifier#Saved_user_ID">https://en.wikipedia.org/wiki/User_identifier#Saved_user_ID</a><br>[^5]:<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/32455684/difference-between-real-user-ID-effective-user-ID-and-saved-user-ID">https://stackoverflow.com/questions/32455684/difference-between-real-user-ID-effective-user-ID-and-saved-user-ID</a><br>[^6]:<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1722142">https://cloud.tencent.com/developer/article/1722142</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2025/08/16/net/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="prev" title="网络编程">
      <i class="fa fa-chevron-left"></i> 网络编程
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2025/08/16/os/%E6%96%87%E4%BB%B6IO%E4%B8%8E%E8%BF%9B%E7%A8%8B/" rel="next" title="文件IO与进程">
      文件IO与进程 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%92%8C%E5%88%86%E7%BB%84"><span class="nav-text">用户和分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%94%A8%E6%88%B7-ID-UID"><span class="nav-text">进程的用户 ID (UID)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E7%94%A8%E6%88%B7-ID-RUID-Real-User-ID-5"><span class="nav-text">实际用户 ID (RUID, Real User ID) [^5]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%89%E6%95%88%E7%94%A8%E6%88%B7-ID%EF%BC%88EUID-Effective-User-ID%EF%BC%89"><span class="nav-text">有效用户 ID（EUID, Effective User ID）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#set-user-ID"><span class="nav-text">set-user-ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#set-group-ID"><span class="nav-text">set-group-ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B2%98%E6%BB%9E%E4%BD%8D%EF%BC%9A"><span class="nav-text">粘滞位：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98%E7%9A%84%E7%94%A8%E6%88%B7-ID-SUID-Saved-User-ID"><span class="nav-text">保存的用户 ID (SUID, Saved User ID)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="nav-text">文件权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%9D%83%E9%99%90%EF%BC%88Symbolic-permissions%EF%BC%89"><span class="nav-text">符号形式的权限（Symbolic permissions）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E5%BD%A2%E5%BC%8F%E7%9A%84%E6%9D%83%E9%99%90%EF%BC%88Numeric-permissions%EF%BC%89"><span class="nav-text">数字形式的权限（Numeric permissions）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-text">相关命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ls-%E5%91%BD%E4%BB%A4"><span class="nav-text">ls 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chmod-%E5%91%BD%E4%BB%A4"><span class="nav-text">chmod 命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SELinux-%E6%9D%83%E9%99%90"><span class="nav-text">SELinux 权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-text">参考文献</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bi-an"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">bi-an</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">108</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bi-an" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bi-an" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ah_zzg@126.com" title="E-Mail → mailto:ah_zzg@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://cuda-doc.readthedocs.io/" title="https:&#x2F;&#x2F;cuda-doc.readthedocs.io" rel="noopener" target="_blank">CUDA中文手册</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://infiniband-doc.readthedocs.io/" title="https:&#x2F;&#x2F;infiniband-doc.readthedocs.io&#x2F;" rel="noopener" target="_blank">InfiniBand中文手册</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bi-an</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
