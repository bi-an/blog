<!DOCTYPE html>
<html lang="en, zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bi-an.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="æ±Ÿå—äººç‰©çš„åšå®¢">
<meta property="og:url" content="https://bi-an.github.io/blog/page/5/index.html">
<meta property="og:site_name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
<meta property="og:locale">
<meta property="article:author" content="bi-an">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bi-an.github.io/blog/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en, zh_CN'
  };
</script>

  <title>æ±Ÿå—äººç‰©çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">æ±Ÿå—äººç‰©çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-resource">

    <a href="/blog/resources/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Resource</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/09/06/linux/File-Exists/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/09/06/linux/File-Exists/" class="post-title-link" itemprop="url">File Exists</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-06 18:09:03" itemprop="dateCreated datePublished" datetime="2024-09-06T18:09:03+00:00">2024-09-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h1><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><ul>
<li><code>access</code></li>
<li><code>stat</code></li>
<li><code>inotify_node</code></li>
<li><code>opendir</code></li>
<li><code>readdir</code></li>
</ul>
<h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸ä¼šå®æ—¶åˆ·æ–°ç¼“å­˜ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚è¿™ä¼šå¯¼è‡´æ–‡ä»¶å³ä½¿å·²ç»åˆ›å»ºï¼Œ<code>access</code>æˆ–<code>stat</code>å‡½æ•°ä¾ç„¶è¿”å›â€No such fileâ€ã€‚<br>ä½†æ˜¯<code>ls</code>å¯ä»¥çœ‹åˆ°æ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸º<code>ls</code>å’Œ<code>access</code>å‡½æ•°çš„å®ç°æœºåˆ¶ä¸åŒã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>åœ¨<code>NFS</code>æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåˆ›å»ºæ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨<code>stat</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶ï¼Œ<code>stat</code>ä¼šæŠ¥å‘Šâ€œæ–‡ä»¶ä¸å­˜åœ¨â€ã€‚<br>åˆ é™¤æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨<code>stat</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶ï¼Œå‘ç°<code>stat</code>ä¾ç„¶å¯ä»¥çœ‹åˆ°è¯¥æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ”¹ç”¨<code>readdir</code>æ¥è¯»å–ç›®å½•ï¼Œå› ä¸ºç›®å½•ä¼šè¢«æ›´å¿«åœ°æ›´æ–°ç¼“å­˜ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/08/02/script/vscode-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/08/02/script/vscode-config/" class="post-title-link" itemprop="url">VSCode Configuration</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-08-02 19:13:09" itemprop="dateCreated datePublished" datetime="2024-08-02T19:13:09+00:00">2024-08-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/script/" itemprop="url" rel="index"><span itemprop="name">script</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p>åœ¨å½“å‰ä»£ç æ ¹ç›®å½•ä¸‹åˆ›å»º.vscode&#x2F;launch.jsonæ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(gdb) Launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;/a.out&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;stopAtEntry&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;miDebuggerServerAddress&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;remote host&gt;:&lt;remote port&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;environment&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;externalConsole&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;(gdb) Attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cppdbg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;attach&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="comment">// &quot;program&quot;: &quot;/path/to/executable&quot;,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/proc/self/exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MIMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;setupCommands&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Enable pretty-printing for gdb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-enable-pretty-printing&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Set Disassembly Flavor to Intel&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-gdb-set disassembly-flavor intel&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;ignoreFailures&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œâ€(gdb) Launchâ€å¯ä»¥ç”¨æ¥è¿æ¥gdbserverã€‚ç”¨gdbserverå¯åŠ¨executableï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdbserver peer_host:local_port prog [args]</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨ç‚¹å‡»â€Runâ€æŒ‰é’®ä¹‹å‰ï¼Œåœ¨VSCodeçš„Debugger Terminalå†™ä¸Šå‘½ä»¤ï¼ˆå¯ä»¥ä¸æŒ‰Enterï¼‰ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œè¯¥å‘½ä»¤ä¼šè¢«å…ˆæ‰§è¡Œã€‚</p>
<h2 id="Q-A"><a href="#Q-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h2><pre><code>1. Q: Configured debug type &#39;cppdbg&#39; is not supported.
A: Please check if the &quot;c/c++&quot; extension is installed. (ref)
2. Q: VS Code Remote-SSH: The vscode server failed to start SSH
A: https://stackoverflow.com/questions/67976875/vs-code-remote-ssh-the-vscode-server-failed-to-start-ssh
3. Q: Where does VS Code store the data for its Local History feature?
A: https://stackoverflow.com/questions/72610147/where-does-vs-code-store-the-data-for-its-local-history-feature
4. vscodeæ— æ³•è·³è½¬åˆ°å®šä¹‰
A: when &quot;C_Cpp.intelliSenseEngine&quot; is set to &quot;Tag Parser&quot;, Goto definition is working fine.
</code></pre>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/vscode-cpptools/issues/273">https://github.com/microsoft/vscode-cpptools/issues/273</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/07/08/libtirpc-Usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/07/08/libtirpc-Usage/" class="post-title-link" itemprop="url">libtirpc Usage</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-07-08 14:57:11" itemprop="dateCreated datePublished" datetime="2024-07-08T14:57:11+00:00">2024-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/i/7.3?topic=communications-using-sun-ti-rpc-develop-distributed-applications">TI-RPC</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/aix/7.1?topic=call-rpc-language">RPC language</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19683-01/816-1435/xdrproto-61652/index.html">XDR Protocol</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/i/7.3?topic=applications-using-rpcgen-compiler">PRC Compiler</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19683-01/816-1435/rpcgenpguide-21470/index.html">rpcgen</a></li>
<li><a target="_blank" rel="noopener" href="https://docs-archive.freebsd.org/44doc/psd/22.rpcgen/paper.pdf">rpcgen programming guide</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> rpcgen</span><br><span class="line">/bin/rpcgen</span><br><span class="line">$ rpcgen</span><br><span class="line">usage: rpcgen infile</span><br><span class="line">        rpcgen [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile</span><br><span class="line">        rpcgen [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]</span><br><span class="line">        rpcgen [-s nettype]* [-o outfile] [infile]</span><br><span class="line">        rpcgen [-n netid]* [-o outfile] [infile]</span><br><span class="line">options:</span><br><span class="line">-a              generate all files, including samples</span><br><span class="line">-b              backward compatibility mode (generates code <span class="keyword">for</span> SunOS 4.1)</span><br><span class="line">-c              generate XDR routines</span><br><span class="line">-C              ANSI C mode</span><br><span class="line">-Dname[=value]  define a symbol (same as <span class="comment">#define)</span></span><br><span class="line">-h              generate header file</span><br><span class="line">-i size         size at <span class="built_in">which</span> to start generating inline code</span><br><span class="line">-I              generate code <span class="keyword">for</span> inetd support <span class="keyword">in</span> server (<span class="keyword">for</span> SunOS 4.1)</span><br><span class="line">-K seconds      server exits after K seconds of inactivity</span><br><span class="line">-l              generate client side stubs</span><br><span class="line">-L              server errors will be printed to syslog</span><br><span class="line">-m              generate server side stubs</span><br><span class="line">-M              generate MT-safe code</span><br><span class="line">-n netid        generate server code that supports named netid</span><br><span class="line">-N              supports multiple arguments and call-by-value</span><br><span class="line">-o outfile      name of the output file</span><br><span class="line">-s nettype      generate server code that supports named nettype</span><br><span class="line">-Sc             generate sample client code that uses remote procedures</span><br><span class="line">-Ss             generate sample server code that defines remote procedures</span><br><span class="line">-Sm             generate makefile template </span><br><span class="line">-t              generate RPC dispatch table</span><br><span class="line">-T              generate code to support RPC dispatch tables</span><br><span class="line">-Y path         directory name to find C preprocessor (cpp)</span><br><span class="line"></span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/libc/bugs.html&gt;.</span><br></pre></td></tr></table></figure>

<p>Note:</p>
<p><code>%</code> å¯ä»¥ç”¨æ¥è½¬ä¹‰æŸè¡Œï¼Œä»»ä½•å¥é¦–å¸¦æœ‰ <code>%</code> çš„è¡Œå°†è¢«è§†ä½œå­—ç¬¦ä¸²ï¼Œç›´æ¥æ”¾å…¥åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚<br>æ³¨æ„ï¼š<code>rpcgen</code> å¯èƒ½æ”¹å˜è¯¥è¡Œçš„ä½ç½®ï¼Œæ‰€ä»¥åº”è¯¥åœ¨è¾“å‡ºæ–‡ä»¶ä¸­å¯¹è¿™äº›è¡Œè¿›è¡Œä»”ç»†æ£€æŸ¥ã€‚</p>
<p><code>rpcgen</code> provides an additional preprocessing feature: any line that begins with a percent sign (<code>%</code>) is passed directly to the output file, with no action on the lineâ€™s content. Use caution because <code>rpcgen</code> does not always place the lines where you intend. Check the output source file and, if needed, edit it.</p>
<p>ä¾‹å¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;abc.h&quot;</span><br></pre></td></tr></table></figure>

<p>å½“æ‰§è¡Œ <code>rpcgen infile</code> å‘½ä»¤æ—¶ï¼Œç”±äº â€œabc.hâ€ ä¸å­˜åœ¨ï¼Œå¯èƒ½ä¼šæŠ¥é”™ã€‚</p>
<p>ä½†æ˜¯å¦‚æœåœ¨å¥é¦–æ·»åŠ ä¸€ä¸ª <code>%</code> ç¬¦å·ï¼Œåˆ™å¯ä»¥ç»•è¿‡æ£€æŸ¥ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%#include &quot;abc.h&quot;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/05/08/english/Hair/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/08/english/Hair/" class="post-title-link" itemprop="url">Hair</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-08 22:10:46" itemprop="dateCreated datePublished" datetime="2024-05-08T22:10:46+00:00">2024-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/English/" itemprop="url" rel="index"><span itemprop="name">English</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h2><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=EzFtsYC4pPg&t=344s">Free English Class! Topic: Hair! ğŸ§”ğŸ½ğŸ’‡âœ‚ï¸ (Lesson Only)</a></p>
<h2 id="Words-Phrases"><a href="#Words-Phrases" class="headerlink" title="Words&#x2F;Phrases"></a>Words&#x2F;Phrases</h2><p>eyelashes<br>makeup<br>hairstyle&#x2F;hairdo<br>get my hair done<br>hair gel<br>buzz cut<br>helmet<br>When you have a lot of hair, the helmet makes your hair flat.<br>hair colouring</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/03/22/concurrency/Multi-Thread-and-Signals/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/03/22/concurrency/Multi-Thread-and-Signals/" class="post-title-link" itemprop="url">Multi Thread and Signals</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-03-22 15:20:14" itemprop="dateCreated datePublished" datetime="2024-03-22T15:20:14+00:00">2024-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>From ChatGPT:</p>
<p>In general, when a program enters a signal handler in a multi-threaded environment, the behavior regarding other threads depends on how the signal handler is set up and the specific signal that is being handled.</p>
<ol>
<li>Default Behavior: By default, when a signal is delivered to a process, it interrupt the thread that is currently running and executes the signal handler in the context of that thread. Other threads in the process continue running unless they are also interrupted by signals.</li>
<li>Thread-Specific Signal Handling: Some signals, such as SIGINT (interrupt signal), SIGTERM (termination signal), or SIGABRT (abort signal), are typically delivered to the entire process, which means they can interrupt any thread. However, other signals, like SIGSEGV (segmentation fault) or SIGILL (illegal signal), are usually delivered to the specific thread that caused the signal.</li>
<li>Signal Masking: In a multi-threaded program, you can use signal masking (sigprocmask in POSIX systems) to block certain signals in specific threads. This can affect whether a signal handler interrupts a particular thread or not.</li>
<li>Asynchronous-Signal-Safe Functions: Signal handlers should only execute functions are considered â€œasynchronous-signal-safeâ€ according to POSIX standards. These functions are designed to be safe to call from within a signal handler. Using non-safe functions in a signal handler can lead to undefined behavior.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/02/24/concurrency/TBB%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/02/24/concurrency/TBB%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">TBB å…¥é—¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-02-24 14:59:52" itemprop="dateCreated datePublished" datetime="2024-02-24T14:59:52+00:00">2024-02-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>ä½¿ç”¨è„šæœ¬ä¸€é”®ç›‘æŸ¥ç³»ç»Ÿæ˜¯å¦å®‰è£…äº† TBB</p>
<figure class="highlight bash"><figcaption><span>check_tbb.sh</span><a href="/blog/downloads/code/tbb/check_tbb.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;==== æ£€æŸ¥ Intel TBB (oneTBB) å®‰è£…æƒ…å†µ ====&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. åŒ…ç®¡ç†å™¨æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v dpkg &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[dpkg] æ£€æŸ¥:&quot;</span></span><br><span class="line">    dpkg -l | grep tbb || <span class="built_in">echo</span> <span class="string">&quot;  æœªæ‰¾åˆ° tbb åŒ… (Debian/Ubuntu)&quot;</span></span><br><span class="line"><span class="keyword">elif</span> <span class="built_in">command</span> -v rpm &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;[rpm] æ£€æŸ¥:&quot;</span></span><br><span class="line">    rpm -qa | grep tbb || <span class="built_in">echo</span> <span class="string">&quot;  æœªæ‰¾åˆ° tbb åŒ… (CentOS/RHEL)&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. pkg-config æ£€æŸ¥</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[pkg-config] æ£€æŸ¥:&quot;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span> -v pkg-config &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> pkg-config --exists tbb; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;  ç‰ˆæœ¬: <span class="subst">$(pkg-config --modversion tbb)</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;  CFLAGS: <span class="subst">$(pkg-config --cflags tbb)</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;  LIBS: <span class="subst">$(pkg-config --libs tbb)</span>&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;  æœªæ£€æµ‹åˆ° pkg-config ä¸­çš„ tbb&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  ç³»ç»Ÿæœªå®‰è£… pkg-config&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. æ–‡ä»¶æ£€æŸ¥</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[æ–‡ä»¶] æ£€æŸ¥:&quot;</span></span><br><span class="line">HEADER_PATH=$(find /usr/include /usr/local/include -<span class="built_in">type</span> d -name tbb 2&gt;/dev/null | <span class="built_in">head</span> -n 1)</span><br><span class="line">LIB_PATH=$(find /usr/lib /usr/local/lib /usr/lib64 -name <span class="string">&quot;libtbb.*&quot;</span> 2&gt;/dev/null | <span class="built_in">head</span> -n 1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$HEADER_PATH</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  å¤´æ–‡ä»¶ç›®å½•: <span class="variable">$HEADER_PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  æœªæ‰¾åˆ° tbb å¤´æ–‡ä»¶&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$LIB_PATH</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  åº“æ–‡ä»¶: <span class="variable">$LIB_PATH</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  æœªæ‰¾åˆ° tbb åº“æ–‡ä»¶&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. æµ‹è¯•ç¼–è¯‘</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;[ç¼–è¯‘æµ‹è¯•] å°è¯•ç¼–è¯‘ä¸€ä¸ª TBB ç¤ºä¾‹...&quot;</span></span><br><span class="line">TMP_CODE=$(<span class="built_in">mktemp</span> /tmp/test_tbb.XXXXXX.cpp)</span><br><span class="line"><span class="built_in">cat</span> &gt; <span class="variable">$TMP_CODE</span> &lt;&lt;<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line"><span class="comment">#include &lt;tbb/tbb.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line">int <span class="function"><span class="title">main</span></span>() {</span><br><span class="line">    tbb::parallel_for(0, 5, [](int i){ std::cout &lt;&lt; <span class="string">i &lt;&lt; &quot; &quot;; });</span></span><br><span class="line"><span class="string">    std::cout &lt;&lt; std::endl;</span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">}</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">g++ $TMP_CODE -o /tmp/test_tbb -ltbb -std=c++17 2&gt;/tmp/tbb_err.log</span></span><br><span class="line"><span class="string">if [ $? -eq 0 ]; then</span></span><br><span class="line"><span class="string">    echo &quot;  âœ… ç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨ TBB&quot;</span></span><br><span class="line"><span class="string">    /tmp/test_tbb</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">    echo &quot;  âŒ ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š&quot;</span></span><br><span class="line"><span class="string">    cat /tmp/tbb_err.log</span></span><br><span class="line"><span class="string">fi</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">rm -f $TMP_CODE /tmp/test_tbb /tmp/tbb_err.log</span></span><br></pre></td></tr></table></figure>

<p>ä»åŒ…ç®¡ç†å™¨å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install libtbb-dev</span><br></pre></td></tr></table></figure>

<p>ç”¨æºç å®‰è£…</p>
<p>å¦‚æœéœ€è¦æœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ä» GitHub è·å– oneTBB</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/oneapi-src/oneTBB.git</span><br><span class="line"><span class="built_in">cd</span> oneTBB</span><br><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make -j$(<span class="built_in">nproc</span>)</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<p>é»˜è®¤ä¼šå®‰è£…åˆ° &#x2F;usr&#x2F;local&#x2F;include&#x2F; å’Œ &#x2F;usr&#x2F;local&#x2F;lib&#x2F;ã€‚</p>
<h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://uxlfoundation.github.io/oneTBB/">https://uxlfoundation.github.io/oneTBB/</a></p>
<h2 id="1-TBB-è°ƒåº¦åŸç†"><a href="#1-TBB-è°ƒåº¦åŸç†" class="headerlink" title="1. TBB è°ƒåº¦åŸç†"></a>1. TBB è°ƒåº¦åŸç†</h2><h3 id="1-1-TBB-çš„ä»»åŠ¡è°ƒåº¦æ¨¡å‹"><a href="#1-1-TBB-çš„ä»»åŠ¡è°ƒåº¦æ¨¡å‹" class="headerlink" title="1.1. TBB çš„ä»»åŠ¡è°ƒåº¦æ¨¡å‹"></a>1.1. TBB çš„ä»»åŠ¡è°ƒåº¦æ¨¡å‹</h3><p>a. çº¿ç¨‹æ±  + ä»»åŠ¡é˜Ÿåˆ—</p>
<ul>
<li>TBB ä¸è®©ä½ ç›´æ¥åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œè€Œæ˜¯ç»´æŠ¤ä¸€ä¸ª å›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼ˆæ•°é‡é€šå¸¸ &#x3D; CPU æ ¸å¿ƒæ•°ï¼‰ã€‚</li>
<li>æ‰€æœ‰å¹¶è¡Œä»»åŠ¡éƒ½è¢«å°è£…æˆ taskï¼Œæ”¾å…¥ ä»»åŠ¡é˜Ÿåˆ—ã€‚</li>
<li>æ¯ä¸ªå·¥ä½œçº¿ç¨‹ä»é˜Ÿåˆ—é‡Œå–ä»»åŠ¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œå°±å–ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</li>
<li>è¿™ç§æ¨¡å¼å« å·¥ä½œçªƒå–ï¼ˆwork-stealingï¼‰è°ƒåº¦ã€‚</li>
</ul>
<p>b. å·¥ä½œçªƒå–æœºåˆ¶</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„åŒç«¯é˜Ÿåˆ—ï¼ˆdequeï¼‰ï¼Œä¼˜å…ˆä»è‡ªå·±é˜Ÿåˆ—å°¾éƒ¨å–ä»»åŠ¡æ‰§è¡Œã€‚</li>
<li>å½“çº¿ç¨‹è‡ªå·±çš„é˜Ÿåˆ—ç©ºäº†ï¼Œä¼šä»åˆ«çš„çº¿ç¨‹é˜Ÿåˆ—å¤´éƒ¨ â€œçªƒå–â€ ä»»åŠ¡ã€‚</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>åŠ¨æ€è´Ÿè½½å‡è¡¡ï¼šæ ¸å¿ƒåˆ©ç”¨ç‡é«˜</li>
<li>å‡å°‘é”ç«äº‰ï¼šçº¿ç¨‹å¤šæ“ä½œè‡ªå·±é˜Ÿåˆ—ï¼Œçªƒå–å°‘é‡è®¿é—®å…¶ä»–é˜Ÿåˆ—</li>
</ul>
<h3 id="1-2-ä¸ç›´æ¥ä½¿ç”¨-std-thread-çš„åŒºåˆ«"><a href="#1-2-ä¸ç›´æ¥ä½¿ç”¨-std-thread-çš„åŒºåˆ«" class="headerlink" title="1.2. ä¸ç›´æ¥ä½¿ç”¨ std::thread çš„åŒºåˆ«"></a>1.2. ä¸ç›´æ¥ä½¿ç”¨ std::thread çš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>std::thread</th>
<th>TBB</th>
</tr>
</thead>
<tbody><tr>
<td>** çº¿ç¨‹æ•°é‡ **</td>
<td>æ¯ä¸ªä»»åŠ¡å¯èƒ½åˆ›å»ºæ–°çº¿ç¨‹</td>
<td>çº¿ç¨‹æ± å›ºå®šçº¿ç¨‹æ•°</td>
</tr>
<tr>
<td>** è°ƒåº¦å¼€é”€ **</td>
<td>æ¯æ¬¡åˆ›å»º &#x2F; é”€æ¯çº¿ç¨‹æˆæœ¬é«˜</td>
<td>ä»»åŠ¡åˆ†é…æˆæœ¬ä½ï¼Œçº¿ç¨‹é‡ç”¨</td>
</tr>
<tr>
<td>** è´Ÿè½½å‡è¡¡ **</td>
<td>éœ€è¦æ‰‹åŠ¨ç®¡ç†ä»»åŠ¡åˆ†é…</td>
<td>è‡ªåŠ¨å·¥ä½œçªƒå–ï¼ŒåŠ¨æ€å‡è¡¡</td>
</tr>
<tr>
<td>** ç²’åº¦æ§åˆ¶ **</td>
<td>çº¿ç¨‹ç²’åº¦ç²—ï¼Œä»»åŠ¡å°ä¸èƒ½å……åˆ†åˆ©ç”¨ CPU</td>
<td>ä»»åŠ¡ç²’åº¦å¯ä»¥å°ï¼ŒTBB è‡ªåŠ¨è°ƒåº¦</td>
</tr>
<tr>
<td>** é”ç«äº‰ **</td>
<td>å…±äº«é˜Ÿåˆ— &#x2F; èµ„æºå®¹æ˜“äº§ç”Ÿå¤§é‡é”ç«äº‰</td>
<td>å·¥ä½œçªƒå–å‡å°‘é”ç«äº‰ï¼Œæ€§èƒ½æ›´é«˜</td>
</tr>
</tbody></table>
<h3 id="1-3-æ€»ç»“"><a href="#1-3-æ€»ç»“" class="headerlink" title="1.3. æ€»ç»“"></a>1.3. æ€»ç»“</h3><p>TBB é«˜æ•ˆçš„æ ¸å¿ƒåŸå› ï¼š</p>
<ul>
<li>å›ºå®šçº¿ç¨‹æ± ï¼šé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹å¸¦æ¥çš„å¼€é”€</li>
<li>ä»»åŠ¡åŒ–è®¾è®¡ï¼šç²’åº¦çµæ´»ï¼Œä»»åŠ¡æ¯”çº¿ç¨‹è½»é‡</li>
<li>å·¥ä½œçªƒå–ï¼šè‡ªåŠ¨è´Ÿè½½å‡è¡¡ï¼Œæé«˜ CPU åˆ©ç”¨ç‡</li>
<li>å‡å°‘é”ç«äº‰ï¼šæ¯ä¸ªçº¿ç¨‹å¤§éƒ¨åˆ†æ—¶é—´åªæ“ä½œè‡ªå·±çš„é˜Ÿåˆ—</li>
</ul>
<p>æ‰€ä»¥ï¼Œç”¨ TBB å†™ parallel_for æˆ– flow::graph æ—¶ï¼Œå³ä½¿ä»»åŠ¡éå¸¸å°ï¼ŒCPU æ ¸å¿ƒä¹Ÿèƒ½è¢«å……åˆ†åˆ©ç”¨ï¼Œè€Œç›´æ¥ std::thread å¾ˆå¯èƒ½çº¿ç¨‹åˆ›å»ºæˆæœ¬æ¯”ä»»åŠ¡æœ¬èº«è¿˜é«˜ï¼Œæ€§èƒ½åè€Œä¸‹é™ã€‚</p>
<h2 id="2-task-group"><a href="#2-task-group" class="headerlink" title="2. task_group"></a>2. task_group</h2><p>task_group çš„æœ¬è´¨</p>
<ul>
<li>tbb::task_group æ˜¯ä¸€ç§ è½»é‡çº§ä»»åŠ¡ç®¡ç†å™¨ï¼Œç”¨æ¥ç»„ç»‡ä¸€ç»„å¹¶è¡Œä»»åŠ¡ã€‚</li>
<li>å®ƒæœ¬èº« ä¸åˆ›å»ºçº¿ç¨‹æ± ï¼Œä¹Ÿä¸ç»´æŠ¤ç‹¬ç«‹çº¿ç¨‹ã€‚</li>
<li>å½“ä½ è°ƒç”¨ task_group.run() æˆ– task_group.wait() æ—¶ï¼š</li>
<li>ä»»åŠ¡ä¼šè¢« æäº¤åˆ°å½“å‰ä¸Šä¸‹æ–‡çš„çº¿ç¨‹æ± ï¼Œé€šå¸¸æ˜¯ å…¨å±€çº¿ç¨‹æ± </li>
<li>ç”±çº¿ç¨‹æ± ä¸­çš„å·¥ä½œçº¿ç¨‹å»è°ƒåº¦å’Œæ‰§è¡Œ</li>
</ul>
<figure class="highlight cpp"><figcaption><span>tbb_thread_pool.cpp</span><a href="/blog/downloads/code/tbb/examples/tbb_thread_pool.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/tbb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">std::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">task_group_function</span><span class="params">()</span> </span>{</span><br><span class="line">    tbb::task_group tg;</span><br><span class="line">    <span class="type">int</span> max_concurrency = tbb::this_task_arena::<span class="built_in">max_concurrency</span>();</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Task group max concurrency: &quot;</span> &lt;&lt; max_concurrency &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) {</span><br><span class="line">        tg.<span class="built_in">run</span>([i] {</span><br><span class="line">            {</span><br><span class="line">                std::lock_guard&lt;std::mutex&gt; <span class="built_in">lock</span>(mtx);</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;Task group thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; is running.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">    tg.<span class="built_in">wait</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">task_arena_function</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">tbb::task_arena <span class="title">arena</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> max_concurrency = arena.<span class="built_in">max_concurrency</span>();</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Task arena max concurrency: &quot;</span> &lt;&lt; max_concurrency &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    arena.<span class="built_in">execute</span>([max_concurrency] {</span><br><span class="line">        tbb::<span class="built_in">parallel_for</span>(<span class="number">0</span>, <span class="number">16</span>, [](<span class="type">int</span> i) {</span><br><span class="line">            {</span><br><span class="line">                std::lock_guard&lt;std::mutex&gt; <span class="built_in">lock</span>(mtx);</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;Task arena thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; is running.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// è·å–é»˜è®¤task_arenaçš„æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="type">int</span> arena_max_concurrency = tbb::this_task_arena::<span class="built_in">max_concurrency</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Default task_arena max concurrency: &quot;</span> &lt;&lt; arena_max_concurrency &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">tg_thread</span><span class="params">(task_group_function)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">ta_thread</span><span class="params">(task_arena_function)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹å®Œæˆ</span></span><br><span class="line">    tg_thread.<span class="built_in">join</span>();</span><br><span class="line">    ta_thread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>


<p>æµ‹è¯•ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build &amp;&amp; cmake .. &amp;&amp; make</span><br><span class="line">$ ./tbb_thread_pool &gt; result.txt</span><br><span class="line">$ <span class="built_in">cat</span> result.txt | grep running | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line">Task arena thread 140667163379264 is running.</span><br><span class="line">Task arena thread 140667167639104 is running.</span><br><span class="line">Task arena thread 140667184678464 is running.</span><br><span class="line">Task arena thread 140667201848896 is running.</span><br><span class="line">Task group thread 140667167639104 is running.</span><br><span class="line">Task group thread 140667171898944 is running.</span><br><span class="line">Task group thread 140667176158784 is running.</span><br><span class="line">Task group thread 140667180418624 is running.</span><br><span class="line">Task group thread 140667188938304 is running.</span><br><span class="line">Task group thread 140667210303040 is running.</span><br></pre></td></tr></table></figure>

<p>ä»è¿™ä¸¤è¡Œæ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œarena å’Œ group é‡ç”¨äº†åŒä¸€ä¸ªçº¿ç¨‹ ID ï¼Œè¯´æ˜å®ƒä»¬åŒå±äºåŒä¸€ä¸ªå…¨å±€çº¿ç¨‹æ± ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Task arena thread 140667167639104 is running.</span><br><span class="line">Task group thread 140667167639104 is running.</span><br></pre></td></tr></table></figure>

<p>è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å‘ç°å…¨å±€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ€»æ•°æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚æœ¬ä¾‹å°±æ˜¯ <code>10</code> ä¸ªï¼Œæ—¢ä¸æ˜¯ <code>task_group</code> çš„ <code>8</code> ä¸ªï¼Œ<br>ä¹Ÿä¸æ˜¯ <code>task_arena</code> çš„ <code>4</code> ä¸ªï¼š</p>
<p>TODO</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> result.txt | grep running | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l</span><br><span class="line">10</span><br></pre></td></tr></table></figure>

<h2 id="3-task-arena"><a href="#3-task-arena" class="headerlink" title="3. task_arena"></a>3. task_arena</h2><p>TBB æ˜¯åŸºäºä»»åŠ¡ï¼Œä¸æ˜¯åŸºäºçº¿ç¨‹ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³ä¿®æ”¹ TBB çš„çº¿ç¨‹æ•°ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ <code>TBB_NUM_THREADS</code> è¿›è¡Œå…¨å±€è®¾ç½®ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TBB_NUM_THREADS=4</span><br></pre></td></tr></table></figure>

<p>TODO: It doesnâ€™t seem to work!</p>
<ul>
<li>æ–¹æ³•äºŒï¼šä½¿ç”¨ <code>tbb::task_arena</code> or <code>tbb::task_scheduler_init</code> (Deprecated) è¿›è¡Œçº¿ç¨‹éš”ç¦»ã€‚</li>
</ul>
<p>TBB will use this setting locally within the scope of the <code>tbb::task_arena</code>.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/pipeline.h&gt;</span></span></span><br><span class="line"><span class="comment">// Deprecated:</span></span><br><span class="line"><span class="comment">// #include &lt;tbb/task_scheduler_init.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/task_arena.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define your pipeline body</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPipeline</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(tbb::flow_control&amp; fc)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Your pipeline logic here</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// Inform the pipeline that there is no more data</span></span><br><span class="line">        fc.<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Deprecated: tbb::task_scheduler_init init(1);</span></span><br><span class="line">    <span class="function">tbb::task_arena <span class="title">arena</span><span class="params">(<span class="number">4</span>)</span></span>; <span class="comment">// 4 threads</span></span><br><span class="line">    <span class="comment">// Do some tasks:</span></span><br><span class="line">    tbb::<span class="built_in">parallel_pipeline</span>(<span class="comment">/* max_number_of_live_tokens */</span> <span class="number">4</span>, MyPipeline); <span class="comment">// <span class="doctag">FIXME:</span> ä¼¼ä¹éœ€è¦æ”¾å…¥ arena çš„ execute å‡½æ•°ä¸­</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>task_arena é»˜è®¤ ä¸ä¼šå»çªƒå–å…¨å±€çº¿ç¨‹æ± çš„çº¿ç¨‹</p>
<ol>
<li>task_arena çš„çº¿ç¨‹éš”ç¦»</li>
</ol>
<p>tbb::task_arena æ˜¯ å±€éƒ¨çº¿ç¨‹æ± çš„æŠ½è±¡ï¼Œå¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°é‡å’Œä¼˜å…ˆçº§ã€‚</p>
<p>åœ¨ arena.execute(â€¦) é‡Œæ‰§è¡Œçš„ä»»åŠ¡ï¼š</p>
<p>ä¼˜å…ˆä½¿ç”¨ task_arena è‡ªå·±çš„çº¿ç¨‹ï¼ˆå¦‚æœ arena é‡Œæœ‰ç©ºé—²çº¿ç¨‹ï¼‰</p>
<p>ä¸ä¼šå»çªƒå–å…¨å±€çº¿ç¨‹æ± çš„çº¿ç¨‹</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œtask_arena å†…çš„ä»»åŠ¡å’Œå…¨å±€çº¿ç¨‹æ± æ˜¯ç›¸å¯¹éš”ç¦»çš„ã€‚</p>
<ol start="2">
<li>åµŒå¥—å¹¶è¡Œå’Œç©ºé—²çº¿ç¨‹åˆ©ç”¨</li>
</ol>
<p>å¦‚æœ task_arena å†…çš„çº¿ç¨‹ç©ºé—²ä¸è¶³ï¼Œé»˜è®¤ä¸ä¼šå»å…¨å±€çº¿ç¨‹æ± çªƒå–çº¿ç¨‹ã€‚</p>
<p>ä½†æ˜¯ TBB å†…éƒ¨å¯èƒ½ä¼šå°†ä¸€äº›æœªä½¿ç”¨çš„çº¿ç¨‹è°ƒåº¦ç»™ arenaï¼Œä½†è¿™å±äºå†…éƒ¨ä¼˜åŒ–ï¼Œä¸ç­‰åŒäºç›´æ¥çªƒå–æ•´ä¸ªå…¨å±€çº¿ç¨‹æ± ã€‚</p>
<p>æ€»ä½“åŸåˆ™ï¼šarena æ§åˆ¶è‡ªå·±çš„çº¿ç¨‹æ•°ï¼Œä¸å½±å“å…¨å±€çº¿ç¨‹æ± ã€‚</p>
<ol start="3">
<li>å…¨å±€çº¿ç¨‹æ±  vs task_arena æ€»ç»“</li>
</ol>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å…¨å±€çº¿ç¨‹æ± </th>
<th>task_arena</th>
</tr>
</thead>
<tbody><tr>
<td>çº¿ç¨‹æ± æ•°é‡</td>
<td>é»˜è®¤ä¸€ä¸ª</td>
<td>æ¯ä¸ª arena ç‹¬ç«‹ï¼Œå¯è‡ªå®šä¹‰çº¿ç¨‹æ•°</td>
</tr>
<tr>
<td>çªƒå–è¡Œä¸º</td>
<td>å·¥ä½œçªƒå–æœºåˆ¶ï¼ˆçº¿ç¨‹ä¹‹é—´äº’çªƒï¼‰</td>
<td>é»˜è®¤åªåœ¨ arena å†…çªƒå–ï¼Œä¸çªƒå–å…¨å±€</td>
</tr>
<tr>
<td>åµŒå¥—å¹¶è¡Œ</td>
<td>åµŒå¥—ä»»åŠ¡å¤ç”¨å…¨å±€çº¿ç¨‹</td>
<td>åµŒå¥—ä»»åŠ¡å¤ç”¨ arena çº¿ç¨‹</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å¤§å¤šæ•°å¹¶è¡Œè°ƒç”¨</td>
<td>å±€éƒ¨æ§åˆ¶çº¿ç¨‹æ•°ã€é¿å…ä¸å…¨å±€ä»»åŠ¡ç«äº‰</td>
</tr>
</tbody></table>
<ol start="4">
<li>å°ç»“</li>
</ol>
<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå…¨å±€çº¿ç¨‹æ± æ˜¯å”¯ä¸€çš„ï¼ŒTBB æ‰€æœ‰æ™®é€šå¹¶è¡Œè°ƒç”¨éƒ½ä¼šå¤ç”¨å®ƒã€‚</li>
<li>task_arena æä¾›å±€éƒ¨çº¿ç¨‹æ± ï¼Œåœ¨å…¶ä½œç”¨åŸŸå†…æ‰§è¡Œçš„ä»»åŠ¡ä¸»è¦ä½¿ç”¨ arena çš„çº¿ç¨‹ï¼Œä¸å»æŠ¢å…¨å±€çº¿ç¨‹æ± ã€‚</li>
<li>ç”¨ task_arena å¯ä»¥åšå±€éƒ¨é™åˆ¶ï¼ˆæ¯”å¦‚ GUI çº¿ç¨‹æˆ–é™åˆ¶ CPU æ ¸å¿ƒå ç”¨ï¼‰ï¼Œå¯¹å…¨å±€çº¿ç¨‹æ± å½±å“å¾ˆå°ã€‚</li>
</ul>
<h2 id="4-parallel-for"><a href="#4-parallel-for" class="headerlink" title="4. parallel_for"></a>4. <code>parallel_for</code></h2><p>API: <a target="_blank" rel="noopener" href="https://oneapi-spec.uxlfoundation.org/specifications/oneapi/latest/elements/onetbb/source/algorithms/functions/parallel_for_func">parallel_for</a></p>
<ol>
<li>ç”¨ <code>my_parallel_for</code> æ¨¡æ‹Ÿ <code>parallel_for</code> çš„å®ç°ï¼š</li>
</ol>


<ol start="2">
<li>å‘å‡ºä»»åŠ¡çš„çº¿ç¨‹ä¹Ÿä¼šæˆä¸ºå·¥ä½œçº¿ç¨‹ä¹‹ä¸€ï¼Œå¹¶å‚ä¸ä»»åŠ¡çš„æ‰§è¡Œï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>


<p>æµ‹è¯•ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./test_parallel_for</span><br><span class="line">Main thread ID: 140220582070080</span><br><span class="line">Processing data: 2 on thread 140220582070080</span><br><span class="line">Processing data: 6 on thread 140220557755968</span><br><span class="line">Processing data: 4 on thread 140220574795328</span><br><span class="line">Processing data: 8 on thread 140220566275648</span><br><span class="line">Processing data: 10 on thread 140220562015808</span><br></pre></td></tr></table></figure>

<p>å¯è§ï¼Œ<code>data 2</code> æ˜¯ç”±ä¸»çº¿ç¨‹å¤„ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>parallel_for</code> è™½ç„¶è¢«ç§°ä¸º a blocking parallel construtï¼Œä½†çº¿ç¨‹ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®ŒæˆæœŸé—´æ˜¯éé˜»å¡çš„ï¼Œå®ƒè¿˜å¯ä»¥å……å½“å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ± ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>ä»£ç æ¨¡æ‹Ÿ <code>parallel_for</code> çš„ <code>wait</code> ï¼š</p>




<h2 id="5-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰"><a href="#5-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰" class="headerlink" title="5. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰"></a>5. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰</h2><p><a target="_blank" rel="noopener" href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/The_Task_Scheduler.html">The Task Scheduler</a></p>
<h3 id="5-1-åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based-Programmingï¼‰"><a href="#5-1-åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based-Programmingï¼‰" class="headerlink" title="5.1. åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based Programmingï¼‰"></a>5.1. åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based Programmingï¼‰</h3><p>å½“è¿½æ±‚æ€§èƒ½æ—¶ï¼Œæ¨èä»¥é€»è¾‘ä»»åŠ¡ï¼ˆlogical tasksï¼‰è€Œä¸æ˜¯çº¿ç¨‹ï¼ˆthreadsï¼‰æ¥ç¼–ç¨‹ï¼Œæœ‰ä»¥ä¸‹åŸå› ï¼š</p>
<ul>
<li>å°†å¹¶è¡Œæ€§ä¸å¯ç”¨èµ„æºåŒ¹é…</li>
<li>æ›´å¿«çš„ä»»åŠ¡å¯åŠ¨å’Œå…³é—­</li>
<li>æ›´æœ‰æ•ˆçš„è¯„ä¼°é¡ºåº</li>
<li>æ”¹è¿›è´Ÿè½½å‡è¡¡</li>
<li>æ›´é«˜å±‚çš„æ€è€ƒ</li>
</ul>
<p>TODO</p>
<h3 id="5-2-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰å¦‚ä½•å·¥ä½œ"><a href="#5-2-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰å¦‚ä½•å·¥ä½œ" class="headerlink" title="5.2. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰å¦‚ä½•å·¥ä½œ"></a>5.2. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰å¦‚ä½•å·¥ä½œ</h3><p><a target="_blank" rel="noopener" href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/How_Task_Scheduler_Works.html">How Task Scheduler Works</a></p>
<h4 id="5-2-1-æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰"><a href="#5-2-1-æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰" class="headerlink" title="5.2.1. æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰"></a>5.2.1. æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰</h4><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„åŒç«¯é˜Ÿåˆ—ï¼Œå¤´éƒ¨ç§°ä¸º top ï¼ˆä¹Ÿç§°é¡¶éƒ¨ï¼‰ï¼Œå°¾éƒ¨ç§°ä¸º bottom ï¼ˆä¹Ÿç§°åº•éƒ¨ï¼‰ã€‚<br>é˜Ÿåˆ—çš„åº•éƒ¨æ˜¯é˜Ÿåˆ—çš„æœ€æ·±å¤„ï¼ˆæœ€æœ«å¤„ï¼‰ï¼Œåº•éƒ¨ä»»åŠ¡æ˜¯æœ€æ–°çš„ï¼Œé¡¶éƒ¨ä»»åŠ¡æ˜¯æœ€æ—§çš„ã€‚</p>
<p>æ·±åº¦ä¼˜å…ˆæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ul>
<li><code>çƒ­ç‚¹ç¼“å­˜å‘½ä¸­</code>ï¼šæœ€æ–°çš„ä»»åŠ¡çš„ç¼“å­˜æ˜¯æœ€çƒ­çš„ï¼Œæ‰€ä»¥ä¼˜å…ˆæ‰§è¡Œæ–°ä»»åŠ¡ã€‚</li>
<li><code>æœ€å°åŒ–ç©ºé—´</code>ï¼šå¹¿åº¦ä¼˜å…ˆä¼šåŒæ—¶åˆ›å»ºæŒ‡æ•°çº§æ•°é‡çš„å…±å­˜èŠ‚ç‚¹ï¼Œè€Œæ·±åº¦ä¼˜å…ˆè™½ç„¶ä¹Ÿä¼šåˆ›å»ºç›¸åŒæ•°é‡çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯åªæœ‰çº¿æ€§æ•°ç›®çš„èŠ‚ç‚¹ä¼šåŒæ—¶å…±å­˜ï¼Œå› ä¸ºå®ƒåˆ›å»ºäº†å…¶ä»–å°±ç»ªä»»åŠ¡çš„æ ˆã€‚</li>
</ul>
<p>ç”Ÿäº§ï¼šå½“çº¿ç¨‹äº§ç”Ÿä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå°†å…¶æ”¾ç½®åˆ°çº¿ç¨‹è‡ªèº«æ‰€æœ‰çš„ deque çš„å°¾éƒ¨ã€‚</p>
<p>æ¶ˆè´¹ï¼šå½“çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œæ ¹æ®ä»¥ä¸‹è§„åˆ™é¡ºåºé€‰å–ä¸€ä¸ªä»»åŠ¡ï¼š</p>
<ul>
<li>è§„åˆ™ 1ï¼šè·å–ä¸Šä¸€ä¸ªä»»åŠ¡è¿”å›çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼›</li>
<li>è§„åˆ™ 2ï¼šä»çº¿ç¨‹è‡ªå·±æ‰€æœ‰çš„ deque å°¾éƒ¨é€‰å–ä¸€ä¸ªä»»åŠ¡ï¼ˆå³æ·±åº¦ä¼˜å…ˆï¼‰ï¼Œå¦‚æœæœ‰ï¼›</li>
<li>è§„åˆ™ 3ï¼šéšæœºé€‰æ‹©ä¸€ä¸ªå…¶ä»–çº¿ç¨‹çš„ deque ï¼Œä»å…¶å¤´éƒ¨çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼ˆå³å¹¿åº¦ä¼˜å…ˆï¼‰ã€‚å¦‚æœè¢«é€‰ deque ä¸ºç©ºï¼Œåˆ™é‡å¤æœ¬æ¡è§„åˆ™ç›´è‡³æˆåŠŸã€‚</li>
</ul>
<p>è§„åˆ™ 1 è¢«ç§°ä¸º â€œä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰â€ã€‚</p>
<p>è§„åˆ™ 2 æ˜¯æ·±åº¦ä¼˜å…ˆï¼Œè¿™ä½¿å¾—å½“å‰çº¿ç¨‹å¾—ä»¥ä¸æ–­æ‰§è¡Œæœ€æ–°çš„ä»»åŠ¡ç›´è‡³å…¶å®Œæˆæ‰€æœ‰å·¥ä½œã€‚</p>
<p>è§„åˆ™ 3 æ˜¯ä¸´æ—¶çš„å¹¿åº¦ä¼˜å…ˆï¼Œå®ƒå°†æ½œåœ¨çš„å¹¶è¡Œè½¬åŒ–ä¸ºå®é™…çš„å¹¶è¡Œã€‚</p>
<h4 id="5-2-2-ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask-Scheduler-Bypassï¼‰æŠ€æœ¯"><a href="#5-2-2-ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask-Scheduler-Bypassï¼‰æŠ€æœ¯" class="headerlink" title="5.2.2. ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰æŠ€æœ¯"></a>5.2.2. ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰æŠ€æœ¯</h4><p>ä¸€ä¸ªä»»åŠ¡ä»äº§ç”Ÿåˆ°è¢«æ‰§è¡Œæ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š</p>
<blockquote>
<ul>
<li>å°†æ–°ä»»åŠ¡åŠ å…¥çº¿ç¨‹çš„ deque ã€‚</li>
<li>æ‰§è¡Œå½“å‰ä»»åŠ¡ç›´è‡³å®Œæˆã€‚</li>
<li>ä»çº¿ç¨‹ deque è·å–ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œé™¤éè¯¥ä»»åŠ¡è¢«å…¶ä»–çº¿ç¨‹çªƒå–èµ°äº†ã€‚</li>
</ul>
</blockquote>
<p>å…¶ä¸­ï¼Œæ­¥éª¤ 1 å’Œ æ­¥éª¤ 3 ä¼šå¼•å…¥ä¸å¿…è¦çš„ deque æ“ä½œï¼Œç”šè‡³æ›´ç³Ÿçš„æ˜¯ï¼Œå…è®¸çªƒå–ä¼šæŸå®³å±€éƒ¨æ€§è€Œä¸ä¼šå¢åŠ æ˜¾è‘—çš„å¹¶è¡Œæ€§ã€‚<br>ä»»åŠ¡è°ƒåº¦å™¨ç»•è¡ŒæŠ€æœ¯å¯ä»¥ç›´æ¥æŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ç”Ÿäº§è¯¥ä»»åŠ¡ï¼Œä»è€Œé¿å…äº†ä¸Šè¿°é—®é¢˜ã€‚<br>å› ä¸ºæ ¹æ® â€œè§„åˆ™ 1â€ï¼Œä¸Šä¸€ä¸ªä»»åŠ¡äº§ç”Ÿçš„æ–°ä»»åŠ¡ä¼šç§°ä¸ºç¬¬ä¸€ä¸ªå¤‡é€‰ä»»åŠ¡ã€‚<br>æ­¤å¤–ï¼Œè¯¥æŠ€æœ¯å‡ ä¹ä¿è¯äº†è¯¥æ–°ä»»åŠ¡è¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œè€Œä¸æ˜¯å…¶ä»–çº¿ç¨‹ã€‚</p>
<p>æ³¨æ„ï¼šå½“å‰å”¯ä¸€èƒ½ä½¿ç”¨è¯¥ä¼˜åŒ–æŠ€æœ¯çš„æ˜¯ä½¿ç”¨ <code>tbb::task_group</code> ã€‚</p>
<h3 id="5-3-æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding-Task-Scheduler-Executionï¼‰"><a href="#5-3-æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding-Task-Scheduler-Executionï¼‰" class="headerlink" title="5.3. æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding Task Scheduler Executionï¼‰"></a>5.3. æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding Task Scheduler Executionï¼‰</h3><p><a target="_blank" rel="noopener" href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/Guiding_Task_Scheduler_Execution.html">Guiding Task Scheduler Execution</a></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¼šå°è¯•ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„è®¡ç®—èµ„æºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†ä»»åŠ¡è®¡åˆ’ç¨‹åºé…ç½®ä¸ºä»…ä½¿ç”¨å…¶ä¸­çš„ä¸€äº›èµ„æºã€‚</p>
<p>æ³¨æ„ï¼šæŒ‡å¯¼ä»»åŠ¡è°ƒåº¦ç¨‹åºçš„æ‰§è¡Œå¯èƒ½ä¼šå¯¼è‡´å¯ç»„åˆæ€§é—®é¢˜ã€‚</p>
<p>TBB æä¾› <code>task_arena</code> æ¥å£ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æŒ‡å¯¼ä»»åŠ¡åœ¨ arena ï¼ˆç«æŠ€åœºï¼‰å†…è¢«æ‰§è¡Œ:</p>
<ul>
<li>è®¾ç½®é¦–é€‰è®¡ç®—å•å…ƒï¼›</li>
<li>é™åˆ¶éƒ¨åˆ†è®¡ç®—å•å…ƒã€‚</li>
</ul>
<h3 id="5-4-å·¥ä½œéš”ç¦»ï¼ˆWork-Isolationï¼‰"><a href="#5-4-å·¥ä½œéš”ç¦»ï¼ˆWork-Isolationï¼‰" class="headerlink" title="5.4. å·¥ä½œéš”ç¦»ï¼ˆWork Isolationï¼‰"></a>5.4. å·¥ä½œéš”ç¦»ï¼ˆWork Isolationï¼‰</h3><p><a target="_blank" rel="noopener" href="https://www.intel.com/content/www/us/en/docs/onetbb/developer-guide-api-reference/2021-12/work-isolation.html">Work Isolation</a></p>


<p>å¦‚æœå½“å‰çº¿ç¨‹è¢« <code>parallel_for</code> â€œé˜»å¡â€ï¼ˆä¸æ˜¯çœŸæ­£çš„é˜»å¡ï¼Œåªèƒ½ç§°ä¸º a blocking parallel constructï¼‰ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹è¢«å…è®¸æ‹¿å–ç¬¬ä¸€ä¸ªå¾ªç¯çš„ä»»åŠ¡æ¥æ‰§è¡Œã€‚è¿™ä¼šå¯¼è‡´å³ä½¿æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Œä¹Ÿå¯å‡ºç°ä¹±åºæ‰§è¡Œçš„æƒ…å†µã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå±å®³ã€‚</p>
<p>ä½†æ˜¯å°‘æ•°æƒ…å†µå¯èƒ½å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚ä¸€ä¸ª thread-local å˜é‡å¯èƒ½ä¼šåœ¨åµŒå¥—å¹¶è¡Œæ„é€ ä¹‹å¤–æ„å¤–è¢«æ›´æ”¹ï¼š</p>


<p>åœ¨å…¶å®ƒåœºæ™¯ä¸‹ï¼Œè¿™ç§è¡Œä¸ºå¯èƒ½ä¼šå¯¼è‡´æ­»é”æˆ–å…¶ä»–é—®é¢˜ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦æ›´æœ‰åŠ›åœ°ä¿è¯çº¿ç¨‹å†…çš„æ‰§è¡Œæ¬¡åºã€‚ä¸ºæ­¤ï¼ŒTBB æä¾›äº†ä¸€äº›éš”ç¦»å¹¶è¡Œæ„é€ çš„æ‰§è¡Œçš„æ–¹æ³•ï¼Œä»¥ä½¿å…¶ä»»åŠ¡ä¸ä¼šå¹²æ‰°å…¶ä»–åŒæ—¶è¿è¡Œçš„ä»»åŠ¡ã€‚</p>
<p>å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯åœ¨å•ç‹¬çš„ <code>task_arena</code> ä¸­æ‰§è¡Œå†…å±‚å¾ªç¯ï¼š</p>


<p>ç„¶è€Œï¼Œä½¿ç”¨å•ç‹¬çš„ arena è¿›è¡Œå·¥ä½œéš”ç¦»å¹¶ä¸æ€»æ˜¯æ–¹ä¾¿çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šäº§ç”Ÿæ˜æ˜¾çš„å¼€é”€ã€‚ä¸ºäº†è§£å†³è¿™äº›ç¼ºç‚¹ï¼ŒTBB æä¾› <code>this_task_arena::isolate</code> å‡½æ•°ï¼Œé€šè¿‡é™åˆ¶è°ƒç”¨çº¿ç¨‹ä»…å¤„ç†åœ¨å‡½æ•°å¯¹è±¡èŒƒå›´å†…ï¼ˆä¹Ÿç§°ä¸ºéš”ç¦»åŒºåŸŸï¼‰å®‰æ’çš„ä»»åŠ¡ï¼Œæ¥éš”ç¦»åœ°è¿è¡Œä¸€ä¸ªç”¨æˆ·æä¾›çš„å‡½æ•°å¯¹è±¡ã€‚</p>
<p>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸€ä¸ªä»»åŠ¡ç­‰å¾…è°ƒç”¨æˆ–ï¼ˆç­‰å¾…ï¼‰åœ¨ä¸€ä¸ªéš”ç¦»åŒºåŸŸå†…çš„é˜»å¡å¹¶è¡Œç»“æ„æ—¶ï¼Œè¯¥çº¿ç¨‹åªèƒ½æ‰§è¡Œåœ¨è¯¥éš”ç¦»åŒºåŸŸå†…ç”Ÿæˆçš„ä»»åŠ¡åŠå…¶ç”±å…¶ä»–çº¿ç¨‹ç”Ÿæˆçš„å­ä»»åŠ¡ï¼ˆæ¢å¥è¯è¯´ï¼Œå³ä½¿å­ä»»åŠ¡æ˜¯ç”±å…¶ä»–çº¿ç¨‹ç”Ÿæˆçš„ï¼Œåªè¦å±äºå½“å‰éš”ç¦»åŒºåŸŸï¼Œå½“å‰çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼‰ã€‚çº¿ç¨‹è¢«ç¦æ­¢æ‰§è¡Œä»»ä½•å¤–å±‚ä»»åŠ¡æˆ–å±äºå…¶ä»–éš”ç¦»åŒºåŸŸçš„ä»»åŠ¡ã€‚</p>
<p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº† <code>this_task_arena::isolate</code> çš„ä½¿ç”¨ï¼Œä»¥ä¿è¯åœ¨åµŒå¥—çš„å¹¶è¡Œç»“æ„è°ƒç”¨æ—¶ï¼Œ thread-local å˜é‡ä¸ä¼šè¢«æ„å¤–ä¿®æ”¹ï¼š</p>


<p>** è¡¥å……ï¼š** è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜éš”ç¦»åŒºåŸŸå†…å…¶ä»–çº¿ç¨‹å¦‚ä½•ç”Ÿæˆå­ä»»åŠ¡ï¼Œå¹¶ä¸”è¿™äº›å­ä»»åŠ¡å¯ä»¥ç”±å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéš”ç¦»åŒºåŸŸï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼šçº¿ç¨‹ A å’Œçº¿ç¨‹ Bã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªéš”ç¦»åŒºåŸŸå†…ç”Ÿæˆäº†ä¸€äº›ä»»åŠ¡ï¼Œå¹¶ä¸”è¿™äº›ä»»åŠ¡å¯èƒ½ä¼šç”Ÿæˆå­ä»»åŠ¡ã€‚</p>


<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p>
<p>taskA å’Œ taskB æ˜¯åœ¨éš”ç¦»åŒºåŸŸå†…ç”Ÿæˆçš„ä»»åŠ¡ã€‚<br>taskA ç”Ÿæˆäº†ä¸¤ä¸ªå­ä»»åŠ¡ Subtask A1 å’Œ Subtask A2ã€‚<br>taskB ç”Ÿæˆäº†ä¸¤ä¸ªå­ä»»åŠ¡ Subtask B1 å’Œ Subtask B2ã€‚<br>å‡è®¾çº¿ç¨‹ A æ‰§è¡Œäº† taskAï¼Œçº¿ç¨‹ B æ‰§è¡Œäº† taskBã€‚åœ¨éš”ç¦»åŒºåŸŸå†…ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B å¯ä»¥æ‰§è¡Œå½¼æ­¤ç”Ÿæˆçš„å­ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ A å¯ä»¥æ‰§è¡Œ Subtask B1 æˆ– Subtask B2ï¼Œè€Œçº¿ç¨‹ B å¯ä»¥æ‰§è¡Œ Subtask A1 æˆ– Subtask A2ï¼Œåªè¦è¿™äº›å­ä»»åŠ¡å±äºåŒä¸€ä¸ªéš”ç¦»åŒºåŸŸã€‚</p>
<h2 id="6-TBB-çš„æ— é”è®¾è®¡"><a href="#6-TBB-çš„æ— é”è®¾è®¡" class="headerlink" title="6. TBB çš„æ— é”è®¾è®¡"></a>6. TBB çš„æ— é”è®¾è®¡</h2><p>ä¸¥æ ¼æ¥è¯´ï¼ŒTBB å¹¶ä¸æ˜¯å®Œå…¨æ— é”ï¼Œä½†å®ƒå°½é‡é‡‡ç”¨ æ— é”ï¼ˆlock-freeï¼‰è®¾è®¡ æ¥æé«˜æ€§èƒ½ã€‚ä¸‹é¢è¯¦ç»†è¯´æ˜ï¼š</p>
<p>a. æ— é”è®¾è®¡çš„éƒ¨åˆ†</p>
<ul>
<li><p>å·¥ä½œçªƒå–åŒç«¯é˜Ÿåˆ—ï¼ˆdequeï¼‰</p>
<ul>
<li>çº¿ç¨‹è‡ªå·±çš„å°¾éƒ¨æ“ä½œï¼ˆpush&#x2F;popï¼‰é€šå¸¸æ˜¯ æ— é”</li>
<li>çªƒå–çº¿ç¨‹ä»å¤´éƒ¨ steal ä»»åŠ¡ä½¿ç”¨ åŸå­ CASï¼ˆCompare-And-Swapï¼‰ï¼Œä¹Ÿæ˜¯æ— é”æ“ä½œ</li>
</ul>
</li>
<li><p>å¹¶è¡Œç®—æ³•ï¼ˆparallel_for, parallel_reduceï¼‰</p>
<ul>
<li>å†…éƒ¨ä»»åŠ¡è°ƒåº¦å’Œåˆ†å‰²é€šå¸¸ç”¨æ— é”é˜Ÿåˆ— + åŸå­æ“ä½œ</li>
</ul>
</li>
<li><p>è½»é‡çº§ä»»åŠ¡å¯¹è±¡ï¼ˆtaskï¼‰å¼•ç”¨è®¡æ•°</p>
<ul>
<li>ä½¿ç”¨åŸå­æ“ä½œç»´æŠ¤ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼Œä¸ä¾èµ–äº’æ–¥é”</li>
</ul>
</li>
</ul>
<p>æ€»ç»“ï¼šTBB åœ¨ä»»åŠ¡è°ƒåº¦å’Œå·¥ä½œçªƒå–ä¸Šï¼Œå°½é‡ç”¨æ— é”å’ŒåŸå­æ“ä½œï¼Œä¿è¯é«˜æ€§èƒ½å¹¶å‘æ‰§è¡Œã€‚</p>
<p>b. ä»ç„¶å­˜åœ¨é”çš„åœºæ™¯</p>
<ul>
<li><p>é˜Ÿåˆ—æ‰©å®¹ï¼ˆgrowï¼‰</p>
<ul>
<li>å½“çº¿ç¨‹é˜Ÿåˆ—æ»¡ï¼Œéœ€è¦æ‰©å®¹åº•å±‚æ•°ç»„æ—¶ä¼šä½¿ç”¨è½»é‡é”ä¿æŠ¤</li>
</ul>
</li>
<li><p>æŸäº›å¹¶è¡Œå®¹å™¨</p>
<ul>
<li>concurrent_hash_map, concurrent_vector ç­‰åœ¨å¤„ç†æç«¯å¹¶å‘æƒ…å†µæ—¶ä¼šä½¿ç”¨é”ï¼ˆæœ‰æ—¶æ˜¯è¯»å†™é”ï¼‰</li>
</ul>
</li>
<li><p>å…¨å±€ç®¡ç†æˆ– arena åˆå§‹åŒ–</p>
<ul>
<li>åˆå§‹åŒ–çº¿ç¨‹æ± ã€ä»»åŠ¡è°ƒåº¦å™¨æ—¶å¯èƒ½ä½¿ç”¨é”ï¼Œé€šå¸¸åªåœ¨å¯åŠ¨é˜¶æ®µå‘ç”Ÿ</li>
</ul>
</li>
</ul>
<h3 id="6-1-æ€»ç»“"><a href="#6-1-æ€»ç»“" class="headerlink" title="6.1. æ€»ç»“"></a>6.1. æ€»ç»“</h3><table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ˜¯å¦æ— é”</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>å·¥ä½œçªƒå– dequeï¼ˆå°¾éƒ¨ push&#x2F;pop + å¤´éƒ¨ stealï¼‰</td>
<td>âœ… æ— é”ï¼ˆåŸå­æ“ä½œï¼‰</td>
<td>æ€§èƒ½å…³é”®éƒ¨åˆ†</td>
</tr>
<tr>
<td>ä»»åŠ¡å¼•ç”¨è®¡æ•°</td>
<td>âœ… åŸå­æ“ä½œ</td>
<td>ä¿è¯ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸå®‰å…¨</td>
</tr>
<tr>
<td>å¹¶è¡Œç®—æ³•å†…éƒ¨è°ƒåº¦</td>
<td>âœ… å¤§éƒ¨åˆ†æ— é”</td>
<td>ä¾èµ–åŸå­å’Œæ— é”é˜Ÿåˆ—</td>
</tr>
<tr>
<td>é˜Ÿåˆ—æ‰©å®¹</td>
<td>âš ï¸ ä½¿ç”¨è½»é‡é”</td>
<td>æå°‘å‘ç”Ÿï¼Œæ€§èƒ½å½±å“æœ‰é™</td>
</tr>
<tr>
<td>å¹¶è¡Œå®¹å™¨</td>
<td>âš ï¸ éƒ¨åˆ†é”</td>
<td>ä¿éšœçº¿ç¨‹å®‰å…¨ï¼Œå¤æ‚å®¹å™¨éœ€è¦</td>
</tr>
</tbody></table>
<h2 id="7-TBB-çš„çº¿ç¨‹ç”Ÿå‘½æœŸ"><a href="#7-TBB-çš„çº¿ç¨‹ç”Ÿå‘½æœŸ" class="headerlink" title="7. TBB çš„çº¿ç¨‹ç”Ÿå‘½æœŸ"></a>7. TBB çš„çº¿ç¨‹ç”Ÿå‘½æœŸ</h2><p>æ˜¯çš„ï¼Œå³ä½¿ä½ åªè°ƒç”¨ä¸€æ¬¡ TBB å¹¶è¡Œå‡½æ•°ï¼Œçº¿ç¨‹æ± åˆ›å»ºååœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ä¹Ÿä¸ä¼šè‡ªåŠ¨é”€æ¯æˆ–å‡å°‘çº¿ç¨‹æ•°ã€‚å…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>å…¨å±€çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸ</li>
</ol>
<p>TBB é»˜è®¤å…¨å±€çº¿ç¨‹æ± æ˜¯åœ¨ ç¬¬ä¸€æ¬¡ä½¿ç”¨ TBB å¹¶è¡Œæ¥å£æ—¶åˆ›å»ºçš„ã€‚<br>çº¿ç¨‹æ•°å›ºå®šï¼ˆé€šå¸¸ç­‰äº CPU æ ¸å¿ƒæ•°ï¼‰ï¼Œæ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´ä¸€ç›´å­˜åœ¨ã€‚<br>ä¸ä¼šå› ä¸ºä½ é•¿æ—¶é—´æ²¡æœ‰æäº¤ä»»åŠ¡è€Œé”€æ¯çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å‡å°‘çº¿ç¨‹æ•°ã€‚</p>
<ol start="2">
<li>çº¿ç¨‹çŠ¶æ€</li>
</ol>
<p>é•¿æ—¶é—´ä¸ä½¿ç”¨ TBB æ—¶ï¼Œçº¿ç¨‹ å¤„äºç©ºé—²ç­‰å¾…çŠ¶æ€ï¼Œä¸ä¼šå ç”¨ CPUã€‚<br>å†…å­˜å ç”¨ä»ç„¶å­˜åœ¨ï¼Œå› ä¸ºçº¿ç¨‹å †æ ˆå’Œçº¿ç¨‹ç®¡ç†ç»“æ„ä»åœ¨ã€‚<br>ä¸€æ—¦å†æ¬¡è°ƒç”¨ TBB å¹¶è¡Œå‡½æ•°ï¼Œçº¿ç¨‹ç«‹å³å¤ç”¨ï¼Œæ— éœ€é‡æ–°åˆ›å»ºã€‚</p>
<ol start="3">
<li>å¯æ§ç­–ç•¥</li>
</ol>
<p>å¦‚æœå¸Œæœ›çº¿ç¨‹åœ¨é•¿æ—¶é—´ä¸ä½¿ç”¨æ—¶é‡Šæ”¾èµ„æºï¼Œå¯ä»¥ï¼š<br>æ‰‹åŠ¨æ§åˆ¶çº¿ç¨‹æ± ç”Ÿå‘½å‘¨æœŸï¼ˆè¾ƒå¤æ‚ï¼Œéœ€æ·±å…¥ TBB å†…éƒ¨ APIï¼Œä¸æ¨èï¼‰<br>ç¨‹åºè®¾è®¡ä¸Šåœ¨é•¿æ—¶é—´ç©ºé—²æ—¶é€€å‡ºè¿›ç¨‹ï¼Œé‡Šæ”¾æ‰€æœ‰çº¿ç¨‹å’Œå†…å­˜<br>ä¸€èˆ¬æœåŠ¡å™¨ç¨‹åºä¼šè®©çº¿ç¨‹æ± æŒç»­å­˜åœ¨ï¼Œåˆ©ç”¨ TBB çš„å·¥ä½œçªƒå–å’Œçº¿ç¨‹å¤ç”¨ä¼˜åŠ¿ï¼Œæé«˜åç»­ä»»åŠ¡æ€§èƒ½ã€‚</p>
<p>âœ… æ€»ç»“</p>
<p>TBB çº¿ç¨‹æ± çº¿ç¨‹æ•°å›ºå®šï¼Œä¸ä¼šå› é•¿æ—¶é—´ä¸ä½¿ç”¨è€Œå‡å°‘ã€‚<br>çº¿ç¨‹ç©ºé—²æ—¶ä¸å ç”¨ CPUï¼Œä½†å ç”¨å†…å­˜å’Œçº¿ç¨‹ç®¡ç†èµ„æºã€‚<br>è¿™ç§è®¾è®¡æ˜¯ä¸ºäº† æé«˜ä»»åŠ¡å†æ¬¡æ‰§è¡Œçš„å“åº”é€Ÿåº¦ï¼Œé€‚åˆæœåŠ¡å™¨æˆ–é•¿æœŸè¿è¡Œçš„é«˜æ€§èƒ½ç¨‹åºã€‚</p>
<h2 id="8-TBB-æ˜¯-CPU-å¯†é›†å‹çš„"><a href="#8-TBB-æ˜¯-CPU-å¯†é›†å‹çš„" class="headerlink" title="8. TBB æ˜¯ CPU å¯†é›†å‹çš„"></a>8. TBB æ˜¯ CPU å¯†é›†å‹çš„</h2><p>å¦‚æœä½ çš„ç¨‹åºæœ‰å¤§é‡ I&#x2F;O æ“ä½œï¼Œä½¿ç”¨ TBB çš„ä¸€äº›ç‰¹ç‚¹å’Œæ³¨æ„äº‹é¡¹éœ€è¦ç‰¹åˆ«ç•™æ„ï¼Œå› ä¸º TBB æ˜¯ä¸º CPU å¯†é›†å‹ä»»åŠ¡ å’Œ ä»»åŠ¡å¹¶è¡ŒåŒ– è®¾è®¡çš„ã€‚å…·ä½“åˆ†æå¦‚ä¸‹ï¼š</p>
<ol>
<li>TBB å¯¹ I&#x2F;O çš„ç‰¹ç‚¹</li>
</ol>
<ul>
<li>çº¿ç¨‹æ± å›ºå®šï¼Œçº¿ç¨‹æ•°é€šå¸¸ &#x3D; CPU æ ¸å¿ƒæ•°</li>
<li>æ¯ä¸ªçº¿ç¨‹ä¼šè¢«ç”¨æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡ä¸­ å‘ç”Ÿé˜»å¡ I&#x2F;Oï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ï¼‰ï¼š</li>
<li>é˜»å¡çº¿ç¨‹ä¼šå ç”¨çº¿ç¨‹æ± çš„ä¸€ä¸ªçº¿ç¨‹</li>
<li>å…¶ä»–ä»»åŠ¡å¯èƒ½å› ä¸ºçº¿ç¨‹ä¸è¶³è€Œç­‰å¾…</li>
</ul>
<p>ç»“è®ºï¼šTBB é»˜è®¤ä¸é€‚åˆå¤§é‡é˜»å¡ I&#x2F;O çš„åœºæ™¯</p>
<ol start="2">
<li>å¸¸è§é—®é¢˜</li>
</ol>
<table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>åŸå› </th>
<th>åæœ</th>
</tr>
</thead>
<tbody><tr>
<td>CPU åˆ©ç”¨ç‡ä½</td>
<td>é˜»å¡ I&#x2F;O å ç”¨çº¿ç¨‹</td>
<td>ä»»åŠ¡ç­‰å¾…ï¼Œæ€§èƒ½ä¸‹é™</td>
</tr>
<tr>
<td>çº¿ç¨‹ä¸è¶³</td>
<td>é˜»å¡çº¿ç¨‹å ç”¨å…¨å±€çº¿ç¨‹æ± </td>
<td>å¹¶è¡Œåº¦é™ä½ï¼Œä»»åŠ¡è°ƒåº¦å—é˜»</td>
</tr>
<tr>
<td>æ­»é”é£é™©</td>
<td>TBB çº¿ç¨‹æ± çº¿ç¨‹è¢«é•¿æ—¶é—´é˜»å¡</td>
<td>å¦‚æœä»»åŠ¡ä¾èµ–å…¶ä»–å¹¶è¡Œä»»åŠ¡ï¼Œå¯èƒ½äº’ç›¸ç­‰å¾…</td>
</tr>
</tbody></table>
<ol start="3">
<li>è§£å†³æ–¹æ³•</li>
</ol>
<p>a. åˆ†ç¦» I&#x2F;O çº¿ç¨‹</p>
<p>ä¸è¦åœ¨ TBB çº¿ç¨‹æ± ä¸­ç›´æ¥åšé˜»å¡ I&#x2F;O<br>å¯ä»¥å¼€ç‹¬ç«‹çº¿ç¨‹æˆ–çº¿ç¨‹æ± ä¸“é—¨å¤„ç† I&#x2F;O<br>TBB çº¿ç¨‹åªå¤„ç† CPU å¯†é›†å‹ä»»åŠ¡</p>
<p>b. ä½¿ç”¨å¼‚æ­¥ I&#x2F;O</p>
<p>å¯¹ç½‘ç»œ &#x2F; æ–‡ä»¶ I&#x2F;O ä½¿ç”¨éé˜»å¡æˆ–å¼‚æ­¥ APIï¼ˆå¦‚ asioã€io_uringï¼‰<br>ä»»åŠ¡æäº¤ç»™ TBB æ—¶ ç«‹å³è¿”å›ï¼ŒI&#x2F;O å®Œæˆé€šè¿‡å›è°ƒæˆ– future å¤„ç†</p>
<p>c. task_arena + é™åˆ¶çº¿ç¨‹</p>
<p>å¦‚æœå¿…é¡»åœ¨ TBB çº¿ç¨‹é‡Œåšå°‘é‡é˜»å¡ I&#x2F;Oï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª å±€éƒ¨ task_arenaï¼Œé™åˆ¶çº¿ç¨‹æ•°ï¼Œé¿å…é˜»å¡å…¨å±€çº¿ç¨‹æ± </p>
<p>d. æ··åˆæ¨¡å‹</p>
<p>CPU å¯†é›†ä»»åŠ¡ç”¨ TBB<br>é˜»å¡ I&#x2F;O ç”¨ä¸“é—¨çº¿ç¨‹æ±  &#x2F; å¼‚æ­¥æ¡†æ¶<br>æœ€åç”¨ future&#x2F;promise æˆ– task_group åè°ƒç»“æœ</p>
<ol start="4">
<li>æ€»ç»“</li>
</ol>
<p>TBB æ˜¯ CPU å¯†é›†å‹å¹¶è¡Œæ¡†æ¶ï¼Œä¸é€‚åˆå¤§é‡é˜»å¡ I&#x2F;O<br>é˜»å¡ I&#x2F;O ä¼šå ç”¨çº¿ç¨‹æ± çº¿ç¨‹ï¼Œé™ä½å¹¶è¡Œåº¦</p>
<p>å»ºè®®ï¼š</p>
<p>åˆ†ç¦» I&#x2F;O çº¿ç¨‹æˆ–çº¿ç¨‹æ± <br>ä½¿ç”¨å¼‚æ­¥ I&#x2F;O<br>TBB åªå¤„ç†è®¡ç®—ä»»åŠ¡</p>
<h2 id="9-æ¨èé˜…è¯»"><a href="#9-æ¨èé˜…è¯»" class="headerlink" title="9. æ¨èé˜…è¯»"></a>9. æ¨èé˜…è¯»</h2><ol>
<li>Intel Building Blocks ç¼–ç¨‹æŒ‡å—. James Reinders.</li>
<li>Patterns for Parallel Pragramming. Timothy Mattson ç­‰.</li>
<li>è®¾è®¡æ¨¡å¼ï¼šDesign Patterns of Reusable Object-Oriented Software (Addison Wesley). Gamma, Helm, Johnson å’Œ Vlissides.</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/02/02/cpp/gcc%E4%B8%8Eglibc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/02/02/cpp/gcc%E4%B8%8Eglibc/" class="post-title-link" itemprop="url">gcc ä¸ glibc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-02-02 13:24:45" itemprop="dateCreated datePublished" datetime="2024-02-02T13:24:45+00:00">2024-02-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h2><p>gccæ˜¯ä¸€ä¸ªç¼–è¯‘å¥—ä»¶ï¼ŒåŒ…å«cã€c++ã€Fortranè¯­è¨€çš„ç¼–è¯‘å™¨ã€‚</p>
<h2 id="glibc"><a href="#glibc" class="headerlink" title="glibc"></a>glibc</h2><p>glibcæ˜¯ä¸€ä¸ªlibraryï¼Œä¸ºCç¨‹åºæä¾›åŸºç¡€å…¬å…±åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€æ•°å­¦å‡½æ•°å’Œå…¶ä»–æ ¸å¿ƒç»„ä»¶ã€‚<br>Linuxå¹³å°å’Œvscodeä¼¼ä¹éƒ½ä¾èµ–glibcï¼Œå¦‚æœæ“…è‡ªå°†<code>LD_LIBRARY_PATH</code>æ›´æ”¹ä¸ºå…¶ä»–ç‰ˆæœ¬çš„glibcè·¯å¾„ï¼Œåˆ™bashä¼šç›´æ¥crashã€‚</p>
<h3 id="glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š"><a href="#glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š" class="headerlink" title="glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š"></a>glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> glibc-v2.34/Linux/RHEL7.0-2017-x86_64/bin &amp;&amp; <span class="built_in">ls</span></span><br><span class="line">catchsegv  getconf  iconv  locale     makedb  pcprofiledump  sotruss  tzselect  zdump</span><br><span class="line">gencat     getent   ldd    localedef  mtrace  pldd           sprof    xtrace</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å…¶ä»–ç‰ˆæœ¬çš„glibc/libç›®å½•æ‰§è¡Œlså‘½ä»¤ä¼šæŠ¥é”™ï¼Œå¤§æ¦‚åŸå› å¯èƒ½æ˜¯å› ä¸ºå½“å‰è·¯å¾„çš„glibcçš„libå’Œç³»ç»Ÿçš„libå†²çªã€‚</span></span><br><span class="line">$ <span class="built_in">cd</span> ../lib &amp;&amp; <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span>: relocation error: ./libc.so.6: symbol __tunable_get_val, version GLIBC_PRIVATE not defined <span class="keyword">in</span> file ld-linux-x86-64.so.2 with <span class="built_in">link</span> time reference</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">ls</span> lib</span><br><span class="line">Mcrt1.o               libanl.so.1             libm.so             libnss_hesiod.so.2</span><br><span class="line">Scrt1.o               libc.a                  libm.so.6           libpcprofile.so</span><br><span class="line">audit                 libc.so                 libmcheck.a         libpthread.a</span><br><span class="line">crt1.o                libc.so.6               libmemusage.so      libpthread.so.0</span><br><span class="line">crti.o                libc_malloc_debug.so    libmvec.a           libresolv.a</span><br><span class="line">crtn.o                libc_malloc_debug.so.0  libmvec.so          libresolv.so</span><br><span class="line">gconv                 libc_nonshared.a        libmvec.so.1        libresolv.so.2</span><br><span class="line">gcrt1.o               libcrypt.a              libnsl.so.1         librt.a</span><br><span class="line">ld-linux-x86-64.so.2  libcrypt.so             libnss_compat.so    librt.so.1</span><br><span class="line">libBrokenLocale.a     libcrypt.so.1           libnss_compat.so.2  libthread_db.so</span><br><span class="line">libBrokenLocale.so    libdl.a                 libnss_db.so        libthread_db.so.1</span><br><span class="line">libBrokenLocale.so.1  libdl.so.2              libnss_db.so.2      libutil.a</span><br><span class="line">libSegFault.so        libg.a                  libnss_dns.so.2     libutil.so.1</span><br><span class="line">libanl.a              libm-2.34.a             libnss_files.so.2</span><br><span class="line">libanl.so             libm.a                  libnss_hesiod.so</span><br></pre></td></tr></table></figure>

<h3 id="æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š"><a href="#æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š" class="headerlink" title="æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š"></a>æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»ä¸Šå¯çŸ¥ï¼Œlddæ˜¯glibcçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€</span></span><br><span class="line">$ ldd --version</span><br></pre></td></tr></table></figure>

<h3 id="å¯»æ‰¾libc-soçš„è·¯å¾„ï¼š"><a href="#å¯»æ‰¾libc-soçš„è·¯å¾„ï¼š" class="headerlink" title="å¯»æ‰¾libc.soçš„è·¯å¾„ï¼š"></a>å¯»æ‰¾libc.soçš„è·¯å¾„ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ locate libc.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libc.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">$ locate libstdc++.so</span><br><span class="line">/usr/lib/gcc/x86_64-linux-gnu/11/libstdc++.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libstdc++.so.6</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30</span><br><span class="line">/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30-gdb.py</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…glibcï¼š"><a href="#å®‰è£…glibcï¼š" class="headerlink" title="å®‰è£…glibcï¼š"></a>å®‰è£…glibcï¼š</h3><p>Ubuntuå¹³å°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install lib6</span><br></pre></td></tr></table></figure>

<p>RedHatå¹³å°</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install glibc</span><br></pre></td></tr></table></figure>

<h3 id="æ£€æŸ¥GNC-C-Library-libstdc-çš„ç‰ˆæœ¬ï¼š"><a href="#æ£€æŸ¥GNC-C-Library-libstdc-çš„ç‰ˆæœ¬ï¼š" class="headerlink" title="æ£€æŸ¥GNC C++ Library (libstdc++)çš„ç‰ˆæœ¬ï¼š"></a>æ£€æŸ¥GNC C++ Library (libstdc++)çš„ç‰ˆæœ¬ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ strings /usr/lib/libstdc++.so.* | grep LIBCXX</span><br><span class="line">[sjcvl-zhigaoz ] /lan/cva_rel/vxe_main/24.02.650.d000/tools.lnx86/lib/64bit % strings /usr/lib/libstdc++.so.* | grep LIBCXX</span><br><span class="line">GLIBCXX_3.4</span><br><span class="line">GLIBCXX_3.4.1</span><br><span class="line">GLIBCXX_3.4.2</span><br><span class="line">...</span><br><span class="line">GLIBCXX_3.4.19</span><br><span class="line">GLIBCXX_DEBUG_MESSAGE_LENGTH</span><br><span class="line"></span><br><span class="line">$ strings /usr/lib/libc.so.* | grep GLIBC</span><br><span class="line">GLIBC_2.0</span><br><span class="line">GLIBC_2.1</span><br><span class="line">GLIBC_2.1.1</span><br><span class="line">...</span><br><span class="line">GLIBC_2.17</span><br><span class="line">GLIBC_PRIVATE</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æœ‰ä¸€ä¸ªä½¿ç”¨äº†libstdc++çš„ç‰¹å®šçš„binaryæˆ–applicationï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥å…¶ç‰ˆæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ldd &lt;your_binary_or_application&gt; | grep libstdc++</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨vscodeçš„â€œRemote SSHâ€å·¥å…·è¯•å›¾è¿æ¥åˆ°Linuxæ—¶ï¼Œå¯èƒ½ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Warning: Missing GLIBCXX &gt;&#x3D; 3.4.25! from &#x2F;usr&#x2F;lib64&#x2F;libstdc++.so.6.0.19<br>Warning: Missing GLIBC &gt;&#x3D; 2.28! from &#x2F;usr&#x2F;lib64&#x2F;libc-2.17.so<br>Error: Missing required dependencies. Please refer to our FAQ <a target="_blank" rel="noopener" href="https://aka.ms/vscode-remote/faq/old-linux">https://aka.ms/vscode-remote/faq/old-linux</a> for additional information.</p>
</blockquote>
<p>è¿™æ˜¯å› ä¸ºLinuxç³»ç»Ÿä¸Šçš„glibcç‰ˆæœ¬ä¸­ä¸åŒ…å«GLIBCXX_3.4.25åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚æ­¤æ—¶éœ€è¦é™çº§vscodeï¼ˆå»ºè®®åšæ³•ï¼‰æˆ–å‡çº§glibcï¼ˆä¼¼ä¹å¾ˆéš¾ï¼‰ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/30/misc/%E8%AE%A1%E6%97%B6%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/30/misc/%E8%AE%A1%E6%97%B6%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">è®¡æ—¶å·¥å…·</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-30 11:07:39" itemprop="dateCreated datePublished" datetime="2024-01-30T11:07:39+00:00">2024-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="times"><a href="#times" class="headerlink" title="times"></a>times</h2><ol>
<li>bash built-in</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">times</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>function</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">clock_t</span> <span class="title">times</span><span class="params">(<span class="keyword">struct</span> tms *buf)</span></span>;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/29/linux/Introduction-to-memory/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/29/linux/Introduction-to-memory/" class="post-title-link" itemprop="url">Introduction to memory</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-29 14:25:24" itemprop="dateCreated datePublished" datetime="2024-01-29T14:25:24+00:00">2024-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="malloc-free"><a href="#malloc-free" class="headerlink" title="malloc&#x2F;free"></a>malloc&#x2F;free</h2><p>See <a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Backtraces.html">this example</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> ** <span class="title">backtrace_symbols</span> <span class="params">(<span class="type">void</span> *<span class="type">const</span> *buffer, <span class="type">int</span> size)</span> </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>The return value of backtrace_symbols is a pointer obtained via the malloc function, and it is the responsibility of the caller to free that pointer. Note that only the return value need be freed, not the individual strings.</p>
</blockquote>
<p>Question: Why does it say â€œonly the return value need be freed, not the individual stringsâ€?</p>
<p>Let us observe the defintion of the <code>malloc</code>&#x2F;<code>free</code> functions first:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">malloc</span><span class="params">( <span class="type">size_t</span> size )</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">free</span><span class="params">( <span class="type">void</span> *ptr )</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>free</code> takes a <code>void*</code> pointer to deallocate the memory, it doesnâ€™t care what type it is, even if it is a multi-level pointer. It means that <code>malloc</code> has stored the memory size in some place and <code>free</code> will find it beforing deallocate the memory.</p>
<p>Let us return the question. The memory pointer returned by <code>backtrace_symbols</code> is the <code>char**</code> type, it must be a whole block contigunous memory using <code>malloc</code> and might be enforced to be transformed as <code>char**</code> pointer when returing. So when we <code>free</code> the memory block, the Linux kernel find its actual memory size and deallocate it.</p>
<p>Example:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>** strings = (<span class="type">char</span>**)<span class="built_in">malloc</span>(<span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">char</span>*) + <span class="number">3</span> * <span class="number">50</span>); <span class="comment">// assuming a maximum 50 characters per sentence</span></span><br><span class="line">    <span class="type">char</span>* block = (<span class="type">char</span>*)(strings + <span class="number">3</span>);</span><br><span class="line">    <span class="type">char</span>* s1 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The first sentence&quot;</span>); block += <span class="built_in">strlen</span>(s1) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span>* s2 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The second sentence&quot;</span>); block += <span class="built_in">strlen</span>(s2) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span>* s3 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The third sentence&quot;</span>);</span><br><span class="line">    strings[<span class="number">0</span>] = s1;</span><br><span class="line">    strings[<span class="number">1</span>] = s2;</span><br><span class="line">    strings[<span class="number">2</span>] = s3;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, strings[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(strings); <span class="comment">// deallocate all memory at once</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>More elegant but less economical code:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>** strings = (<span class="type">char</span>**)<span class="built_in">malloc</span>(<span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">char</span>*) + <span class="number">3</span> * <span class="number">50</span>);</span><br><span class="line">    <span class="type">char</span>* block = (<span class="type">char</span>*)(strings + <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        strings[i] = block + i * <span class="number">50</span>; <span class="comment">// Assuming a maximum of 50 characters per sentence</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">0</span>], <span class="string">&quot;The first sentence&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">1</span>], <span class="string">&quot;The second sentence&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">2</span>], <span class="string">&quot;The third sentence&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, strings[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(strings); <span class="comment">// deallocate all memory at once</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Memory_002dmapped-I_002fO.html">The GNU C Library (glibc) manual: 13.8 Memory-mapped I&#x2F;O</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Memory-Protection.html">The GNU C Library (glibc) manual: 3.4 Memory Protection</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/29/UML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/29/UML/" class="post-title-link" itemprop="url">UML</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-29 11:10:46" itemprop="dateCreated datePublished" datetime="2024-01-29T11:10:46+00:00">2024-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-04 11:20:22" itemprop="dateModified" datetime="2025-09-04T11:20:22+00:00">2025-09-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1176331">è®¤è¯†UMLç±»å…³ç³»â€”â€”ä¾èµ–ã€å…³è”ã€èšåˆã€ç»„åˆã€æ³›åŒ–</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/blog/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/10/">10</a><a class="extend next" rel="next" href="/blog/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bi-an"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">bi-an</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bi-an" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;bi-an" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ah_zzg@126.com" title="E-Mail â†’ mailto:ah_zzg@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://cuda-doc.readthedocs.io/" title="https:&#x2F;&#x2F;cuda-doc.readthedocs.io" rel="noopener" target="_blank">CUDAä¸­æ–‡æ‰‹å†Œ</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://infiniband-doc.readthedocs.io/" title="https:&#x2F;&#x2F;infiniband-doc.readthedocs.io&#x2F;" rel="noopener" target="_blank">InfiniBandä¸­æ–‡æ‰‹å†Œ</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bi-an</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
