<!DOCTYPE html>
<html lang="en, zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bi-an.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="æ±Ÿå—äººç‰©çš„åšå®¢">
<meta property="og:url" content="https://bi-an.github.io/blog/page/7/index.html">
<meta property="og:site_name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
<meta property="og:locale">
<meta property="article:author" content="bi-an">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bi-an.github.io/blog/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en, zh_CN'
  };
</script>

  <title>æ±Ÿå—äººç‰©çš„åšå®¢</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">æ±Ÿå—äººç‰©çš„åšå®¢</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-resource">

    <a href="/blog/resources/" rel="section"><i class="fa fa-paperclip fa-fw"></i>Resource</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/linux/Drive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/linux/Drive/" class="post-title-link" itemprop="url">Drive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:56:44" itemprop="dateCreated datePublished" datetime="2024-01-23T21:56:44+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="é©±åŠ¨"><a href="#é©±åŠ¨" class="headerlink" title="é©±åŠ¨"></a>é©±åŠ¨</h1><p>æœ¬æ–‡ä»‹ç»é©±åŠ¨ã€‚</p>
<h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul>
<li><p><code>lsmod</code> - Show status of modules in the Linux kernel.</p>
<p><code>lsmod</code> is a trivial program which nicely formats the contents of the <code>/proc/odules</code>,<br>showing what kernel modules are currently loaded.</p>
</li>
<li><p><code>dmesg</code> - examine or control the kernel ring buffer.</p>
<p>  The kernel buffer is a data structure used for keeping the log messages of the kernel and the kernel modules.<br>  Itâ€™s a ring buffer with a fixed size. Once itâ€™s full, new messages overwrite the oldest messages.<br>  During boot, the kernel saves the messages into the kernel buffer.</p>
</li>
<li><p><code>lsscsi</code> - Uses information in sysfs (Linux kernel series 2.6 and later) to list SCSI devices (or hosts) currently attached to the system.</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/personal_site/git-Usage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/personal_site/git-Usage/" class="post-title-link" itemprop="url">git Usage</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:52:17" itemprop="dateCreated datePublished" datetime="2024-01-23T21:52:17+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="gitignoreä¸ç”Ÿæ•ˆ"><a href="#gitignoreä¸ç”Ÿæ•ˆ" class="headerlink" title="gitignoreä¸ç”Ÿæ•ˆ"></a>gitignoreä¸ç”Ÿæ•ˆ</h2><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.python100.com/html/32VIQ026UL7U.html">é“¾æ¥</a>ã€‚</p>
<h2 id="file-mode-10064çš„å«ä¹‰"><a href="#file-mode-10064çš„å«ä¹‰" class="headerlink" title="file mode 10064çš„å«ä¹‰"></a>file mode 10064çš„å«ä¹‰</h2><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/flyd1005/article/details/43824473">åšå®¢</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/linux/Environment-Variables/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/linux/Environment-Variables/" class="post-title-link" itemprop="url">Environment Variables</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:49:40" itemprop="dateCreated datePublished" datetime="2024-01-23T21:49:40+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><ul>
<li><p><code>environ</code> - ç”¨æˆ·ç¯å¢ƒï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚å¤´æ–‡ä»¶ <code>&lt;unistd.h&gt;</code>ã€‚å¯ä»¥é€šè¿‡ <code>man environ</code> æŸ¥çœ‹æ‰‹å†Œã€‚</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;program environment: &quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>** entry = environ; *entry; ++entry) &#123;</span><br><span class="line">        cout &lt;&lt; *entry &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>getenv</code> - è·å–ç¯å¢ƒå˜é‡ã€‚å¤´æ–‡ä»¶ <code>&lt;stdlib.h&gt;</code>ã€‚</p>
</li>
<li><p><code>setenv</code> - è®¾ç½®ç¯å¢ƒå˜é‡ã€‚å¤´æ–‡ä»¶ <code>stdlib.h</code>ã€‚</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/concurrency/Thread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/concurrency/Thread/" class="post-title-link" itemprop="url">Thread</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:46:41" itemprop="dateCreated datePublished" datetime="2024-01-23T21:46:41+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="sched-setaffinity"><a href="#sched-setaffinity" class="headerlink" title="sched_setaffinity"></a><code>sched_setaffinity</code></h2><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/sched_setaffinity.2.html">manpage</a>.</p>
<p>affinity è¡¨ç¤º CPU äº²ç¼˜æ€§ï¼šå³ä¸å“ªä¸ªæ›´äº²ï¼Œæ›´æ„¿æ„å±äºå“ªä¸€ä¸ªã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/itjinks/article/details/40477779">https://blog.csdn.net/itjinks/article/details/40477779</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/itjinks/article/details/40477779">CPU affinity æ˜¯ä¸€ç§è°ƒåº¦å±æ€§(scheduler property), å®ƒå¯ä»¥å°†ä¸€ä¸ªè¿›ç¨‹â€ç»‘å®šâ€ åˆ°ä¸€ä¸ªæˆ–ä¸€ç»„CPUä¸Š.</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/misc/GNU-Introducation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/misc/GNU-Introducation/" class="post-title-link" itemprop="url">GNU Introducation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:45:31" itemprop="dateCreated datePublished" datetime="2024-01-23T21:45:31+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Misc/" itemprop="url" rel="index"><span itemprop="name">Misc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/">GNU</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/">GNU Software</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/gnulib/">Gnulib</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/make/">Gnumake</a></li>
</ul>
<h2 id="libc"><a href="#libc" class="headerlink" title="libc"></a>libc</h2><h3 id="Memory-Protection"><a href="#Memory-Protection" class="headerlink" title="Memory Protection"></a>Memory Protection</h3><p>å‚è§ï¼š<a target="_blank" rel="noopener" href="https://www.gnu.org/software/libc/manual/html_node/Memory-Protection.html">æ–‡æ¡£</a>ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">gdb å…¥é—¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:44:37" itemprop="dateCreated datePublished" datetime="2024-01-23T21:44:37+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="gdbå®ç°åŸç†"><a href="#gdbå®ç°åŸç†" class="headerlink" title="gdbå®ç°åŸç†"></a>gdbå®ç°åŸç†</h2><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://www.zhihu.com/people/bi-an-60-46">é“¾æ¥</a>ã€‚</p>
<h2 id="åœ¨-vim-emacs-ä¸­å¯åŠ¨-gdb"><a href="#åœ¨-vim-emacs-ä¸­å¯åŠ¨-gdb" class="headerlink" title="åœ¨ vim &#x2F; emacs ä¸­å¯åŠ¨ gdb"></a>åœ¨ vim &#x2F; emacs ä¸­å¯åŠ¨ gdb</h2><p>ä¸ºä»€ä¹ˆåœ¨ Emacs&#x2F;vim ä¸­è¿è¡Œ GDBï¼Ÿ</p>
<ul>
<li>ç»Ÿä¸€ç¯å¢ƒï¼šä½ å¯ä»¥åœ¨ Emacs ä¸­åŒæ—¶æŸ¥çœ‹æºä»£ç å’Œè°ƒè¯•ä¿¡æ¯</li>
<li>å¿«æ·é”®æ”¯æŒï¼šä½¿ç”¨ Emacs çš„å¿«æ·é”®æ§åˆ¶ GDBï¼ˆå¦‚è®¾ç½®æ–­ç‚¹ã€å•æ­¥æ‰§è¡Œï¼‰</li>
<li>å›¾å½¢åŒ–å¸ƒå±€ï¼šæ”¯æŒå¤šçª—å£æ˜¾ç¤ºï¼Œå¦‚æ–­ç‚¹åˆ—è¡¨ã€å †æ ˆä¿¡æ¯ã€å˜é‡å€¼ç­‰</li>
<li>å¢å¼ºæ•ˆç‡ï¼šæ— éœ€ç¦»å¼€ç¼–è¾‘å™¨å³å¯å®Œæˆè°ƒè¯•ä»»åŠ¡</li>
</ul>
<p>Vim ä» 8.1 ç‰ˆæœ¬å¼€å§‹å†…ç½®äº†ä¸€ä¸ªå«åš Termdebug çš„æ’ä»¶ï¼Œå®ƒå¯ä»¥ç›´æ¥åœ¨ Vim ä¸­è¿è¡Œ GDBï¼Œå¹¶æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ã€‚</p>
<p>âœ… æ­¥éª¤ï¼š<br>ç¡®ä¿ Vim ç‰ˆæœ¬ â‰¥ 8.1</p>
<p>ç¼–è¯‘ä½ çš„ç¨‹åºï¼ˆåŠ ä¸Š -g é€‰é¡¹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -g my_program.c -o my_program</span><br></pre></td></tr></table></figure>

<p>åœ¨ Vim ä¸­åŠ è½½æ’ä»¶ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:packadd termdebug</span><br><span class="line">:Termdebug</span><br></pre></td></tr></table></figure>

<p>Vim ä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œæ˜¾ç¤º GDB æ§åˆ¶å°ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢è¾“å…¥ GDB å‘½ä»¤ã€‚</p>
<p>ğŸ“– æ•™ç¨‹å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.baeldung.com/linux/vim-gdb-integration">Baeldung çš„ Vim-GDB é›†æˆæŒ‡å—</a></p>
<h2 id="gdbå‘½ä»¤"><a href="#gdbå‘½ä»¤" class="headerlink" title="gdbå‘½ä»¤"></a>gdbå‘½ä»¤</h2><ul>
<li><p><code>thread apply [threadno] [all] args</code> - å°†å‘½ä»¤ä¼ é€’ç»™ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œå‚è§<a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/DeveloperTools/gdb/gdb/gdb_5.html">é“¾æ¥</a>ã€‚<br>æ¯”å¦‚ï¼Œ<code>thread apply all continue</code>è¡¨ç¤ºå°†<code>continue</code>å‘½ä»¤ä¼ é€’ç»™æ‰€æœ‰çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è®©æ‰€æœ‰çº¿ç¨‹éƒ½ç»§ç»­è¿è¡Œã€‚</p>
</li>
<li><p><code>rbreak</code> - Set a breakpoint for all functions matching REGEXP. å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/zdl1016/article/details/8708077">é“¾æ¥</a>ã€‚</p>
<p>  e.g. <code>rbreak file.C:.*</code> - ç»™file.Cçš„æ‰€æœ‰å‡½æ•°åŠ ä¸Šæ–­ç‚¹ã€‚</p>
</li>
<li><p><code>info</code></p>
<ul>
<li><code>info inferior</code> - å¯ä»¥æŸ¥çœ‹å½“å‰è°ƒè¯•çš„è¿›ç¨‹çš„PIDã€‚å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯åœ¨gdbå‘½ä»¤è¡Œä¸­ç›´æ¥è°ƒç”¨Cå‡½æ•°ï¼š<code>print (int)getpid()</code>ã€‚å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://www.qiniu.com/qfans/qnso-36704270">é“¾æ¥</a>ã€‚</li>
<li><code>info source</code> - å½“å‰è°ƒè¯•çš„æºæ–‡ä»¶è·¯å¾„ã€‚</li>
<li><code>info sources &lt;pattern&gt;</code> - æŸ¥è¯¢æºæ–‡ä»¶è·¯å¾„</li>
<li><code>info proc</code> - <a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/Process-Information.html">å½“å‰è¿›ç¨‹ä¿¡æ¯</a>ã€‚<ul>
<li><code>info proc files</code> - å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼ˆå’Œæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚</li>
<li><code>info args</code> - æŸ¥çœ‹å‡½æ•°å‚æ•°</li>
<li><code>info locals</code> - æŸ¥çœ‹å±€éƒ¨å˜é‡ã€‚</li>
<li><code>info reg</code> æŸ¥çœ‹å¯„å­˜å™¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å¸¸ç”¨å¯„å­˜å™¨ï¼š</p>
<table>
<thead>
<tr>
<th align="center">å¯„å­˜å™¨</th>
<th align="center">ç”¨é€”è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="center">rax</td>
<td align="center">å‡½æ•°è¿”å›å€¼ï¼Œä¹˜é™¤æ³•è¿ç®—</td>
</tr>
<tr>
<td align="center">rbx</td>
<td align="center">é€šç”¨å¯„å­˜å™¨ï¼Œå¸¸ç”¨äºåŸºå€</td>
</tr>
<tr>
<td align="center">rcx</td>
<td align="center">å¾ªç¯è®¡æ•°å™¨</td>
</tr>
<tr>
<td align="center">rdx</td>
<td align="center">I&#x2F;O æŒ‡é’ˆæˆ–ä¸­é—´æ•°æ®</td>
</tr>
<tr>
<td align="center">rdi</td>
<td align="center">å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°</td>
</tr>
<tr>
<td align="center">rsi</td>
<td align="center">å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°</td>
</tr>
<tr>
<td align="center">rsp</td>
<td align="center">æ ˆé¡¶æŒ‡é’ˆ</td>
</tr>
<tr>
<td align="center">rbp</td>
<td align="center">æ ˆåº•æŒ‡é’ˆï¼Œæ ˆå¸§åŸºå€</td>
</tr>
<tr>
<td align="center">rip</td>
<td align="center">å½“å‰æ‰§è¡ŒæŒ‡ä»¤åœ°å€</td>
</tr>
<tr>
<td align="center">eflags</td>
<td align="center">è¿ç®—çŠ¶æ€æ ‡å¿—ï¼Œå¦‚ ZFï¼ˆé›¶æ ‡å¿—ï¼‰ã€CFï¼ˆè¿›ä½æ ‡å¿—ï¼‰ç­‰</td>
</tr>
</tbody></table>
<p>gdb çš„å¯„å­˜å™¨å˜é‡</p>
<p>x86ï¼ˆ32 ä½ï¼‰</p>
<table>
<thead>
<tr>
<th>$eax, $ebx, $ecx, $edx</th>
<th>é€šç”¨å¯„å­˜å™¨</th>
</tr>
</thead>
<tbody><tr>
<td>$esi, $edi</td>
<td>æº&#x2F;ç›®æ ‡ç´¢å¼•å¯„å­˜å™¨</td>
</tr>
<tr>
<td>$esp</td>
<td>æ ˆé¡¶æŒ‡é’ˆï¼ˆStack Pointerï¼‰</td>
</tr>
<tr>
<td>$ebp</td>
<td>æ ˆåº•æŒ‡é’ˆï¼ˆBase Pointerï¼‰</td>
</tr>
<tr>
<td>$eip</td>
<td>æŒ‡ä»¤æŒ‡é’ˆï¼ˆä¸‹ä¸€æ¡æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼‰</td>
</tr>
<tr>
<td>$eflags</td>
<td>æ ‡å¿—å¯„å­˜å™¨ï¼ˆä¿å­˜æ¡ä»¶æ ‡å¿—ï¼‰</td>
</tr>
</tbody></table>
<p>x86_64ï¼ˆ64 ä½ï¼‰</p>
<table>
<thead>
<tr>
<th align="center">å¯„å­˜å™¨</th>
<th align="center">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$rax, $rbx, $rcx, $rdx</td>
<td align="center">é€šç”¨å¯„å­˜å™¨ï¼ˆ64 ä½ï¼‰</td>
</tr>
<tr>
<td align="center">$rsi, $rdi</td>
<td align="center">å‚æ•°å¯„å­˜å™¨</td>
</tr>
<tr>
<td align="center">$rsp</td>
<td align="center">æ ˆé¡¶æŒ‡é’ˆ</td>
</tr>
<tr>
<td align="center">$rbp</td>
<td align="center">æ ˆåº•æŒ‡é’ˆ</td>
</tr>
<tr>
<td align="center">$rip</td>
<td align="center">æŒ‡ä»¤æŒ‡é’ˆ</td>
</tr>
<tr>
<td align="center">$r8~$r15</td>
<td align="center">æ‰©å±•é€šç”¨å¯„å­˜å™¨</td>
</tr>
<tr>
<td align="center">$eflags</td>
<td align="center">æ ‡å¿—å¯„å­˜å™¨</td>
</tr>
</tbody></table>
<ul>
<li><code>show</code> <ul>
<li><code>show environment</code> æŸ¥çœ‹å…¨å±€å˜é‡</li>
<li><code>set environment &lt;var&gt;=&lt;value&gt;</code> è®¾ç½®ç¯å¢ƒå˜é‡</li>
</ul>
</li>
<li><code>attach</code> - è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ä¸<code>gdb -p</code>æ•ˆæœç›¸åŒã€‚</li>
<li><code>detach</code> - å–æ¶ˆè¿æ¥çš„è¿›ç¨‹ã€‚</li>
<li><code>handle &lt;signal&gt; print pass nostop</code> - æ•è·ä¿¡å·ï¼ˆæ¯”å¦‚<code>SIGSEGV</code>ï¼‰å¹¶ä¸”å¿½ç•¥å®ƒã€‚<code>handle &lt;signal nostop</code>ã€‚<ul>
<li><code>pass</code> è¡¨ç¤º gdb ä¼šå°†æ•è·åˆ°çš„ä¿¡å·å‘å›ç»™è¢«è°ƒè¯•çš„è¿›ç¨‹ã€‚</li>
</ul>
</li>
<li><code>set</code> - ä¿®æ”¹å˜é‡çš„å€¼ï¼Œæ¯”å¦‚<code>set x=10</code>ï¼ˆæˆ–<code>set var x=10</code>ï¼‰å°†å˜é‡<code>x</code>çš„å€¼æ”¹ä¸º<code>10</code>ã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/yasi_xi/article/details/12784507">åšå®¢</a>ã€‚</li>
<li><code>show directories</code></li>
<li><code>print</code> - gdbé»˜è®¤è®¾ç½®æ‰“å°å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º200ï¼›æ›´æ”¹æ‰“å°æœ€å¤§é•¿åº¦ï¼š<code>set print elements &lt;number-of-elements&gt;</code>ï¼Œ<code>0</code>è¡¨ç¤ºunlimited.<br>    - æ‰“å°æ•°ç»„: <code>print arr[0]@3</code> ï¼Œå…¶ä¸­ <code>@3</code> è¡¨ç¤ºæ‰“å° 3 ä¸ªå…ƒç´ ã€‚<br>    - ä»¥åå…­è¿›åˆ¶æ‰“å°ï¼š<code>p/x &lt;var&gt;</code></li>
<li><code>ptype &lt;variable name&gt;</code> - æ‰“å°å˜é‡ç±»å‹ã€‚</li>
<li><code>finish</code> - ä»å‡½æ•°ä¸­è¿”å›ï¼Œå¹¶æ‰“å°å‡½æ•°è¿”å›å€¼ï¼ˆå³ä½¿å‡½æ•°çš„returnè¯­å¥å¾ˆå¤æ‚ï¼Œä¹Ÿå¯ä»¥è·å–è¿”å›å€¼ï¼‰ã€‚</li>
<li><code>frame &lt;n&gt;</code> - è·³è½¬åˆ°æŸä¸ªæ ˆå¸§ã€‚</li>
<li><code>up</code> è·³è½¬åˆ°ä¸Šä¸€ä¸ªæ ˆå¸§</li>
<li><code>x/FMT</code>: <code>x</code> è¡¨ç¤º <code>examine</code> ï¼ŒæŸ¥çœ‹å†…å­˜ã€‚<ul>
<li><code>/i</code> è¡¨ç¤º <code>instruction</code> ï¼Œå³æŸ¥çœ‹æ±‡ç¼–æŒ‡ä»¤ã€‚</li>
<li><code>/g</code> è¡¨ç¤º <code>giant word</code> ï¼Œå³æ¯æ¬¡æŸ¥çœ‹ 8 å­—èŠ‚ã€‚<ul>
<li><code>x/g 0x400000</code> æŸ¥çœ‹åœ°å€ 0x400000 å¤„çš„ 8 å­—èŠ‚å†…å®¹ï¼ˆä»¥åå…­è¿›åˆ¶æ˜¾ç¤ºï¼‰</li>
<li><code>x/4g $rsp</code> æŸ¥çœ‹å½“å‰æ ˆæŒ‡é’ˆ <code>$rsp</code> æŒ‡å‘çš„è¿ç»­ 4 ä¸ª 8 å­—èŠ‚å€¼ï¼ˆå…± 32 å­—èŠ‚ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">å‘½ä»¤</th>
<th align="center">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="center">x&#x2F;g</td>
<td align="center">é»˜è®¤åå…­è¿›åˆ¶æ˜¾ç¤º 8 å­—èŠ‚å†…å®¹</td>
</tr>
<tr>
<td align="center">x&#x2F;dg</td>
<td align="center">åè¿›åˆ¶æ˜¾ç¤º 8 å­—èŠ‚å†…å®¹</td>
</tr>
<tr>
<td align="center">x&#x2F;ug</td>
<td align="center">æ— ç¬¦å·åè¿›åˆ¶æ˜¾ç¤º 8 å­—èŠ‚å†…å®¹</td>
</tr>
<tr>
<td align="center">x&#x2F;tg</td>
<td align="center">äºŒè¿›åˆ¶æ˜¾ç¤º 8 å­—èŠ‚å†…å®¹</td>
</tr>
<tr>
<td align="center">x&#x2F;fg</td>
<td align="center">æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤º 8 å­—èŠ‚å†…å®¹ï¼ˆdoubleï¼‰</td>
</tr>
</tbody></table>
<h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>è§<a target="_blank" rel="noopener" href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_set_environm.htm">é“¾æ¥</a></p>
<h2 id="æ–­ç‚¹"><a href="#æ–­ç‚¹" class="headerlink" title="æ–­ç‚¹"></a>æ–­ç‚¹</h2><p>æ·»åŠ æ–­ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">break file:line_no</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹æ–­ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info break</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ç¬¬2ä¸ªæ–­ç‚¹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete 2</span><br></pre></td></tr></table></figure>


<h3 id="æ¡ä»¶æ–­ç‚¹"><a href="#æ¡ä»¶æ–­ç‚¹" class="headerlink" title="æ¡ä»¶æ–­ç‚¹"></a>æ¡ä»¶æ–­ç‚¹</h3><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/8255.html">åšå®¢</a>ã€<a target="_blank" rel="noopener" href="https://ftp.gnu.org/old-gnu/Manuals/gdb/html_node/gdb_28.html">æ–‡æ¡£</a>ã€‚</p>
<p><code>break ... if cond</code></p>
<h3 id="è§‚å¯Ÿæ–­ç‚¹"><a href="#è§‚å¯Ÿæ–­ç‚¹" class="headerlink" title="è§‚å¯Ÿæ–­ç‚¹"></a>è§‚å¯Ÿæ–­ç‚¹</h3><h3 id="æ•æ‰æ–­ç‚¹"><a href="#æ•æ‰æ–­ç‚¹" class="headerlink" title="æ•æ‰æ–­ç‚¹"></a>æ•æ‰æ–­ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">try...catch</span><br></pre></td></tr></table></figure>

<h3 id="æ‰“å°é•¿åº¦çš„é™åˆ¶"><a href="#æ‰“å°é•¿åº¦çš„é™åˆ¶" class="headerlink" title="æ‰“å°é•¿åº¦çš„é™åˆ¶"></a>æ‰“å°é•¿åº¦çš„é™åˆ¶</h3><ul>
<li>Value sizes - å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/Value-Sizes.html">æ–‡æ¡£</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> max-value-size bytes</span><br><span class="line"><span class="built_in">set</span> max-value-size unlimited</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ‰“å°å­—ç¬¦é•¿åº¦é™åˆ¶</p>
<p>gdbé»˜è®¤è®¾ç½®æ‰“å°å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º200ï¼›æ›´æ”¹æ‰“å°æœ€å¤§é•¿åº¦ï¼š<code>set print elements</code></p>
</li>
</ul>
<h2 id="coredump"><a href="#coredump" class="headerlink" title="coredump"></a>coredump</h2><p>gdbå‘½ä»¤ï¼š<code>gcore</code>ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/core.5.html">Reference</a></p>
<h2 id="WSLæ— æ³•ä½¿ç”¨gdb"><a href="#WSLæ— æ³•ä½¿ç”¨gdb" class="headerlink" title="WSLæ— æ³•ä½¿ç”¨gdb"></a>WSLæ— æ³•ä½¿ç”¨gdb</h2><p>WSLæŒ‡Windowsè™šæ‹Ÿæœºã€‚</p>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/WSL/issues/8516">è§£å†³æ–¹æ³•</a>ï¼š</p>
<p>å®‰è£…<a target="_blank" rel="noopener" href="https://launchpad.net/~ubuntu-support-team/+archive/ubuntu/gdb">PPAçš„daily buildç‰ˆæœ¬</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-support-team/gdb</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install gdb</span><br></pre></td></tr></table></figure>

<h2 id="gdb-attach-æƒé™æŠ¥é”™"><a href="#gdb-attach-æƒé™æŠ¥é”™" class="headerlink" title="gdb attach æƒé™æŠ¥é”™"></a>gdb attach æƒé™æŠ¥é”™</h2><p>This is due to kernel hardening in Linux; you can disable this behavior by <code>echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</code> or by modifying it in <code>/etc/sysctl.d/10-ptrace.conf</code>.</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19215177/how-to-solve-ptrace-operation-not-permitted-when-trying-to-attach-gdb-to-a-pro">How to solve â€œptrace operation not permittedâ€ when trying to attach GDB to a process?</a></p>
<h2 id="gdb-debug-forks"><a href="#gdb-debug-forks" class="headerlink" title="gdb debug forks"></a>gdb debug forks</h2><p><a target="_blank" rel="noopener" href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Forks.html">Reference</a></p>
<p>By default, when a program forks, gdb will continue to debug the parent process and the child process will run unimpeded.</p>
<p>If you want to follow the child process instead of the parent process, use the command set <code>follow-fork-mode</code>.</p>
<p><code>set follow-fork-mode mode</code><br>Set the debugger response to a program call of <code>fork</code> or <code>vfork</code>. A call to fork or vfork creates a new process. The mode argument can be:<br><code>parent</code><br>The original process is debugged after a fork. The child process runs unimpeded. This is the default.<br><code>child</code><br>The new process is debugged after a fork. The parent process runs unimpeded.<br><code>ask</code><br>gdb ä¼šæç¤ºè®©ä½ é€‰æ‹© <code>parent</code> è¿˜æ˜¯ <code>child</code> ã€‚</p>
<p><code>show follow-fork-mode</code><br>Display the current debugger response to a fork or vfork call.<br>On Linux, if you want to debug both the parent and child processes, use the command set detach-on-fork.</p>
<p><code>set detach-on-fork mode</code><br>Tells gdb whether to detach one of the processes after a fork, or retain debugger control over them both.<br><code>on</code><br>The child process (or parent process, depending on the value of follow-fork-mode) will be detached and allowed to run independently. This is the default.<br><code>off</code><br>Both processes will be held under the control of gdb. One process (child or parent, depending on the value of follow-fork-mode) is debugged as usual, while the other is held suspended.</p>
<p><code>show detach-on-fork</code><br>Show whether detach-on-fork mode is on&#x2F;off.</p>
<p>If you issue a run command to gdb after an exec call executes, the new target restarts. To restart the parent process, use the file command with the parent executable name as its argument. By default, after an exec call executes, gdb discards the symbols of the previous executable image. You can change this behaviour with the set follow-exec-mode command.</p>
<p>set follow-exec-mode mode<br>Set debugger response to a program call of exec. An exec call replaces the program image of a process.<br>follow-exec-mode can be:</p>
<p><code>new</code><br>gdb creates a new inferior and rebinds the process to this new inferior. The program the process was running before the exec call can be restarted afterwards by restarting the original inferior.<br>For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">(gdb) info inferior</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 2    &lt;null&gt;        prog2</span><br><span class="line">  1    &lt;null&gt;        prog1</span><br></pre></td></tr></table></figure>

<p><code>same</code><br>gdb keeps the process bound to the same inferior. The new executable image replaces the previous executable loaded in the inferior. Restarting the inferior after the exec call, with e.g., the run command, restarts the executable the process was running after the exec call. This is the default mode.<br>For example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog2</span><br></pre></td></tr></table></figure>

<h2 id="Setting-Catchpoints"><a href="#Setting-Catchpoints" class="headerlink" title="Setting Catchpoints"></a>Setting Catchpoints</h2><p><a target="_blank" rel="noopener" href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Set-Catchpoints.html#Set-Catchpoints">Reference</a></p>
<h2 id="gdb-redirect-to-a-log-file"><a href="#gdb-redirect-to-a-log-file" class="headerlink" title="gdb redirect to a log file"></a>gdb redirect to a log file</h2><p>You need to enable logging:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set logging on</span><br><span class="line">Now GDB will log to ./gdb.txt. You can tell it which file to use:</span><br><span class="line"></span><br><span class="line">(gdb) set logging file my_god_object.log</span><br><span class="line">And you can examine the current logging configuration:</span><br><span class="line"></span><br><span class="line">(gdb) show logging</span><br></pre></td></tr></table></figure>

<p>æ›´æ–°ï¼šæ–°ç‰ˆæœ¬ gdb é‡‡ç”¨ <code>set logging enabled on</code> ã€‚</p>
<p>è®°å½•è¾“å…¥çš„å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set trace-commands on</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5941158/gdb-print-to-file-instead-of-stdout">Refercence</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/gcc%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/cpp/gcc%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">gcc å…¥é—¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:44:11" itemprop="dateCreated datePublished" datetime="2024-01-23T21:44:11+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="é€’å½’å¤„ç†é¡ºåº"><a href="#é€’å½’å¤„ç†é¡ºåº" class="headerlink" title="é€’å½’å¤„ç†é¡ºåº"></a>é€’å½’å¤„ç†é¡ºåº</h2><p>gcc çš„è¾“å…¥æ–‡ä»¶å’Œåº“æ˜¯ä»å·¦å¾€å³å¤„ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¸‹å‘½ä»¤æ˜¯é”™è¯¯çš„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -L. -la main.cc</span><br></pre></td></tr></table></figure>

<p>é“¾æ¥å™¨å¤„ç†åˆ°æŸä¸ªç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚ main.cc ç¼–è¯‘åçš„ç›®æ ‡ä»£ç ï¼‰æ—¶ï¼Œå¦‚æœé‡åˆ°æœªè§£æçš„ç¬¦å·ï¼ˆæ¯”å¦‚ f() ï¼‰ï¼Œ<br>å®ƒä¼šä»æ¥ä¸‹æ¥çš„åº“ä¸­æŸ¥æ‰¾è¿™äº›ç¬¦å·ã€‚å› æ­¤é¡ºåºéå¸¸é‡è¦ã€‚</p>
<p>è¿™é‡Œï¼Œ-L. -la é€‰é¡¹åœ¨ main.cc ä¹‹å‰ï¼Œé“¾æ¥å™¨ä¼šé¦–å…ˆå°è¯•ä» liba.so ä¸­æŸ¥æ‰¾å¼•ç”¨çš„ç¬¦å·ï¼Œ<br>ä½†æ˜¯ï¼Œå› ä¸ºæ­¤æ—¶ main.cc è¿˜æœªè¢«å¤„ç†ï¼Œæ‰€ä»¥é“¾æ¥å™¨è¿˜ä¸çŸ¥é“æœ‰å¯¹ liba.so ä¸­çš„å‡½æ•° f() çš„å¼•ç”¨ã€‚<br>åˆ°äº† main.cc ï¼Œé“¾æ¥å™¨è§£æå‡ºå¼•ç”¨ï¼Œä½†å®ƒä¸ä¼šå›å¤´å†å» liba.so ä¸­æŸ¥æ‰¾ï¼Œå¯¼è‡´æŠ¥é”™ï¼šâ€undefined reference to f()â€ã€‚</p>
<p>æ­£ç¡®çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.cc -L. -la</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šliba.so çš„æŒ‡å®šå¿…é¡»å»æ‰ lib å’Œ .so ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸ç›´æ¥æŒ‡å®šâ€œåº“æ–‡ä»¶åâ€ï¼Œè€Œæ˜¯åªèƒ½æŒ‡å®šâ€œåº“åâ€ã€‚<br>å¦‚æœæƒ³ç›´æ¥æŒ‡å®šåº“æ–‡ä»¶åï¼Œé‚£ä¹ˆåº”è¯¥æŠŠ liba.so å½“æˆè¾“å…¥æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.cc ./liba.so</span><br></pre></td></tr></table></figure>

<h2 id="å±æ€§è¯­æ³•ï¼ˆAttribute-Syntaxï¼‰"><a href="#å±æ€§è¯­æ³•ï¼ˆAttribute-Syntaxï¼‰" class="headerlink" title="å±æ€§è¯­æ³•ï¼ˆAttribute Syntaxï¼‰"></a>å±æ€§è¯­æ³•ï¼ˆAttribute Syntaxï¼‰</h2><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Attribute-Syntax.html#Attribute%20Syntax">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="å‡½æ•°å±æ€§ï¼ˆFunction-Attributesï¼‰"><a href="#å‡½æ•°å±æ€§ï¼ˆFunction-Attributesï¼‰" class="headerlink" title="å‡½æ•°å±æ€§ï¼ˆFunction Attributesï¼‰"></a>å‡½æ•°å±æ€§ï¼ˆFunction Attributesï¼‰</h3><p>å‚è€ƒï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/11621043/how-should-i-properly-use-attribute-format-printf-x-y-inside-a-class">stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Function-Attributes.html">gccå®˜æ–¹æ–‡æ¡£ï¼šFunction Attributes</a></li>
</ul>
<p>å±æ€§åˆ—ä¸¾ï¼š</p>
<ul>
<li><p><code>format (archetype, string-index, first-to-check)</code></p>
<p>  format å±æ€§ï¼ŒæŒ‡å®šå‡½æ•°é‡‡ç”¨ printfã€scanfã€strftime æˆ– strfmon é£æ ¼çš„å‚æ•°ï¼Œ<br>  è¿™äº›å‚æ•°åº”æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²ï¼ˆformat stringï¼‰è¿›è¡Œç±»å‹æ£€æŸ¥ï¼ˆtype-checkedï¼‰ã€‚<br>  ç±»å‹æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æœŸã€‚</p>
<p>  ä¸¾ä¾‹ï¼š</p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">my_printf</span> <span class="params">(<span class="type">void</span> *my_object, <span class="type">const</span> <span class="type">char</span> *my_format, ...)</span></span></span><br><span class="line"><span class="function">    __<span class="title">attribute__</span> <span class="params">((format (printf, <span class="number">2</span>, <span class="number">3</span>)))</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>archetype</code>å†³å®šformat stringåº”è¯¥å¦‚ä½•è§£é‡Šã€‚<br>å¯é€‰ä¸º<code>printf</code>ã€<code>scanf</code>ã€<code>strftime</code>æˆ–<code>strfmon</code>ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨<code>__printf__</code>ã€<code>__scanf__</code>ã€<code>__strftime__</code>æˆ–<code>__strfmon__</code>ï¼‰ã€‚</li>
<li><code>string-index</code>æŒ‡å®šå“ªä¸ªå‚æ•°æ˜¯format stringï¼ˆä»1å¼€å§‹ï¼‰ã€‚</li>
<li><code>first-to-check</code>æŒ‡å®šformat stringå¯¹åº”çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åºå·ã€‚<br>å¯¹äºé‚£äº›æ— æ³•æ£€æŸ¥å‚æ•°çš„å‡½æ•°ï¼ˆæ¯”å¦‚<code>vprintf</code>ï¼‰ï¼Œè¯¥å‚æ•°æŒ‡å®šä¸º<code>0</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä»…æ£€æŸ¥format stringçš„ä¸€è‡´æ€§ã€‚å¯¹äº<code>strftime</code>æ ¼å¼ï¼Œè¯¥å‚æ•°å¿…é¡»ä¸º<code>0</code>ã€‚</li>
</ul>
</li>
</ul>
<h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><ul>
<li><code>-save-temps</code>: å¯ä»¥ä¿ç•™æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼Œä¾‹å¦‚é¢„ç¼–è¯‘æ–‡ä»¶ã€æ±‡ç¼–æ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶ç­‰ã€‚</li>
</ul>
<h2 id="ç¬¦å·å¯è§æ€§"><a href="#ç¬¦å·å¯è§æ€§" class="headerlink" title="ç¬¦å·å¯è§æ€§"></a>ç¬¦å·å¯è§æ€§</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC visibility push(hidden)</span></span><br><span class="line"></span><br><span class="line">__attribute__((__visibility__(<span class="string">&quot;default&quot;</span>)))</span><br></pre></td></tr></table></figure>

<p>gcc ç¼–è¯‘é€‰é¡¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fvisibility=hidden ...</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/core-dump/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/cpp/core-dump/" class="post-title-link" itemprop="url">core dump</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:42:51" itemprop="dateCreated datePublished" datetime="2024-01-23T21:42:51+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a><code>ulimit</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹é…ç½®</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="comment">#è®¾ç½®core file size</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure>

<p><code>ulimit</code>åªå¯¹å½“å‰ç»ˆç«¯æœ‰æ•ˆã€‚</p>
<p>ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯¹æ‰€æœ‰ç”¨æˆ·å’Œç»ˆç«¯æœ‰æ•ˆï¼š</p>
<ol>
<li>åœ¨<code>/etc/security/limits.conf</code>ä¸­è®¾ç½®ï¼ˆredhatè¡ç”Ÿç³»linuxï¼‰ã€‚</li>
<li>æˆ–æ³¨é‡Šæ‰<code>/etc/profile</code>ä¸­çš„è¿™ä¸€è¡Œï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># No core files by default</span></span><br><span class="line"><span class="built_in">ulimit</span> -S -c 0 &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="core-pattern"><a href="#core-pattern" class="headerlink" title="core_pattern"></a>core_pattern</h2><h3 id="core-patternè§£é‡Š"><a href="#core-patternè§£é‡Š" class="headerlink" title="core_patternè§£é‡Š"></a>core_patternè§£é‡Š</h3><p>è§<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2065912/core-dumped-but-core-file-is-not-in-the-current-directory">é“¾æ¥</a>ã€‚</p>
<p>Read <a target="_blank" rel="noopener" href="http://www.kernel.org/doc/Documentation/sysctl/kernel.txt">&#x2F;usr&#x2F;src&#x2F;linux&#x2F;Documentation&#x2F;sysctl&#x2F;kernel.txt</a>.</p>
<pre><code>core_pattern is used to specify a core dumpfile pattern name.
</code></pre>
<p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œ<a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/Apport">Apport</a>ï¼ˆcrash reporting serviceï¼‰ä¼šç”Ÿæˆé…ç½®æ–‡ä»¶<code>/proc/sys/kernel/core_pattern</code>ã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://askubuntu.com/questions/420410/how-to-permanently-edit-the-core-pattern-file">è¿™é‡Œ</a>ã€‚</p>
<p>Apport uses <code>/proc/sys/kernel/core_pattern</code> to directly pipe the core dump into <code>apport</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">|/usr/share/apport/apport %p %s %c</span><br><span class="line">$ </span><br></pre></td></tr></table></figure>

<p>Note that even if <code>ulimit</code> is set to disabled core files (by specyfing a core file size of zero using <code>ulimit -c 0</code>), <code>apport</code> will still capture the crash.</p>
<p>For intercepting Python crashes it installs a <code>/etc/python*/sitecustomize.py</code> to call apport on unhandled exceptions.</p>
<p>å…¶ä¸­ï¼Œ<code>/usr/share/apport/apport</code>æ˜¯ä¸€ä¸ªpythonè„šæœ¬ã€‚</p>
<p>ä»¥ä¸‹æ˜¯core_patternæ–‡ä»¶çš„å‚æ•°è¯´æ˜ï¼ˆå‚è€ƒLinux Manual Pageï¼š<code>man core</code>ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%c - Core file size soft resource limit of crashing process (since Linux 2.6.24).</span><br><span class="line">%p - insert pid into filename æ·»åŠ pid</span><br><span class="line">%u - insert current uid into filename æ·»åŠ å½“å‰uid</span><br><span class="line">%g - insert current gid into filename æ·»åŠ å½“å‰gid</span><br><span class="line">%s - insert signal that caused the coredump into the filename æ·»åŠ å¯¼è‡´äº§ç”Ÿcoreçš„ä¿¡å·</span><br><span class="line">%t - insert UNIX time that the coredump occurred into filename æ·»åŠ coreæ–‡ä»¶ç”Ÿæˆæ—¶çš„unixæ—¶é—´</span><br><span class="line">%h - insert hostname where the coredump happened into filename æ·»åŠ ä¸»æœºå</span><br><span class="line">%e - insert coredumping executable name into filename æ·»åŠ å‘½ä»¤å</span><br><span class="line"></span><br><span class="line">If the first character of the pattern is a &#x27;|&#x27;, the kernel will treat the rest of the pattern as a command to run. The core dump will be written to the standard input of that program instead of to a file.</span><br></pre></td></tr></table></figure>

<p>Apportçš„æ‹¦æˆªç»„ä»¶é»˜è®¤æ˜¯å…³é—­çš„ï¼š</p>
<p>Apport itself is running at all times because it collects crash data for whoopsie (see <a target="_blank" rel="noopener" href="https://wiki.ubuntu.com/ErrorTracker">ErrorTracker</a>). However, the crash interception component is still disabled. To enable it permanently, do:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apport/crashdb.conf</span><br></pre></td></tr></table></figure>

<p>â€¦ and add a hash symbol # in the beginning of the following line:</p>
<pre><code>&#39;problem_types&#39;: [&#39;Bug&#39;, &#39;Package&#39;],
</code></pre>
<p>To disable crash reporting just remove the hash symbol.</p>
<h3 id="è®¾ç½®core-pattern"><a href="#è®¾ç½®core-pattern" class="headerlink" title="è®¾ç½®core_pattern"></a>è®¾ç½®core_pattern</h3><p>è§<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaodoujiaohome/p/6222895.html">é“¾æ¥</a>ã€‚</p>
<ol>
<li><p>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_uses_pidå¯ä»¥æ§åˆ¶äº§ç”Ÿçš„coreæ–‡ä»¶çš„æ–‡ä»¶åä¸­æ˜¯å¦æ·»åŠ pidä½œä¸ºæ‰©å±•ï¼Œå¦‚æœæ·»åŠ åˆ™æ–‡ä»¶å†…å®¹ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼›</p>
</li>
<li><p>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_patternå¯ä»¥è®¾ç½®æ ¼å¼åŒ–çš„coreæ–‡ä»¶ä¿å­˜ä½ç½®æˆ–æ–‡ä»¶åï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">|/usr/share/apport/apport %p %s %c</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;/corefile/core-%e-%p-%t&quot;</span> &gt; /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure>


<p> ä½ å¯ä»¥ç”¨ä¸‹åˆ—æ–¹å¼æ¥å®Œæˆï¼š</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰sysctlæ‰€æœ‰å˜é‡çš„å€¼ã€‚</span></span><br><span class="line">sysctl -a</span><br><span class="line"><span class="comment">#è®¾ç½®å˜é‡kernel.core_patternä¸ºå¦‚ä¸‹å€¼ã€‚</span></span><br><span class="line">sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</span><br></pre></td></tr></table></figure>

<p> è¿™äº›æ“ä½œä¸€æ—¦è®¡ç®—æœºé‡å¯ï¼Œåˆ™ä¼šä¸¢å¤±ï¼Œå¦‚æœä½ æƒ³æŒä¹…åŒ–è¿™äº›æ“ä½œï¼Œå¯ä»¥åœ¨ &#x2F;etc&#x2F;sysctl.confæ–‡ä»¶ä¸­å¢åŠ ï¼š</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.core_pattern=/tmp/core%p</span><br></pre></td></tr></table></figure>

<p> åŠ å¥½åï¼Œå¦‚æœä½ æƒ³ä¸é‡å¯çœ‹çœ‹æ•ˆæœçš„è¯ï¼Œåˆ™ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.conf</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ç›¸å…³å‘½ä»¤è¡Œå·¥å…·"><a href="#ç›¸å…³å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="ç›¸å…³å‘½ä»¤è¡Œå·¥å…·"></a>ç›¸å…³å‘½ä»¤è¡Œå·¥å…·</h2><p>å‚è€ƒèµ„æ–™ï¼š</p>
<p>Linux Manual Page: <a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/core.5.html"><code>man core</code></a></p>
<pre><code>SEE ALSO
    bash(1),  coredumpctl(1),  gdb(1),  getrlimit(2), mmap(2), prctl(2), sigaction(2), elf(5), proc(5), pthreads(7), signal(7), systemd-coredump(8)
</code></pre>
<h2 id="Segment-Faultæ’æŸ¥"><a href="#Segment-Faultæ’æŸ¥" class="headerlink" title="Segment Faultæ’æŸ¥"></a>Segment Faultæ’æŸ¥</h2><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://www.wtango.com/%E6%AE%B5%E9%94%99%E8%AF%AFsegmentation-fault%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0%E4%BB%A5%E5%8F%8A%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95/">é“¾æ¥</a>ã€‚</p>
<ol>
<li><p>dmesg + nm + addr2line</p>
<p>addr2lineåªèƒ½æ‰¾å‡ºexecutableçš„è¡Œå·ï¼›å¦‚æœæ˜¯shared librariesï¼Œè¯·ä½¿ç”¨gdbã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2549214/interpreting-segfault-messages">è¿™é‡Œ</a>ã€‚</p>
<p>dmesgè¾“å‡ºçš„å«ä¹‰ï¼š</p>
<p>ip: è¡¨ç¤ºinstruction pointer.</p>
</li>
<li><p>fprintf</p>
</li>
<li><p>gdb</p>
</li>
<li><p>signal(SIGSEGV,handler)</p>
</li>
<li><p>valgrind<br>å‚è€ƒï¼š<br> <a target="_blank" rel="noopener" href="https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/">åšå®¢</a><br> <a target="_blank" rel="noopener" href="https://valgrind.org/docs/manual/ms-manual.html">æ–‡æ¡£</a><br> <a target="_blank" rel="noopener" href="https://courses.cs.washington.edu/courses/cse326/05wi/valgrind-doc/ms_main.html">å¯ä»¥ä½¿ç”¨PostScriptæŸ¥çœ‹å›¾å½¢åŒ–ç»“æœ</a></p>
</li>
<li><p>heaptrack</p>
<p> è§<a target="_blank" rel="noopener" href="https://github.com/KDE/heaptrack">githubä»“åº“</a></p>
</li>
<li><p>Jemalloc</p>
<p> è§<a target="_blank" rel="noopener" href="https://jemalloc.net/">å®˜ç½‘</a></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/cpp/%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5/" class="post-title-link" itemprop="url">ç¼–è¯‘å’Œé“¾æ¥</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:36:08" itemprop="dateCreated datePublished" datetime="2024-01-23T21:36:08+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç¼–è¯‘ä¸»è¦æ­¥éª¤"><a href="#ç¼–è¯‘ä¸»è¦æ­¥éª¤" class="headerlink" title="ç¼–è¯‘ä¸»è¦æ­¥éª¤"></a>ç¼–è¯‘ä¸»è¦æ­¥éª¤</h2><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.csdn.net/chen1415886044/article/details/104537547">åšå®¢</a></p>
<ol>
<li>é¢„å¤„ç†</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -E test.c -o test.i</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>ç¼–è¯‘</p>
<p> ç¼–è¯‘æ˜¯å°†é«˜çº§è¯­è¨€ï¼ˆä¾‹å¦‚Cã€C++ã€Javeç­‰ï¼‰ä»£ç è½¬æ¢æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚<br> ç¼–è¯‘å¯ä»¥åˆ†æˆå¤šä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä¼˜åŒ–å’Œä»£ç ç”Ÿæˆã€‚<br> ç¼–è¯‘å™¨é¦–å…ˆå°†æºä»£ç è½¬æ¢ä¸€ç§ä¸­é—´è¡¨ç¤ºï¼ˆé€šå¸¸æ˜¯æ±‡ç¼–ä»£ç æˆ–å­—èŠ‚ç ï¼‰ï¼Œç„¶åå†å°†å…¶è½¬æ¢ä¸ºç›®æ ‡æœºå™¨çš„æœºå™¨ä»£ç ã€‚<br> ç»è¿‡ç¼–è¯‘çš„ä»£ç é€šå¸¸æ˜¯äºŒè¿›åˆ¶çš„ï¼Œå¯ä»¥ç›´æ¥åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œã€‚</p>
</li>
</ol>
<p>å…ˆç”Ÿæˆæ±‡ç¼–ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S test.i -o test.s</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>æ±‡ç¼–</p>
<p> å°†æ±‡ç¼–ä»£ç è½¬æˆæœºå™¨ç ã€‚</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c test.s -o test.o</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>é“¾æ¥</p>
<p> è¯¥ç›®æ ‡æ–‡ä»¶ä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ç­‰é“¾æ¥èµ·æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc test.o -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p>Note: å¯ä»¥ä½¿ç”¨ <code>-save-temps</code> é€‰é¡¹ä»¥ä¿ç•™ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -save-temps test.c</span><br></pre></td></tr></table></figure>

<h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><h2 id="C-åç§°ä¿®é¥°"><a href="#C-åç§°ä¿®é¥°" class="headerlink" title="C++åç§°ä¿®é¥°"></a>C++åç§°ä¿®é¥°</h2><p><code>Name mangling (C++ only)</code>: åç§°ä¿®é¥°ï¼Œä¹Ÿç§°ä¸ºåç§°é‡æ•´ã€åç§°æ”¹ç¼–ã€‚å‚è§é“¾æ¥<a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/i/7.2?topic=linkage-name-mangling-c-only">1</a>ã€<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%90%8D%E5%AD%97%E4%BF%AE%E9%A5%B0">2</a>ã€‚</p>
<h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>å‚è€ƒï¼š<code>man ld.so</code></p>
<pre><code>PATH
LD_LIBRARY_PATH
LD_PRELOAD  åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¼ºåˆ¶ä¼˜å…ˆåŠ è½½æŒ‡å®šçš„å…±äº«åº“ï¼Œå³ä½¿ç³»ç»Ÿä¸­å·²æœ‰å…¶ä»–ç‰ˆæœ¬ã€‚å¸¸ç”¨äºè°ƒè¯•ã€æ€§èƒ½åˆ†æã€å‡½æ•°æ‹¦æˆªï¼ˆhookï¼‰ç­‰ã€‚
            åªåœ¨è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚
            ä¼˜å…ˆçº§é«˜äº rpathã€LD_LIBRARY_PATH ç­‰ã€‚
            å¯ä»¥ç”¨æ¥â€œæ³¨å…¥â€åº“ï¼Œä¿®æ”¹ç¨‹åºè¡Œä¸ºã€‚
LD_DEBUG

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_DEBUG=libs ./your_executable 2&gt;&amp;1 | grep tcl</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><p>å‚è€ƒï¼š<code>man ld.so</code>, <code>man vdso</code>, <code>man elf</code>, <a target="_blank" rel="noopener" href="https://linux.die.net/man/1/scanelf">scanelf</a></p>
<pre><code>ld(1), ldd(1), pldd(1), sprof(1), dlopen(3),getauxval(3), elf(5), capabilities(7),
rtld-audit(7), ldconfig(8), sln(8), vdso(7), as(1), elfedit(1), gdb(1), nm(1),
objcopy(1), objdump(1), patchelf(1), readelf(1), size(1), strings(1), strip(1),
execve(2), dl_iterate_phdr(3), core(5), ld.so(8)
</code></pre>
<p>ldconfig</p>
<pre><code>é…ç½®åŠ¨æ€è¿æ¥å™¨ï¼ˆdynamic linkerï¼‰çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆdynamic bindingsï¼‰ã€‚
å¦‚æœä½ åˆšåˆšå®‰è£…å¥½å…±äº«åº“ï¼ˆsoçš„ç‰ˆæœ¬å·è¢«æ›´æ–°ï¼‰ï¼Œå¯èƒ½éœ€è¦è¿è¡Œldconfigï¼š
    sudo ldconfig
é€šå¸¸éœ€è¦è¶…çº§ç”¨æˆ·æ¥è¿è¡Œldconfigï¼Œå› ä¸ºå¯èƒ½å¯¹éœ€è¦æŸäº›rootç”¨æˆ·æ‰€æœ‰çš„ç›®å½•å’Œæ–‡ä»¶æœ‰å†™å…¥æƒé™ã€‚
lddconfig ä¸ºä»ä»¥ä¸‹ç›®å½•æ‰¾åˆ°çš„å…±äº«åº“åˆ›å»ºå¿…è¦çš„ links å’Œ cache ( `/etc/ld.so.cache` )ï¼š
    command lineæŒ‡å®šçš„ç›®å½•ï¼›
    /etc/ld.so.confæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›®å½•ï¼›
    å—ä¿¡ä»»çš„ç›®å½•: /lib, /lib64, /usr/lib, /usr/lib64 ã€‚
è¯¥ cache è¢«è¿è¡Œæ—¶è¿æ¥å™¨ï¼ˆrun-time linkerï¼‰ ld.so æˆ– ld-linux.so ä½¿ç”¨ã€‚
æ³¨æ„ï¼šå¦‚æœ so çš„ç‰ˆæœ¬å·æ²¡æœ‰æ›´æ–°ï¼Œè€Œåªæ›´æ–°äº†ä»£ç ï¼Œé‚£ä¹ˆ ldconfig å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œexecutable å¯èƒ½è¿˜æ˜¯é“¾æ¥æ—§ so ä¸Šï¼ˆå¦‚æœæ—§ so æ²¡æœ‰è¢«åˆ ï¼‰ã€‚

ldconfig å°è¯•åŸºäºè¯¥åº“è¿æ¥çš„ C åº“æ¥æ¨æ–­ ELF åº“ï¼ˆæ¯”å¦‚ libc5 æˆ– libc6/glibcï¼‰çš„ç±»å‹ã€‚

ä¸€äº›ç°æœ‰çš„åº“æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ¨æ–­å…¶ç±»å‹ã€‚
å› æ­¤ï¼Œ /etc/ld.so.conf æ–‡ä»¶æ ¼å¼å…è®¸æŒ‡å®šæœŸæœ›çš„ç±»å‹ã€‚
è¿™åªåœ¨è¿™äº› ELF åº“ä¸èƒ½è¢«è§£å†³çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚

ldconfig æœŸæœ›çš„ç¬¦å·é“¾æ¥æœ‰æŸç§ç‰¹å®šçš„å½¢å¼ï¼Œæ¯”å¦‚ï¼š

    libfoo.so -&gt; libfoo.so.1 -&gt; libfoo.so.1.12

å…¶ä¸­ï¼Œä¸­é—´çš„æ–‡ä»¶ libfoo.so.1 æ˜¯åº“çš„ SONAME ã€‚

å¦‚æœä¸éµå¾ªè¿™ç§æ ¼å¼å¯èƒ½ä¼šå¯¼è‡´å‡çº§åçš„å…¼å®¹æ€§é—®é¢˜ã€‚
</code></pre>
<p>ldd</p>
<pre><code>æè¿°ï¼š
    lddè°ƒç”¨æ ‡å‡†åŠ¨æ€è¿æ¥å™¨ï¼ˆè§ ld.so(8)ï¼‰ï¼Œå¹¶ä¸”å°†ç¯å¢ƒå˜é‡ LD_TRACE_LODADED_OBJECTS ä¸º 1 ã€‚
    è¿™ä¼šè®©åŠ¨æ€è¿æ¥å™¨æ£€æŸ¥ç¨‹åºçš„åŠ¨æ€ä¾èµ–ï¼Œå¹¶ä¸”å¯»æ‰¾ï¼ˆæ ¹æ® ld.so(8) æè¿°çš„è§„åˆ™ï¼‰
    å’ŒåŠ è½½æ»¡è¶³è¿™äº›ä¾èµ–çš„ç›®æ ‡ã€‚å¯¹äºæ¯ä¸€æ¡ä¾èµ–ï¼Œ
    ldd æ˜¾ç¤ºåŒ¹é…çš„ç›®æ ‡çš„ä½ç½®å’Œå…¶è½½å…¥å¤„çš„16è¿›åˆ¶åœ°å€ã€‚
    ï¼ˆlinux-vdsoå’Œld-linuxå…±äº«ä¾èµ–æ˜¯ç‰¹æ®Šçš„ï¼›è§vdso(7)å’Œld.so(8)ï¼‰

å®‰å…¨æ€§ï¼š
    æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€äº›ç‰ˆæœ¬çš„lddå¯èƒ½ä¼šå°è¯•é€šè¿‡ç›´æ¥è¿è¡Œç¨‹åºï¼ˆå¯èƒ½å¯¼è‡´ç¨‹åºä¸­çš„ELFè§£é‡Šå™¨
    æˆ–ç¨‹åºæœ¬èº«çš„è¿è¡Œï¼‰æ¥è·å–ä¾èµ–ä¿¡æ¯ã€‚

    å› æ­¤ï¼Œæ°¸è¿œä¸è¦åœ¨ä¸å—ä¿¡ä»»çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä½¿ç”¨lddï¼Œå› ä¸ºä¼šå¯¼è‡´éšæ„ä»£ç çš„è¿è¡Œã€‚æ›´å®‰å…¨æ›¿ä»£æ–¹æ³•ä¸ºï¼š
        $ objdump -p /path/to/program | grep NEEDED
    æ³¨æ„ï¼Œè¿™ç§æ›¿ä»£æ–¹æ³•åªä¼šæ˜¾ç¤ºè¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„ç›´æ¥ä¾èµ–ï¼Œè€Œlddæ˜¾ç¤ºè¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ•´ä¸ªä¾èµ–æ ‘ã€‚

è§£é‡Šlddçš„è¾“å‡º:
$ ldd -v libibsupport_real.so 
./libibsupport_real.so: /usr/lib64/libibverbs.so.1: version `IBVERBS_1.8&#39; not found (required by ./libibsupport_real.so)
    linux-vdso.so.1 =&gt;  (0x00002ad3e49e3000)
    libibverbs.so.1 =&gt; /usr/lib64/libibverbs.so.1 (0x00002ad3e589b000)
    ...

    Version information:
    ./libibsupport_real.so:
            libgcc_s.so.1 (GCC_3.0) =&gt; /usr/lib64/libgcc_s.so.1
            libibverbs.so.1 (IBVERBS_1.8) =&gt; not found
            libibverbs.so.1 (IBVERBS_1.1) =&gt; /usr/lib64/libibverbs.so.1
            ...
    /usr/lib64/libnl-3.so.200:
                libm.so.6 (GLIBC_2.2.5) =&gt; /usr/lib64/libm.so.6
                ...
åœ¨&quot;Version information&quot;ä¸­ï¼Œ&quot;libgcc_s.so.1 (GCC_3.0) =&gt; /usr/lib64/libgcc_s.so.1&quot;è¡¨ç¤ºï¼š
    &quot;libgcc_s.so.1&quot;æŒ‡å®šä¸€ä¸ªshared libraryçš„åå­—ï¼ˆlibgcc_s.so.1æ˜¯GCC runtime libraryçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè¯¥shared libraryä¸º&quot;./libibsupport_real.so&quot;æ‰€ä¾èµ–ï¼›
    &quot;(GCC_3.0)&quot;è¡¨æ˜&quot;libgcc_s.so.1&quot;éœ€è¦3.0ç‰ˆæœ¬åŠä»¥ä¸Šçš„GNU Compiler Collection (GCC)ï¼›
    &quot;=&gt;&quot;æŒ‡å‡ºæ»¡è¶³ä¾èµ–çš„shared libraryï¼›
    &quot;/usr/lib64/libgcc_s.so.1&quot;æ˜¯æ»¡è¶³è¦æ±‚çš„shared libraryçš„è·¯å¾„ã€‚
</code></pre>
<p>  <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34428037/how-to-interpret-the-output-of-the-ldd-program">ldd outputè¯´æ˜</a></p>
<p>sprof</p>
<p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/881074/how-to-use-sprof">stackoverflows</a></p>
<p>objdump</p>
<pre><code>[-p|--private-headers]
[-x|--all-headers]
</code></pre>
<p>readelf</p>
<pre><code>[-d|--dynamic]
</code></pre>
<h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><pre><code>/lib/ld.so
    Run-time linker/loader.
/etc/ld.so.conf
    File containing a list of directories, one per line, in which to search for libraries.
/etc/ld.so.cache
    File containing an ordered list of libraries found in the directories specified in /etc/ld.so.conf, as well as those found in the trusted directories.

The trusted directories:
    /lib
    /lib64
    /usr/lib
    /usr/lib64
</code></pre>
<p>ld.so</p>
<pre><code>åå­—
    ld.so, ld-linux.so - åŠ¨æ€è¿æ¥/åŠ è½½å™¨ã€‚

ç®€ä»‹
    åŠ¨æ€è¿æ¥å™¨å¯ä»¥è¢«é—´æ¥è¿è¡Œæˆ–ç›´æ¥è¿è¡Œã€‚
    é—´æ¥è¿è¡Œï¼š
        è¿è¡ŒæŸäº›åŠ¨æ€è¿æ¥ç¨‹åºæˆ–å…±äº«åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½å‘åŠ¨æ€è¿æ¥å™¨ä¼ é€’å‘½ä»¤è¡Œé€‰é¡¹ï¼›å¹¶ä¸”åœ¨ELFæƒ…å†µä¸‹ï¼Œå­˜å‚¨åœ¨ç¨‹åºçš„.interp sectionä¸­çš„åŠ¨æ€è¿æ¥å™¨è¢«æ‰§è¡Œã€‚
    ç›´æ¥è¿è¡Œï¼š
        /lib/ld-linux.so.* [OPTIONS] [PRAGRAM [ARGUMENTS]]

æè¿°
    ld.so å’Œ ld-linux.so* å¯»æ‰¾å’ŒåŠ è½½ç¨‹åºæ‰€éœ€çš„å…±äº«å¯¹è±¡ï¼ˆå…±äº«åº“ï¼‰ï¼Œå‡†å¤‡ç¨‹åºçš„è¿è¡Œï¼Œç„¶åè¿è¡Œå®ƒã€‚

    å¦‚æœåœ¨ç¼–è¯‘æœŸæ²¡æœ‰å‘ ld(1) æŒ‡å®š -static é€‰é¡¹ï¼Œåˆ™LinuxäºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦åŠ¨æ€è¿æ¥ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ï¼‰ã€‚
</code></pre>
<h3 id="SONAME"><a href="#SONAME" class="headerlink" title="SONAME"></a>SONAME</h3><p>å‚è€ƒï¼š<code>man ldconfig</code><br>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Soname">SONAME Wiki</a></p>
<blockquote>
<p>GNU linkerä½¿ç”¨ -hname æˆ– -soname&#x3D;name æ¥æŒ‡å®šè¯¥åº“çš„library name fieldã€‚<br>åœ¨å†…éƒ¨ï¼Œlinkerä¼šåˆ›å»ºä¸€ä¸ª DT_SONAME fieldå¹¶ä¸”ç”¨ name æ¥å¡«å……å®ƒã€‚</p>
</blockquote>
<ol>
<li>æŒ‡å®šSONAMEï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Use ld:</span></span><br><span class="line">$ ld -shared -soname libexample.so.1 -o libexample.so.1.2.3 file1.o file2.o</span><br><span class="line"><span class="comment">#Use gcc or g++:</span></span><br><span class="line">$ gcc -shared -Wl,-soname,libexample.so.1 -o libexample.so.1.2.3 file1.o file2.o</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®‰è£…æ—¶åˆ›å»ºè½¯é“¾æ¥ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s libexample.so.1.2.3 libexample.so.1</span><br><span class="line"><span class="built_in">ln</span> -s libexample.so.1 libexample.so</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æŸ¥çœ‹SONAMEï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Use objdump</span></span><br><span class="line">$ objdump -p libexample.so.1.3 | grep SONAME</span><br><span class="line">  SONAME               libexample.so.1</span><br><span class="line"><span class="comment">#Use readelf</span></span><br><span class="line">$ readelf -d libexample.so | grep SONAME</span><br><span class="line"> 0x000000000000000e (SONAME)             Library soname: [libexample.so.1]</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol-versioningï¼‰"><a href="#ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol-versioningï¼‰" class="headerlink" title="ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol versioningï¼‰"></a>ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol versioningï¼‰</h3><h4 id="å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š"><a href="#å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š" class="headerlink" title="å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š"></a>å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š</h4><ol>
<li>example.cä¸­å®šä¹‰å‡½æ•°<code>my_printf</code>ï¼š</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">my_printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, format);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>version_script.txtä¸­å®šä¹‰å‡½æ•°çš„ç‰ˆæœ¬ä¸º<code>VERSION_1</code>ï¼š</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VERSION_1 &#123;</span><br><span class="line"> global:</span><br><span class="line">   my_printf;</span><br><span class="line"> local:</span><br><span class="line">   *;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç¼–è¯‘æ—¶æŒ‡å®š<code>version_script.txt</code>ä¸ºversion-scriptï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -Wl,--version-script=version_script.txt -o libexample.so example.o</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>-Wl,</code>å¼•å‡ºè¿æ¥å™¨é€‰é¡¹ã€‚</p>
<ol start="4">
<li>æŸ¥çœ‹ï¼š<ol>
<li>ä½¿ç”¨<code>readelf -sW libexample.so</code>æŸ¥çœ‹å‡½æ•°<code>my_printf</code>çš„ç‰ˆæœ¬å·ï¼ˆâ€VERSION_1â€ï¼‰ï¼š</li>
</ol>
</li>
</ol>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Symbol table &#x27;.dynsym&#x27; contains 8 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTable</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (3)</span><br><span class="line">     3: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">     4: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable</span><br><span class="line">     5: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (3)</span><br><span class="line">     6: 0000000000001105    39 FUNC    GLOBAL DEFAULT   13 my_printf@@VERSION_1</span><br><span class="line">     7: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  ABS VERSION_1</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä½¿ç”¨<code>objdump -T libexample.so</code></li>
<li>ä½¿ç”¨<code>nm -D libexample.so</code></li>
</ol>
<h4 id="å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬"><a href="#å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬" class="headerlink" title="å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬"></a>å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬</h4><ol>
<li>ç¼–å†™æºä»£ç </li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;foo version 1.0\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo_v2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;foo_v2 version 2.0\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–å†™ç‰ˆæœ¬è„šæœ¬</li>
</ol>
<p>ä¾‹å¦‚ï¼Œversion_script.mapæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">VERS_1.0 &#123;</span><br><span class="line">    global: <span class="comment"># globalè¡¨ç¤ºç¬¦å·å…¨å±€å¯è§ï¼›é»˜è®¤ä¸ºå±€éƒ¨ï¼ˆä¹Ÿå¯èƒ½é€šè¿‡localæ˜¾å¼å£°æ˜ä¸ºå±€éƒ¨ï¼‰ï¼Œä¸ä¼šè¢«å¯¼å‡º</span></span><br><span class="line">        foo;</span><br><span class="line">&#125; VERS_1.1;</span><br><span class="line"></span><br><span class="line">VERS_1.1 &#123;</span><br><span class="line">    global:</span><br><span class="line">        foo_v2;</span><br><span class="line">    foo; <span class="comment"># VER_1.1ç»§æ‰¿è‡ªVER_1.0</span></span><br><span class="line">         <span class="comment"># 1. fooåœ¨VER_1.0ä¸­å·²ç»å£°æ˜ä¸ºäº†globalï¼Œä¸éœ€è¦å†æ¬¡å£°æ˜global</span></span><br><span class="line">         <span class="comment"># 2. å½“ç„¶å¯ä»¥å†æ¬¡æ˜¾å¼å£°æ˜ä¸ºglobalï¼Œä½†æ˜¯è¿™ä¸æ˜¯æ¨èçš„åšæ³•</span></span><br><span class="line">         <span class="comment"># 3. å‡è®¾fooåœ¨VER_1.0ä¸­ä¸æ˜¯globalï¼Œæ­¤å¤„å£°æ˜ä¸ºglobalï¼Œ</span></span><br><span class="line">         <span class="comment"># ä¼šå°†åŸæœ¬ä¸æ˜¯globalçš„fooå˜å¾—å…¨å±€å¯è§</span></span><br><span class="line">         <span class="comment"># 4. æˆ‘ä»¬å…¶å®æ— éœ€å†æ¬¡å¯¼å‡ºfooï¼Œå› ä¸ºé™¤éæˆ‘ä»¬æ˜¾å¼éšè—ï¼ˆä½¿ç”¨localå…³é”®å­—ï¼‰ï¼Œfooå°±åœ¨</span></span><br><span class="line">         <span class="comment"># VER_1.1æ˜¯å’ŒVER_1.0ä¸­çš„å¯è§æ€§ä¿æŒä¸€è‡´</span></span><br><span class="line">         <span class="comment"># 5. å¦‚æœå¸Œæœ›åœ¨VER_1.1ä¸­çš„fooä¸VER_1.0æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆéœ€è¦å†æ¬¡å°†å…¶å¯¼å‡º</span></span><br><span class="line">&#125; VERS_2.0;</span><br><span class="line"></span><br><span class="line">VERS_2.0 &#123;</span><br><span class="line">    global:</span><br><span class="line">        foo_v2</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>VER_1.1ç»§æ‰¿äº†VER_1.0çš„å…¨éƒ¨ç¬¦å·ï¼ŒåŒæ—¶VER_1.1å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹ç¬¦å·ã€‚</p>
<p>VER_1.0ï¼šç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯¼å‡ºfooç¬¦å·ï¼›<br>VER_1.1ï¼šç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå¼•å…¥foo_v2ï¼Œå¹¶é‡æ–°å¯¼å‡ºfooï¼›</p>
<h4 id="ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬"><a href="#ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬" class="headerlink" title="ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬"></a>ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬</h4><p>æœ‰å¦‚ä¸‹ç®€å•ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: main.cc</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸ç¼–è¯‘ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cc -o a.out</span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç¬¦å·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings a.out</span><br></pre></td></tr></table></figure>

<p>ä½ ä¼šå‘ç°å…¶ä¸­æœ‰ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">GLIBC_2.34</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ç”Ÿæˆåº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä¼šæ ¹æ®ç³»ç»Ÿä¸Šå®‰è£…çš„glibcç‰ˆæœ¬ï¼ˆå› ä¸ºåº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–glibcï¼‰ï¼Œ<br>ä¸ºåº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„å‡½æ•°ç¬¦å·é™„åŠ ä¸Šç‰¹å®šçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚<br>ä¸ºäº†ä¿è¯å‘ä¸‹å…¼å®¹ï¼Œglibcé€šè¿‡ç¬¦å·æ§åˆ¶ä¿ç•™äº†å¤šä¸ªç‰ˆæœ¬çš„ç¬¦å·ï¼Œæ”¯æŒè€ç‰ˆæœ¬çš„è½¯ä»¶èƒ½åœ¨è¾ƒæ–°çš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªå‡½æ•°åœ¨glibc2.2.5ä¸­å¼•å…¥ï¼Œå®ƒå¯ä»¥ç»§ç»­ä¿ç•™åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œä½†ç¬¦å·æ ‡è®°ä¸ºGLIBC_2.2.5ã€‚</p>
<h3 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h3><pre><code>ELF - Executable and Linking Format.
ELFæè¿°äº†normal executable filesã€relocatable object filesã€core fileså’Œshared objectsçš„æ ¼å¼ã€‚
</code></pre>
<p>å‚è€ƒï¼š<code>man elf</code>, <a target="_blank" rel="noopener" href="http://chuquan.me/2018/05/21/elf-introduce/">åšå®¢:elfä»‹ç»</a>ã€‚</p>
<h3 id="é“¾æ¥å"><a href="#é“¾æ¥å" class="headerlink" title="é“¾æ¥å"></a>é“¾æ¥å</h3><p>å‚è€ƒï¼š<a target="_blank" rel="noopener" href="https://littlebee1024.github.io/learning_book/booknotes/cxydzwxy/link/dynamic/#_16">ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</a>, <code>man ld</code></p>
<p>GCCçš„æä¾›äº†ä¸åŒçš„æ–¹æ³•æŒ‡å®šé“¾æ¥çš„å…±äº«åº“ï¼š</p>
<ul>
<li><p><code>l&lt;link_name&gt;</code>å‚æ•°</p>
<p>  æŒ‡å®šéœ€è¦é“¾æ¥çš„å…±äº«åº“lib<link_name>.so</p>
</li>
<li><p><code>l:&lt;filename&gt;</code>å‚æ•°</p>
<p>  é€šè¿‡æ–‡ä»¶åæŒ‡å®šå…±äº«åº“ï¼Œå‚è€ƒLDæ‰‹å†Œ</p>
</li>
<li><p>å…¨è·¯å¾„æŒ‡å®š</p>
</li>
<li><p><code>Wl,-static</code>å‚æ•°</p>
<p>  æŒ‡å®šæŸ¥æ‰¾é™æ€åº“ï¼Œé€šè¿‡-Wl,-Bdynamicæ¢å¤æˆåŠ¨æ€åº“æŸ¥æ‰¾</p>
</li>
</ul>
<h3 id="é“¾æ¥å™¨é€‰é¡¹"><a href="#é“¾æ¥å™¨é€‰é¡¹" class="headerlink" title="é“¾æ¥å™¨é€‰é¡¹"></a>é“¾æ¥å™¨é€‰é¡¹</h3><p>å‚è€ƒï¼š<code>man ld</code></p>
<pre><code>ld - The GNU linker
</code></pre>
<p>é€‰é¡¹ï¼š</p>
<pre><code>-rpath=dir
    æ·»åŠ ä¸€ä¸ªç›®å½•åˆ°è¿è¡Œæ—¶åº“æœå¯»è·¯å¾„ä¸­ã€‚
</code></pre>
<p>gccé€šè¿‡ <code>-Wl</code> å‰ç¼€æŒ‡å®šé“¾æ¥å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code> gcc -Wl,--start-group foo.o bar.o -Wl,--end-group
 gcc -Wl,-rpath,&#39;$ORIGIN/../lib&#39;

-rpath-link
    ç”¨äºåœ¨é“¾æ¥æ—¶æŒ‡å®šé¢å¤–çš„å…±äº«åº“æœç´¢è·¯å¾„ã€‚åœ¨ç¼–è¯‘/é“¾æ¥é˜¶æ®µï¼Œå‘Šè¯‰é“¾æ¥å™¨å»å“ªé‡Œæ‰¾é—´æ¥ä¾èµ–çš„å…±äº«åº“ã€‚åªå½±å“æ„å»ºè¿‡ç¨‹ï¼Œä¸å½±å“è¿è¡Œæ—¶è¡Œä¸ºã€‚
    å½“ä½ é“¾æ¥ä¸€ä¸ªå…±äº«åº“ï¼ˆæ¯”å¦‚ libfoo.soï¼‰ï¼Œè€Œè¿™ä¸ªåº“åˆä¾èµ–å…¶ä»–å…±äº«åº“ï¼ˆæ¯”å¦‚ libbar.soï¼‰ï¼Œå¦‚æœè¿™äº›ä¾èµ–åº“ä¸åœ¨æ ‡å‡†è·¯å¾„ä¸­ï¼Œé“¾æ¥å™¨å¯èƒ½æ‰¾ä¸åˆ°å®ƒä»¬ã€‚è¿™æ—¶å°±å¯ä»¥ç”¨ -rpath-link æ¥å‘Šè¯‰é“¾æ¥å™¨å»å“ªé‡Œæ‰¾è¿™äº›â€œé—´æ¥ä¾èµ–â€çš„åº“ã€‚
</code></pre>
<table>
<thead>
<tr>
<th>é€‰é¡¹</th>
<th>ç”¨é€”</th>
<th>ç”Ÿæ•ˆæ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>-L</td>
<td>æ·»åŠ åº“æœç´¢è·¯å¾„</td>
<td>é“¾æ¥æ—¶</td>
</tr>
<tr>
<td>-rpath-link</td>
<td>æ·»åŠ é—´æ¥ä¾èµ–åº“çš„æœç´¢è·¯å¾„</td>
<td>é“¾æ¥æ—¶</td>
</tr>
<tr>
<td>-Wl,-rpath</td>
<td>å°†è·¯å¾„å†™å…¥å¯æ‰§è¡Œæ–‡ä»¶ä¾›è¿è¡Œæ—¶ä½¿ç”¨</td>
<td>è¿è¡Œæ—¶</td>
</tr>
<tr>
<td>LD_LIBRARY_PATH</td>
<td>ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šè¿è¡Œæ—¶åº“è·¯å¾„</td>
<td>è¿è¡Œæ—¶</td>
</tr>
</tbody></table>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><ol>
<li><a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/120015/how-to-find-out-the-dynamic-libraries-executables-loads-when-run">How to find out the dynamic libraries are loaded when running an executable?</a></li>
</ol>
<p>Answer:</p>
<ul>
<li><code>ldd /path/to/program</code></li>
<li><code>objdump -p /path/to/program | grep NEEDED</code></li>
<li><code>lddtree</code> (from <code>pax-utils</code>) or <code>readelf -d /bin/ls | grep &#39;NEEDED&#39;</code></li>
<li><code>lsof -p PID | grep mem</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ pidof nginx</span><br><span class="line">6920 6919</span><br><span class="line"></span><br><span class="line">$ lsof -p 6919 | grep mem</span><br></pre></td></tr></table></figure>

<ul>
<li><code>strace -e trace=open myprogram</code></li>
</ul>
<p><code>ldd</code> and <code>lsof</code> show the libraries loaded either directly or at a given moment. They do not account for libraries loaded via <code>dlopen</code> (or discarded by <code>dlclose</code>). You can get a better picture of this using <code>strace</code>.</p>
<ul>
<li><code>pmap &lt;pid&gt; -p</code></li>
</ul>
<h3 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h3><ol>
<li><p>ç”Ÿæˆsoæ—¶ï¼Œé“¾æ¥å™¨ä¸ä¼šå¯»æ‰¾å…¶soä¾èµ–ï¼›executableä¼šå¯»æ‰¾soçš„ä¾èµ–å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿soç”Ÿæˆè¿‡ç¨‹ä¸æŠ¥é”™ï¼Œä½†æ˜¯executableç”Ÿæˆæ—¶å¯èƒ½ä¼šæŠ¥é”™ã€‚</p>
</li>
<li><p>ç”Ÿæˆsoæ—¶ï¼Œå¦‚æœå¼•ç”¨äº†å…¶ä»– so ï¼Œåªè¦ include å…¶ä»– so çš„å¤´æ–‡ä»¶ï¼Œå¼•ç”¨å¤´æ–‡ä»¶ä¸­çš„ç¬¦å·æ—¶ï¼Œå°±èƒ½ç¼–è¯‘é€šè¿‡ã€‚ä½†æ˜¯è¿™æ ·ç”Ÿæˆçš„ so æ²¡æœ‰åŠ ä¸Šå¯¹åº”ç¬¦å·çš„ä¾èµ–ã€‚<br>æ­¤æ—¶ç”¨ readelf -s æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·ï¼Œå…¶ type ä¸º NOTYPE ã€‚</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -sW libb.so</span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.dynsym&#x27; contains 14 entries:</span><br><span class="line">Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line"> 6: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND _Z1fv</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœåŠ ä¸Šå¯¹åº” -la é€‰é¡¹ï¼Œå°±ä¼šä» liba.so ä¸­å¯»æ‰¾ä¾èµ–çš„ç¬¦å·ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™æ·»åŠ è¿›å…¥ so çš„ä¾èµ–é¡¹ä¸­ã€‚å½“è¿è¡Œæ—¶åˆ™ä¼šåŠ è½½ liba.so ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¸ä¼šåŠ è½½ã€‚<br>ç”¨ readelf -s æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·ï¼Œå…¶ type ä¸å†æ—¶ NOTYPE ï¼Œè€Œæ˜¯ FUNC ï¼ˆå¦‚æœè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå‡½æ•°çš„è¯ï¼‰ã€‚</p>
 <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _Z1fv</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦å·ï¼Œæˆ–è€…è¯´ liba.so ä¸­æ ¹æœ¬æ²¡æœ‰å®ç°è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå…¶ type ä¾ç„¶æ˜¯ NOTYPE ï¼Œæ­¤æ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚<br>æ³¨æ„ï¼šå¦‚æœåªæ˜¯ include å¤´æ–‡ä»¶ï¼Œä¹Ÿå°±è¯´åªæœ‰æŸä¸ªç¬¦å·çš„å£°æ˜ï¼Œå¹¶æ²¡æœ‰å…¶å®šä¹‰æˆ–å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆ so ä¸­ä¸ä¼šç”Ÿæˆå…¶ä¿¡æ¯ã€‚</p>
</li>
</ol>
<h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><h3 id="è¿è¡Œæ—¶é”™è¯¯ï¼šâ€-path-to-a-out-usr-lib-x86-64-linux-gnu-libstdc-so-6-version-GLIBCXX-3-4-30â€™-not-found-required-by-path-to-libxxx-so-â€"><a href="#è¿è¡Œæ—¶é”™è¯¯ï¼šâ€-path-to-a-out-usr-lib-x86-64-linux-gnu-libstdc-so-6-version-GLIBCXX-3-4-30â€™-not-found-required-by-path-to-libxxx-so-â€" class="headerlink" title="è¿è¡Œæ—¶é”™è¯¯ï¼šâ€&#x2F;path&#x2F;to&#x2F;a.out: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6: version &#96;GLIBCXX_3.4.30â€™ not found (required by &#x2F;path&#x2F;to&#x2F;libxxx.so)â€"></a>è¿è¡Œæ—¶é”™è¯¯ï¼šâ€&#x2F;path&#x2F;to&#x2F;a.out: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6: version &#96;GLIBCXX_3.4.30â€™ not found (required by &#x2F;path&#x2F;to&#x2F;libxxx.so)â€</h3><p>è§£é‡Šï¼š<code>libxxx.so</code> å¼•ç”¨äº†ä¸€ä¸ª <code>GLIBCXX_3.4.30</code> çš„ç¬¦å·ï¼ˆå¯èƒ½æ˜¯å…¨å±€å˜é‡æˆ–å‡½æ•°ï¼‰ï¼Œä½†æ˜¯åœ¨ç³»ç»Ÿçš„ <code>/usr/lib/x86_64-linux-gnu/libstdc++.so.6</code> ä¸­æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬çš„ç¬¦å·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep <span class="string">&#x27;GLIBCXX_3.4.&#x27;</span></span><br><span class="line">GLIBCXX_3.4.1</span><br><span class="line">...</span><br><span class="line">GLIBCXX_3.4.27</span><br><span class="line">GLIBCXX_3.4.28</span><br><span class="line"><span class="comment"># æ²¡æœ‰ GLIBCXX_3.4.30</span></span><br><span class="line"></span><br><span class="line">$ strings /path/to/libxxx.so | grep <span class="string">&#x27;GLIBCXX_3.4.30&#x27;</span> | c++filt</span><br><span class="line">GLIBCXX_3.4.30</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)@@GLIBCXX_3.4.30</span><br></pre></td></tr></table></figure>

<p>è¿™å¾€å¾€æ˜¯å› ä¸ºåŸå§‹çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>libxxx.so</code> æ˜¯åœ¨ä¸€å°æœºå™¨ä¸­ç¼–è¯‘çš„ï¼Œæ­¤æ—¶å°†è¯¥æœºå™¨çš„ <code>GLIBCXX_3.4.30</code> ç¬¦å·ç¼–è¯‘åˆ°å…¶ä¸­äº†ã€‚ä½†æ˜¯è¿è¡Œæ—¶çš„æœºå™¨æ˜¯å¦ä¸€å°ï¼Œè¯¥æœºå™¨ä¸Š<br>ä¸å­˜åœ¨ <code>GLIBCXX_3.4.30</code> ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿è¡Œæ—¶æŠ¥é”™ã€‚</p>
<p>æˆ–è€…ï¼Œå› ä¸ºç¯å¢ƒå˜é‡çš„é…ç½®é”™è¯¯ï¼Œç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶å¼•ç”¨çš„ <code>libstdc++.so.6</code> ä¸æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´è¿è¡Œæ—¶å¯èƒ½æ‰¾ä¸åˆ°ç¼–è¯‘æ—¶çš„ <code>GLIBCXX_3.4.30</code> ç‰ˆæœ¬ã€‚</p>
<p>å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬ï¼ˆä½¿ç”¨è¿è¡Œæ—¶çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ <code>GLIBCXX_3.4.11</code> ï¼‰ï¼š</p>
<ol>
<li>æŸ¥æ‰¾ç‰ˆæœ¬ï¼š</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -T /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep condition_variable | c++filt</span><br><span class="line">00000000000d52d0 g    DF .text  000000000000000c  GLIBCXX_3.4.30 std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line">00000000000ac730 g    DF .text  000000000000001c (GLIBCXX_3.4.11) std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line"></span><br><span class="line">$ objdump -T /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep condition_variable</span><br><span class="line">00000000000d52d0 g    DF .text  000000000000000c  GLIBCXX_3.4.30 _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</span><br><span class="line">00000000000ac730 g    DF .text  000000000000001c (GLIBCXX_3.4.11) _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç¡®å®šç¬¦å·ä¸º <code>_ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</code> ï¼Œç‰ˆæœ¬ä¸º <code>GLIBCXX_3.4.11</code> ã€‚</p>
<p>åœ¨æºæ–‡ä»¶ä¸­æŒ‡å®šç‰ˆæœ¬</p>
<figure class="highlight cpp"><figcaption><span>symver</span><a href="/blog/downloads/code/symver.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‡å®šç‰¹å®šç‰ˆæœ¬çš„ç¬¦å· START */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/** __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line">__asm__ (<span class="string">&quot;.symver _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE, _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE@GLIBCXX_3.4.11&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/** __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** æŒ‡å®šç‰¹å®šç‰ˆæœ¬çš„ç¬¦å· END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹åå°±å¯ä»¥ä½¿ç”¨ std::condition_variable::wait(std::unique_lock&lt;std::mutex&gt;&amp;) å°±æ˜¯ GLIBCXX_3.4.11 çš„</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"> </span><br><span class="line">std::mutex m;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line">std::string data;</span><br><span class="line"><span class="type">bool</span> ready = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span> processed = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">worker_thread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// wait until main() sends data</span></span><br><span class="line">    <span class="function">std::unique_lock <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">    cv.<span class="built_in">wait</span>(lk, []{ <span class="keyword">return</span> ready; });</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// after the wait, we own the lock</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Worker thread is processing data\n&quot;</span>;</span><br><span class="line">    data += <span class="string">&quot; after processing&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// send data back to main()</span></span><br><span class="line">    processed = <span class="literal">true</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Worker thread signals data processing completed\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// manual unlocking is done before notifying, to avoid waking up</span></span><br><span class="line">    <span class="comment">// the waiting thread only to block again (see notify_one for details)</span></span><br><span class="line">    lk.<span class="built_in">unlock</span>();</span><br><span class="line">    cv.<span class="built_in">notify_one</span>();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">(worker_thread)</span></span>;</span><br><span class="line"> </span><br><span class="line">    data = <span class="string">&quot;Example data&quot;</span>;</span><br><span class="line">    <span class="comment">// send data to the worker thread</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">        ready = <span class="literal">true</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;main() signals data ready for processing\n&quot;</span>;</span><br><span class="line">    }</span><br><span class="line">    cv.<span class="built_in">notify_one</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// wait for the worker</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">        cv.<span class="built_in">wait</span>(lk, []{ <span class="keyword">return</span> processed; });</span><br><span class="line">    }</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Back in main(), data = &quot;</span> &lt;&lt; data &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    worker.<span class="built_in">join</span>();</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ symver.cpp</span><br></pre></td></tr></table></figure>

<p>éªŒè¯ç¬¦å·ç‰ˆæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ strings a.out | grep condition_variable | c++filt</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)@GLIBCXX_3.4.11</span><br></pre></td></tr></table></figure>

<h2 id="æ‰‹åŠ¨åŠ è½½so"><a href="#æ‰‹åŠ¨åŠ è½½so" class="headerlink" title="æ‰‹åŠ¨åŠ è½½so"></a>æ‰‹åŠ¨åŠ è½½so</h2><p>ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight cpp"><figcaption><span>dlopen.cpp</span><a href="/blog/downloads/code/compile/dlopen.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*<span class="type">func_t</span>)</span><span class="params">()</span></span>;  <span class="comment">// å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// æ‰“å¼€ .so æ–‡ä»¶</span></span><br><span class="line">    <span class="type">void</span> *handle = <span class="built_in">dlopen</span>(<span class="string">&quot;your_library.so&quot;</span>, RTLD_LAZY);</span><br><span class="line">    <span class="keyword">if</span> (!handle) {</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;%s\n&quot;</span>, <span class="built_in">dlerror</span>());</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…é™¤ä»»ä½•ç°æœ‰çš„é”™è¯¯</span></span><br><span class="line">    <span class="built_in">dlerror</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ç¬¦å·</span></span><br><span class="line">    <span class="comment">// void (*func)(); // æ–¹æ³•ä¸€ï¼šå£°æ˜å¹¶å®šä¹‰å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">func_t</span> func;  <span class="comment">// æ–¹æ³•äºŒï¼šå®šä¹‰å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å››ç§æ–¹æ³•/å†™æ³•éƒ½å¯ä»¥ç”¨äºå°† dlsym è¿”å›çš„ void* èµ‹å€¼ç»™å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// (1) *(void **) (&amp;func) = dlsym(handle, &quot;your_function&quot;);</span></span><br><span class="line">    <span class="comment">//    è§£é‡Šï¼šå–å‡½æ•°æŒ‡é’ˆ func çš„åœ°å€ï¼Œå°†å…¶è½¬ä¸º void**ï¼Œç„¶åå°† dlsym è¿”å›çš„ void* èµ‹å€¼ç»™å®ƒè§£å¼•ç”¨åçš„å˜é‡ï¼ˆå³ funcï¼‰</span></span><br><span class="line">    <span class="comment">// (2) func = (void (*)())dlsym(handle, &quot;your_function&quot;);</span></span><br><span class="line">    <span class="comment">// (3) func = reinterpret_cast&lt;func_t&gt;(dlsym(handle, &quot;your_function&quot;));</span></span><br><span class="line">    <span class="comment">// (4) å¦‚ä¸‹</span></span><br><span class="line">    func = (<span class="type">func_t</span>)<span class="built_in">dlsym</span>(handle, <span class="string">&quot;your_function&quot;</span>);</span><br><span class="line">    <span class="type">char</span> *error = <span class="built_in">dlerror</span>();</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;%s\n&quot;</span>, error);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ç¬¦å·</span></span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­ .so æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">dlclose</span>(handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2024/01/23/cpp/C++%E7%BC%BA%E9%99%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿå—äººç‰©çš„åšå®¢">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/01/23/cpp/C++%E7%BC%BA%E9%99%B7/" class="post-title-link" itemprop="url">C++ ç¼ºé™·</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-23 21:33:51" itemprop="dateCreated datePublished" datetime="2024-01-23T21:33:51+00:00">2024-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-03 01:44:34" itemprop="dateModified" datetime="2025-09-03T01:44:34+00:00">2025-09-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="basic-string-M-construct-null-not-valid"><a href="#basic-string-M-construct-null-not-valid" class="headerlink" title="basic_string::_M_construct null not valid"></a>basic_string::_M_construct null not valid</h2><p>C++æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cpp defeat: basic_string::_M_construct null not valid</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;fun&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fun</span>(<span class="number">0</span>); <span class="comment">// Run-time error: basic_string::_M_construct null not valid</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>fun(0)</code>çš„<code>0</code>ä¼šè¢«è§†ä¸º<code>const char*</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯<code>nullptr</code>ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸå¯ä»¥é€šè¿‡ã€‚<br>ä½†æ˜¯è¿è¡ŒæœŸä¼šè§¦å‘<code>string</code>å¯¹è±¡çš„æ„é€ é”™è¯¯â€œbasic_string::_M_construct null not validâ€ã€‚</p>
<p>éšè”½ä¸€ç‚¹çš„ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> * <span class="title">get_a_string</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Attention: Alaways take care that a parameter to a string should not be NULL!</span></span><br><span class="line">    <span class="built_in">fun</span>(<span class="built_in">get_a_string</span>()); <span class="comment">// Run-time error: basic_string::_M_construct null not valid</span></span><br><span class="line">    <span class="comment">// Better code</span></span><br><span class="line">    <span class="type">char</span> * str = <span class="built_in">get_a_string</span>();</span><br><span class="line">    <span class="built_in">fun</span>(str != <span class="literal">NULL</span>? str : <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/blog/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/10/">10</a><a class="extend next" rel="next" href="/blog/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bi-an"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">bi-an</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bi-an" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;bi-an" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ah_zzg@126.com" title="E-Mail â†’ mailto:ah_zzg@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://cuda-doc.readthedocs.io/" title="https:&#x2F;&#x2F;cuda-doc.readthedocs.io" rel="noopener" target="_blank">CUDAä¸­æ–‡æ‰‹å†Œ</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://infiniband-doc.readthedocs.io/" title="https:&#x2F;&#x2F;infiniband-doc.readthedocs.io&#x2F;" rel="noopener" target="_blank">InfiniBandä¸­æ–‡æ‰‹å†Œ</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bi-an</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
