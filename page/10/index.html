<!DOCTYPE html>
<html lang="en, zh_CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"bi-an.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="江南人物的博客">
<meta property="og:url" content="https://bi-an.github.io/blog/page/10/index.html">
<meta property="og:site_name" content="江南人物的博客">
<meta property="og:locale">
<meta property="article:author" content="bi-an">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://bi-an.github.io/blog/page/10/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en, zh_CN'
  };
</script>

  <title>江南人物的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江南人物的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/29/personal_site/npm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/29/personal_site/npm/" class="post-title-link" itemprop="url">npm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-29 11:01:11" itemprop="dateCreated datePublished" datetime="2023-12-29T11:01:11+00:00">2023-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p><code>npm root</code> - Current installation root path.<br><code>npm root -g</code> - The global installation root path.<br><code>npm uninstall</code> - After executing this command, you should also remove the items in the <code>package.json</code> file and delete the <code>package-lock.json</code> file and the <code>node_modules</code> directory.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5926672/where-does-npm-install-packages">Where does npm install packages?</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/66978786/cannot-uninstall-two-npm-packages">Cannot Uninstall two npm Packages</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/29/net/%E7%BD%91%E7%BB%9C%E6%8E%A2%E6%B5%8B%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/29/net/%E7%BD%91%E7%BB%9C%E6%8E%A2%E6%B5%8B%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">网络检测工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-29 09:55:00" itemprop="dateCreated datePublished" datetime="2023-12-29T09:55:00+00:00">2023-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code>sudo apt install net-tools
</code></pre>
<h2 id="手册"><a href="#手册" class="headerlink" title="手册"></a>手册</h2><pre><code>man 7 socket - socket options
man 7 tcp - tcp options
</code></pre>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><pre><code>/proc/sys/net/ipv4/ip_local_port_range
</code></pre>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><h3 id="网关（Gateway）"><a href="#网关（Gateway）" class="headerlink" title="网关（Gateway）"></a>网关（Gateway）</h3><p>网关（Gateway）是一个网络节点，它充当其他网络之间的访问点或网关。网关通常用于连接不同的网络，并且可以在不同的协议之间进行转换。网关设备可以是路由器、服务器或其他网络设备。当本地网络中的设备需要与外部网络通信时，它们会将数据包发送到网关，网关再将数据包转发到目标网络。</p>
<p>举例： 假设你的本地网络使用的IP地址范围是192.168.1.0&#x2F;24，而你的网关IP地址是192.168.1.1。当你的计算机需要访问外部网络（例如互联网）时，它会将数据包发送到网关（192.168.1.1），然后由网关将数据包转发到目标网络。</p>
<p>在Linux系统中，你可以使用<code>ip route</code>命令查看默认网关。例如：</p>
<p>在这个例子中，<code>default via 192.168.1.1 dev eth0</code>表示默认网关是<code>192.168.1.1</code>，你的计算机通过网络接口<code>eth0</code>与网关连接。</p>
<h3 id="子网（CIDR表示法）"><a href="#子网（CIDR表示法）" class="headerlink" title="子网（CIDR表示法）"></a>子网（CIDR表示法）</h3><p>CIDR（Classless Inter-Domain Routing，无类别域间路由）是一种用于分配IP地址和路由的标准，使用斜杠（&#x2F;）后跟一个数字来表示子网掩码的位数。</p>
<p>在CIDR表示法中，<code>192.168.1.0/24</code>表示一个子网，其中<code>/24</code>表示子网掩码为255.255.255.0。这意味着子网中有256个IP地址（从0到255），但其中两个地址是保留的：</p>
<ol>
<li><strong>网络地址</strong>：<code>192.168.1.0</code>，用于标识子网本身。</li>
<li><strong>广播地址</strong>：<code>192.168.1.255</code>，用于向子网中的所有设备发送广播消息。</li>
</ol>
<p>因此，有效的主机IP地址范围是从<code>192.168.1.1</code>到<code>192.168.1.254</code>，共254个可用的IP地址。</p>
<h3 id="Link-local-Adress"><a href="#Link-local-Adress" class="headerlink" title="Link-local Adress"></a>Link-local Adress</h3><p>The link-local address range refers to IP addresses that are used for communication within a single network segment or link. These addresses are not routable, meaning they are not intended to be used for communication beyond the local network segment.</p>
<p>For IPv4, the link-local address range is 169.254.0.0&#x2F;16. This range is automatically assigned to network interfaces when no other IP address is available (e.g., when DHCP fails). Devices on the same local network can communicate with each other using these addresses without requiring a router.</p>
<p>For IPv6, the link-local address range is fe80::&#x2F;10. These addresses are automatically configured on all IPv6-enabled interfaces and are used for local network communication.</p>
<p>The IP address range 169.254.0.0&#x2F;16 is regarded as link-local because it is reserved for link-local addresses by the Internet Assigned Numbers Authority (IANA). These addresses are used for communication within a single network segment or link and are not routable beyond that segment.</p>
<p>Characteristics of Link-Local Addresses:</p>
<ul>
<li>Automatic Assignment: Devices automatically assign themselves an IP address from the 169.254.0.0&#x2F;16 range if they cannot obtain an IP address through DHCP.</li>
<li>Non-Routable: These addresses are not meant to be routed across different network segments. They are only valid within the local network.</li>
<li>Zero Configuration: Link-local addresses allow devices to communicate without manual configuration or a DHCP server.</li>
</ul>
<p>Example:<br>When a device fails to get an IP address from a DHCP server, it might assign itself an address like 169.254.1.2. Other devices on the same local network segment will also have addresses in the 169.254.0.0&#x2F;16 range, allowing them to communicate directly.</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h3><p>NAME</p>
<pre><code>ip - show / manipulate routing, devices, policy routing and tunnels.
</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ip route get 8.8.8.8</span><br><span class="line">8.8.8.8 via 192.168.1.1 dev eth0 src 192.168.1.100 uid 1000</span><br><span class="line">    cache</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><code>8.8.8.8</code>: The destination IP address for which the route is being queried.</li>
<li><code>via 192.168.1.1</code>: The gateway IP address through which the destination can be reached.</li>
<li><code>dev eth0</code>: The network interface (e.g., <code>eth0</code>) used to reach the destination.</li>
<li><code>src 192.168.1.100</code>: The source IP address used for sending packets to the destination.</li>
<li><code>uid 1000</code>: The user ID of the process that issued the command.</li>
<li><code>cache</code>: Indicates that the route information is cached.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ip route show</span><br><span class="line">default via 192.168.1.1 dev eth0 </span><br><span class="line">192.168.1.0/24 dev eth0 proto kernel scope <span class="built_in">link</span> src 192.168.1.100</span><br><span class="line">169.254.0.0/16 dev idrac proto kernel scope <span class="built_in">link</span> src 169.254.1.2</span><br></pre></td></tr></table></figure>

<p>说明：该命令用于显示路由表：</p>
<ul>
<li><code>default via 192.168.1.1 dev eth0</code>: The default route, packets to any destination not in the routing table will be sent to <code>192.168.1.1</code> via the <code>eth0</code> interface.</li>
<li><code>192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.100</code>: A route for the <code>192.168.1.0/24</code> network (destination network), directly reachable via the <code>eth0</code> interface, with the source IP <code>192.168.1.100</code>.</li>
<li><code>192.168.1.0/24</code>: Destination network.</li>
<li><code>dev eth0</code>: Interface <code>eth0</code>.</li>
<li><code>proto kernel</code>: Added by the kernel.</li>
<li><code>scope link</code>: Directly reachable.</li>
<li><code>src 192.168.1.100</code>: Source IP address.</li>
<li><code>169.254.0.0/16</code>: Link-local address range.</li>
</ul>
<h3 id="netstat-ss"><a href="#netstat-ss" class="headerlink" title="netstat &#x2F; ss"></a>netstat &#x2F; ss</h3><p>NAME</p>
<pre><code>ss - another to investigate sockets.
</code></pre>
<p>Reference</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/45920111">查看进程占用的端口</a></p>
<p>COMMANDS</p>
<pre><code>ss -lnpt
</code></pre>
<p>OPTIONS</p>
<pre><code>-n, --numberic

-l, --listening

-t, --tcp
    Note: Only established (non-listening) connections.

-a, --all
    Display both listening and non-linstening (for TCP this means established connections) sockets.

-u, --udp

-p, --process
</code></pre>
<h3 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h3><p>Options:</p>
<pre><code>-n inhibits the conversion of network numbers to host names for network files.

-P inhibits the conversion of port numbers to port names for network files.

-i specifies the Internet addresses

    multiple addresses (up to a limit of 100) may be specified with multiple options.

    An Internet address is specified in the form (Items in square brackets are optional.):

    [46][protocol][@hostname|hostaddr][:service|port]

    where:
    46 specifies the IP version, IPv4 or IPv6
        that applies to the following address.
        &#39;6&#39; may be be specified only if the UNIX
        dialect supports IPv6.  If neither &#39;4&#39; nor
        &#39;6&#39; is specified, the following address
        applies to all IP versions.
    protocol is a protocol name - TCP, UDP
    hostname is an Internet host name.  Unless a
        specific IP version is specified, open
        network files associated with host names
        of all versions will be selected.
    hostaddr is a numeric Internet IPv4 address in
        dot form; or an IPv6 numeric address in
        colon form, enclosed in brackets, if the
        UNIX dialect supports IPv6.  When an IP
        version is selected, only its numeric
        addresses may be specified.
    service is an /etc/services name - e.g., smtp -
        or a list of them.
    port is a port number, or a list of them.

-s list file size

-s p:s  exclude(^)|select protocol (p = TCP|UDP) states by name(s).
</code></pre>
<p>Examples:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:&lt;port&gt;</span><br><span class="line">lsof -i -P -n | grep LISTEN</span><br><span class="line">lsof -nP -iTCP -sTCP:LISTEN</span><br></pre></td></tr></table></figure>

<h3 id="nc-netcat-nmap"><a href="#nc-netcat-nmap" class="headerlink" title="nc&#x2F;netcat&#x2F;nmap"></a>nc&#x2F;netcat&#x2F;nmap</h3><h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><p>Create a TCP or a UNIX domain socket and connect to stdin&#x2F;out.</p>
<p>Installation:</p>
<pre><code>sudo apt-get install socket
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/23/english/Written-in-Blood/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/23/english/Written-in-Blood/" class="post-title-link" itemprop="url">Written in Blood</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-23 19:22:48" itemprop="dateCreated datePublished" datetime="2023-12-23T19:22:48+00:00">2023-12-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/English/" itemprop="url" rel="index"><span itemprop="name">English</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="电影链接"><a href="#电影链接" class="headerlink" title="电影链接"></a>电影链接</h2><p><a target="_blank" rel="noopener" href="https://tubitv.com/tv-shows/520415/s01-e02-written-in-blood">Midsomer Murders： Season 1 Episode 2 - Written in Blood</a></p>
<h2 id="台词"><a href="#台词" class="headerlink" title="台词"></a>台词</h2><p>Phoenix turned and fired twice, the 34 millimetre bullets spitting through the air and splintering the brickwork two inches to the left of the Russia thug’s shoulder. A moment later came the reply of the Uzi semiautomatic and Phoenix twisted round. 菲尼克斯转身开了两枪，34毫米的子弹在空中喷射，将俄罗斯暴徒肩膀左侧两英寸砖墙击碎。过一会儿，乌兹半自动冲锋枪回应了，菲尼克斯扭过身来。</p>
<p>Her lips, searching in the sapphire, honeyscented darkness, found his; cool, forceful, unresisting, and as the frozen waves crashed down. 当冰冷、有力、不可抗拒的浪汹涌而下的时候，她的嘴唇在蓝宝石般散发着蜜香的夜色中寻找，找到了他的嘴唇。</p>
<p>-Got your meeting, have you? 你要去开会，对吗？<br>-Yes, I’m on my way. 是的，我正在去。</p>
<p>He pulled her towards him, his powerful, masculine hands tearing at the silk faric of her Gaultier nightshirt.</p>
<p>The repetitive beat of the innercity drum.</p>
<p>1887, Sebastian Lyddiard, greatgrandson of Herbert Lyddiard, who served under Sir John Jervis against Napoleon. 对抗拿破仑。</p>
<p>The Right Honourable William Lyddiard. 威廉·利迪亚德阁下。</p>
<p>-Do you ever regret marrying hime, Amy? I wonder if you ever think that but for you he might still be alive? 你后悔嫁给他吗，埃米？我不知道你是否想过，如果不是因为你，他可能现在还活着？<br>-(Amy) No. 没有想过。<br>-Well I do. 我想过。</p>
<p>-So we come to the question of which writer we invite to address us? 所以我们打算请哪位作家来给我们做演讲呢？<br>-How about Jilly Cooper?<br>-I think he said a writer.<br>-Do you think we could interest Frederick Forsythe?<br>-I rather doubt it.<br>-Oh, it’s a wonderful idea, Gerald. Especially since you’re writing a thriller. I think Frederick Forsythe would be first rate! 我认为Frederick Forsythe是第一流的。<br>-He’d never come. He’d just pretend he didn’t have time. They always do.<br>-I’d like Seamus Heaney.<br>-The poet?<br>-Not another poet. That last one was such a ghastly little man.</p>
<h2 id="词汇"><a href="#词汇" class="headerlink" title="词汇"></a>词汇</h2><p>screenplay by 剧本由……写成<br>millimetre 毫米<br>phoenix 凤凰，这里是人名，菲尼克斯<br>spit 吐，唾<br>thug 恶棍，暴徒<br>twist 扭，拧，捻<br>brickwork 砖砌体，砖墙<br>splinter n. 碎片，弹片； v. 碎裂。<br>Uzi semiautomatic 乌兹半自动冲锋枪（<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Uzi">Uzi</a> submachine gun）。Uzi 冲锋枪是由以色列国防军 (IDF) 上尉（后来的少校）Uziel Gal 在 1948 年阿以战争后设计的。<br>sapphire 蓝宝石<br>honey 蜂蜜，蜜<br>scent 香味（a pleasant natural smell）；scented 散发香味的<br>resist 抗拒的；unresisted 不可抗拒的。<br>masculine 男性的。<br>tear 撕，撕破，撕毁；拆；泪水。<br>nightshirt 睡衣<br>scum 浮渣<br>scum-bag 渣子袋，这里应该是“渣男”、“人渣”的意思，骂人的话。<br>hum 哼声<br>greatgrandson 曾孙<br>Sir 爵士<br>Napoleon 拿破仑<br>The Right Honourable <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/The_Right_Honourable">阁下</a>。其中，Right是副词，意思是’very’ or ‘fully’。从语法上说，The Right Honourable 是形容短语，直接用来称呼人名或者某人用来自称都是不正确的，应该与其引用的名称或名称一起使用第三人称。<br>address 演讲<br>first rate 第一流<br>pretend 假装<br>ghastly US:&#x2F;ˈɡæst.li&#x2F; UK:&#x2F;ˈɡɑːst.li&#x2F; 阴森的，可怕的，非常坏的<br>bestseller 畅销书</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/07/cpp/cmake%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/07/cpp/cmake%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">cmake 入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-07 10:58:25" itemprop="dateCreated datePublished" datetime="2023-12-07T10:58:25+00:00">2023-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Specify the search path for <code>pkg_check_modules</code>: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/44487053/set-pkg-config-path-in-cmake">Solution</a></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;PKG_CONFIG_PATH&#125; <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/libs/opencv-install/lib/pkgconfig&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/97369704">find_package</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/07/personal_site/Hexo-Documentation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/07/personal_site/Hexo-Documentation/" class="post-title-link" itemprop="url">Hexo Documentation</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-07 10:06:59" itemprop="dateCreated datePublished" datetime="2023-12-07T10:06:59+00:00">2023-12-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Tools/" itemprop="url" rel="index"><span itemprop="name">Tools</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="hexo修改默认端口号"><a href="#hexo修改默认端口号" class="headerlink" title="hexo修改默认端口号"></a>hexo修改默认端口号</h2><p>参考<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8398621502fd">博客</a></p>
<h2 id="添加目录"><a href="#添加目录" class="headerlink" title="添加目录"></a>添加目录</h2><p><a target="_blank" rel="noopener" href="https://blog.ligos.net/2016-07-25/Writing-Content-On-Hexo.html">https://blog.ligos.net/2016-07-25/Writing-Content-On-Hexo.html</a><br><a target="_blank" rel="noopener" href="https://medium.com/employbl/create-a-custom-blog-theme-with-hexo-js-b24c82eb9271#.viurzqeac">https://medium.com/employbl/create-a-custom-blog-theme-with-hexo-js-b24c82eb9271#.viurzqeac</a><br><a target="_blank" rel="noopener" href="https://hexo.io/docs/themes">https://hexo.io/docs/themes</a><br><a target="_blank" rel="noopener" href="https://hexo.io/docs/templates">https://hexo.io/docs/templates</a><br><a target="_blank" rel="noopener" href="https://hexo.io/docs/helpers">https://hexo.io/docs/helpers</a></p>
<h2 id="Add-pages"><a href="#Add-pages" class="headerlink" title="Add pages"></a>Add pages</h2><p>Commands</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The following command generate a &#x27;categories/index.md&#x27; file</span></span><br><span class="line">hexo new page categories</span><br><span class="line"></span><br><span class="line">hexo new page tags</span><br><span class="line">hexo new page about</span><br></pre></td></tr></table></figure>

<p>Refers to <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/60759559/hexo-next-theme-categories-and-tags-page">Hexo NeXT Theme categories and tags page</a></p>
<h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wugenqiang/article/details/88377669">Display PDF</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/06/net/bsub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/06/net/bsub/" class="post-title-link" itemprop="url">bsub用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-06 09:41:56" itemprop="dateCreated datePublished" datetime="2023-12-06T09:41:56+00:00">2023-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Network/" itemprop="url" rel="index"><span itemprop="name">Network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="find-host-queue-sh"><a href="#find-host-queue-sh" class="headerlink" title="find_host_queue.sh"></a>find_host_queue.sh</h2><p>寻找 hostname 所在的 queue ：</p>
<figure class="highlight bash"><figcaption><span>find_host_queue.sh</span><a href="/blog/downloads/code/bsub/find_host_queue.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查是否提供了主机名参数</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用法: <span class="variable">$0</span> &lt;hostname&gt;&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">HOSTNAME=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;正在查找包含主机 [<span class="variable">$HOSTNAME</span>] 或其主机组的队列...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有队列名</span></span><br><span class="line">queues=$(bqueues | awk <span class="string">&#x27;NR&gt;1 {print $1}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 获取队列的 HOSTS 字段</span></span><br><span class="line">    hosts_line=$(bqueues -l <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;/HOSTS:/,/^$/&#x27;</span>)</span><br><span class="line">    <span class="comment"># 将字符串按空格拆分为数组</span></span><br><span class="line">    host_array=(<span class="variable">$hosts_line</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取所有主机或主机组</span></span><br><span class="line">    <span class="keyword">for</span> entry <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${host_array[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># 如果是主机组（以@开头或以/结尾）</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$entry</span> == @* || <span class="variable">$entry</span> == */ ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># if [[ $entry == @* ]]; then</span></span><br><span class="line">            <span class="comment">#     # 去掉前面的@符号</span></span><br><span class="line">            <span class="comment">#     entry=${entry:1}</span></span><br><span class="line">            <span class="comment"># fi</span></span><br><span class="line">            <span class="comment"># 去掉前面的@符号和后面的斜杠</span></span><br><span class="line">            group=<span class="variable">${entry#@}</span></span><br><span class="line">            group=<span class="variable">${entry%/}</span></span><br><span class="line">            <span class="comment"># 获取主机组中的主机列表</span></span><br><span class="line">            <span class="keyword">if</span> bmgroup <span class="variable">$group</span> 2&gt;/dev/null | grep -qw <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;✅ 队列 [<span class="variable">$q</span>] 包含主机组 [<span class="variable">$group</span>]，其中包括主机 [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment"># 直接匹配主机名</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> == <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;✅ 队列 [<span class="variable">$q</span>] 直接包含主机 [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<h2 id="auto-submit-to-host-queue-sh"><a href="#auto-submit-to-host-queue-sh" class="headerlink" title="auto_submit_to_host_queue.sh"></a>auto_submit_to_host_queue.sh</h2><p>根据提供的 hostname ，自动寻找最空闲的队列提交 bsub 作业：</p>
<figure class="highlight bash"><figcaption><span>auto_submit_to_host_queue.sh</span><a href="/blog/downloads/code/bsub/auto_submit_to_host_queue.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 该脚本会自动将 hostname 提交到延迟最小、最空闲的队列</span></span><br><span class="line"><span class="comment"># 处理后的命令为 bsub -q &lt;queue&gt; -m &lt;host&gt; &lt;args&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用法提示</span></span><br><span class="line"><span class="comment"># 例如：$0 myhostname -Is bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 2 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;用法: <span class="variable">$0</span> &lt;hostname&gt; &lt;args&gt;&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">HOSTNAME=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># JOB_SCRIPT=$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 检查作业脚本是否存在</span></span><br><span class="line"><span class="comment"># if [ ! -f &quot;$JOB_SCRIPT&quot; ]; then</span></span><br><span class="line"><span class="comment">#     echo &quot;错误：找不到作业脚本 $JOB_SCRIPT&quot;</span></span><br><span class="line"><span class="comment">#     exit 1</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;🔍 正在查找包含主机 [<span class="variable">$HOSTNAME</span>] 的队列...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -A matching_queues</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有队列名</span></span><br><span class="line">queues=$(bqueues | awk <span class="string">&#x27;NR&gt;1 {print $1}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># 获取队列的 HOSTS 字段</span></span><br><span class="line">    hosts_line=$(bqueues -l <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;/HOSTS:/,/^$/&#x27;</span>)</span><br><span class="line">    host_array=(<span class="variable">$hosts_line</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> entry <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${host_array[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># 如果是主机组（以@开头或以/结尾）</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$entry</span> == @* || <span class="variable">$entry</span> == */ ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># 去掉前面的@符号和后面的斜杠</span></span><br><span class="line">            group=<span class="variable">${entry#@}</span></span><br><span class="line">            group=<span class="variable">${entry%/}</span></span><br><span class="line">            <span class="keyword">if</span> bmgroup <span class="string">&quot;<span class="variable">$group</span>&quot;</span> 2&gt;/dev/null | grep -qw <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;✅ 队列 [<span class="variable">$q</span>] 包含主机组 [<span class="variable">$group</span>]，其中包括主机 [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">                matching_queues[<span class="string">&quot;<span class="variable">$q</span>&quot;</span>]=1</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> == <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;✅ 队列 [<span class="variable">$q</span>] 直接包含主机 [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            matching_queues[<span class="string">&quot;<span class="variable">$q</span>&quot;</span>]=1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">${#matching_queues[@]}</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;❌ 没有找到包含主机 [<span class="variable">$HOSTNAME</span>] 的队列。&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;✅ 找到以下队列包含主机 [<span class="variable">$HOSTNAME</span>]：&quot;</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${!matching_queues[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; - <span class="variable">$q</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取这些队列的等待任务数，选择最空闲的一个</span></span><br><span class="line">best_queue=<span class="string">&quot;&quot;</span></span><br><span class="line">min_pend=999999</span><br><span class="line"></span><br><span class="line">sorted_queues=$(<span class="keyword">for</span> q <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${!matching_queues[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    pend=$(bqueues <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;NR==2 {print $9}&#x27;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pend</span> <span class="variable">$q</span>&quot;</span></span><br><span class="line">    <span class="comment"># if [[ &quot;$pend&quot; =~ ^[0-9]+$ ]] &amp;&amp; [ &quot;$pend&quot; -lt &quot;$min_pend&quot; ]; then</span></span><br><span class="line">    <span class="comment">#     min_pend=$pend</span></span><br><span class="line">    <span class="comment">#     best_queue=$q</span></span><br><span class="line">    <span class="comment"># fi</span></span><br><span class="line"><span class="keyword">done</span> | <span class="built_in">sort</span> -n | awk <span class="string">&#x27;{print $2}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># if [ -z &quot;$best_queue&quot; ]; then</span></span><br><span class="line"><span class="comment">#     echo &quot;⚠️ 无法确定最空闲队列，默认使用第一个：${!matching_queues[@]}&quot;</span></span><br><span class="line"><span class="comment">#     best_queue=${!matching_queues[@]}</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 依次尝试提交任务</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$sorted_queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;🔎 尝试队列 [<span class="variable">$q</span>]...&quot;</span></span><br><span class="line">    test_output=$(<span class="built_in">timeout</span> 10 bsub -q <span class="string">&quot;<span class="variable">$q</span>&quot;</span> -n 1 -Is /bin/true 2&gt;&amp;1)</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 124 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;⏳ 队列 [<span class="variable">$q</span>] 测试超时，跳过。&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$test_output</span>&quot;</span> | grep -q <span class="string">&quot;User cannot use the queue&quot;</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;⛔ 无权限使用队列 [<span class="variable">$q</span>]，跳过。&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;🚀 提交任务到队列 [<span class="variable">$q</span>]...&quot;</span></span><br><span class="line">    CMD=<span class="string">&quot;bsub -q <span class="variable">$q</span> -m <span class="variable">$HOSTNAME</span> <span class="variable">${@:2}</span>&quot;</span></span><br><span class="line">    <span class="comment"># exec将当前终端传递给bsub</span></span><br><span class="line">    <span class="comment"># exec $CMD</span></span><br><span class="line">    <span class="variable">$CMD</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;❌ 所有队列都无法使用或提交失败。&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo &quot;🚀 正在将任务提交到最空闲的队列 [$best_queue]...&quot;</span></span><br><span class="line"><span class="comment"># # bsub -q &quot;$best_queue&quot; &quot;$JOB_SCRIPT&quot;</span></span><br><span class="line"><span class="comment"># bsub -q &quot;$best_queue&quot; -m &quot;$HOSTNAME&quot; &quot;$argv[2-]&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/12/06/rdma/InfiniBand/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/12/06/rdma/InfiniBand/" class="post-title-link" itemprop="url">Getting Started with InfiniBand</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-12-06 09:41:56" itemprop="dateCreated datePublished" datetime="2023-12-06T09:41:56+00:00">2023-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/RDMA/" itemprop="url" rel="index"><span itemprop="name">RDMA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="ibv-fork-init"><a href="#ibv-fork-init" class="headerlink" title="ibv_fork_init"></a><code>ibv_fork_init</code></h3><p>文档<br><a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17/ibv_fork_init">ibv_fork_init</a></p>
<p><strong>模板</strong>: <code>int ibv_fork_init(void)</code></p>
<p><strong>输入参数</strong>: 无</p>
<p><strong>输出参数</strong>: 无</p>
<p><strong>返回值</strong>: <code>0</code> on success, <code>-1</code> on error. If the call fails, errno will be set to indicate the<br>reason for the failure.</p>
<p><strong>描述</strong>: <code>ibv_fork_init</code> 初始化 libverbs 的数据结构来安全地处理 <code>fork()</code> 并避免数据损坏，不论<br><code>fork()</code> 是被显式调用还是隐式调用（比如在 <code>system()</code> 中被调用）。如果所有的父进程总是阻塞直至所有的<br>子进程结束或使用 <code>exec()</code> 改变地址空间，那么 <code>ibv_fork_init</code> 可以不被调用。</p>
<p>该函数在支持 <code>madvise</code> 的 <code>MADV_DONTFORK</code> 标记的 Linux 内核（2.6.17 或更高）上可以工作。</p>
<p>设置环境变量 <code>RDMAV_FORK_SAFE</code> 或 <code>IBV_FORK_SAFE</code> 环境变量为任意值，有着与 <code>ibv_fork_init</code> 相同的效<br>果。</p>
<p>设置 <code>RDMAV_HUGEPAGES_SAFE</code> 为任意值，以告诉库需要检查内核为内存域（memory regions）使用的底层内存页<br>的大小。如果应用程序直接或通过库（如 libhugtlbfs ）间接使用大内存页（博主注：即大于 4KB）时，该环境<br>变量是必须的。（博主注：<code>ibv_fork_init</code> 将检查 <code>RDMAV_HUGEPAGES_SAFE</code> ）</p>
<p>调用 <code>ibv_fork_init</code> 将降低性能，因为每个内存注册都将有一个额外的系统调用和分配附加的内存以追踪内存<br>域（memory regions）。确切的性能损失取决于工作负载，通常不会很大。</p>
<p>设置 <code>RDMAV_HUGEPAGES_SAFE</code> 会为所有的内存注册增加更多的开销。</p>
<h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a target="_blank" rel="noopener" href="https://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=346D319BA2A9F06B8C49B2C0AAFD28D9?doi=10.1.1.668.4459&rep=rep1&type=pdf">Documentation: RDMA Aware Networks Programming User Manual v1.6</a></p>
<p><a href="/blog/documents/RDMA-Aware-Networks-Programming.pdf">Local Documentation</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E19671-01/835-0793-03/z40000419112.html#scrolltoc">Sun Network QDR InfiniBand Gateway Switch Topic Set</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1231181516811390976">RDMA 知乎专栏</a></p>
<p>用户态的 Verbs API 手册跟代码在一个仓库维护，手册地址<br>：<a target="_blank" rel="noopener" href="https://github.com/linux-rdma/rdma-core/tree/master/libibverbs/man">https://github.com/linux-rdma/rdma-core/tree/master/libibverbs/man</a></p>
<p>有很多在线的 man page 网站可以查阅这些接口的说明，比如官方的连接<br>：<a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man3/ibv_post_send.3.html">https://man7.org/linux/man-pages/man3/ibv_post_send.3.html</a></p>
<p>也有一些其他非官方网页，支持在线搜索：<a target="_blank" rel="noopener" href="https://linux.die.net/man/3/ibv">https://linux.die.net/man/3/ibv</a></p>
<p>查阅系统 man page 如果你使用的商用 OS 安装了 rdma-core 或者 libibverbs 库，那么可以直接用 man 命令查<br>询接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man ibv_post_send</span><br></pre></td></tr></table></figure>

<p>查询 Mellanox 的编程手册<br>《<a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17">RDMA Aware Networks Programming User Manual Rev 1.7</a>》<br>，最新版是 2015 年更新的。该手册写的比较详尽，并且附有示例程序，但是可能与最新的接口有一些差异<br>。Mellanox VPI®（Virtual Procotol Interconnect）架构为同时支持 InfiniBand 和以太网语义的网络适配器和<br>交换机提供高性能、低延迟和可靠的方法。</p>
<p>Book:<br><a target="_blank" rel="noopener" href="https://github.com/faquir-1990/itBooks/blob/master/Linux%20Kernel%20Networking%20-%20Implementation%20and%20Theory.pdf">Linux Kernel Networking - Implementation and Theory</a></p>
<p><a target="_blank" rel="noopener" href="http://www.rdmamojo.com/">Dotan’s blog</a>: Dotan Barak, an InfiniBand Expert. Dotan is a Senior<br>Software Manager at Mellanox Technologies working on RDMA Technologies.</p>
<h2 id="性能分析工具（profiling）"><a href="#性能分析工具（profiling）" class="headerlink" title="性能分析工具（profiling）"></a>性能分析工具（profiling）</h2><p>Blog:<br><a target="_blank" rel="noopener" href="https://www.rdmamojo.com/2013/06/08/tips-and-tricks-to-optimize-your-rdma-code/">Tips and tricks to optimize your RDMA code</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/mellanox-hpc/libibprof">libibprof</a></p>
<h2 id="IB-简介"><a href="#IB-简介" class="headerlink" title="IB 简介"></a>IB 简介</h2><p>RDMA - Remote Direct Memory Access 远程直接内存存取。</p>
<p>InfiniBand 是一种高性能计算机网络通信标准，它具有极高的吞吐量和极低的延迟。如果您需要使用 InfiniBand<br>进行编程，您需要使用支持 InfiniBand 的编程语言（如 C++）来编写代码。</p>
<p>机构和组织：</p>
<p>OFA: <a target="_blank" rel="noopener" href="https://www.openfabrics.org/">Open Fabrics Alliance</a>.</p>
<p>IBTA: <a target="_blank" rel="noopener" href="https://www.infinibandta.org/">InfiniBand Trade Association</a>.</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><ul>
<li><code>CQ</code> - Complete Queue 完成队列</li>
<li><code>WQ</code> - Work Queue 工作队列</li>
<li><code>WR</code> - Work Request 工作请求</li>
<li><code>QP</code> - Queue Pairs 队列对（Send-Receive）</li>
<li><code>SQ</code> - Send Queue 发送队列</li>
<li><code>RQ</code> - Receive Queue 接收队列</li>
<li><code>PD</code> - Protection Domain 保护域，将 QP 和 MR 结合在一起</li>
<li><code>MR</code> - Memory Region 内存区域。一块经注册过的且本地网卡可以读写的内存区域。包含 R_Key 和 L_Key。</li>
<li><code>SGE</code> - Scatter&#x2F;Gather Elements 分散&#x2F;聚集元素。</li>
<li><code>R_Key</code> - Remote Key</li>
<li><code>L_Key</code> - Local Key</li>
<li><code>CA</code> - (Host) Channel Adapter, an inifiniband network interface card.</li>
<li><code>NIC</code> - Network Interface Card 网卡。</li>
<li><code>LID</code> - Local Identifier.</li>
<li><code>CM</code> - Connection Manager.</li>
</ul>
<p>其他常见缩写：</p>
<ul>
<li><code>RC</code> - reliable connected.</li>
<li><code>SCSI</code> - Small Computer System Interface 小型计算机系统接口。</li>
<li><code>SRP</code> - SCSI RDMA Protocol. &#x2F; Secure Remote Password.</li>
</ul>
<p>博客：<a target="_blank" rel="noopener" href="https://blog.51cto.com/liangchaoxi/4044818">https://blog.51cto.com/liangchaoxi/4044818</a></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/sec-infiniband_and_rdma_related_software_packages">InfiniBand 和 RDMA 相关软件包</a></p>
<pre><code>sudo apt-get install infiniband-diags
sudo apt install ibverbs-utils
</code></pre>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><ul>
<li><a target="_blank" rel="noopener" href="https://insujang.github.io/2020-02-09/introduction-to-programming-infiniband/">introduction to programming infiniband</a></li>
<li><a target="_blank" rel="noopener" href="https://indico.cern.ch/event/218156/attachments/351725/490089/RDMA_Aware_Programming_user_manual.pdf">RDMA Aware Programming user manual (PDF)</a></li>
</ul>
<p>以下是一些支持 InfiniBand 的 C++库：</p>
<p>Infinity：这是一个轻量级的 C++ RDMA 库，用于 InfiniBand 网络。它提供了对两侧（发送&#x2F;接收）和单侧（读&#x2F;<br>写&#x2F;原子）操作的支持，并且是一个简单而强大的面向对象的 ibVerbs 抽象。该库使用户能够构建使用 RDMA 的复<br>杂应用程序，而不会影响性能<a target="_blank" rel="noopener" href="https://github.com/claudebarthels/infinity">1</a>。</p>
<p>OFED：这是一个开放式 Fabrics Enterprise Distribution，它提供了对 InfiniBand 和 RoCE（RDMA over<br>Converged Ethernet）技术的支持。OFED 提供了一组用户空间库和驱动程序，可用于构建支持 RDMA 的应用程<br>序<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/337461037">2</a>。</p>
<p>以下是使用 Infinity 库编写支持 InfiniBand 的 C++代码示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建新上下文</span></span><br><span class="line">infinity::core::Context *context = <span class="keyword">new</span> infinity::core::<span class="built_in">Context</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建队列对</span></span><br><span class="line">infinity::queues::QueuePairFactory *qpFactory = <span class="keyword">new</span> infinity::queues::<span class="built_in">QueuePairFactory</span>(context);</span><br><span class="line">infinity::queues::QueuePair *qp = qpFactory-&gt;<span class="built_in">connectToRemoteHost</span>(SERVER_IP, PORT_NUMBER);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建并向网络注册缓冲区</span></span><br><span class="line">infinity::memory::Buffer *localBuffer = <span class="keyword">new</span> infinity::memory::<span class="built_in">Buffer</span>(context, BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从远程缓冲区读取（单向）并等待完成</span></span><br><span class="line">infinity::memory::RegionToken *remoteBufferToken = <span class="keyword">new</span> infinity::memory::<span class="built_in">RegionToken</span>(REMOTE_BUFFER_INFO);</span><br><span class="line">infinity::<span class="function">requests::RequestToken <span class="title">requestToken</span><span class="params">(context)</span></span>;</span><br><span class="line">qp-&gt;<span class="built_in">read</span>(localBuffer, remoteBufferToken, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将本地缓冲区的内容写入远程缓冲区（单向）并等待完成</span></span><br><span class="line">qp-&gt;<span class="built_in">write</span>(localBuffer, remoteBufferToken, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将本地缓冲区的内容通过队列对发送（双向）并等待完成</span></span><br><span class="line">qp-&gt;<span class="built_in">send</span>(localBuffer, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line"><span class="keyword">delete</span> remoteBufferToken;</span><br><span class="line"><span class="keyword">delete</span> localBuffer;</span><br><span class="line"><span class="keyword">delete</span> qp;</span><br><span class="line"><span class="keyword">delete</span> qpFactory;</span><br><span class="line"><span class="keyword">delete</span> context;</span><br></pre></td></tr></table></figure>

<p>以下是使用 OFED 库编写支持 InfiniBand 的 C++代码示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建新上下文</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_context</span> *context = <span class="built_in">ibv_open_device</span>(*device);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建完成端口</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_pd</span> *pd = <span class="built_in">ibv_alloc_pd</span>(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建队列对</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_qp_init_attr</span> qp_init_attr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;qp_init_attr, <span class="number">0</span>, <span class="built_in">sizeof</span>(qp_init_attr));</span><br><span class="line">qp_init_attr.send_cq = cq;</span><br><span class="line">qp_init_attr.recv_cq = cq;</span><br><span class="line">qp_init_attr.qp_type = IBV_QPT_RC;</span><br><span class="line">qp_init_attr.cap.max_send_wr = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_recv_wr = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_send_sge = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_recv_sge = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_qp</span> *qp = <span class="built_in">ibv_create_qp</span>(pd, &amp;qp_init_attr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建并向网络注册缓冲区</span></span><br><span class="line"><span class="type">char</span> *localBuffer = (<span class="type">char</span> *)<span class="built_in">malloc</span>(BUFFER_SIZE);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_mr</span> *mr = <span class="built_in">ibv_reg_mr</span>(pd, localBuffer, BUFFER_SIZE, IBV_ACCESS_LOCAL_WRITE | IBV_ACCESS_REMOTE_READ | IBV_ACCESS_REMOTE_WRITE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接到远程主机</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> remoteAddress;</span><br><span class="line"><span class="built_in">memset</span>(&amp;remoteAddress, <span class="number">0</span>, <span class="built_in">sizeof</span>(remoteAddress));</span><br><span class="line">remoteAddress.sin_family = AF_INET;</span><br><span class="line">remoteAddress.sin_port = <span class="built_in">htons</span>(PORT_NUMBER);</span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, SERVER_IP, &amp;remoteAddress.sin_addr);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rdma_cm_id</span> *cmId;</span><br><span class="line"><span class="built_in">rdma_create_id</span>(*eventChannel, &amp;cmId, <span class="literal">NULL</span>, RDMA_PS_TCP);</span><br><span class="line"><span class="built_in">rdma_resolve_addr</span>(cmId, <span class="literal">NULL</span>, (<span class="keyword">struct</span> sockaddr *)&amp;remoteAddress, RESOLVE_TIMEOUT_MS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等待连接完成</span></span><br><span class="line"><span class="built_in">rdma_wait_event</span>(*eventChannel, RDMA_CM_EVENT_ESTABLISHED);</span><br><span class="line"><span class="built_in">rdma_ack_cm_event</span>(cmEvent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取远程缓冲区信息</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_wc</span> wc;</span><br><span class="line"><span class="built_in">ibv_post_recv</span>(qp, &amp;recvWr, &amp;badRecvWr);</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">ibv_poll_cq</span>(cq, <span class="number">1</span>, &amp;wc);</span><br><span class="line">&#125; <span class="keyword">while</span> (wc.status != IBV_WC_SUCCESS || wc.opcode != IBV_WC_RECV_RDMA_WITH_IMM || wc.imm_data != <span class="built_in">htonl</span>(IMM_DATA));</span><br><span class="line">remoteBufferInfo.rkey = <span class="built_in">ntohl</span>(wc.imm_data &gt;&gt; <span class="number">8</span>);</span><br><span class="line">remoteBufferInfo.vaddr = wc.wr_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将本地缓冲区的内容写入远程缓冲区（单向）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_send_wr</span> sendWr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;sendWr, <span class="number">0</span>, <span class="built_in">sizeof</span>(sendWr));</span><br><span class="line">sendWr.wr_id = <span class="number">0</span>;</span><br><span class="line">sendWr.opcode = IBV_WR_RDMA_WRITE_WITH_IMM;</span><br><span class="line">sendWr.sg_list = &amp;localSge;</span><br><span class="line">sendWr.num_sge = <span class="number">1</span>;</span><br><span class="line">sendWr.send_flags = IBV_SEND_SIGNALED;</span><br><span class="line">sendWr.wr.rdma.remote_addr = remoteBufferInfo.vaddr;</span><br><span class="line">sendWr.wr.rdma.rkey = remoteBufferInfo.rkey;</span><br><span class="line">localSge.addr = (<span class="type">uintptr_t</span>)localBuffer;</span><br><span class="line">localSge.length = BUFFER_SIZE;</span><br><span class="line">localSge.lkey = mr-&gt;lkey;</span><br><span class="line"><span class="built_in">ibv_post_send</span>(qp, &amp;sendWr, &amp;badSendWr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line"><span class="built_in">ibv_dereg_mr</span>(mr);</span><br><span class="line"><span class="built_in">free</span>(localBuffer);</span><br><span class="line"><span class="built_in">ibv_destroy_qp</span>(qp);</span><br><span class="line"><span class="built_in">ibv_dealloc_pd</span>(pd);</span><br><span class="line"><span class="built_in">ibv_close_device</span>(context);</span><br></pre></td></tr></table></figure>

<ul>
<li>入门级文档：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/337461037">https://zhuanlan.zhihu.com/p/337461037</a></li>
<li>文档：<a target="_blank" rel="noopener" href="https://docs.kernel.org/infiniband/index.html">https://docs.kernel.org/infiniband/index.html</a></li>
<li>文档：<a target="_blank" rel="noopener" href="http://blog.foool.net/wp-content/uploads/linuxdocs/infiniband.pdf">http://blog.foool.net/wp-content/uploads/linuxdocs/infiniband.pdf</a></li>
<li>文档：<a target="_blank" rel="noopener" href="https://support.bull.com/documentation/byproduct/infra/sw-extremcomp/sw-extremcomp-com/g">https://support.bull.com/documentation/byproduct/infra/sw-extremcomp/sw-extremcomp-com/g</a></li>
<li>文档<br>：<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_infiniband_and_rdma_networks/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_infiniband_and_rdma_networks/index</a></li>
<li>博客：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/337461037">https://zhuanlan.zhihu.com/p/337461037</a></li>
<li>文档<br>：<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_infiniband_and_rdma_networks">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_infiniband_and_rdma_networks</a></li>
<li>知乎专栏：<a target="_blank" rel="noopener" href="https://www.zhihu.com/column/c_1231181516811390976">https://www.zhihu.com/column/c_1231181516811390976</a></li>
<li>知乎专栏：<a target="_blank" rel="noopener" href="https://www.zhihu.com/column/rdmatechnology">https://www.zhihu.com/column/rdmatechnology</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man3/ibv_reg_mr.3.html">Linux manual page</a></p>
<h2 id="Command-Line"><a href="#Command-Line" class="headerlink" title="Command-Line"></a>Command-Line</h2><p>文档：<a target="_blank" rel="noopener" href="https://docs.nvidia.com/networking/pages/viewpage.action?pageId=43719572">https://docs.nvidia.com/networking/pages/viewpage.action?pageId=43719572</a></p>
<ul>
<li><p><code>ibstat</code></p>
</li>
<li><p><code>ibhosts</code> - 查看所有的 IB hosts。</p>
</li>
<li><p><code>ibnetdiscover</code> - discover InfiniBand topology.</p>
</li>
<li><p><code>ibv_devices</code> - list RDMA devices.</p>
</li>
<li><p><code>ibv_devinof</code> - Print information about RDMA devices available for use from userspace.</p>
</li>
<li><p><code>ibv_rc_pingpong</code> - Run a simple ping-pong test over InfiniBand via the reliable connected (RC)<br>transport.</p>
</li>
<li><p><code>targetcli</code> - administration shell for storage targets</p>
<p><code>targetcli</code> is a shell for viewing, editing, and saving the configuration of the kernel’s target<br>subsystem, also known as LIO. It enables the administrator to assign local storage resources<br>backed by either files, volumes, local SCSI devices, or ramdisk, and export them to remote systems<br>via network fabrics, such as iSCSI or FCoE.</p>
</li>
<li><p><code>srp_daemon</code> - Discovers and connects to InfiniBand SCSI RDMA Protocol (SRP) targets in an IB<br>fabric.</p>
</li>
<li><p><code>ibsrpdm</code> - List InfiniBand SCSI RDMA Protocol (SRP) targets on an IB fabric.</p>
</li>
</ul>
<h2 id="liraries"><a href="#liraries" class="headerlink" title="liraries"></a>liraries</h2><p>devid: device ID library. Refer to<br><a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E86824_01/html/E54772/libdevid-3lib.html">here</a>.</p>
<p>ibverbs: 使得用户空间进程能够使用 RDMA verbs（即进行 RDMA 操作）。Refer to<br><a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/aix/7.2?topic=ofed-libibverbs-library">here</a>.</p>
<p>dl: Dynamic Loader.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/11/30/cpp/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/11/30/cpp/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">单例模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-30 17:44:24" itemprop="dateCreated datePublished" datetime="2023-11-30T17:44:24+00:00">2023-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8623657/multiple-instances-of-singleton-across-shared-libraries-on-linux">Multiple instances of singleton across shared libraries on Linux</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/11/27/cpp/printf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/11/27/cpp/printf/" class="post-title-link" itemprop="url">printf</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-27 14:45:21" itemprop="dateCreated datePublished" datetime="2023-11-27T14:45:21+00:00">2023-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p><a target="_blank" rel="noopener" href="https://cpp.hotexamples.com/zh/examples/-/-/lprintf/cpp-lprintf-function-examples.html">https://cpp.hotexamples.com/zh/examples/-/-/lprintf/cpp-lprintf-function-examples.html</a></p>
<ul>
<li>printf</li>
<li>lprintf</li>
<li>fprintf</li>
<li>sprintf</li>
<li>vsprintf</li>
</ul>
<p>字符串处理函数<br>bcopy</p>
<h2 id="非打印字符"><a href="#非打印字符" class="headerlink" title="非打印字符"></a>非打印字符</h2><p>参见 <a target="_blank" rel="noopener" href="https://en.cppreference.com/w/cpp/language/escape">Escape sequeneces</a>.</p>
<pre><code><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> str[] = <span class="string">&quot;\x1E&quot;</span>; <span class="comment">// &quot;0x1E&quot; 是一个非打印字符</span></span><br></pre></td></tr></table></figure>
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en, zh_CN">
    <link itemprop="mainEntityOfPage" href="https://bi-an.github.io/blog/2023/11/17/cpp/Makefile%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="bi-an">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江南人物的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2023/11/17/cpp/Makefile%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">Makefile入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-11-17 14:19:35" itemprop="dateCreated datePublished" datetime="2023-11-17T14:19:35+00:00">2023-11-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-09-24 14:13:42" itemprop="dateModified" datetime="2025-09-24T14:13:42+00:00">2025-09-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/c-cpp/" itemprop="url" rel="index"><span itemprop="name">c/cpp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Makefile默认shell"><a href="#Makefile默认shell" class="headerlink" title="Makefile默认shell"></a>Makefile默认shell</h2><p>Makefile 默认的 shell 是 &#x2F;bin&#x2F;sh:<br>查看 Makefile 默认的 shell:<br>$(warning ${SHELL}) # 查看默认 shell</p>
<p>如果在 Makefile 开头加上以下语句，可以指定 shell:<br>SHELL :&#x3D; &#x2F;bin&#x2F;bash</p>
<p>Makefile 的 shell 命令似乎每一条都会新开辟一个 shell 环境来执行，因为每条 shell 命令似乎都执行了一次 .cshrc 脚本。<br>要想在同一个 shell 环境中执行所有命令，则需要使用分号分割并转义换行符。</p>
<h2 id="Makefile环境变量"><a href="#Makefile环境变量" class="headerlink" title="Makefile环境变量"></a>Makefile环境变量</h2><p>你可以通过设置环境变量 MAKEFLAGS 来让所有的子shell都将 make 认作 make -n：<br>export MAKEFLAGS&#x3D;”-n”<br>注：-n, –dry-run 表示只打印将要执行的命令，但是不真正执行它们。</p>
<p>Makefile 设置 PATH 环境变量：<br>PATH :&#x3D; mypath:$(PATH)<br>必须使用 “:&#x3D;” ，因为 “:&#x3D;” 是简单赋值，但是 “&#x3D;” 会递归展开，会导致报错 “Recursive variable &#96;PATH’ references itself (eventually)”。</p>
<p>Makefile 定义多行变量：使用 define 语句。<br>Makefile 接收命令行参数</p>
<p>非常奇特的现象：<br>$ make clean<br>cat clean.sh &gt;clean<br>chmod a+x clean<br>因为 Makefile 文件中没有 clean 的 recipe，但是当前目录下有个 clean.sh 文件。<br>但是，当再次执行 make clean，clean 脚本还是不会被执行：<br>$ make clean<br>make: &#96;clean’ is up to date.</p>
<h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h2><h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><p>Makefile对空格的处理，似乎是：从第一个非空格开始，到明确的截止符（换行、逗号、括号、注释标记’#’等）为止。<br>a &#x3D;   b   #注意末尾有3个空格<br>$(warning a&#x3D;$(a)c)</p>
<p>结果：<br>a&#x3D;    b   c</p>
<p>Makefile转义符：<br>字符	转义方法<br>$	$$<br>#	#<br>\	\</p>
<p>注意：这里说的是Makefile中的转义符，不是bash中的转义符。</p>
<h3 id="括号"><a href="#括号" class="headerlink" title="括号"></a>括号</h3><p>引用变量时，Shell使用大括号，Makefile则大括号和小括号都行。但是在命令中使用Shell变量就需要使用大括号。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/bigmarco/article/details/6687337">参考</a></p>
<h2 id="Makefile调试方法"><a href="#Makefile调试方法" class="headerlink" title="Makefile调试方法"></a>Makefile调试方法</h2><p>要调试 Makefile 并查看其执行过程，可以使用以下几种方法：<br>    1. 使用 make 的 -n 或 –dry-run 选项：这将显示 Makefile 中的所有命令，而不会真正执行它们。<br>make -n<br>    1. 使用 make 的 -d 或 –debug 选项：这将显示详细的调试信息，包括变量的展开和规则的匹配过程。<br>make -d<br>    1. 使用 make 的 -p 或 –print-data-base 选项：这将打印所有的变量、规则和隐含规则。<br>make -p<br>    1. 在 Makefile 中添加调试信息：你可以在 Makefile 中添加一些调试信息，例如使用 $(info …) 来打印变量的值。<br>print:<br>    @$(foreach V, $(.VARIABLES), $(info $(V) &#x3D; $($(V))))<br>    1. 使用 make 的 -j 选项：如果你使用并行执行，可以使用 -j 选项来限制并行任务的数量，并更容易地跟踪输出。<br>make -j1</p>
<p>makefile打印所有变量的值：<br>debug:<br>    @$(foreach V, $(.VARIABLES), $(info $(V) &#x3D; $($(V))))<br>然后在命令行中运行：<br>make debug<br>这将打印所有变量及其值。</p>
<p>print-%:<br>    @echo $* &#x3D; $($*)</p>
<p>print-% 是一个 Makefile 目标，用于打印变量的值。具体步骤如下：<br>    1. 定义一个目标 print-%，其中 % 是一个通配符，表示任意变量名。<br>    2. 使用 @echo $* &#x3D; $($*) 打印变量名和变量值。</p>
<p>示例代码：<br>print-%:<br>    @echo $* &#x3D; $($*)<br>使用方法：<br>在命令行中运行：<br>make print-VARIABLE_NAME<br>例如：<br>make print-XTENSA_SW_RELEASE<br>这将打印 XTENSA_SW_RELEASE 变量的值。</p>
<h2 id="命令行参数"><a href="#命令行参数" class="headerlink" title="命令行参数"></a>命令行参数</h2><p>See <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2214575/passing-arguments-to-make-run">here</a>.</p>
<p><code>@:</code> See <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/92978/what-does-this-2-mean-in-shell-scripting">here</a>.</p>
<p>This works fine for me:</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If the first argument is &quot;run&quot;...</span></span><br><span class="line"><span class="keyword">ifeq</span> (run,<span class="variable">$(<span class="built_in">firstword</span> <span class="variable">$(MAKECMDGOALS)</span>)</span>)</span><br><span class="line">  <span class="comment"># use the rest as arguments for &quot;run&quot;</span></span><br><span class="line">  RUN_ARGS := <span class="variable">$(<span class="built_in">wordlist</span> 2,$(words <span class="variable">$(MAKECMDGOALS)</span>)</span>,<span class="variable">$(MAKECMDGOALS)</span>)</span><br><span class="line">  <span class="comment"># ...and turn them into do-nothing targets</span></span><br><span class="line">  <span class="comment"># <span class="doctag">TODO:</span> What does the following line mean?</span></span><br><span class="line">  <span class="comment"># $(eval $(RUN_ARGS):;@:)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;cmd&quot; refers to any command</span></span><br><span class="line"><span class="section">run:</span></span><br><span class="line">	cmd <span class="variable">$(RUN_ARGS)</span></span><br></pre></td></tr></table></figure>

<h2 id="makefile同名目标处理方式"><a href="#makefile同名目标处理方式" class="headerlink" title="makefile同名目标处理方式"></a>makefile同名目标处理方式</h2><p>参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lixiangminghate/article/details/50448664">链接</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/43718595/two-targets-with-the-same-name-in-a-makefile">链接</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2019989/how-to-assign-the-output-of-a-command-to-a-makefile-variable">makefile将命令结果赋值给变量</a></p>
<h2 id="Makefile中短划线"><a href="#Makefile中短划线" class="headerlink" title="Makefile中短划线"></a>Makefile中短划线</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">all:</span></span><br><span class="line">	-/bin/rm -rf *.log</span><br></pre></td></tr></table></figure>

<p>其中，”<code>-/bin/rm</code>“的短划线”<code>-</code>“是一个特殊前缀，表示忽略命令执行过程的错误。</p>
<h2 id="为每个源文件生成一个可执行程序"><a href="#为每个源文件生成一个可执行程序" class="headerlink" title="为每个源文件生成一个可执行程序"></a>为每个源文件生成一个可执行程序</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SRCS = <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: $(SRCS:.c=)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Unnecessary, as the default rules are adequate.</span></span><br><span class="line"><span class="section">.c:</span></span><br><span class="line">	gcc <span class="variable">$(CPFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>最后两行其实不需要，默认规则已经足够了。</p>
<p>其中，<code>$(SRCS:.c=.o)</code>表示将变量<code>SRCS</code>中的每个单词（以空格分割）中的<code>.c</code>替换为<code>.o</code>。以上代码则是将所有<code>.c</code>都去掉。</p>
<h2 id="Makefile保留中间文件"><a href="#Makefile保留中间文件" class="headerlink" title="Makefile保留中间文件"></a>Makefile保留中间文件</h2><p>🛡️ 方法一：使用 .PRECIOUS 保留中间文件<br>这是最直接的方式，告诉 make 不要删除某些目标，即使构建失败：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.PRECIOUS: %.o %.d</span></span><br></pre></td></tr></table></figure>

<p>你可以指定具体的文件名或模式（如 %.o 表示所有 .o 文件）。</p>
<p>🛡️ 方法二：使用 .SECONDARY 保留中间文件但不强制重建<br>如果你希望保留中间文件，但又不希望它们被视为最终目标，可以用：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.SECONDARY: intermediate.o</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.SECONDARY:</span></span><br></pre></td></tr></table></figure>

<p>这会保留所有中间文件。</p>
<p>🧠 方法三：避免使用“中间目标”语法<br>如果你写了类似：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">intermediate: ;</span></span><br></pre></td></tr></table></figure>

<p>这种空规则会让 make 把 intermediate 视为中间目标，构建失败时自动删除。避免这种写法，或者配合 .PRECIOUS 使用。</p>
<p>🛠️ 方法四：将中间文件输出到特定目录<br>你可以将中间文件集中到一个目录中，便于管理和保留：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OBJ_DIR := build/obj</span><br><span class="line"><span class="variable">$(OBJ_DIR)</span>/%.o: %.cpp</span><br><span class="line">    <span class="variable">$(CXX)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line">然后用 .PRECIOUS: <span class="variable">$(OBJ_DIR)</span>/%.o 保留它们。</span><br></pre></td></tr></table></figure>

<p>📌 示例：保留 .o 和 .d 文件</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.PRECIOUS: %.o %.d</span></span><br><span class="line"></span><br><span class="line"><span class="section">main: main.o</span></span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">main.o: main.c</span></span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>

<p>gcc可以使用 <code>-save-temps</code> 选项保留中间文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -save-temps -c main.c</span><br></pre></td></tr></table></figure>


<p>🧠 补充：<code>-save-temps=obj</code></p>
<p>如果你只想把中间文件保存在目标文件所在目录，而不是当前目录，可以使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -save-temps=obj main.c -o main</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/9/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/blog/page/11/">11</a><a class="extend next" rel="next" href="/blog/page/11/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="bi-an"
      src="/blog/images/avatar.gif">
  <p class="site-author-name" itemprop="name">bi-an</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">107</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bi-an" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bi-an" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ah_zzg@126.com" title="E-Mail → mailto:ah_zzg@126.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://cuda-doc.readthedocs.io/" title="https:&#x2F;&#x2F;cuda-doc.readthedocs.io" rel="noopener" target="_blank">CUDA中文手册</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://infiniband-doc.readthedocs.io/" title="https:&#x2F;&#x2F;infiniband-doc.readthedocs.io&#x2F;" rel="noopener" target="_blank">InfiniBand中文手册</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bi-an</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

</body>
</html>
