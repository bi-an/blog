<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>çº¿ç¨‹çŠ¶æ€è½¬æ¢</title>
      <link href="/blog/2025/08/01/thread/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2/"/>
      <url>/blog/2025/08/01/thread/%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="çº¿ç¨‹çŠ¶æ€"><a href="#çº¿ç¨‹çŠ¶æ€" class="headerlink" title="çº¿ç¨‹çŠ¶æ€"></a>çº¿ç¨‹çŠ¶æ€</h2><ul><li>Newï¼ˆæ–°å»ºï¼‰ï¼šçº¿ç¨‹å¯¹è±¡åˆšåˆ›å»ºï¼Œè¿˜æœªå¼€å§‹æ‰§è¡Œã€‚</li><li>Readyï¼ˆå°±ç»ªï¼‰ï¼šçº¿ç¨‹å‡†å¤‡å¥½è¿è¡Œï¼Œç­‰å¾…è°ƒåº¦å™¨åˆ†é… CPUã€‚</li><li>Runningï¼ˆè¿è¡Œï¼‰ï¼šçº¿ç¨‹æ­£åœ¨ä½¿ç”¨ CPU æ‰§è¡ŒæŒ‡ä»¤ã€‚</li><li>Blockedï¼ˆé˜»å¡ï¼‰ï¼šçº¿ç¨‹åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆå¦‚ I&#x2F;Oã€é”ã€æ¡ä»¶å˜é‡ç­‰ï¼‰ï¼Œä¸èƒ½è¿è¡Œã€‚</li><li>Terminatedï¼ˆç»ˆæ­¢ï¼‰ï¼šçº¿ç¨‹æ‰§è¡Œå®Œæ¯•æˆ–è¢«å¼ºåˆ¶ç»“æŸã€‚</li><li>Sleepingï¼ˆä¼‘çœ ï¼‰ï¼šçº¿ç¨‹ä¸»åŠ¨æš‚åœä¸€æ®µæ—¶é—´ï¼ˆå¦‚ sleep()ï¼‰ï¼Œä¸èƒ½è¢«è°ƒåº¦ã€‚</li></ul><h2 id="çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾"><a href="#çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾" class="headerlink" title="çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾"></a>çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾</h2><table><thead><tr><th>å½“å‰çŠ¶æ€</th><th>è§¦å‘æ¡ä»¶</th><th>è½¬æ¢åçŠ¶æ€</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>New</td><td>è°ƒç”¨ start() æˆ– std::thread æ„é€ å‡½æ•°</td><td>Ready</td><td>çº¿ç¨‹è¢«åˆ›å»ºï¼Œç­‰å¾…è°ƒåº¦</td></tr><tr><td>Ready</td><td>è¢«è°ƒåº¦å™¨é€‰ä¸­</td><td>Running</td><td>è·å¾— CPUï¼Œå¼€å§‹æ‰§è¡Œ</td></tr><tr><td>Running</td><td>æ—¶é—´ç‰‡è€—å°½ &#x2F; yield()</td><td>Ready</td><td>ä¸»åŠ¨æˆ–è¢«åŠ¨è®©å‡º CPUï¼Œé‡æ–°æ’é˜Ÿ</td></tr><tr><td>Running</td><td>è°ƒç”¨ sleep() &#x2F; wait() &#x2F; ç­‰å¾…é”</td><td>Blocked &#x2F; Sleeping</td><td>çº¿ç¨‹ä¸èƒ½ç»§ç»­æ‰§è¡Œï¼Œç­‰å¾…äº‹ä»¶æˆ–æ—¶é—´</td></tr><tr><td>Blocked &#x2F; Sleeping</td><td>æ¡ä»¶æ»¡è¶³ &#x2F; æ—¶é—´åˆ°</td><td>Ready</td><td>çº¿ç¨‹é‡æ–°å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œç­‰å¾…è°ƒåº¦</td></tr><tr><td>Running</td><td>æ‰§è¡Œç»“æŸæˆ–å¼‚å¸¸</td><td>Terminated</td><td>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸç»“æŸ</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ€§èƒ½åˆ†æ</title>
      <link href="/blog/2025/07/31/cpp/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/"/>
      <url>/blog/2025/07/31/cpp/%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h2><h3 id="CPUæ—¶é—´"><a href="#CPUæ—¶é—´" class="headerlink" title="CPUæ—¶é—´"></a>CPUæ—¶é—´</h3><p><strong>å‡½æ•°è°ƒç”¨çš„ CPU æ—¶é—´:</strong></p><ul><li><code>Inclusive time</code>: total cpu time, include all functions it calls.</li><li><code>Exclusive time</code>: only the time used by the function itself, exclusive all its children.</li></ul><p>Refer to <a href="https://stackoverflow.com/questions/15760447/what-is-the-meaning-of-incl-cpu-time-excl-cpu-time-incl-real-cpu-time-excl-re/74426370">here</a>.</p><ol><li><p>Wall time: total time the process used, containing IO time.</p></li><li><p>CPU usage (CPUåˆ©ç”¨ç‡) &#x3D; CPU time &#x2F; Wall time.</p></li><li><p>real&#x2F;user&#x2F;system time</p><ul><li><strong>Real</strong> is wall clock time - time from start to finish of the call. This is all elapsed time including time slices used by other processes and time the process spends blocked (for example if it is waiting for I&#x2F;O to complete).</li><li><strong>User</strong> is the amount of CPU time spent in user-mode code (outside the kernel) within the process. This is only actual CPU time used in executing the process. Other processes and time the process spends blocked do not count towards this figure.</li><li><strong>Sys</strong> is the amount of CPU time spent in the kernel within the process. This means executing CPU time spent in system calls within the kernel, as opposed to library code, which is still running in user-space. Like â€˜userâ€™, this is only CPU time used by the process. See below for a brief description of kernel mode (also known as â€˜supervisorâ€™ mode) and the system call mechanism.</li></ul><p> Refer to <a href="https://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1">here</a>.</p></li><li><p>CPU æ—¶é—´å¯èƒ½å¤§äºå¢™ä¸Šæ—¶é—´ï¼š</p><p>è¿™æ˜¯å› ä¸º CPU æ—¶é—´æ˜¯æ‰€æœ‰ CPU æ ¸çš„è¿è¡Œæ—¶é—´çš„ç´¯åŠ å’Œï¼Œå¢™ä¸Šæ—¶é—´åˆ™æ˜¯å®é™…çš„æ—¶é—´ã€‚æ­¤æ—¶ CPU åˆ©ç”¨ç‡å¤§äº 100%. ï¼ˆè¿™æ˜¯è‡ªå·±çš„ç†è§£ï¼‰</p></li><li><p>TODO: Is CPU time in <em>flame graph</em> sum of all the CPU time? Or is it the wall time when CPU works?</p></li></ol><h3 id="è®¡æ—¶å·¥å…·ï¼štimer"><a href="#è®¡æ—¶å·¥å…·ï¼štimer" class="headerlink" title="è®¡æ—¶å·¥å…·ï¼štimer"></a>è®¡æ—¶å·¥å…·ï¼š<code>timer</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /usr/bin/time -p <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p>Or,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ time <span class="built_in">ls</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼ˆå‚è€ƒ<a href="https://ostechnix.com/how-to-find-the-execution-time-of-a-command-or-process-in-linux/">é“¾æ¥</a>ï¼‰ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">type</span> -a time</span><br><span class="line">time is a shell keyword</span><br><span class="line">time is /usr/bin/time</span><br></pre></td></tr></table></figure><h2 id="åˆ†æå·¥å…·"><a href="#åˆ†æå·¥å…·" class="headerlink" title="åˆ†æå·¥å…·"></a>åˆ†æå·¥å…·</h2><ul><li>Performance Analyzer</li><li>Thread Analyzer</li><li>gprof</li><li>DDT&#x2F;gdb</li></ul><h3 id="Performance-Analyzer"><a href="#Performance-Analyzer" class="headerlink" title="Performance Analyzer"></a>Performance Analyzer</h3><p>Oracle Developer Studio æä¾›äº†å¤šç§å·¥å…·ï¼šPerformance Analyzerã€Thread Analyzerã€‚</p><blockquote><p><a href="https://docs.oracle.com/cd/E77782_01/html/E77798/afagg.html#OSSPAgrkam">Performance Analyzer å®˜æ–¹æ–‡æ¡£</a></p></blockquote><p><strong>1. æ”¶é›†æ•°æ®</strong></p><p>ä½¿ç”¨ <code>collect</code> å‘½ä»¤æ”¶é›†æ•°æ®ï¼ˆ<a href="https://docs.oracle.com/cd/E77782_01/html/E77798/afadn.html#scrolltoc">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">collect collect-options program program-arguments</span><br></pre></td></tr></table></figure><p><strong>2. å¼€å§‹æ€§èƒ½åˆ†æ</strong></p><p>ä½¿ç”¨ <code>analyzer</code> å‘½ä»¤è¿›è¡Œæ€§èƒ½åˆ†æï¼ˆ<a href="https://docs.oracle.com/cd/E77782_01/html/E77798/afafs.html#scrolltoc">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">analyzer [control-options] [experiment | experiment-list]</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">analyzer -c test.1.er test.4.er</span><br></pre></td></tr></table></figure><h3 id="Thread-Analyzer"><a href="#Thread-Analyzer" class="headerlink" title="Thread Analyzer"></a>Thread Analyzer</h3><blockquote><p><a href="https://www.oracle.com/application-development/technologies/developerstudio-features.html#thread-analyzer-tab">Thread Analyzer å®˜æ–¹æ–‡æ¡£</a></p></blockquote><h3 id="gprof"><a href="#gprof" class="headerlink" title="gprof"></a>gprof</h3><p>gprof(GNU profiler)æ˜¯GNU binutilså·¥å…·é›†ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œlinuxç³»ç»Ÿå½“ä¸­ä¼šè‡ªå¸¦è¿™ä¸ªå·¥å…·ã€‚å®ƒå¯ä»¥åˆ†æç¨‹åºçš„æ€§èƒ½ï¼Œèƒ½ç»™å‡ºå‡½æ•°è°ƒç”¨æ—¶é—´ã€è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨å…³ç³»ï¼Œæ‰¾å‡ºç¨‹åºçš„ç“¶é¢ˆæ‰€åœ¨ã€‚åœ¨ç¼–è¯‘å’Œé“¾æ¥é€‰é¡¹ä¸­éƒ½åŠ å…¥-pgä¹‹åï¼Œgccä¼šåœ¨æ¯ä¸ªå‡½æ•°ä¸­æ’å…¥ä»£ç ç‰‡æ®µï¼Œç”¨äºè®°å½•å‡½æ•°é—´çš„è°ƒç”¨å…³ç³»å’Œè°ƒç”¨æ¬¡æ•°ï¼Œå¹¶é‡‡é›†å‡½æ•°çš„è°ƒç”¨æ—¶é—´ã€‚</p><ul><li><a href="https://ftp.gnu.org/old-gnu/Manuals/gprof-2.9.1/html_mono/gprof.html">gprofå®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://blog.csdn.net/luronggui/article/-details/118141262">ä½¿ç”¨æ–¹æ³•</a></li><li><a href="https://zhuanlan.zhihu.com/p/385842627">åšå®¢</a></li></ul><h3 id="DDT"><a href="#DDT" class="headerlink" title="DDT"></a>DDT</h3><p><a href="https://www.linaroforge.com/linaroDdt">DDT</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ··åˆç¼–è¯‘</title>
      <link href="/blog/2025/07/31/cpp/%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%91/"/>
      <url>/blog/2025/07/31/cpp/%E6%B7%B7%E5%90%88%E7%BC%96%E8%AF%91/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>â€œHybrid Buildâ€ï¼ˆæ··åˆæ„å»ºï¼‰æ˜¯æŒ‡ä¸€ç§ å…¼é¡¾è°ƒè¯•èƒ½åŠ›ä¸è¿è¡Œæ€§èƒ½ çš„æ„å»ºæ–¹å¼ï¼Œå¸¸ç”¨äºéœ€è¦åœ¨ Release ç¯å¢ƒä¸­è¿›è¡Œé—®é¢˜åˆ†æï¼Œä½†åˆä¸èƒ½å®Œå…¨ä½¿ç”¨ Debug æ„å»ºçš„åœºæ™¯ã€‚</p><h3 id="ğŸ§©-Hybrid-Build-çš„æ ¸å¿ƒç‰¹å¾"><a href="#ğŸ§©-Hybrid-Build-çš„æ ¸å¿ƒç‰¹å¾" class="headerlink" title="ğŸ§© Hybrid Build çš„æ ¸å¿ƒç‰¹å¾"></a>ğŸ§© Hybrid Build çš„æ ¸å¿ƒç‰¹å¾</h3><table><thead><tr><th>ç‰¹æ€§</th><th>æè¿°</th></tr></thead><tbody><tr><td>ä¼˜åŒ–ç­‰çº§</td><td>ä½¿ç”¨ -O2 æˆ– -O3ï¼Œä¿æŒæ¥è¿‘ Release çš„æ€§èƒ½</td></tr><tr><td>è°ƒè¯•ä¿¡æ¯</td><td>ä¿ç•™ -gï¼Œç”Ÿæˆ DWARF è°ƒè¯•ç¬¦å·ï¼Œä¾¿äºåˆ†æ core dump æˆ–ä½¿ç”¨ gdb</td></tr><tr><td>ç¬¦å·è¡¨</td><td>å¯é€‰å¼€å¯ -fno-omit-frame-pointerï¼Œä¾¿äºæ ˆå›æº¯</td></tr><tr><td>æ—¥å¿—&#x2F;ä¿æŠ¤æœºåˆ¶</td><td>å¯åµŒå…¥è½»é‡çº§æ—¥å¿—ã€ASAN-liteã€canary ç­‰æœºåˆ¶ï¼Œå¢å¼ºå¯è§‚æµ‹æ€§</td></tr><tr><td>éƒ¨ç½²ç­–ç•¥</td><td>ä»…åœ¨å†…éƒ¨æˆ–ç‰¹å®šå®¢æˆ·ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé¿å…æš´éœ²å®Œæ•´æºç ç»“æ„æˆ–è°ƒè¯•ç¬¦å·</td></tr></tbody></table><p>âœ… ç¼–è¯‘ç¤ºä¾‹ï¼ˆGCC&#x2F;Clangï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -O2 -g -fno-omit-frame-pointer -DNDEBUG -o your_program main.cpp</span><br></pre></td></tr></table></figure><ul><li>-O2ï¼šä¼˜åŒ–ä»£ç ï¼Œæ¥è¿‘ Release æ€§èƒ½</li><li>-gï¼šä¿ç•™è°ƒè¯•ä¿¡æ¯</li><li>-fno-omit-frame-pointerï¼šä¿ç•™å¸§æŒ‡é’ˆï¼Œä¾¿äºæ ˆè¿½è¸ª</li><li>-DNDEBUGï¼šå…³é—­æ–­è¨€ï¼ˆassertï¼‰</li></ul><h3 id="ğŸ¯-ä½¿ç”¨åœºæ™¯"><a href="#ğŸ¯-ä½¿ç”¨åœºæ™¯" class="headerlink" title="ğŸ¯ ä½¿ç”¨åœºæ™¯"></a>ğŸ¯ ä½¿ç”¨åœºæ™¯</h3><table><thead><tr><th>åœºæ™¯</th><th>æ˜¯å¦æ¨èä½¿ç”¨ Hybrid Build</th><th>åŸå› è¯´æ˜</th></tr></thead><tbody><tr><td>å®¢æˆ·ç°åœºå¤ç°å´©æºƒ</td><td>âœ…</td><td>å¯é€šè¿‡ core dump + ç¬¦å·è¡¨å¿«é€Ÿå®šä½é—®é¢˜</td></tr><tr><td>å†…éƒ¨æ€§èƒ½æµ‹è¯•</td><td>âœ…</td><td>ä¿æŒä¼˜åŒ–æ•ˆæœï¼ŒåŒæ—¶å¯è°ƒè¯•</td></tr><tr><td>æ­£å¼å‘å¸ƒç»™å®¢æˆ·ï¼ˆå¤§è§„æ¨¡éƒ¨ç½²ï¼‰</td><td>âŒ</td><td>ä¸å»ºè®®ï¼Œå¯èƒ½æš´éœ²ç¬¦å·ä¿¡æ¯ï¼Œä½“ç§¯è¾ƒå¤§</td></tr><tr><td>ä¸ ASAN&#x2F;TSAN è”åˆä½¿ç”¨</td><td>âš ï¸ï¼ˆéœ€å…³é—­ä¼˜åŒ–ï¼‰</td><td>ASAN&#x2F;TSAN æ›´é€‚åˆ Debug æ„å»ºï¼ŒHybrid ä¼šå½±å“æ£€æµ‹ç²¾åº¦</td></tr></tbody></table><h3 id="ğŸ› ï¸-å®è·µå»ºè®®"><a href="#ğŸ› ï¸-å®è·µå»ºè®®" class="headerlink" title="ğŸ› ï¸ å®è·µå»ºè®®"></a>ğŸ› ï¸ å®è·µå»ºè®®</h3><ul><li>ç¬¦å·åˆ†ç¦»ï¼šä½¿ç”¨ <code>objcopy --only-keep-debug</code> åˆ†ç¦»è°ƒè¯•ç¬¦å·ï¼Œé¿å…æš´éœ²ç»™å®¢æˆ·ã€‚</li><li>ç¬¦å·æœåŠ¡å™¨ï¼šå†…éƒ¨ç»´æŠ¤ç¬¦å·æœåŠ¡å™¨ï¼Œæ”¯æŒé€šè¿‡ core æ–‡ä»¶è‡ªåŠ¨ç¬¦å·åŒ–ã€‚</li><li>ç»“åˆæ—¥å¿—æ¡†æ¶ï¼šHybrid Build å¯ä¸è½»é‡çº§æ—¥å¿—æ¡†æ¶ç»“åˆï¼Œå¢å¼ºé—®é¢˜å®šä½èƒ½åŠ›ã€‚</li></ul><h2 id="ç¬¦å·åˆ†ç¦»ï¼ˆSplit-Debug-Infoï¼‰"><a href="#ç¬¦å·åˆ†ç¦»ï¼ˆSplit-Debug-Infoï¼‰" class="headerlink" title="ç¬¦å·åˆ†ç¦»ï¼ˆSplit Debug Infoï¼‰"></a>ç¬¦å·åˆ†ç¦»ï¼ˆSplit Debug Infoï¼‰</h2><p><strong>âœ… ä¸ºä»€ä¹ˆè¦åˆ†ç¦»ï¼Ÿ</strong></p><ul><li>Release ç‰ˆæœ¬ï¼šä½“ç§¯å°ï¼Œæ€§èƒ½é«˜ï¼Œä½†ç¼ºå°‘è°ƒè¯•ä¿¡æ¯</li><li>è°ƒè¯•ç¬¦å·æ–‡ä»¶ï¼šä¿ç•™å®Œæ•´ç¬¦å·ä¿¡æ¯ï¼Œç”¨äºå†…éƒ¨åˆ†æ core dump</li></ul><p><strong>ğŸ› ï¸ åˆ†ç¦»æµç¨‹ï¼ˆä»¥ GCC&#x2F;Clang ä¸ºä¾‹ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¯‘æ—¶ä¿ç•™è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">g++ -O2 -g -o your_program main.cpp</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†ç¦»è°ƒè¯•ç¬¦å·</span></span><br><span class="line">objcopy --only-keep-debug your_program your_program.debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»é™¤ä¸»ç¨‹åºä¸­çš„è°ƒè¯•ä¿¡æ¯</span></span><br><span class="line">strip --strip-debug --strip-unneeded your_program</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ è°ƒè¯•ç¬¦å·å…³è”ä¿¡æ¯</span></span><br><span class="line">objcopy --add-gnu-debuglink=your_program.debug your_program</span><br></pre></td></tr></table></figure><p><strong>âœ… æœ€ç»ˆäº§ç‰©ï¼š</strong></p><ul><li>your_programï¼šå¯äº¤ä»˜ç»™å®¢æˆ·çš„ Release å¯æ‰§è¡Œæ–‡ä»¶</li><li>your_program.debugï¼šå†…éƒ¨ä½¿ç”¨çš„è°ƒè¯•ç¬¦å·æ–‡ä»¶</li></ul><h2 id="core-dump-åˆ†æ"><a href="#core-dump-åˆ†æ" class="headerlink" title="core dump åˆ†æ"></a>core dump åˆ†æ</h2><p><strong>1. å®¢æˆ·ä¾§è®¾ç½® core dump</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p><strong>2. å®¢æˆ·è¿è¡Œç¨‹åºå¹¶ç”Ÿæˆ core æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./your_program crash_input.txt</span><br><span class="line"><span class="comment"># ç¨‹åºå´©æºƒåç”Ÿæˆ core æ–‡ä»¶ï¼Œå¦‚ core.12345</span></span><br></pre></td></tr></table></figure><p><strong>3. å®¢æˆ·æä¾› core æ–‡ä»¶ + å¯æ‰§è¡Œæ–‡ä»¶</strong></p><ul><li>core.12345</li><li>your_programï¼ˆRelease ç‰ˆæœ¬ï¼‰</li></ul><p><strong>4. ä½ åœ¨å†…éƒ¨åˆ†æ core æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gdb your_program core.12345</span><br><span class="line"><span class="comment"># åŠ è½½è°ƒè¯•ç¬¦å·</span></span><br><span class="line">(gdb) symbol-file your_program.debug</span><br><span class="line">(gdb) bt  <span class="comment"># æŸ¥çœ‹è°ƒç”¨æ ˆ</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…å­˜åˆ†æ</title>
      <link href="/blog/2025/07/31/cpp/%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/"/>
      <url>/blog/2025/07/31/cpp/%E5%86%85%E5%AD%98%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><p>valgrind æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å†…å­˜è°ƒè¯•å’Œæ€§èƒ½åˆ†æå·¥å…·ï¼Œå®ƒçš„ä¸åŒå­å·¥å…·ç”¨äºä¸åŒçš„åˆ†æç›®çš„ã€‚<code>--memcheck</code> å’Œ <code>--massif</code> æ˜¯å…¶ä¸­ä¸¤ä¸ªå¸¸ç”¨çš„å·¥å…·ã€‚</p><p>ASANï¼ˆAddressSanitizerï¼‰ å’Œ TSANï¼ˆThreadSanitizerï¼‰ éƒ½æ˜¯ç”±ç°ä»£ç¼–è¯‘å™¨ï¼ˆå¦‚ Clang å’Œ GCCï¼‰æä¾›çš„ è¿è¡Œæ—¶æ£€æµ‹å·¥å…·ï¼Œç”¨äºå¸®åŠ©å¼€å‘è€…åœ¨å¼€å‘é˜¶æ®µå‘ç°å†…å­˜é”™è¯¯å’Œçº¿ç¨‹é—®é¢˜ã€‚</p><ul><li>Clangï¼šå…¨é¢æ”¯æŒ ASAN å’Œ TSAN</li><li>GCCï¼šä¹Ÿæ”¯æŒï¼Œä½† TSAN çš„æ”¯æŒç•¥é€Šäº Clang</li></ul><p><a href="https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/">åšå®¢ï¼šHow to get a core dump for a segfault on Linux</a></p><h3 id="Memcheckï¼šå†…å­˜é”™è¯¯æ£€æŸ¥å·¥å…·"><a href="#Memcheckï¼šå†…å­˜é”™è¯¯æ£€æŸ¥å·¥å…·" class="headerlink" title="Memcheckï¼šå†…å­˜é”™è¯¯æ£€æŸ¥å·¥å…·"></a>Memcheckï¼šå†…å­˜é”™è¯¯æ£€æŸ¥å·¥å…·</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://valgrind.org/docs/manual/mc-manual.html">4. Memcheck: a memory error detector</a></p><ul><li>ç”¨é€”ï¼šæ£€æµ‹å†…å­˜ç›¸å…³çš„é”™è¯¯ï¼Œå¦‚å†…å­˜æ³„æ¼ã€è¶Šç•Œè®¿é—®ã€æœªåˆå§‹åŒ–å†…å­˜è¯»å–ç­‰ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šè°ƒè¯•ç¨‹åºä¸­çš„å†…å­˜é”™è¯¯ï¼Œç¡®ä¿ç¨‹åºçš„å†…å­˜ä½¿ç”¨æ˜¯å®‰å…¨çš„ã€‚</li><li>è¾“å‡ºå†…å®¹ï¼š<ul><li>å“ªäº›å†…å­˜æ²¡æœ‰é‡Šæ”¾ï¼ˆå†…å­˜æ³„æ¼ï¼‰</li><li>å“ªäº›å†…å­˜è¢«éæ³•è®¿é—®ï¼ˆè¶Šç•Œã€æœªåˆå§‹åŒ–ç­‰ï¼‰</li><li>å“ªäº›å†…å­˜è®¿é—®æ˜¯æœªå®šä¹‰è¡Œä¸º</li></ul></li><li>å¸¸ç”¨å‘½ä»¤ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valgrind --tool=memcheck ./your_program</span><br></pre></td></tr></table></figure><h3 id="Massifï¼šå †å†…å­˜ä½¿ç”¨åˆ†æå·¥å…·"><a href="#Massifï¼šå †å†…å­˜ä½¿ç”¨åˆ†æå·¥å…·" class="headerlink" title="Massifï¼šå †å†…å­˜ä½¿ç”¨åˆ†æå·¥å…·"></a>Massifï¼šå †å†…å­˜ä½¿ç”¨åˆ†æå·¥å…·</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://valgrind.org/docs/manual/ms-manual.html">9. Massif: a heap profiler</a></p><ul><li>ç”¨é€”ï¼šåˆ†æç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œå¸®åŠ©ä¼˜åŒ–å†…å­˜å ç”¨ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šæ€§èƒ½åˆ†æï¼Œæ‰¾å‡ºå†…å­˜å ç”¨é«˜çš„ä»£ç è·¯å¾„æˆ–æ•°æ®ç»“æ„ã€‚</li><li>è¾“å‡ºå†…å®¹ï¼š<ul><li>å †å†…å­˜ä½¿ç”¨éšæ—¶é—´çš„å˜åŒ–ï¼ˆå¿«ç…§ï¼‰ï¼šéœ€ç”¨ <code>ms_print</code> æˆ– <a href="https://courses.cs.washington.edu/courses/cse326/05wi/valgrind-doc/ms_main.html">PostScript Viewer</a> æŸ¥çœ‹</li><li>å“ªäº›å‡½æ•°æˆ–è°ƒç”¨è·¯å¾„åˆ†é…äº†æœ€å¤šçš„å†…å­˜</li><li>å¸¸ç”¨å‘½ä»¤ï¼š</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">valgrind --tool=massif ./your_program</span><br><span class="line">ms_print massif.out.&lt;pid&gt;</span><br></pre></td></tr></table></figure><p><strong>ğŸ†š Memcheck vs Massif å¯¹æ¯”æ€»ç»“</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th><code>--memcheck</code></th><th><code>--massif</code></th></tr></thead><tbody><tr><td>å·¥å…·ç±»å‹</td><td>å†…å­˜é”™è¯¯æ£€æŸ¥å·¥å…·</td><td>å †å†…å­˜ä½¿ç”¨åˆ†æå·¥å…·</td></tr><tr><td>ä¸»è¦ç”¨é€”</td><td>æ£€æŸ¥å†…å­˜æ³„æ¼ã€è¶Šç•Œè®¿é—®ã€æœªåˆå§‹åŒ–è¯»å–ç­‰</td><td>åˆ†æå †å†…å­˜ä½¿ç”¨è¶‹åŠ¿å’Œå³°å€¼</td></tr><tr><td>æ£€æµ‹å†…å­˜æ³„æ¼</td><td>âœ…</td><td>âŒï¼ˆä¸ç›´æ¥æ£€æµ‹ï¼‰</td></tr><tr><td>åˆ†æå†…å­˜å¢é•¿è¶‹åŠ¿</td><td>âŒ</td><td>âœ…</td></tr><tr><td>è¾“å‡ºæ ¼å¼</td><td>é”™è¯¯æŠ¥å‘Šï¼ˆæ–‡æœ¬ï¼‰</td><td>å†…å­˜å¿«ç…§ï¼ˆéœ€ç”¨ <code>ms_print</code> æŸ¥çœ‹ï¼‰</td></tr><tr><td>æ€§èƒ½å¼€é”€</td><td>é«˜ï¼ˆè¿è¡Œé€Ÿåº¦å˜æ…¢ï¼‰</td><td>ä¸­ç­‰</td></tr></tbody></table><h3 id="ThreadSanitizerï¼ˆTSANï¼‰"><a href="#ThreadSanitizerï¼ˆTSANï¼‰" class="headerlink" title="ThreadSanitizerï¼ˆTSANï¼‰"></a>ThreadSanitizerï¼ˆTSANï¼‰</h3><ul><li>ç”¨é€”ï¼šæ£€æµ‹å¤šçº¿ç¨‹ç¨‹åºä¸­çš„ æ•°æ®ç«äº‰ï¼ˆdata raceï¼‰ å’Œå…¶ä»–çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šå¹¶å‘ç¨‹åºè°ƒè¯•ï¼Œå°¤å…¶æ˜¯å½“å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«å˜é‡æ—¶ã€‚</li><li>æ£€æµ‹å†…å®¹ï¼š<ul><li>æ•°æ®ç«äº‰ï¼ˆä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å˜é‡ï¼Œä¸”è‡³å°‘ä¸€ä¸ªæ˜¯å†™æ“ä½œï¼‰</li><li>é”ä½¿ç”¨é”™è¯¯ï¼ˆæ­»é”ã€åŒé‡è§£é”ç­‰ï¼‰</li></ul></li><li>å¯ç”¨æ–¹å¼ï¼ˆClang&#x2F;GCCï¼‰ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -fsanitize=thread -g your_program.c -o your_program</span><br></pre></td></tr></table></figure><h3 id="AddressSanitizerï¼ˆASANï¼‰"><a href="#AddressSanitizerï¼ˆASANï¼‰" class="headerlink" title="AddressSanitizerï¼ˆASANï¼‰"></a>AddressSanitizerï¼ˆASANï¼‰</h3><p><a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">AddressSanitizer æ–‡æ¡£</a></p><ul><li>ç”¨é€”ï¼šæ£€æµ‹å†…å­˜è®¿é—®é”™è¯¯ã€‚</li><li>é€‚ç”¨åœºæ™¯ï¼šå•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹ç¨‹åºä¸­è°ƒè¯•å†…å­˜é—®é¢˜ã€‚</li><li>æ£€æµ‹å†…å®¹ï¼š<ul><li>è¶Šç•Œè®¿é—®ï¼ˆstack&#x2F;heap&#x2F;globalï¼‰</li><li>use-after-freeï¼ˆé‡Šæ”¾åä½¿ç”¨ï¼‰</li><li>å†…å­˜æ³„æ¼ï¼ˆå¯é€‰ï¼‰</li><li>use-after-scopeï¼ˆä½œç”¨åŸŸç»“æŸåä½¿ç”¨å±€éƒ¨å˜é‡ï¼‰</li></ul></li><li>å¯ç”¨æ–¹å¼ï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -fsanitize=address -g your_program.c -o your_program</span><br></pre></td></tr></table></figure><p><strong>ğŸ†š TSAN vs ASAN å¯¹æ¯”æ€»ç»“</strong></p><table><thead><tr><th>ç‰¹æ€§</th><th>TSANï¼ˆThreadSanitizerï¼‰</th><th>ASANï¼ˆAddressSanitizerï¼‰</th></tr></thead><tbody><tr><td>æ£€æµ‹ç›®æ ‡</td><td>å¤šçº¿ç¨‹æ•°æ®ç«äº‰</td><td>å†…å­˜è®¿é—®é”™è¯¯</td></tr><tr><td>æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹</td><td>âœ…ï¼ˆä¸“ä¸ºå¤šçº¿ç¨‹è®¾è®¡ï¼‰</td><td>âœ…ï¼ˆæ”¯æŒï¼Œä½†ä¸æ£€æµ‹æ•°æ®ç«äº‰ï¼‰</td></tr><tr><td>æ€§èƒ½å¼€é”€</td><td>è¾ƒé«˜ï¼ˆ10x~40xï¼‰</td><td>ä¸­ç­‰ï¼ˆ2x~3xï¼‰</td></tr><tr><td>å†…å­˜å¼€é”€</td><td>ä¸­ç­‰</td><td>è¾ƒé«˜ï¼ˆå¢åŠ çº¦2å€å†…å­˜ä½¿ç”¨ï¼‰</td></tr><tr><td>æ˜¯å¦æ£€æµ‹å†…å­˜æ³„æ¼</td><td>âŒï¼ˆä¸æ£€æµ‹ï¼‰</td><td>âœ…ï¼ˆå¯é€‰å¼€å¯ï¼‰</td></tr><tr><td>æ˜¯å¦æ£€æµ‹æ•°æ®ç«äº‰</td><td>âœ…</td><td>âŒ</td></tr></tbody></table><p><strong>ğŸ†š Memcheck vs Massif vs TSAN vs ASAN å¯¹æ¯”æ€»ç»“</strong></p><table><thead><tr><th>å·¥å…·åç§°</th><th>ç±»å‹</th><th>ä¸»è¦ç”¨é€”</th><th>æ£€æµ‹å†…å®¹</th><th>æ˜¯å¦æ”¯æŒå¤šçº¿ç¨‹</th><th>æ€§èƒ½å¼€é”€</th><th>å†…å­˜å¼€é”€</th><th>æ˜¯å¦æ£€æµ‹å†…å­˜æ³„æ¼</th><th>æ˜¯å¦æ£€æµ‹æ•°æ®ç«äº‰</th></tr></thead><tbody><tr><td><strong>Memcheck</strong></td><td>Valgrind å·¥å…·</td><td>å†…å­˜é”™è¯¯æ£€æµ‹</td><td>å†…å­˜æ³„æ¼ã€è¶Šç•Œè®¿é—®ã€æœªåˆå§‹åŒ–è¯»å–ã€éæ³•é‡Šæ”¾ç­‰</td><td>âœ…ï¼ˆæœ‰é™æ”¯æŒï¼‰</td><td>é«˜ï¼ˆ10x+ï¼‰</td><td>é«˜</td><td>âœ…</td><td>âŒ</td></tr><tr><td><strong>Massif</strong></td><td>Valgrind å·¥å…·</td><td>å †å†…å­˜ä½¿ç”¨åˆ†æ</td><td>å †å†…å­˜åˆ†é…è¶‹åŠ¿ã€å†…å­˜å³°å€¼ã€è°ƒç”¨è·¯å¾„åˆ†æ</td><td>âœ…</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>âŒ</td><td>âŒ</td></tr><tr><td><strong>ASAN</strong></td><td>ç¼–è¯‘å™¨å·¥å…·</td><td>å†…å­˜è®¿é—®é”™è¯¯æ£€æµ‹</td><td>è¶Šç•Œè®¿é—®ã€use-after-freeã€use-after-scopeã€å†…å­˜æ³„æ¼ï¼ˆå¯é€‰ï¼‰</td><td>âœ…</td><td>ä¸­ç­‰ï¼ˆ2x~3xï¼‰</td><td>é«˜ï¼ˆçº¦2å€ï¼‰</td><td>âœ…ï¼ˆå¯é€‰ï¼‰</td><td>âŒ</td></tr><tr><td><strong>TSAN</strong></td><td>ç¼–è¯‘å™¨å·¥å…·</td><td>å¤šçº¿ç¨‹æ•°æ®ç«äº‰æ£€æµ‹</td><td>æ•°æ®ç«äº‰ã€æ­»é”ã€é”™è¯¯çš„é”ä½¿ç”¨ç­‰</td><td>âœ…ï¼ˆå¼ºæ”¯æŒï¼‰</td><td>é«˜ï¼ˆ5x~40xï¼‰</td><td>ä¸­ç­‰</td><td>âŒ</td><td>âœ…</td></tr></tbody></table><h2 id="UBSan-Unifined-Behavior-Sanitizer"><a href="#UBSan-Unifined-Behavior-Sanitizer" class="headerlink" title="UBSan (Unifined Behavior Sanitizer)"></a>UBSan (Unifined Behavior Sanitizer)</h2><table><thead><tr><th>Sanitizer</th><th>æ£€æµ‹å†…å®¹</th><th>Google è´¡çŒ®</th></tr></thead><tbody><tr><td>ASAN</td><td>å†…å­˜è®¿é—®é”™è¯¯</td><td>âœ… æ˜¯</td></tr><tr><td>UBSan</td><td>æœªå®šä¹‰è¡Œä¸º</td><td>âœ… æ˜¯</td></tr><tr><td>TSAN</td><td>æ•°æ®ç«äº‰</td><td>âœ… æ˜¯</td></tr><tr><td>MSAN</td><td>æœªåˆå§‹åŒ–å†…å­˜ä½¿ç”¨</td><td>âœ… æ˜¯</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gccå±æ€§</title>
      <link href="/blog/2025/07/25/cpp/gcc%E5%B1%9E%E6%80%A7/"/>
      <url>/blog/2025/07/25/cpp/gcc%E5%B1%9E%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="attribute-visibility-default"><a href="#attribute-visibility-default" class="headerlink" title="__attribute__((__visibility__(&quot;default&quot;)))"></a><code>__attribute__((__visibility__(&quot;default&quot;)))</code></h2><p><code>__attribute__((__visibility__(&quot;default&quot;)))</code> æ˜¯ GCC ç¼–è¯‘å™¨çš„ä¸€ä¸ªå±æ€§ï¼Œç”¨äºæ§åˆ¶ç¬¦å·çš„å¯è§æ€§ã€‚å®ƒæŒ‡å®šäº†ä¸€ä¸ªç¬¦å·ï¼ˆå¦‚å‡½æ•°æˆ–å˜é‡ï¼‰åœ¨å…±äº«åº“ä¸­çš„å¯è§æ€§ã€‚</p><h3 id="å«ä¹‰ï¼š"><a href="#å«ä¹‰ï¼š" class="headerlink" title="å«ä¹‰ï¼š"></a>å«ä¹‰ï¼š</h3><ul><li><strong><code>default</code> å¯è§æ€§</strong>ï¼š<ul><li>ç¬¦å·å¯ä»¥è¢«å…¶ä»–å…±äº«åº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶è®¿é—®ã€‚</li><li>ç¬¦å·ä¼šè¢«å¯¼å‡ºåˆ°å…±äº«åº“çš„ç¬¦å·è¡¨ä¸­ã€‚</li></ul></li></ul><h3 id="ç”¨é€”ï¼š"><a href="#ç”¨é€”ï¼š" class="headerlink" title="ç”¨é€”ï¼š"></a>ç”¨é€”ï¼š</h3><ul><li><p>ç”¨äºæ˜¾å¼å¯¼å‡ºç¬¦å·ï¼Œä½¿å…¶åœ¨åŠ¨æ€é“¾æ¥æ—¶å¯è¢«å…¶ä»–æ¨¡å—ä½¿ç”¨ã€‚</p></li><li><p>åœ¨å…±äº«åº“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¬¦å·æ˜¯ <code>default</code> å¯è§çš„ï¼Œä½†ä½¿ç”¨ <code>-fvisibility=hidden</code> ç¼–è¯‘é€‰é¡¹æ—¶ï¼Œæ‰€æœ‰ç¬¦å·ä¼šè¢«éšè—ï¼Œåªæœ‰æ˜¾å¼æ ‡è®°ä¸º <code>default</code> çš„ç¬¦å·æ‰ä¼šå¯¼å‡ºã€‚</p></li><li><p>ç¼–è¯‘å™¨ä¼˜åŒ–çš„å½±å“ï¼šå³ä½¿æ²¡æœ‰ <code>-fvisibility=hidden</code>ï¼ŒæŸäº›ç¼–è¯‘å™¨ä¼˜åŒ–ï¼ˆå¦‚ <code>-flto</code>ï¼‰å¯èƒ½ä¼šå½±å“ç¬¦å·çš„å¯¼å‡ºã€‚<br>æ˜¾å¼ä½¿ç”¨ <code>__attribute__((__visibility__(&quot;default&quot;)))</code> å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p></li></ul><h3 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((__visibility__(<span class="string">&quot;default&quot;</span>)))</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myFunc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Function implementation</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ç¡®è®¤ <code>myFunc</code> æ˜¯å¦åœ¨è¢«é“¾æ¥æ—¶å¯è§ï¼š</p><h3 id="æ–¹æ³•-1-ä½¿ç”¨-nm-å·¥å…·æ£€æŸ¥ç¬¦å·"><a href="#æ–¹æ³•-1-ä½¿ç”¨-nm-å·¥å…·æ£€æŸ¥ç¬¦å·" class="headerlink" title="æ–¹æ³• 1: ä½¿ç”¨ nm å·¥å…·æ£€æŸ¥ç¬¦å·"></a>æ–¹æ³• 1: ä½¿ç”¨ <code>nm</code> å·¥å…·æ£€æŸ¥ç¬¦å·</h3><p><code>nm</code> æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥åˆ—å‡ºç›®æ ‡æ–‡ä»¶æˆ–å…±äº«åº“ä¸­çš„ç¬¦å·è¡¨ã€‚</p><ol><li><p>æ£€æŸ¥ <code>libchip.so</code> ä¸­æ˜¯å¦å¯¼å‡ºäº† <code>myFunc</code>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nm -D libchip.so | grep myFunc</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ <code>myFunc</code> å‡ºç°åœ¨è¾“å‡ºä¸­ï¼Œè¯´æ˜å®ƒè¢«å¯¼å‡ºå¹¶ä¸”å¯è§ã€‚</li><li>å¦‚æœæ²¡æœ‰å‡ºç°ï¼Œå¯èƒ½æ˜¯ç¬¦å·è¢«éšè—ï¼ˆä¾‹å¦‚ä½¿ç”¨äº† <code>-fvisibility=hidden</code>ï¼‰ã€‚</li></ul></li><li><p>å¦‚æœ <code>myFunc</code> æ²¡æœ‰å¯¼å‡ºï¼š</p><ul><li>ç¡®è®¤æ˜¯å¦åœ¨ä»£ç ä¸­ä½¿ç”¨äº† <code>__attribute__((__visibility__(&quot;default&quot;)))</code>ã€‚</li><li>ç¡®è®¤ç¼–è¯‘æ—¶æ˜¯å¦å¯ç”¨äº† <code>-fvisibility=hidden</code>ã€‚</li></ul></li></ol><hr><h3 id="æ–¹æ³•-2-ä½¿ç”¨-readelf-æ£€æŸ¥åŠ¨æ€ç¬¦å·"><a href="#æ–¹æ³•-2-ä½¿ç”¨-readelf-æ£€æŸ¥åŠ¨æ€ç¬¦å·" class="headerlink" title="æ–¹æ³• 2: ä½¿ç”¨ readelf æ£€æŸ¥åŠ¨æ€ç¬¦å·"></a>æ–¹æ³• 2: ä½¿ç”¨ <code>readelf</code> æ£€æŸ¥åŠ¨æ€ç¬¦å·</h3><p><code>readelf</code> å¯ä»¥æ˜¾ç¤ºå…±äº«åº“çš„åŠ¨æ€ç¬¦å·è¡¨ã€‚</p><ol><li>æ£€æŸ¥ <code>libchip.so</code> çš„åŠ¨æ€ç¬¦å·è¡¨ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -Ws libchip.so | grep myFunc</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ <code>myFunc</code> å‡ºç°åœ¨è¾“å‡ºä¸­ï¼Œè¯´æ˜å®ƒæ˜¯åŠ¨æ€å¯è§çš„ã€‚</li><li>å¦‚æœæ²¡æœ‰å‡ºç°ï¼Œè¯´æ˜ç¬¦å·è¢«éšè—ã€‚</li></ul></li></ol><hr><h3 id="æ–¹æ³•-3-æ£€æŸ¥é“¾æ¥ä¾èµ–å…³ç³»"><a href="#æ–¹æ³•-3-æ£€æŸ¥é“¾æ¥ä¾èµ–å…³ç³»" class="headerlink" title="æ–¹æ³• 3: æ£€æŸ¥é“¾æ¥ä¾èµ–å…³ç³»"></a>æ–¹æ³• 3: æ£€æŸ¥é“¾æ¥ä¾èµ–å…³ç³»</h3><ol><li><p>æ£€æŸ¥ <code>libdbg.so</code> æ˜¯å¦å£°æ˜äº†å¯¹ <code>libchip.so</code> çš„ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -d libdbg.so | grep NEEDED</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœ <code>libchip.so</code> å‡ºç°åœ¨ <code>NEEDED</code> åˆ—è¡¨ä¸­ï¼Œè¯´æ˜ <code>libdbg.so</code>ä¾èµ– <code>libchip.so</code>ã€‚</li></ul></li><li><p>å¦‚æœ <code>libchip.so</code> åœ¨ä¾èµ–åˆ—è¡¨ä¸­ï¼Œä½†é“¾æ¥æ—¶ä»ç„¶æŠ¥é”™ï¼š</p><ul><li>ç¡®è®¤ <code>myFunc</code> æ˜¯å¦åœ¨ <code>libchip.so</code> ä¸­å¯¼å‡ºï¼ˆä½¿ç”¨ <code>nm</code> æˆ– <code>readelf</code> æ£€æŸ¥ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="æ–¹æ³•-4-æ£€æŸ¥é“¾æ¥å™¨é”™è¯¯"><a href="#æ–¹æ³•-4-æ£€æŸ¥é“¾æ¥å™¨é”™è¯¯" class="headerlink" title="æ–¹æ³• 4: æ£€æŸ¥é“¾æ¥å™¨é”™è¯¯"></a>æ–¹æ³• 4: æ£€æŸ¥é“¾æ¥å™¨é”™è¯¯</h3><p>å¦‚æœé“¾æ¥å™¨æŠ¥é”™ <code>undefined reference to myFunc</code>ï¼š</p><ul><li>ç¡®è®¤é“¾æ¥å‘½ä»¤æ˜¯å¦æ˜¾å¼åŒ…å« <code>libchip.so</code>ï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o executable main.o -L/path/to/libs -ldbg -lchip</span><br></pre></td></tr></table></figure></li><li>å¦‚æœæ²¡æœ‰æ˜¾å¼é“¾æ¥ <code>libchip.so</code>ï¼ŒåŠ¨æ€é“¾æ¥å™¨å¯èƒ½æ— æ³•è§£æ <code>myFunc</code>ã€‚</li></ul><hr><h3 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h3><ul><li>ä½¿ç”¨ <code>nm</code> æˆ– <code>readelf</code> æ£€æŸ¥ <code>libchip.so</code> æ˜¯å¦å¯¼å‡ºäº† <code>myFunc</code>ã€‚</li><li>å¦‚æœç¬¦å·æœªå¯¼å‡ºï¼Œç¡®ä¿ä»£ç ä¸­ä½¿ç”¨äº† <code>__attribute__((__visibility__(&quot;default&quot;)))</code> å¹¶æ£€æŸ¥ç¼–è¯‘é€‰é¡¹ã€‚</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell è¯¯å¯¼æ€§é”™è¯¯ No such file or directory</title>
      <link href="/blog/2025/07/23/cpp/shell%E8%AF%AF%E5%AF%BC%E6%80%A7%E9%94%99%E8%AF%AFNo-such-file-or-directory/"/>
      <url>/blog/2025/07/23/cpp/shell%E8%AF%AF%E5%AF%BC%E6%80%A7%E9%94%99%E8%AF%AFNo-such-file-or-directory/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ“-ç°è±¡æè¿°"><a href="#ğŸ“-ç°è±¡æè¿°" class="headerlink" title="ğŸ“ ç°è±¡æè¿°"></a>ğŸ“ ç°è±¡æè¿°</h2><p>å½“ä½ è¿è¡Œä¸€ä¸ª ELF å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæ¯”å¦‚ä¸€ä¸ª 32-bit çš„ç¨‹åºï¼‰ï¼Œè€Œå®ƒä¾èµ–çš„ loader æˆ–å…±äº«åº“æ‰¾ä¸åˆ° æ—¶ï¼ŒShell ä¼šæç¤ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash: ./a.out: No such file or directory</span><br></pre></td></tr></table></figure><p>ä½†å…¶å®ï¼Œè¿™ä¸ªâ€œæ–‡ä»¶â€ç¡®å®å­˜åœ¨ï¼Œé—®é¢˜å‡ºåœ¨å®ƒ ä¾èµ–çš„ loader æ–‡ä»¶æˆ–åº“æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œè¿›è€Œå¯¼è‡´ execve() ç³»ç»Ÿè°ƒç”¨å¤±è´¥ã€‚</p><p>æˆ‘ä»¬ä» å†…æ ¸æ‰§è¡Œè·¯å¾„ è§’åº¦æ¥è§£æè¿™èƒŒåçš„åŸç†ã€‚</p><h2 id="ğŸ§ Linux-å†…éƒ¨é€»è¾‘è§£æ"><a href="#ğŸ§ Linux-å†…éƒ¨é€»è¾‘è§£æ" class="headerlink" title="ğŸ§ Linux å†…éƒ¨é€»è¾‘è§£æ"></a>ğŸ§ Linux å†…éƒ¨é€»è¾‘è§£æ</h2><ol><li>Shell è¿è¡Œç¨‹åºçš„è¿‡ç¨‹</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./my_app</span><br></pre></td></tr></table></figure><p>Shell å®é™…åšçš„æ˜¯è°ƒç”¨ execve() ç³»ç»Ÿè°ƒç”¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(<span class="string">&quot;./my_app&quot;</span>, argv, envp);</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ Linux åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªç¨‹åºçš„å”¯ä¸€å…¥å£ã€‚</p><ol start="2"><li>execve() åšäº†ä»€ä¹ˆï¼Ÿ</li></ol><p>å†…æ ¸æ‰§è¡Œ execve() æ—¶ï¼Œå®ƒä¼šï¼š</p><p>ğŸ”¹ Step 1: æ‰“å¼€å¹¶è¯»å– ELF å¤´ï¼ˆæ–‡ä»¶çš„å‰å‡ ä¸ªå­—èŠ‚ï¼‰<br>ä»è€Œåˆ¤æ–­è¿™æ˜¯ä¸€ä¸ª ELF å¯æ‰§è¡Œæ–‡ä»¶ã€è„šæœ¬ï¼Œè¿˜æ˜¯å…¶ä»–æ ¼å¼ã€‚</p><p>ğŸ”¹ Step 2: æ£€æŸ¥ ELF çš„æ¶æ„ä½æ•°ã€ABIã€åŠ¨æ€é“¾æ¥éœ€æ±‚<br>å¯¹äºåŠ¨æ€é“¾æ¥ç¨‹åºï¼Œå®ƒä¼šåœ¨ ELF å¤´ä¸­è¯»å–å¦‚ä¸‹å­—æ®µï¼š</p><ul><li>e_ident[EI_CLASS]: 32-bit æˆ– 64-bit</li><li>e_interpreter: è¿™æ˜¯æœ€å…³é”®çš„ï¼</li></ul><ol start="3"><li>e_interpreter æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>è¿™æ˜¯ ELF æ–‡ä»¶é‡Œå®šä¹‰çš„ â€œç¨‹åºè§£é‡Šå™¨è·¯å¾„â€ï¼ˆinterpreter pathï¼‰ã€‚å³è¿™ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œç³»ç»Ÿéœ€è¦å…ˆåŠ è½½è°æ¥å¸®å®ƒåŠ è½½å‰©ä¸‹çš„åŠ¨æ€åº“ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>readelf -l my_app</code> æŸ¥çœ‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -l ./my_app | grep interpreter</span><br><span class="line"></span><br><span class="line">[Requesting program interpreter: /lib/ld-linux.so.2]</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š<code>/lib/ld-linux.so.2</code> æ˜¯ 32-bit ç¨‹åºä½¿ç”¨çš„ loaderã€‚</p><ol start="4"><li>å¦‚æœè¿™ä¸ª loader ä¸å­˜åœ¨ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</li></ol><ul><li>execve() å°è¯•æ‰“å¼€ ELF æŒ‡å®šçš„è§£é‡Šå™¨ï¼ˆ&#x2F;lib&#x2F;ld-linux.so.2ï¼‰</li><li>å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œopen() å¤±è´¥</li><li>æ•´ä¸ª execve() è°ƒç”¨å¤±è´¥</li><li>é”™è¯¯ä»£ç æ˜¯ ENOENTï¼ˆ2ï¼‰ï¼Œä»£è¡¨ï¼š</li></ul><blockquote><p>â€œNo such file or directoryâ€</p></blockquote><p>ä½†è¿™å¹¶ä¸æ˜¯è¯´ ä½ è¿è¡Œçš„é‚£ä¸ªæ–‡ä»¶ .&#x2F;my_app ä¸å­˜åœ¨ï¼Œè€Œæ˜¯ å®ƒä¾èµ–çš„è§£é‡Šå™¨ä¸åœ¨ç³»ç»Ÿä¸­ï¼Œå¯¼è‡´æ•´ä¸ªæ‰§è¡Œå¤±è´¥ã€‚</p><h2 id="ğŸ¤¯-ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯¯å¯¼ï¼Ÿ"><a href="#ğŸ¤¯-ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯¯å¯¼ï¼Ÿ" class="headerlink" title="ğŸ¤¯ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯¯å¯¼ï¼Ÿ"></a>ğŸ¤¯ ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯¯å¯¼ï¼Ÿ</h2><p>å› ä¸º shellï¼ˆbash&#x2F;zshï¼‰è°ƒç”¨ execve() å¤±è´¥åï¼Œåªçœ‹åˆ°äº† errno &#x3D; ENOENTï¼Œå®ƒé»˜è®¤è§£é‡Šä¸ºï¼š</p><blockquote><p>â€œä½ æŒ‡å®šçš„é‚£ä¸ªæ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨â€</p></blockquote><p>è€Œä¸æ˜¯æ›´æ·±å±‚æ¬¡çš„ï¼š</p><blockquote><p>â€œæ–‡ä»¶å­˜åœ¨ï¼Œä½†å®ƒéœ€è¦çš„ loader ä¸å­˜åœ¨â€</p></blockquote><p>è¿™æ˜¯ shell çš„ å†å²é—ç•™è¡Œä¸ºï¼Œæ²¡æœ‰ç»†åˆ† errno èƒŒåè¯­ä¹‰ã€‚</p><h2 id="ğŸ§ª-ä¸¾ä¸ªå®é™…ä¾‹å­"><a href="#ğŸ§ª-ä¸¾ä¸ªå®é™…ä¾‹å­" class="headerlink" title="ğŸ§ª ä¸¾ä¸ªå®é™…ä¾‹å­"></a>ğŸ§ª ä¸¾ä¸ªå®é™…ä¾‹å­</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ file ./a.out</span><br><span class="line">./a.out: ELF 32-bit LSB executable, Intel 80386, ...</span><br><span class="line"></span><br><span class="line">$ readelf -l ./a.out | grep interpreter</span><br><span class="line">[Requesting program interpreter: /lib/ld-linux.so.2]</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">ls</span> /lib/ld-linux.so.2</span><br><span class="line"><span class="built_in">ls</span>: cannot access <span class="string">&#x27;/lib/ld-linux.so.2&#x27;</span>: No such file or directory</span><br><span class="line"></span><br><span class="line">$ ./a.out</span><br><span class="line">bash: ./a.out: No such file or directory  âŒ</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯ ç¼ºå°‘è§£é‡Šå™¨ <code>/lib/ld-linux.so.2</code>ï¼Œè€Œä¸æ˜¯ a.out æœ¬èº«ã€‚</p><h2 id="âœ…-æ€»ç»“"><a href="#âœ…-æ€»ç»“" class="headerlink" title="âœ… æ€»ç»“"></a>âœ… æ€»ç»“</h2><table><thead><tr><th>å±‚çº§</th><th>è¡Œä¸º</th></tr></thead><tbody><tr><td>ç”¨æˆ·</td><td>è¾“å…¥ <code>./prog</code></td></tr><tr><td>Shell</td><td>è°ƒç”¨ <code>execve(&quot;./prog&quot;, ...)</code></td></tr><tr><td>å†…æ ¸</td><td>è§£æ ELFï¼Œå‘ç° <code>interpreter</code> æ˜¯ <code>/lib/ld-linux.so.2</code></td></tr><tr><td>å†…æ ¸</td><td>æ‰¾ä¸åˆ°è§£é‡Šå™¨ï¼Œè¿”å› <code>ENOENT</code></td></tr><tr><td>Shell</td><td>æŠ¥ <code>No such file or directory</code> âŒï¼ˆè¯¯å¯¼æ€§ï¼‰</td></tr></tbody></table><h2 id="ğŸ› ï¸-Bonusï¼šç¼–è¯‘-32-bit-ç¨‹åº"><a href="#ğŸ› ï¸-Bonusï¼šç¼–è¯‘-32-bit-ç¨‹åº" class="headerlink" title="ğŸ› ï¸ Bonusï¼šç¼–è¯‘ 32-bit ç¨‹åº"></a>ğŸ› ï¸ Bonusï¼šç¼–è¯‘ 32-bit ç¨‹åº</h2><ol><li>ç¼–å†™ä¸€ä¸ªç®€å•çš„ C ç¨‹åº</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello from 32-bit program!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¯‘æˆ 32 bit ç¨‹åº</li></ol><p>éœ€è¦å…ˆå®‰è£… 32-bit ç¼–è¯‘æ”¯æŒï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install gcc-multilib</span><br></pre></td></tr></table></figure><p>ç„¶åç¼–è¯‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -m32 hello.c -o hello32</span><br></pre></td></tr></table></figure><ol start="3"><li>éªŒè¯æ˜¯å¦æ˜¯ 32-bit ELF å¯æ‰§è¡Œæ–‡ä»¶</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file hello32</span><br></pre></td></tr></table></figure><p>è¾“å‡ºåº”ç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello32: ELF 32-bit LSB executable, Intel 80386, ...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dlfcn</title>
      <link href="/blog/2025/04/16/dlfcn/"/>
      <url>/blog/2025/04/16/dlfcn/</url>
      
        <content type="html"><![CDATA[<figure class="highlight cpp"><figcaption><span>Makefile</span><a href="/blog/downloads/code/dlfcn/Makefile">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CXX = g++</span><br><span class="line">CXXFLAGS = -fPIC -Wall -Wextra</span><br><span class="line">LDFLAGS = -shared</span><br><span class="line"></span><br><span class="line">all: main libhello.so</span><br><span class="line"></span><br><span class="line">main: main.cpp</span><br><span class="line">$(CXX) main.cpp -o main -ldl</span><br><span class="line"></span><br><span class="line">libhello.so: hello.cpp</span><br><span class="line">$(CXX) $(CXXFLAGS) $(LDFLAGS) hello.cpp -o libhello.so</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">rm -f main libhello.</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><figcaption><span>main.cpp</span><a href="/blog/downloads/code/dlfcn/main.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*HelloFunc)</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// æ‰“å¼€å…±äº«åº“</span></span><br><span class="line">    <span class="type">void</span>* handle = <span class="built_in">dlopen</span>(<span class="string">&quot;./libhello.so&quot;</span>, RTLD_LAZY);</span><br><span class="line">    <span class="keyword">if</span> (!handle) {</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;dlopen failed: &quot;</span> &lt;&lt; <span class="built_in">dlerror</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…é™¤ä¹‹å‰çš„é”™è¯¯</span></span><br><span class="line">    <span class="built_in">dlerror</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    HelloFunc hello = (HelloFunc)<span class="built_in">dlsym</span>(handle, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* dlsym_error = <span class="built_in">dlerror</span>();</span><br><span class="line">    <span class="keyword">if</span> (dlsym_error) {</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;dlsym failed: &quot;</span> &lt;&lt; dlsym_error &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">dlclose</span>(handle);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°å‡½æ•°åœ°å€</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Address of hello function: &quot;</span> &lt;&lt; <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>*&gt;(hello) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="line">    <span class="built_in">hello</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å…±äº«åº“</span></span><br><span class="line">    <span class="built_in">dlclose</span>(handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>åŸå­å˜é‡</title>
      <link href="/blog/2025/03/19/cpp/%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F/"/>
      <url>/blog/2025/03/19/cpp/%E5%8E%9F%E5%AD%90%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>å½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŸå­å˜é‡æ—¶ï¼Œä»¥ä¸‹æ“ä½œä¼šå‘ç”Ÿï¼š</p><p>åŸå­æ€§ï¼šåŸå­å˜é‡çš„ä¿®æ”¹æ˜¯åŸå­çš„ï¼Œå³æ¯æ¬¡ä¿®æ”¹éƒ½æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ“ä½œã€‚è¿™æ„å‘³ç€åœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸåœ°ä¿®æ”¹åŸå­å˜é‡ï¼Œè€Œä¸ä¼šå‡ºç°ç«äº‰æ¡ä»¶ã€‚</p><p>åŒæ­¥æœºåˆ¶ï¼šåŸå­å˜é‡ä½¿ç”¨ç¡¬ä»¶çº§åˆ«çš„åŒæ­¥æœºåˆ¶ï¼ˆå¦‚é”ã€æ¯”è¾ƒå¹¶äº¤æ¢æ“ä½œç­‰ï¼‰æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ã€‚è¿™äº›æœºåˆ¶ç¡®ä¿çº¿ç¨‹åœ¨ä¿®æ”¹åŸå­å˜é‡æ—¶ä¸ä¼šå¹²æ‰°å…¶ä»–çº¿ç¨‹çš„æ“ä½œã€‚</p><p>å†…å­˜å¯è§æ€§ï¼šåŸå­å˜é‡çš„ä¿®æ”¹ä¼šç¡®ä¿å†…å­˜å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹å¯¹åŸå­å˜é‡çš„ä¿®æ”¹ä¼šç«‹å³å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚è¿™æ„å‘³ç€å…¶ä»–çº¿ç¨‹å¯ä»¥çœ‹åˆ°æœ€æ–°çš„ä¿®æ”¹ç»“æœï¼Œè€Œä¸ä¼šè¯»å–åˆ°è¿‡æ—¶çš„æ•°æ®ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŸå­å˜é‡ <code>std::atomic&lt;int&gt; counter</code>ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ <code>counter++</code> æ“ä½œï¼š</p><figure class="highlight cpp"><figcaption><span>atomic1.cpp</span><a href="/blog/downloads/code/atomic/atomic1.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        counter++;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>ä¸¤ä¸ªçº¿ç¨‹ t1 å’Œ t2 åŒæ—¶æ‰§è¡Œ increment å‡½æ•°ï¼Œå°è¯•ä¿®æ”¹åŸå­å˜é‡ counterã€‚<br>åŸå­æ€§ ç¡®ä¿æ¯æ¬¡ <code>counter++</code> æ“ä½œéƒ½æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œé¿å…ç«äº‰æ¡ä»¶ã€‚<br>åŒæ­¥æœºåˆ¶ ç¡®ä¿ä¸¤ä¸ªçº¿ç¨‹ä¸ä¼šåŒæ—¶ä¿®æ”¹ counterï¼Œè€Œæ˜¯ä¸€ä¸ªçº¿ç¨‹æˆåŠŸä¿®æ”¹åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½ç»§ç»­ä¿®æ”¹ã€‚<br>å†…å­˜å¯è§æ€§ ç¡®ä¿ counter çš„æœ€æ–°å€¼å¯¹ä¸¤ä¸ªçº¿ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚</p><h2 id="å®ç°æœºåˆ¶"><a href="#å®ç°æœºåˆ¶" class="headerlink" title="å®ç°æœºåˆ¶"></a>å®ç°æœºåˆ¶</h2><p>è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¸€ä¸‹ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹åŸå­å˜é‡æ—¶çš„åº•å±‚æœºåˆ¶ã€‚</p><ol><li><p>åŸå­æ“ä½œçš„ç¡¬ä»¶æ”¯æŒ<br>åŸå­æ“ä½œé€šå¸¸ç”±ç¡¬ä»¶æŒ‡ä»¤æ”¯æŒï¼Œè¿™äº›æŒ‡ä»¤ç¡®ä¿æ“ä½œçš„åŸå­æ€§ã€‚ä¾‹å¦‚ï¼Œx86æ¶æ„æä¾›äº† <code>LOCK</code> å‰ç¼€ï¼Œç”¨äºç¡®ä¿æŒ‡ä»¤åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­çš„åŸå­æ€§ã€‚å¸¸è§çš„åŸå­æŒ‡ä»¤åŒ…æ‹¬ <code>LOCK XADD</code>ï¼ˆåŸå­åŠ æ³•ï¼‰å’Œ <code>LOCK CMPXCHG</code>ï¼ˆåŸå­æ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ã€‚</p></li><li><p>ç¼“å­˜ä¸€è‡´æ€§åè®®<br>å¤šæ ¸å¤„ç†å™¨ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ˆå¦‚<code>MESI</code>åè®®ï¼‰æ¥ç¡®ä¿å„ä¸ªå¤„ç†å™¨ç¼“å­˜ä¸­çš„æ•°æ®ä¸€è‡´æ€§ã€‚å½“ä¸€ä¸ªå¤„ç†å™¨ä¿®æ”¹åŸå­å˜é‡æ—¶ï¼Œç¼“å­˜ä¸€è‡´æ€§åè®®ä¼šç¡®ä¿å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜ä¸­å¯¹åº”çš„æ•°æ®æ— æ•ˆæˆ–æ›´æ–°ã€‚</p></li><li><p>å†…å­˜å±éšœ<br>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰æ˜¯ä¸€ç§æŒ‡ä»¤ï¼Œç”¨äºé˜²æ­¢ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹å†…å­˜æ“ä½œè¿›è¡Œé‡æ’åºã€‚åŸå­æ“ä½œé€šå¸¸ä¼šä½¿ç”¨å†…å­˜å±éšœæ¥ç¡®ä¿æ“ä½œçš„é¡ºåºæ€§å’Œå¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œ<code>std::atomic</code> åœ¨å®ç°æ—¶ä¼šä½¿ç”¨å†…å­˜å±éšœæ¥ç¡®ä¿æ“ä½œçš„æ­£ç¡®æ€§ã€‚</p></li><li><p>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCASï¼‰<br>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-And-Swap, CASï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œå®ƒé€šè¿‡æ¯”è¾ƒå˜é‡çš„å½“å‰å€¼å’Œé¢„æœŸå€¼ï¼Œå¦‚æœç›¸ç­‰åˆ™æ›´æ–°å˜é‡çš„å€¼ã€‚CASæ“ä½œæ˜¯æ— é”ç¼–ç¨‹çš„åŸºç¡€ï¼Œç”¨äºå®ç°è®¸å¤šå¹¶å‘æ•°æ®ç»“æ„ã€‚</p></li><li><p>ä¼ªä»£ç ç¤ºä¾‹<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¼ªä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†CASæ“ä½œçš„å·¥ä½œåŸç†ï¼š</p></li></ol><figure class="highlight cpp"><figcaption><span>cas_mock.cpp</span><a href="/blog/downloads/code/atomic/cas_mock.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">compare_and_swap</span><span class="params">(<span class="type">int</span>* ptr, <span class="type">int</span> old_value, <span class="type">int</span> new_value)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (*ptr == old_value) {</span><br><span class="line">        *ptr = new_value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼ŒCASæ“ä½œå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆåŠŸä¿®æ”¹å˜é‡çš„å€¼ï¼Œè€Œå…¶ä»–çº¿ç¨‹ä¼šå¤±è´¥å¹¶é‡è¯•ã€‚</p><ol start="6"><li>å®é™…åº”ç”¨<br>åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒåŸå­å˜é‡çš„æ“ä½œå¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</li></ol><figure class="highlight cpp"><figcaption><span>atomic2.cpp</span><a href="/blog/downloads/code/atomic/atomic2.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        <span class="type">int</span> expected = counter.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">while</span> (!counter.<span class="built_in">compare_exchange_weak</span>(expected, expected + <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">// é‡è¯•ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcompare_exchange_weak ä½¿ç”¨CASæ“ä½œæ¥ç¡®ä¿ counter çš„åŸå­æ€§ä¿®æ”¹ã€‚æ¯æ¬¡ä¿®æ”¹å¤±è´¥æ—¶ï¼Œçº¿ç¨‹ä¼šé‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚</p><h3 id="ç¼“å­˜ä¸€è‡´æ€§åè®®"><a href="#ç¼“å­˜ä¸€è‡´æ€§åè®®" class="headerlink" title="ç¼“å­˜ä¸€è‡´æ€§åè®®"></a>ç¼“å­˜ä¸€è‡´æ€§åè®®</h3><p>ç¼“å­˜ä¸€è‡´æ€§åè®®æ˜¯ç¡®ä¿å¤šæ ¸å¤„ç†å™¨ä¸­å„ä¸ªç¼“å­˜ä¹‹é—´æ•°æ®ä¸€è‡´æ€§çš„æœºåˆ¶ã€‚æœ€å¸¸è§çš„ç¼“å­˜ä¸€è‡´æ€§åè®®æ˜¯MESIåè®®ã€‚è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><p><strong>MESIåè®®</strong></p><p>MESIåè®®æ˜¯ç”±å››ç§çŠ¶æ€ç»„æˆçš„ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œæ¯ä¸ªç¼“å­˜è¡Œï¼ˆCache Lineï¼‰å¯ä»¥å¤„äºä»¥ä¸‹å››ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li>Modifiedï¼ˆä¿®æ”¹ï¼‰ï¼šç¼“å­˜è¡Œä¸­çš„æ•°æ®å·²è¢«ä¿®æ”¹ï¼Œä¸ä¸»å†…å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¸”è¯¥æ•°æ®ä»…å­˜åœ¨äºå½“å‰ç¼“å­˜ä¸­ã€‚</li><li>Exclusiveï¼ˆç‹¬å ï¼‰ï¼šç¼“å­˜è¡Œä¸­çš„æ•°æ®ä¸ä¸»å†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œä¸”è¯¥æ•°æ®ä»…å­˜åœ¨äºå½“å‰ç¼“å­˜ä¸­ã€‚</li><li>Sharedï¼ˆå…±äº«ï¼‰ï¼šç¼“å­˜è¡Œä¸­çš„æ•°æ®ä¸ä¸»å†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ï¼Œä¸”è¯¥æ•°æ®å¯èƒ½å­˜åœ¨äºå¤šä¸ªç¼“å­˜ä¸­ã€‚</li><li>Invalidï¼ˆæ— æ•ˆï¼‰ï¼šç¼“å­˜è¡Œä¸­çš„æ•°æ®æ— æ•ˆã€‚</li></ul><p><strong>çŠ¶æ€è½¬æ¢</strong></p><p>ç¼“å­˜è¡Œçš„çŠ¶æ€ä¼šæ ¹æ®ä¸åŒçš„æ“ä½œè¿›è¡Œè½¬æ¢ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„çŠ¶æ€è½¬æ¢ï¼š</p><p>ä»ä¸»å†…å­˜è¯»å–æ•°æ®ï¼šå¦‚æœä¸€ä¸ªç¼“å­˜è¡Œå¤„äºInvalidçŠ¶æ€ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨è¯»å–è¯¥æ•°æ®æ—¶ï¼Œç¼“å­˜è¡Œä¼šå˜ä¸ºSharedæˆ–ExclusiveçŠ¶æ€ã€‚<br>ä¿®æ”¹æ•°æ®ï¼šå¦‚æœä¸€ä¸ªç¼“å­˜è¡Œå¤„äºSharedæˆ–ExclusiveçŠ¶æ€ï¼Œå½“ä¸€ä¸ªå¤„ç†å™¨ä¿®æ”¹è¯¥æ•°æ®æ—¶ï¼Œç¼“å­˜è¡Œä¼šå˜ä¸ºModifiedçŠ¶æ€ï¼Œå¹¶é€šçŸ¥å…¶ä»–ç¼“å­˜å°†è¯¥ç¼“å­˜è¡Œç½®ä¸ºInvalidçŠ¶æ€ã€‚<br>å†™å›æ•°æ®ï¼šå¦‚æœä¸€ä¸ªç¼“å­˜è¡Œå¤„äºModifiedçŠ¶æ€ï¼Œå½“è¯¥ç¼“å­˜è¡Œè¢«æ›¿æ¢æ—¶ï¼Œæ•°æ®ä¼šè¢«å†™å›ä¸»å†…å­˜ï¼Œç¼“å­˜è¡Œå˜ä¸ºInvalidçŠ¶æ€ã€‚</p><p><strong>å·¥ä½œåŸç†</strong></p><p>å‡è®¾æœ‰ä¸‰ä¸ªå¤„ç†å™¨Aã€Bå’ŒCï¼Œå®ƒä»¬å„è‡ªæœ‰è‡ªå·±çš„ç¼“å­˜ã€‚ä¸»å†…å­˜ä¸­æœ‰ä¸€ä¸ªå˜é‡xï¼Œåˆå§‹å€¼ä¸º0ã€‚</p><p>è¯»å–æ•°æ®ï¼š</p><p>å¤„ç†å™¨Aä»ä¸»å†…å­˜è¯»å–xï¼Œç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºExclusiveã€‚<br>å¤„ç†å™¨Bä»ä¸»å†…å­˜è¯»å–xï¼Œå¤„ç†å™¨Aæ£€æµ‹åˆ°å†²çªï¼Œå°†ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºSharedï¼Œå¤„ç†å™¨Bçš„ç¼“å­˜è¡ŒçŠ¶æ€ä¹Ÿå˜ä¸ºSharedã€‚<br>ä¿®æ”¹æ•°æ®ï¼š</p><p>å¤„ç†å™¨Aä¿®æ”¹xï¼Œç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºModifiedï¼Œå¹¶é€šçŸ¥å¤„ç†å™¨Bå°†å…¶ç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºInvalidã€‚<br>å¤„ç†å™¨Bå°è¯•è¯»å–xæ—¶ï¼Œæ£€æµ‹åˆ°ç¼“å­˜è¡Œæ— æ•ˆï¼Œä»ä¸»å†…å­˜é‡æ–°è¯»å–æ•°æ®ã€‚</p><p>å†™å›æ•°æ®ï¼š</p><p>å¤„ç†å™¨Aå°†ä¿®æ”¹åçš„æ•°æ®å†™å›ä¸»å†…å­˜ï¼Œç¼“å­˜è¡ŒçŠ¶æ€å˜ä¸ºInvalidã€‚</p><p><strong>ä¼˜åŒ–å’Œé—®é¢˜</strong></p><p>ç¼“å­˜ä¸€è‡´æ€§åè®®é€šè¿‡æ€»çº¿å—…æ¢ï¼ˆBus Snoopingï¼‰å’ŒçŠ¶æ€æœºæœºåˆ¶æ¥å®ç°æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†ä¹Ÿä¼šå¼•å…¥ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œå¦‚æ€»çº¿å¸¦å®½å‹åŠ›å’Œå¤„ç†å™¨ç­‰å¾…æ—¶é—´ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç°ä»£å¤„ç†å™¨å¼•å…¥äº†å­˜å‚¨ç¼“å†²åŒºï¼ˆStore Bufferï¼‰å’Œå†™å›ç­–ç•¥ï¼ˆWrite Backï¼‰ç­‰ä¼˜åŒ–æŠ€æœ¯ã€‚</p><h3 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h3><p>æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆCompare-And-Swap, CASï¼‰æ“ä½œåœ¨å¹¶å‘ç¼–ç¨‹ä¸­æœ‰è®¸å¤šå¥½å¤„ï¼š</p><ol><li><p>æ— é”ç¼–ç¨‹<br>CASæ“ä½œæ˜¯æ— é”ç¼–ç¨‹çš„åŸºç¡€ï¼Œå®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åœ¨ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®‰å…¨åœ°ä¿®æ”¹å…±äº«æ•°æ®ã€‚æ— é”ç¼–ç¨‹å¯ä»¥å‡å°‘é”çš„å¼€é”€ï¼Œé¿å…æ­»é”ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½ã€‚</p></li><li><p>åŸå­æ€§<br>CASæ“ä½œæ˜¯åŸå­çš„ï¼Œå³å®ƒç¡®ä¿æ¯”è¾ƒå’Œäº¤æ¢æ“ä½œåœ¨ç¡¬ä»¶çº§åˆ«ä¸Šæ˜¯ä¸å¯åˆ†å‰²çš„ã€‚è¿™æ„å‘³ç€åœ¨ä»»ä½•æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸåœ°ä¿®æ”¹å˜é‡çš„å€¼ï¼Œé¿å…ç«äº‰æ¡ä»¶ã€‚</p></li><li><p>é«˜æ•ˆæ€§<br>CASæ“ä½œé€šå¸¸ç”±ç¡¬ä»¶æŒ‡ä»¤æ”¯æŒï¼ˆå¦‚x86æ¶æ„ä¸­çš„ LOCK CMPXCHG æŒ‡ä»¤ï¼‰ï¼Œè¿™äº›æŒ‡ä»¤éå¸¸é«˜æ•ˆï¼Œèƒ½å¤Ÿå¿«é€Ÿå®Œæˆæ¯”è¾ƒå’Œäº¤æ¢æ“ä½œã€‚ç›¸æ¯”äºä½¿ç”¨é”ï¼ŒCASæ“ä½œçš„å¼€é”€æ›´ä½ã€‚</p></li><li><p>å¯æ‰©å±•æ€§<br>CASæ“ä½œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•ä¿®æ”¹å˜é‡ï¼Œè€Œä¸ä¼šé˜»å¡å…¶ä»–çº¿ç¨‹ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—CASæ“ä½œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸­å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿå¤„ç†å¤§é‡çº¿ç¨‹çš„å¹¶å‘è®¿é—®ã€‚</p></li><li><p>å®ç°å¤æ‚çš„å¹¶å‘æ•°æ®ç»“æ„<br>CASæ“ä½œå¯ä»¥ç”¨äºå®ç°å¤æ‚çš„å¹¶å‘æ•°æ®ç»“æ„ï¼Œå¦‚æ— é”é˜Ÿåˆ—ã€æ— é”æ ˆç­‰ã€‚è¿™äº›æ•°æ®ç»“æ„èƒ½å¤Ÿåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸­æä¾›é«˜æ•ˆçš„æ“ä½œï¼Œè€Œä¸ä¼šå¼•å…¥é”çš„å¼€é”€ã€‚</p></li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨CASæ“ä½œå®ç°æ— é”è®¡æ•°å™¨çš„ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><figcaption><span>cas_counter.cpp</span><a href="/blog/downloads/code/atomic/cas_counter.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        <span class="type">int</span> expected = counter.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">while</span> (!counter.<span class="built_in">compare_exchange_weak</span>(expected, expected + <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">// é‡è¯•ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œcompare_exchange_weak ä½¿ç”¨CASæ“ä½œæ¥ç¡®ä¿ counter çš„åŸå­æ€§ä¿®æ”¹ã€‚æ¯æ¬¡ä¿®æ”¹å¤±è´¥æ—¶ï¼Œçº¿ç¨‹ä¼šé‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚</p><h4 id="compare-exchange-weak-å’Œ-fetch-add"><a href="#compare-exchange-weak-å’Œ-fetch-add" class="headerlink" title="compare_exchange_weak å’Œ fetch_add"></a>compare_exchange_weak å’Œ fetch_add</h4><p>compare_exchange_weak å’Œ fetch_add æ˜¯ä¸¤ç§ä¸åŒçš„åŸå­æ“ä½œï¼Œå®ƒä»¬åœ¨åŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯ä¸Šæœ‰æ˜æ˜¾çš„åŒºåˆ«ã€‚è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ä»¥åŠå¦‚ä½•é€‰æ‹©ã€‚</p><h5 id="compare-exchange-weak"><a href="#compare-exchange-weak" class="headerlink" title="compare_exchange_weak"></a>compare_exchange_weak</h5><p>åŠŸèƒ½ï¼š</p><p>compare_exchange_weak æ˜¯ä¸€ç§CASï¼ˆCompare-And-Swapï¼‰æ“ä½œï¼Œç”¨äºæ¯”è¾ƒåŸå­å˜é‡çš„å½“å‰å€¼ä¸é¢„æœŸå€¼ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™å°†æ–°å€¼å­˜å‚¨åˆ°å˜é‡ä¸­ï¼Œå¹¶è¿”å› trueï¼›å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¿”å› false å¹¶æ›´æ–°é¢„æœŸå€¼ã€‚<br>è¯¥æ“ä½œå…è®¸å¶å°”çš„å¤±è´¥ï¼ˆå³ä½¿å½“å‰å€¼ä¸é¢„æœŸå€¼ç›¸ç­‰ï¼Œä¹Ÿå¯èƒ½è¿”å› falseï¼‰ï¼Œè¿™åœ¨ä¸€äº›å¾ªç¯ç®—æ³•ä¸­æ˜¯å¯ä»¥æ¥å—çš„ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p>é€‚ç”¨äºéœ€è¦åœ¨å¾ªç¯ä¸­åå¤å°è¯•æ›´æ–°å˜é‡çš„åœºæ™¯ï¼Œä¾‹å¦‚å®ç°æ— é”æ•°æ®ç»“æ„ï¼ˆå¦‚æ— é”é˜Ÿåˆ—ã€æ ˆç­‰ï¼‰ã€‚<br>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸­ï¼Œcompare_exchange_weak é€šå¸¸æ¯” compare_exchange_strong æ€§èƒ½æ›´é«˜ï¼Œå› ä¸ºå®ƒå…è®¸å¶å°”çš„å¤±è´¥ï¼Œä»è€Œå‡å°‘äº†æ€»çº¿é”å®šçš„å¼€é”€.</p><h5 id="fetch-add"><a href="#fetch-add" class="headerlink" title="fetch_add"></a>fetch_add</h5><p>åŠŸèƒ½ï¼š</p><p>fetch_add æ˜¯ä¸€ç§åŸå­åŠ æ³•æ“ä½œï¼Œå®ƒå°†ç»™å®šçš„å€¼åŠ åˆ°åŸå­å˜é‡çš„å½“å‰å€¼ä¸­ï¼Œå¹¶è¿”å›å˜é‡çš„æ—§å€¼ã€‚<br>è¯¥æ“ä½œæ˜¯åŸå­çš„ï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°ç«äº‰æ¡ä»¶ã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><p>é€‚ç”¨äºç®€å•çš„è®¡æ•°å™¨æˆ–ç´¯åŠ å™¨åœºæ™¯ï¼Œä¾‹å¦‚ç»Ÿè®¡è®¿é—®æ¬¡æ•°ã€ç´¯åŠ æ€»å’Œç­‰ã€‚<br>åœ¨éœ€è¦å¯¹å˜é‡è¿›è¡Œç®€å•çš„åŠ æ³•æ“ä½œæ—¶ï¼Œfetch_add æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„é€‰æ‹©2.</p><h5 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h5><p>é€‰æ‹© compare_exchange_weak è¿˜æ˜¯ fetch_add å–å†³äºå…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼š</p><p>å¦‚æœéœ€è¦å®ç°å¤æ‚çš„æ— é”æ•°æ®ç»“æ„ï¼ˆå¦‚æ— é”é˜Ÿåˆ—ã€æ ˆç­‰ï¼‰ï¼Œå¹¶ä¸”éœ€è¦åå¤å°è¯•æ›´æ–°å˜é‡ï¼Œé€‰æ‹© compare_exchange_weakã€‚<br>å¦‚æœéœ€è¦å¯¹å˜é‡è¿›è¡Œç®€å•çš„åŠ æ³•æ“ä½œï¼ˆå¦‚è®¡æ•°å™¨ã€ç´¯åŠ å™¨ï¼‰ï¼Œé€‰æ‹© fetch_addã€‚<br>ç¤ºä¾‹ä»£ç <br>ä»¥ä¸‹æ˜¯ä½¿ç”¨ compare_exchange_weak å’Œ fetch_add çš„ç¤ºä¾‹ä»£ç ï¼š</p><p>compare_exchange_weak ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><figcaption><span>compare_exchange_weak_eg.cpp</span><a href="/blog/downloads/code/atomic/compare_exchange_weak_eg.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        <span class="type">int</span> expected = counter.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">while</span> (!counter.<span class="built_in">compare_exchange_weak</span>(expected, expected + <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">// é‡è¯•ï¼Œç›´åˆ°æˆåŠŸ</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>fetch_add ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><figcaption><span>fetch_add_eg.cpp</span><a href="/blog/downloads/code/atomic/fetch_add_eg.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        counter.<span class="built_in">fetch_add</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åªéœ€è¦ç®€å•åœ°é€’å¢è®¡æ•°å™¨ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–æ¡ä»¶é™åˆ¶ï¼Œfetch_add ç¡®å®æ˜¯ä¸€ä¸ªæ›´ç›´æ¥å’Œé«˜æ•ˆçš„é€‰æ‹©ã€‚fetch_add èƒ½å¤Ÿç¡®ä¿æ¯æ¬¡é€’å¢æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œé¿å…äº†ç«äº‰æ¡ä»¶ã€‚</p><p>ç„¶è€Œï¼Œåœ¨æŸäº›ç‰¹å®šåœºæ™¯ä¸‹ï¼Œcompare_exchange_weak å¯èƒ½æ›´ä¸ºåˆé€‚ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦åŸºäºç‰¹å®šæ¡ä»¶è¿›è¡Œæ›´æ–°æ—¶ï¼Œcompare_exchange_weak å¯ä»¥ç¡®ä¿åªæœ‰åœ¨æ»¡è¶³æ¡ä»¶æ—¶æ‰è¿›è¡Œæ›´æ–°æ“ä½œã€‚</p><p>ç¤ºä¾‹ï¼šåŸºäºæ¡ä»¶çš„æ›´æ–°<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œéœ€è¦åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è¿›è¡Œé€’å¢æ“ä½œï¼š</p><figure class="highlight cpp"><figcaption><span>cas_case.cpp</span><a href="/blog/downloads/code/atomic/cas_case.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">conditional_increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        <span class="type">int</span> expected = counter.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">while</span> (expected &lt; <span class="number">500</span> &amp;&amp; !counter.<span class="built_in">compare_exchange_weak</span>(expected, expected + <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">// é‡è¯•ï¼Œç›´åˆ°æˆåŠŸæˆ–æ¡ä»¶ä¸æ»¡è¶³</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(conditional_increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(conditional_increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªæœ‰å½“ counter çš„å€¼å°äº500æ—¶ï¼Œæ‰ä¼šè¿›è¡Œé€’å¢æ“ä½œã€‚compare_exchange_weak ç¡®ä¿æ¡ä»¶æ›´æ–°çš„åŸå­æ€§å’Œå®‰å…¨æ€§ã€‚</p><p>ä½¿ç”¨ fetch_add çš„åœºæ™¯<br>å¦‚æœæˆ‘ä»¬ä¸éœ€è¦åŸºäºæ¡ä»¶è¿›è¡Œæ›´æ–°ï¼Œåªæ˜¯ç®€å•åœ°é€’å¢è®¡æ•°å™¨ï¼Œé‚£ä¹ˆ fetch_add æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼š</p><figure class="highlight cpp"><figcaption><span>fetch_add_case.cpp</span><a href="/blog/downloads/code/atomic/fetch_add_case.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        counter.<span class="built_in">fetch_add</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œfetch_add ç¡®ä¿æ¯æ¬¡é€’å¢æ“ä½œéƒ½æ˜¯åŸå­çš„ï¼Œé¿å…äº†ç«äº‰æ¡ä»¶ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå¦‚æœä½ çš„æ“ä½œåªæ˜¯ç®€å•çš„é€’å¢ï¼Œfetch_add æ˜¯æ›´é«˜æ•ˆçš„é€‰æ‹©ï¼›å¦‚æœéœ€è¦åŸºäºæ¡ä»¶è¿›è¡Œæ›´æ–°ï¼Œcompare_exchange_weak åˆ™æ›´ä¸ºåˆé€‚ã€‚</p><h4 id="ABA"><a href="#ABA" class="headerlink" title="ABA"></a>ABA</h4><p>ABAé—®é¢˜åœ¨å¹¶å‘ç¼–ç¨‹ä¸­æ˜¯ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨CASï¼ˆCompare-And-Swapï¼‰æ“ä½œæ—¶ã€‚ABAé—®é¢˜çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå˜é‡çš„å€¼åœ¨ä¸¤æ¬¡æ¯”è¾ƒä¹‹é—´å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æœ€ç»ˆå€¼åˆå›åˆ°äº†åŸå§‹å€¼ï¼Œå¯¼è‡´CASæ“ä½œæ— æ³•æ£€æµ‹åˆ°è¿™ç§å˜åŒ–ã€‚ä¸ºäº†é¿å…ABAé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ç‰ˆæœ¬å·æˆ–æ ‡è®°çš„åŸå­å¼•ç”¨ï¼Œä¾‹å¦‚ AtomicStampedReferenceã€‚</p><p>ç¤ºä¾‹ï¼šä½¿ç”¨ AtomicStampedReference é¿å…ABAé—®é¢˜<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ AtomicStampedReference é¿å…ABAé—®é¢˜çš„ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><figcaption><span>atomic_stamped_reference.cpp</span><a href="/blog/downloads/code/atomic/atomic_stamped_reference.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">counter</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">int</span>&gt; <span class="title">stamp</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">conditional_increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        <span class="type">int</span> expected = counter.<span class="built_in">load</span>();</span><br><span class="line">        <span class="type">int</span> expected_stamp = stamp.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">while</span> (expected &lt; <span class="number">500</span> &amp;&amp; !counter.<span class="built_in">compare_exchange_weak</span>(expected, expected + <span class="number">1</span>) &amp;&amp; !stamp.<span class="built_in">compare_exchange_weak</span>(expected_stamp, expected_stamp + <span class="number">1</span>)) {</span><br><span class="line">            <span class="comment">// é‡è¯•ï¼Œç›´åˆ°æˆåŠŸæˆ–æ¡ä»¶ä¸æ»¡è¶³</span></span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(conditional_increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(conditional_increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final counter value: &quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final stamp value: &quot;</span> &lt;&lt; stamp &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªé¢å¤–çš„ stamp å˜é‡æ¥è®°å½•æ¯æ¬¡æ›´æ–°çš„ç‰ˆæœ¬å·ã€‚æ¯æ¬¡æ›´æ–° counter æ—¶ï¼ŒåŒæ—¶æ›´æ–° stampã€‚è¿™æ ·ï¼Œå³ä½¿ counter çš„å€¼å›åˆ°äº†åŸå§‹å€¼ï¼Œstamp çš„å€¼ä¹Ÿä¼šä¸åŒï¼Œä»è€Œé¿å…äº†ABAé—®é¢˜ã€‚</p><p>è§£é‡Š<br>ç‰ˆæœ¬å·ï¼šæ¯æ¬¡æ›´æ–° counter æ—¶ï¼ŒåŒæ—¶æ›´æ–° stampï¼Œç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚<br>CASæ“ä½œï¼šä½¿ç”¨ compare_exchange_weak ç¡®ä¿ counter å’Œ stamp çš„æ›´æ–°æ˜¯åŸå­çš„ã€‚<br>é‡è¯•æœºåˆ¶ï¼šå¦‚æœCASæ“ä½œå¤±è´¥ï¼Œçº¿ç¨‹ä¼šé‡è¯•ï¼Œç›´åˆ°æˆåŠŸæˆ–æ¡ä»¶ä¸æ»¡è¶³ã€‚<br>è¿™ç§æ–¹æ³•é€šè¿‡å¼•å…¥ç‰ˆæœ¬å·æˆ–æ ‡è®°ï¼Œç¡®ä¿å³ä½¿å˜é‡çš„å€¼å›åˆ°äº†åŸå§‹å€¼ï¼Œç‰ˆæœ¬å·ä¹Ÿä¼šä¸åŒï¼Œä»è€Œé¿å…äº†ABAé—®é¢˜ã€‚</p><p>ABAé—®é¢˜ä¸ä»…å­˜åœ¨äºCASæ“ä½œä¸­ï¼Œè¿˜å¯èƒ½åœ¨å…¶ä»–å¹¶å‘ç¼–ç¨‹åœºæ™¯ä¸­å‡ºç°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å‡ºç°ABAé—®é¢˜çš„æƒ…æ™¯ï¼š</p><ol><li><p>åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰<br>åœ¨åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼ä¸­ï¼ŒABAé—®é¢˜å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆå§‹åŒ–å•ä¾‹å¯¹è±¡æ—¶ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ£€æŸ¥å¯¹è±¡æ˜¯å¦ä¸ºç©ºï¼Œå¹¶ä¸”ä¸€ä¸ªçº¿ç¨‹åœ¨æ£€æŸ¥åç«‹å³åˆ›å»ºå¯¹è±¡ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ£€æŸ¥åå‘ç°å¯¹è±¡å·²ç»è¢«åˆ›å»ºå¹¶ä¸”å†æ¬¡æ£€æŸ¥æ—¶å‘ç°å¯¹è±¡ä¸ºç©ºï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„åˆå§‹åŒ–ã€‚</p></li><li><p>æ— é”é˜Ÿåˆ—å’Œæ ˆ<br>åœ¨æ— é”é˜Ÿåˆ—å’Œæ ˆçš„å®ç°ä¸­ï¼ŒABAé—®é¢˜å¯èƒ½ä¼šå¯¼è‡´èŠ‚ç‚¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œå‡ºç°é”™è¯¯ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ’å…¥å’Œåˆ é™¤ç›¸åŒçš„èŠ‚ç‚¹ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªçº¿ç¨‹æ— æ³•æ­£ç¡®åˆ¤æ–­èŠ‚ç‚¹çš„çŠ¶æ€ã€‚</p></li><li><p>ç‰ˆæœ¬æ§åˆ¶<br>åœ¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼ŒABAé—®é¢˜å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„ç‰ˆæœ¬åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æ£€æŸ¥ç‰ˆæœ¬å·æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½ä¼šæ›´æ–°ç‰ˆæœ¬å·å¹¶ä¸”å†æ¬¡æ›´æ–°å›åŸå§‹ç‰ˆæœ¬å·ï¼Œå¯¼è‡´ç¬¬ä¸€ä¸ªçº¿ç¨‹æ— æ³•æ­£ç¡®åˆ¤æ–­ç‰ˆæœ¬æ˜¯å¦è¢«ä¿®æ”¹ã€‚</p></li></ol><p>è§£å†³æ–¹æ¡ˆ<br>ä¸ºäº†é¿å…ABAé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</p><p>ç‰ˆæœ¬å·æˆ–æ ‡è®°ï¼šä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ ‡è®°æ¥è®°å½•æ¯æ¬¡æ›´æ–°çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ AtomicStampedReference æ¥ç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚<br>æ—¶é—´æˆ³ï¼šä½¿ç”¨æ—¶é—´æˆ³æ¥è®°å½•æ¯æ¬¡æ›´æ–°çš„æ—¶é—´ï¼Œç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ—¶é—´æ ‡è®°ã€‚<br>é€»è¾‘æ—¶é’Ÿï¼šä½¿ç”¨é€»è¾‘æ—¶é’Ÿæ¥è®°å½•æ¯æ¬¡æ›´æ–°çš„é¡ºåºï¼Œç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„é¡ºåºæ ‡è®°ã€‚<br>ç¤ºä¾‹ï¼šä½¿ç”¨ AtomicStampedReference é¿å…ABAé—®é¢˜<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ AtomicStampedReference é¿å…ABAé—®é¢˜çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><figcaption><span>atomic_stamped_reference.java</span><a href="/blog/downloads/code/atomic/atomic_stamped_reference.java">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ABAExample</span> {</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicStampedReference&lt;Integer&gt; atomicStampedRef = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> {</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedRef.getStamp();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> atomicStampedRef.getReference();</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 1 initial value: &quot;</span> + value + <span class="string">&quot;, stamp: &quot;</span> + stamp);</span><br><span class="line">            atomicStampedRef.compareAndSet(value, value + <span class="number">1</span>, stamp, stamp + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 1 updated value: &quot;</span> + atomicStampedRef.getReference() + <span class="string">&quot;, stamp: &quot;</span> + atomicStampedRef.getStamp());</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; {</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedRef.getStamp();</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> atomicStampedRef.getReference();</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 2 initial value: &quot;</span> + value + <span class="string">&quot;, stamp: &quot;</span> + stamp);</span><br><span class="line">            atomicStampedRef.compareAndSet(value, value + <span class="number">1</span>, stamp, stamp + <span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread 2 updated value: &quot;</span> + atomicStampedRef.getReference() + <span class="string">&quot;, stamp: &quot;</span> + atomicStampedRef.getStamp());</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAtomicStampedReference ä½¿ç”¨ç‰ˆæœ¬å·æ¥é¿å…ABAé—®é¢˜ï¼Œç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç‰ˆæœ¬å·ã€‚</p><p>C++ æ ‡å‡†åº“ä¸­æ²¡æœ‰ç›´æ¥ç­‰åŒäº Java çš„ AtomicStampedReference çš„ç±»ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ç»„åˆ std::atomic å’Œè‡ªå®šä¹‰ç»“æ„ä½“æ¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ C++ ä¸­å®ç°å¸¦æœ‰ç‰ˆæœ¬å·çš„åŸå­å¼•ç”¨ï¼Œä»¥é¿å… ABA é—®é¢˜ï¼š</p><p>ç¤ºä¾‹ï¼šå®ç°å¸¦æœ‰ç‰ˆæœ¬å·çš„åŸå­å¼•ç”¨</p><figure class="highlight cpp"><figcaption><span>cas_with_version.cpp</span><a href="/blog/downloads/code/atomic/cas_with_version.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">StampedValue</span> {</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="type">int</span> stamp;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">std::atomic&lt;StampedValue&gt; atomicStampedValue{StampedValue{<span class="number">0</span>, <span class="number">0</span>}};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">increment</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) {</span><br><span class="line">        StampedValue expected = atomicStampedValue.<span class="built_in">load</span>();</span><br><span class="line">        StampedValue newValue;</span><br><span class="line">        <span class="keyword">do</span> {</span><br><span class="line">            newValue = {expected.value + <span class="number">1</span>, expected.stamp + <span class="number">1</span>};</span><br><span class="line">        } <span class="keyword">while</span> (!atomicStampedValue.<span class="built_in">compare_exchange_weak</span>(expected, newValue));</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(increment)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(increment)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    StampedValue finalValue = atomicStampedValue.<span class="built_in">load</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Final value: &quot;</span> &lt;&lt; finalValue.value &lt;&lt; <span class="string">&quot;, Final stamp: &quot;</span> &lt;&lt; finalValue.stamp &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>è§£é‡Š<br>StampedValue ç»“æ„ä½“ï¼šåŒ…å«ä¸€ä¸ªå€¼å’Œä¸€ä¸ªç‰ˆæœ¬å·ï¼ˆæˆ–æ—¶é—´æˆ³ï¼‰ã€‚<br>std::atomicï¼šä½¿ç”¨ std::atomic åŒ…è£… StampedValue ç»“æ„ä½“ï¼Œä»¥ç¡®ä¿åŸå­æ€§æ“ä½œã€‚<br>compare_exchange_weakï¼šåœ¨æ›´æ–°å€¼å’Œç‰ˆæœ¬å·æ—¶ä½¿ç”¨ CAS æ“ä½œï¼Œç¡®ä¿æ“ä½œçš„åŸå­æ€§å’Œé¿å… ABA é—®é¢˜ã€‚<br>ä½¿ç”¨åœºæ™¯<br>è¿™ç§æ–¹æ³•é€‚ç”¨äºéœ€è¦é¿å… ABA é—®é¢˜çš„åœºæ™¯ï¼Œä¾‹å¦‚æ— é”é˜Ÿåˆ—ã€æ— é”æ ˆç­‰å¤æ‚å¹¶å‘æ•°æ®ç»“æ„ã€‚</p><h4 id="compare-exchange-weak-å’Œ-compare-exchange-strong"><a href="#compare-exchange-weak-å’Œ-compare-exchange-strong" class="headerlink" title="compare_exchange_weak å’Œ compare_exchange_strong"></a>compare_exchange_weak å’Œ compare_exchange_strong</h4><p>åŒºåˆ«<br>å¯é æ€§ï¼š</p><p>compare_exchange_weakï¼šå…è®¸å¶å°”å¤±è´¥ï¼Œå³ä½¿å½“å‰å€¼ä¸æœŸæœ›å€¼ç›¸ç­‰ï¼Œä¹Ÿå¯èƒ½è¿”å› falseã€‚è¿™ç§è®¾è®¡æ˜¯ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé€‚ç”¨äºå¾ªç¯ä¸­çš„è‡ªæ—‹é”ç­‰åœºæ™¯ã€‚<br>compare_exchange_strongï¼šä¿è¯æ“ä½œæˆåŠŸï¼Œå¦‚æœå½“å‰å€¼ä¸æœŸæœ›å€¼ç›¸ç­‰ï¼Œåˆ™ä¸€å®šè¿”å› trueã€‚é€‚ç”¨äºéœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸçš„åœºæ™¯ã€‚<br>æ€§èƒ½ï¼š</p><p>compare_exchange_weakï¼šé€šå¸¸æ¯” compare_exchange_strong æ€§èƒ½æ›´é«˜ï¼Œå› ä¸ºå®ƒå…è®¸å¶å°”å¤±è´¥ã€‚<br>compare_exchange_strongï¼šåœ¨æŸäº›å¹³å°ä¸Šæ€§èƒ½å¯èƒ½è¾ƒä½ï¼Œå› ä¸ºå®ƒéœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸã€‚<br>é€‚ç”¨åœºæ™¯<br>compare_exchange_weakï¼š</p><ul><li>é€‚ç”¨äºå¾ªç¯ä¸­çš„è‡ªæ—‹é”ã€‚</li><li>é€‚ç”¨äºé«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ã€‚</li></ul><p>compare_exchange_strongï¼š</p><ul><li>é€‚ç”¨äºéœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸçš„åœºæ™¯ã€‚</li><li>é€‚ç”¨äºçº¿ç¨‹åŒæ­¥ã€‚</li></ul><p>compare_exchange_weak å…è®¸è™šå‡å¤±è´¥çš„åº•å±‚å®ç°åŸºäº CASï¼ˆCompare-And-Swapï¼‰ æ“ä½œå’Œç¡¬ä»¶æŒ‡ä»¤çš„ç‰¹æ€§ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š</p><p>CASæ“ä½œ<br>CAS æ“ä½œæœ‰ä¸‰ä¸ªå‚æ•°ï¼šå†…å­˜åœ°å€ã€é¢„æœŸå€¼å’Œæ–°å€¼ã€‚å…¶åŸºæœ¬åŸç†æ˜¯ï¼š</p><p>æ¯”è¾ƒå†…å­˜åœ°å€ä¸­çš„å€¼æ˜¯å¦ä¸é¢„æœŸå€¼ç›¸ç­‰ã€‚<br>å¦‚æœç›¸ç­‰ï¼Œåˆ™å°†å†…å­˜åœ°å€ä¸­çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ã€‚<br>å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œï¼Œå¹¶è¿”å›å½“å‰å†…å­˜åœ°å€ä¸­çš„å€¼ã€‚<br>è™šå‡å¤±è´¥çš„åŸå› <br>compare_exchange_weak å…è®¸è™šå‡å¤±è´¥ï¼Œå³ä½¿å½“å‰å€¼ä¸é¢„æœŸå€¼ç›¸ç­‰ï¼Œä¹Ÿå¯èƒ½è¿”å› falseã€‚è¿™ç§æƒ…å†µé€šå¸¸å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><p>ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼š</p><p>åœ¨å¤šæ ¸å¤„ç†å™¨ä¸­ï¼Œç¼“å­˜ä¸€è‡´æ€§åè®®å¯èƒ½å¯¼è‡´ CAS æ“ä½œå¤±è´¥ï¼Œå³ä½¿å†…å­˜ä¸­çš„å€¼æ²¡æœ‰æ”¹å˜ã€‚ä¾‹å¦‚ï¼Œåœ¨ ARM æ¶æ„ä¸­ï¼Œä½¿ç”¨ LDXR&#x2F;STXR æŒ‡ä»¤æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹åŒä¸€ç¼“å­˜è¡Œçš„è®¿é—®å¯èƒ½å¯¼è‡´ CAS æ“ä½œå¤±è´¥1ã€‚<br>ç¡¬ä»¶æŒ‡ä»¤çš„å®ç°ï¼š</p><p>åœ¨æŸäº›å¹³å°ä¸Šï¼ŒCAS æ“ä½œå¯èƒ½è¢«å®ç°ä¸ºå•æ¬¡ LL&#x2F;SCï¼ˆLoad-Linked&#x2F;Store-Conditionalï¼‰å°è¯•ã€‚è¿™ç§å®ç°å…è®¸ CAS æ“ä½œå¶å°”å¤±è´¥ï¼Œä»¥æé«˜æ€§èƒ½</p><p>ä¸ºä»€ä¹ˆcompare_exchange_strongä¸è¢«ç”¨äºå®ç°è‡ªæ—‹é”ï¼Ÿ<br>Copilot said:<br>Copilot<br>compare_exchange_strong é€šå¸¸ä¸ç”¨äºå®ç°è‡ªæ—‹é”ï¼Œä¸»è¦åŸå› åœ¨äºå…¶æ€§èƒ½å’Œè®¾è®¡ç›®çš„ï¼š</p><p>æ€§èƒ½<br>compare_exchange_strong ä¿è¯æ“ä½œæˆåŠŸï¼Œå¦‚æœå½“å‰å€¼ä¸é¢„æœŸå€¼ç›¸ç­‰ï¼Œåˆ™ä¸€å®šè¿”å› true1ã€‚è¿™ç§ä¿è¯éœ€è¦æ›´å¤šçš„ç¡¬ä»¶èµ„æºå’Œæ—¶é—´æ¥å®Œæˆæ“ä½œï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™1ã€‚<br>compare_exchange_weak å…è®¸å¶å°”å¤±è´¥ï¼Œå³ä½¿å½“å‰å€¼ä¸é¢„æœŸå€¼ç›¸ç­‰ï¼Œä¹Ÿå¯èƒ½è¿”å› false1ã€‚è¿™ç§è®¾è®¡å‡å°‘äº†ç¡¬ä»¶èµ„æºçš„æ¶ˆè€—ï¼Œæé«˜äº†æ€§èƒ½1ã€‚<br>è®¾è®¡ç›®çš„<br>è‡ªæ—‹é” çš„è®¾è®¡ç›®çš„æ˜¯åœ¨çŸ­æ—¶é—´å†…é¢‘ç¹å°è¯•è·å–é”ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´ç­‰å¾…ã€‚å› æ­¤ï¼Œè‡ªæ—‹é”æ›´é€‚åˆä½¿ç”¨ compare_exchange_weakï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨å¤±è´¥æ—¶å¿«é€Ÿé‡è¯•1ã€‚<br>compare_exchange_strong æ›´é€‚åˆéœ€è¦ç¡®ä¿æ“ä½œæˆåŠŸçš„åœºæ™¯ï¼Œå¦‚çº¿ç¨‹åŒæ­¥1ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œæ“ä½œçš„æˆåŠŸç‡æ¯”æ€§èƒ½æ›´é‡è¦ã€‚<br>ä»£ç ç¤ºä¾‹<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ compare_exchange_weak å®ç°è‡ªæ—‹é”çš„ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><figcaption><span>cas_spin_lock.cpp</span><a href="/blog/downloads/code/atomic/cas_spin_lock.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SpinLock</span> {</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::atomic&lt;<span class="type">bool</span>&gt; flag = {<span class="literal">false</span>};</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">lock</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="type">bool</span> expected = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (!flag.<span class="built_in">compare_exchange_weak</span>(expected, <span class="literal">true</span>, std::memory_order_acquire)) {</span><br><span class="line">            expected = <span class="literal">false</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unlock</span><span class="params">()</span> </span>{</span><br><span class="line">        flag.<span class="built_in">store</span>(<span class="literal">false</span>, std::memory_order_release);</span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œcompare_exchange_weak è¢«ç”¨æ¥å®ç°è‡ªæ—‹é”ï¼Œå› ä¸ºå®ƒåœ¨å¤±è´¥æ—¶å¯ä»¥å¿«é€Ÿé‡è¯•ï¼Œä»è€Œæé«˜æ€§èƒ½</p><h3 id="å†…å­˜å±éšœ"><a href="#å†…å­˜å±éšœ" class="headerlink" title="å†…å­˜å±éšœ"></a>å†…å­˜å±éšœ</h3><p>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºå†…å­˜æ …æ ï¼ˆMemory Fenceï¼‰æˆ–å†…å­˜å›´æ ï¼ˆMemory Fenceï¼‰ï¼Œæ˜¯ä¸€ç§ç¡¬ä»¶æˆ–è½¯ä»¶çš„åŒæ­¥æœºåˆ¶ï¼Œç”¨äºåœ¨å¹¶å‘ç³»ç»Ÿä¸­ä¿æŒå†…å­˜æ“ä½œçš„é¡ºåºæ€§123ã€‚è¿™æ˜¯å¤šæ ¸å’Œå¤šçº¿ç¨‹ç¯å¢ƒä¸­è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºç°ä»£å¤„ç†å™¨ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºä»¥æé«˜æ‰§è¡Œæ•ˆç‡123ã€‚</p><p>å†…å­˜å±éšœçš„ä½œç”¨<br>é˜²æ­¢æŒ‡ä»¤é‡æ’åºï¼š</p><p>ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä»¥ä¼˜åŒ–æ€§èƒ½12ã€‚å†…å­˜å±éšœç¡®ä¿ç‰¹å®šçš„å†…å­˜æ“ä½œåœ¨å±éšœä¹‹å‰å®Œæˆï¼Œè€Œä¸ä¼šè¢«é‡æ’åºåˆ°å±éšœä¹‹å12ã€‚<br>ä¿è¯å†…å­˜å¯è§æ€§ï¼š</p><p>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹å†…å­˜çš„ä¿®æ”¹å¿…é¡»å¯¹å…¶ä»–çº¿ç¨‹å¯è§12ã€‚å†…å­˜å±éšœç¡®ä¿åœ¨å±éšœä¹‹å‰çš„æ‰€æœ‰å†™æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹å¯è§12ã€‚<br>ç±»å‹<br>åŠ è½½å±éšœï¼ˆLoad Barrierï¼‰ï¼š</p><p>ç¡®ä¿åœ¨å±éšœä¹‹å‰çš„æ‰€æœ‰åŠ è½½æ“ä½œå®Œæˆåï¼Œæ‰å¼€å§‹æ‰§è¡Œå±éšœä¹‹åçš„åŠ è½½æ“ä½œ12ã€‚<br>å­˜å‚¨å±éšœï¼ˆStore Barrierï¼‰ï¼š</p><p>ç¡®ä¿åœ¨å±éšœä¹‹å‰çš„æ‰€æœ‰å­˜å‚¨æ“ä½œå®Œæˆåï¼Œæ‰å¼€å§‹æ‰§è¡Œå±éšœä¹‹åçš„å­˜å‚¨æ“ä½œ12ã€‚<br>å…¨å±éšœï¼ˆFull Barrierï¼‰ï¼š</p><p>ç»“åˆäº†åŠ è½½å±éšœå’Œå­˜å‚¨å±éšœçš„åŠŸèƒ½ï¼Œç¡®ä¿åœ¨å±éšœä¹‹å‰çš„æ‰€æœ‰åŠ è½½å’Œå­˜å‚¨æ“ä½œå®Œæˆåï¼Œæ‰å¼€å§‹æ‰§è¡Œå±éšœä¹‹åçš„åŠ è½½å’Œå­˜å‚¨æ“ä½œ12ã€‚<br>ä»£ç ç¤ºä¾‹<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å†…å­˜å±éšœï¼š</p><figure class="highlight cpp"><figcaption><span>memory_barrier.cpp</span><a href="/blog/downloads/code/atomic/memory_barrier.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::atomic&lt;<span class="type">int</span>&gt; a{<span class="number">0</span>};</span><br><span class="line">std::atomic&lt;<span class="type">int</span>&gt; b{<span class="number">0</span>};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread1</span><span class="params">()</span> </span>{</span><br><span class="line">    a.<span class="built_in">store</span>(<span class="number">1</span>, std::memory_order_relaxed);</span><br><span class="line">    std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_seq_cst);  <span class="comment">// å…¨å±éšœ</span></span><br><span class="line">    b.<span class="built_in">store</span>(<span class="number">1</span>, std::memory_order_relaxed);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">thread2</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (b.<span class="built_in">load</span>(std::memory_order_relaxed) == <span class="number">0</span>);</span><br><span class="line">    std::<span class="built_in">atomic_thread_fence</span>(std::memory_order_seq_cst);  <span class="comment">// å…¨å±éšœ</span></span><br><span class="line">    <span class="built_in">assert</span>(a.<span class="built_in">load</span>(std::memory_order_relaxed) == <span class="number">1</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œstd::atomic_thread_fence ç”¨äºæ’å…¥å†…å­˜å±éšœï¼Œç¡®ä¿åœ¨å±éšœä¹‹å‰çš„å­˜å‚¨æ“ä½œå®Œæˆåï¼Œæ‰å¼€å§‹æ‰§è¡Œå±éšœä¹‹åçš„å­˜å‚¨æ“ä½œ</p><h4 id="å†…å­˜åº"><a href="#å†…å­˜åº" class="headerlink" title="å†…å­˜åº"></a>å†…å­˜åº</h4><p>å†…å­˜åºï¼ˆMemory Orderï¼‰æè¿°äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå†…å­˜æ“ä½œçš„é¡ºåºå’Œå¯è§æ€§ã€‚å®ƒå†³å®šäº†ä¸€ä¸ªçº¿ç¨‹å¯¹å†…å­˜çš„ä¿®æ”¹ä½•æ—¶ä»¥åŠå¦‚ä½•å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚C++11 å¼•å…¥äº†å…­ç§å†…å­˜åºï¼Œä»¥ä¾¿ç¨‹åºå‘˜åœ¨å¹¶å‘ç¼–ç¨‹ä¸­æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„åŒæ­¥æœºåˆ¶123ã€‚</p><p>å…­ç§å†…å­˜åº<br>memory_order_relaxedï¼š</p><p>åªä¿è¯å½“å‰æ“ä½œçš„åŸå­æ€§ï¼Œä¸è€ƒè™‘çº¿ç¨‹é—´çš„åŒæ­¥12ã€‚é€‚ç”¨äºä¸éœ€è¦åŒæ­¥çš„åœºæ™¯ï¼Œå¦‚è®¡æ•°å™¨çš„å¢åŠ 12ã€‚<br>memory_order_consumeï¼š</p><p>ç¡®ä¿å½“å‰æ“ä½œä¾èµ–çš„æ‰€æœ‰å†™æ“ä½œåœ¨æ­¤æ“ä½œä¹‹å‰å®Œæˆ12ã€‚ä¸»è¦ç”¨äºä¾èµ–å…³ç³»è¾ƒå¼ºçš„åœºæ™¯12ã€‚<br>memory_order_acquireï¼š</p><p>ç¡®ä¿åœ¨æ­¤æ“ä½œä¹‹åçš„æ‰€æœ‰è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°æ­¤æ“ä½œä¹‹å‰12ã€‚å¸¸ç”¨äºè·å–é”çš„æ“ä½œ12ã€‚<br>memory_order_releaseï¼š</p><p>ç¡®ä¿åœ¨æ­¤æ“ä½œä¹‹å‰çš„æ‰€æœ‰è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°æ­¤æ“ä½œä¹‹å12ã€‚å¸¸ç”¨äºé‡Šæ”¾é”çš„æ“ä½œ12ã€‚<br>memory_order_acq_relï¼š</p><p>ç»“åˆäº† acquire å’Œ release çš„è¯­ä¹‰ï¼Œç¡®ä¿åœ¨æ­¤æ“ä½œä¹‹å‰çš„å†™æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°æ­¤æ“ä½œä¹‹åï¼ŒåŒæ—¶åœ¨æ­¤æ“ä½œä¹‹åçš„è¯»æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°æ­¤æ“ä½œä¹‹å‰12ã€‚é€‚ç”¨äºè¯»-ä¿®æ”¹-å†™æ“ä½œ12ã€‚<br>memory_order_seq_cstï¼š</p><p>é¡ºåºä¸€è‡´æ€§ï¼Œç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„å†…å­˜æ“ä½œé¡ºåºä¸€è‡´12ã€‚è¿™æ˜¯æœ€ä¸¥æ ¼çš„å†…å­˜åºï¼Œé€‚ç”¨äºéœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯12ã€‚<br>ä»£ç ç¤ºä¾‹<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¸åŒçš„å†…å­˜åºï¼š</p><figure class="highlight cpp"><figcaption><span>memory_order.cpp</span><a href="/blog/downloads/code/atomic/memory_order.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::atomic&lt;<span class="type">int</span>&gt; data{<span class="number">0</span>};</span><br><span class="line">std::atomic&lt;<span class="type">bool</span>&gt; ready{<span class="literal">false</span>};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">()</span> </span>{</span><br><span class="line">    data.<span class="built_in">store</span>(<span class="number">42</span>, std::memory_order_relaxed);</span><br><span class="line">    ready.<span class="built_in">store</span>(<span class="literal">true</span>, std::memory_order_release);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (!ready.<span class="built_in">load</span>(std::memory_order_acquire));</span><br><span class="line">    <span class="built_in">assert</span>(data.<span class="built_in">load</span>(std::memory_order_relaxed) == <span class="number">42</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(producer)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">(consumer)</span></span>;</span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œproducer çº¿ç¨‹ä½¿ç”¨ memory_order_release æ¥å‘å¸ƒæ•°æ®ï¼Œè€Œ consumer çº¿ç¨‹ä½¿ç”¨ memory_order_acquire æ¥ç¡®ä¿è¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„</p><p>TODO</p>]]></content>
      
      
      
        <tags>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TCLå…¥é—¨</title>
      <link href="/blog/2025/02/24/TCL%E5%85%A5%E9%97%A8/"/>
      <url>/blog/2025/02/24/TCL%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="TCL-Main"><a href="#TCL-Main" class="headerlink" title="TCL_Main"></a>TCL_Main</h2><p><code>Tcl_Main</code>çš„ç®€åŒ–æµç¨‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tcl_Main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[], Tcl_AppInitProc *appInitProc)</span> </span>&#123;</span><br><span class="line">    Tcl_Interp *interp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Tcl è§£é‡Šå™¨</span></span><br><span class="line">    interp = <span class="built_in">Tcl_CreateInterp</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨åº”ç”¨ç¨‹åºåˆå§‹åŒ–å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> ((*appInitProc)(interp) != TCL_OK) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Application initialization failed: %s\n&quot;</span>, <span class="built_in">Tcl_GetStringResult</span>(interp));</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿›å…¥ Tcl äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    <span class="built_in">Tcl_MainLoop</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="èŠ±æ‹¬å·çš„ç”¨æ³•"><a href="#èŠ±æ‹¬å·çš„ç”¨æ³•" class="headerlink" title="èŠ±æ‹¬å·çš„ç”¨æ³•"></a>èŠ±æ‹¬å·çš„ç”¨æ³•</h2><p>åœ¨Tclä¸­ï¼ŒèŠ±æ‹¬å· <code>&#123;&#125;</code> æœ‰å¤šç§ç”¨æ³•ï¼Œä¸»è¦ç”¨äºåˆ†ç»„ã€å»¶è¿Ÿè§£æã€åˆ›å»ºåˆ—è¡¨å’Œå­—å…¸ç­‰ã€‚ä»¥ä¸‹æ˜¯èŠ±æ‹¬å·çš„ä¸»è¦ç”¨æ³•åŠç¤ºä¾‹ï¼š</p><ol><li><p>åˆ†ç»„ä»£ç å—<br>èŠ±æ‹¬å·ç”¨äºå°†ä¸€æ®µä»£ç åˆ†ç»„ï¼Œä½¿å…¶ä½œä¸ºä¸€ä¸ªæ•´ä½“ä¼ é€’æˆ–æ‰§è¡Œã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &#123;[<span class="keyword">catch</span> &#123;myProc&#125; msg]&#125; &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;An error occurred: $msg&quot;</span></span><br><span class="line">&#125; else &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;myProc executed successfully&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å»¶è¿Ÿè§£æ<br>èŠ±æ‹¬å·å†…çš„å†…å®¹ä¸ä¼šç«‹å³è§£æï¼Œç›´åˆ°éœ€è¦æ—¶æ‰ä¼šè¢«è§£æã€‚è¿™åœ¨å¤„ç†åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶éå¸¸æœ‰ç”¨ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> script &#123;<span class="keyword">puts</span> <span class="string">&quot;Hello, World!&quot;</span>&#125;</span><br><span class="line"><span class="keyword">eval</span> <span class="variable">$script</span>  <span class="comment">;# è¾“å‡º &quot;Hello, World!&quot;</span></span><br></pre></td></tr></table></figure> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> &#123;[<span class="keyword">catch</span> &#123;myProc&#125; msg]&#125; &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;An error occurred: $msg&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºåˆ—è¡¨<br>èŠ±æ‹¬å·ç”¨äºåˆ›å»ºåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> myList &#123;one two three&#125;</span><br><span class="line"><span class="keyword">puts</span> [<span class="keyword">lindex</span> <span class="variable">$myList</span> <span class="number">1</span>]  <span class="comment">;# è¾“å‡º &quot;two&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå­—å…¸<br>èŠ±æ‹¬å·ç”¨äºåˆ›å»ºå­—å…¸ï¼Œå­—å…¸ä¸­çš„é”®å€¼å¯¹å¯ä»¥åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> myDict &#123;key1 value1 key2 value2&#125;</span><br><span class="line"><span class="keyword">puts</span> [<span class="keyword">dict</span> get <span class="variable">$myDict</span> key1]  <span class="comment">;# è¾“å‡º &quot;value1&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>å¤šè¡Œå­—ç¬¦ä¸²<br>èŠ±æ‹¬å·ç”¨äºåˆ›å»ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ¢è¡Œç¬¦å’Œç©ºæ ¼ä¼šè¢«ä¿ç•™ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> multiLineString &#123;</span><br><span class="line">    This is a multi-line</span><br><span class="line">    <span class="keyword">string</span> in Tcl.</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$multiLineString</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿æŠ¤ç‰¹æ®Šå­—ç¬¦<br>èŠ±æ‹¬å·ç”¨äºä¿æŠ¤ç‰¹æ®Šå­—ç¬¦ï¼Œä½¿å…¶ä¸è¢«è§£é‡Šä¸ºå‘½ä»¤æˆ–å˜é‡ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> specialChars &#123;This is a &#123;special&#125; <span class="keyword">string</span> with [brackets] and <span class="variable">$dollar</span> signs.&#125;</span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$specialChars</span></span><br></pre></td></tr></table></figure></li><li><p>åœ¨æ§åˆ¶ç»“æ„ä¸­ä½¿ç”¨<br>èŠ±æ‹¬å·ç”¨äºæ§åˆ¶ç»“æ„ï¼ˆå¦‚ ifã€whileã€for ç­‰ï¼‰ä¸­çš„æ¡ä»¶å’Œä»£ç å—ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> x <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> &#123;<span class="variable">$x</span> &gt; <span class="number">5</span>&#125; &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;x is greater than 5&quot;</span></span><br><span class="line">&#125; else &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;x is 5 or less&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®šä¹‰è¿‡ç¨‹<br>èŠ±æ‹¬å·ç”¨äºå®šä¹‰è¿‡ç¨‹çš„å‚æ•°å’Œä¸»ä½“ã€‚</p> <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">proc</span><span class="title"> greet</span> &#123;name&#125; &#123;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;Hello, $name!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">greet <span class="string">&quot;Tcl User&quot;</span>  <span class="comment">;# è¾“å‡º &quot;Hello, Tcl User!&quot;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="global-å’Œ-varaible"><a href="#global-å’Œ-varaible" class="headerlink" title="global å’Œ varaible"></a>global å’Œ varaible</h2><p><code>global</code> å’Œ <code>variable</code> ç”¨äºå£°æ˜è¯¥å˜é‡æ¥è‡ªå…¨å±€è¿˜æ˜¯å½“å‰å‘½åç©ºé—´ã€‚</p><p>æ³¨æ„ï¼šä¸¤è€…éƒ½æ˜¯å£°æ˜ï¼Œä¸æ˜¯å®šä¹‰ã€‚</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> i <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="keyword">eval</span> test &#123;</span><br><span class="line">    <span class="comment">;# variable i</span></span><br><span class="line">    <span class="comment">;# iæ²¡æœ‰è¢«äº‹å…ˆå£°æ˜ä¸ºåå­—ç©ºé—´çš„å˜é‡ï¼Œåˆ™ä¼šå¼•ç”¨å…¨å±€å˜é‡i</span></span><br><span class="line">    <span class="keyword">for</span> &#123; <span class="keyword">set</span> i <span class="number">1</span>&#125; &#123; <span class="variable">$i</span> &lt;=<span class="number">5</span>&#125; &#123; <span class="keyword">incr</span> i&#125; &#123;</span><br><span class="line">        <span class="keyword">puts</span> -nonewline <span class="string">&quot;i=$i; &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="comment">;# ç”±äºæ²¡æœ‰å…¨å±€çš„jï¼Œæ‰€ä»¥jè¢«é»˜è®¤è§†ä½œå‘½åç©ºé—´å†…éƒ¨å˜é‡ï¼Œå¼•ç”¨æ—¶å¿…é¡»åŠ ä¸Šå‘½åç©ºé—´ä¸ºå‰ç¼€</span></span><br><span class="line">    <span class="keyword">for</span> &#123;<span class="keyword">set</span> j <span class="number">1</span>&#125; &#123; <span class="variable">$j</span>&lt;=<span class="number">5</span>&#125; &#123;<span class="keyword">incr</span> j&#125; &#123;</span><br><span class="line">        <span class="keyword">puts</span> -nonewline <span class="string">&quot;j=$j; &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">puts</span> <span class="string">&quot;\n&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$test::j</span></span><br></pre></td></tr></table></figure><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;#æ³¨æ„içš„å®šä¹‰å¤„è¢«æ³¨é‡Šäº†</span></span><br><span class="line"><span class="comment">#set i 20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="keyword">eval</span> test &#123;</span><br><span class="line">    <span class="comment">;# è¿™é‡Œçš„ global å£°æ˜æ— æ•ˆï¼Œå› ä¸ºæ²¡æœ‰åœ¨å…¨å±€å®šä¹‰i</span></span><br><span class="line">    <span class="keyword">global</span> i</span><br><span class="line">    <span class="comment">;# æ­¤å¤„çš„iä»ç„¶æ˜¯å‘½ä»¤ç©ºé—´å†…éƒ¨çš„</span></span><br><span class="line">    <span class="keyword">for</span> &#123; <span class="keyword">set</span> i <span class="number">1</span>&#125; &#123; <span class="variable">$i</span> &lt;=<span class="number">5</span>&#125; &#123; <span class="keyword">incr</span> i&#125; &#123;</span><br><span class="line">        <span class="keyword">puts</span> -nonewline <span class="string">&quot;i=$i; &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">;# é”™è¯¯ï¼</span></span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$i</span></span><br><span class="line"></span><br><span class="line"><span class="comment">;# æ­£ç¡®</span></span><br><span class="line"><span class="keyword">puts</span> <span class="variable">$test::i</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬2ç«  åŸºäºVerilogçš„æ•°å­—ICè®¾è®¡æ–¹æ³•</title>
      <link href="/blog/2025/01/17/IC/2.%E5%9F%BA%E4%BA%8EVerilog%E7%9A%84%E6%95%B0%E5%AD%97IC%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/"/>
      <url>/blog/2025/01/17/IC/2.%E5%9F%BA%E4%BA%8EVerilog%E7%9A%84%E6%95%B0%E5%AD%97IC%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‚è€ƒ"><a href="#1-å‚è€ƒ" class="headerlink" title="1. å‚è€ƒ"></a>1. å‚è€ƒ</h2><p>ç™½æ æ—¸. æ•°å­—ICè®¾è®¡å…¥é—¨ï¼ˆå¾®è¯¾è§†é¢‘ç‰ˆï¼‰[M]. åŒ—äº¬: æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾ï¼Œ2023-09-01:ç¬¬2ç« .</p><h2 id="2-æ•°å­—å™¨ä»¶ä¸Verilogè¯­æ³•"><a href="#2-æ•°å­—å™¨ä»¶ä¸Verilogè¯­æ³•" class="headerlink" title="2. æ•°å­—å™¨ä»¶ä¸Verilogè¯­æ³•"></a>2. æ•°å­—å™¨ä»¶ä¸Verilogè¯­æ³•</h2><p>è™½ç„¶ Foundry æä¾›çš„å¯ç”¨å…ƒå™¨ä»¶ç§ç±»è¾ƒå¤šï¼Œä½†æ•°å­—è®¾è®¡å¸ˆå¹¶ä¸ç‰¹åˆ«åœ¨æ„è¿™äº›å…ƒå™¨ä»¶ï¼Œåœ¨å…¶å¤´è„‘ä¸­ï¼Œåªå­˜åœ¨ 10 ç§ç®€å•å…ƒå™¨ä»¶ï¼š</p><ul><li>ä¸é—¨ã€æˆ–é—¨ã€éé—¨ã€å¼‚æˆ–é—¨ã€</li><li>åŠ æ³•å™¨ã€ä¹˜æ³•å™¨ã€ç§»ä½å™¨ã€</li><li>é€‰æ‹©å™¨ã€æ¯”è¾ƒå™¨ã€</li><li>è§¦å‘å™¨</li></ul><p>æ³¨æ„ï¼Œè™½ç„¶åŠ æ³•å™¨ã€ä¹˜æ³•å™¨ã€æ¯”è¾ƒå™¨ç­‰å…ƒå™¨ä»¶å¯ä»¥ç”±é€»è¾‘é—¨ç”Ÿæˆï¼Œä½†æ˜¯ä»Verilogå¸¸ç”¨çš„è¡¨è¾¾å¼æ¥çœ‹ï¼Œä¸€èˆ¬ç›´æ¥ç”¨â€œ+â€è¿™ä¸ªç¬¦å·è¡¨ç¤ºåŠ æ³•ï¼Œè€Œå¾ˆå°‘ç”¨é—¨ç”µè·¯å»ç›´æ¥æ­å»ºã€‚å› ä¸ºç°ä»£èŠ¯ç‰‡è§„æ¨¡åºå¤§ï¼ŒåŠŸèƒ½å¤æ‚ï¼Œå·¥ç¨‹å¸ˆåº”è¯¥å°†ä¸»è¦ç²¾åŠ›æŠ•å…¥åˆ°é‡ç‚¹éš¾é¢˜çš„å®ç°ä¸­ï¼Œè€Œå¯¹äºå¦‚ä½•å®ç°åŠ æ³•å™¨ç­‰æœ€åº•å±‚çš„é—®é¢˜ï¼Œåº”è¯¥äº¤ç»™ç»¼åˆæ­¥éª¤è‡ªåŠ¨å®Œæˆã€‚</p><p>åŸºæœ¬å…ƒå™¨ä»¶ä¸­ä¸åŒ…æ‹¬é™¤æ³•ï¼Œå› ä¸ºé™¤æ³•çš„å®ç°ä¸åŒäºä¹˜æ³•ï¼Œå®ƒå—åˆ°è¢«é™¤æ•°ã€é™¤æ•°ã€å•†çš„æ•°å€¼èŒƒå›´é™åˆ¶ï¼Œæœ‰æ—¶éœ€è¦ç”¨åˆ°è¿­ä»£ç­‰å¤æ‚æ–¹æ³•å®ç°ï¼Œè¿˜æœ‰åˆ†æ¯ä¸º 0 ç­‰å¼‚å¸¸æƒ…å†µéœ€è¦æŠ¥å‘Šï¼Œæ‰€ä»¥ä¸å±äºVerilogä¸­å¸¸ç”¨çš„ç›´æ¥è¿ç®—æ–¹å¼ã€‚</p><p>åŠ¡å¿…æ³¨æ„ï¼Œæ•°å­—å‰ç«¯å†™çš„Verilogä»…ä»…æ˜¯ä»£ç ï¼Œè€Œéç¨‹åºï¼Œå…¶ä»£ç æ˜¯ä»£æ›¿ç”µè·¯å›¾çš„ä¸€ç§æ–‡æœ¬è¯­è¨€æè¿°ã€‚ä¸æˆ–éåŠ ä¹˜ç­‰æŒ‡çš„æ˜¯å…ƒå™¨ä»¶ã€‚å†™Verilogæ—¶è¦æœ‰ç”µè·¯æ¦‚è²Œå’Œæ—¶åºã€‚</p><p>10ç§æ•°å­—å™¨ä»¶çš„ç¬¦å·è¡¨ç¤ºåŠVerilogè¡¨ç¤ºæ–¹æ³•è§è¡¨æ ¼ï¼š</p><figure style="text-align:center;"><figcaption>10ç§æ•°å­—é€»è¾‘å™¨ä»¶å’ŒVerilogè¡¨ç¤º</figcaption><img src='https://i.postimg.cc/B65vgDMk/20250117214703.jpg' border='0' alt='20250117214703' width="90%"/></figure><p>çœŸæ­£çš„å…ƒå™¨ä»¶åº“ä¸­æœ‰å¾ˆå¤šå¤æ‚çš„å…ƒå™¨ä»¶ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><figure style="text-align:center;"><img src="https://i.postimg.cc/6QSLdsyT/20250117214659.jpg" alt="20250117214659" width="50%"/><figcaption>å¤æ‚å…ƒå™¨ä»¶ç¤ºä¾‹</figcaption></figure><p>ä½†æ˜¯è¿™äº›å…ƒå™¨ä»¶éƒ½å¯ä»¥çœ‹ä½œä»¥ä¸Š10ç§åŸºç¡€å…ƒå™¨ä»¶çš„ç»„åˆï¼Œä¸ä¼šè¶…å‡ºåŸæœ‰çš„åŠŸèƒ½èŒƒå›´ã€‚æ‰€ä»¥è®¾è®¡æ—¶ï¼Œå¤´è„‘ä¸­åªéœ€è¦æœ‰ä»¥ä¸Š10ç§å…ƒå™¨ä»¶ã€‚</p><p>æ•°å­—ICè®¾è®¡åˆç§°ä¸ºæ•°å­—é€»è¾‘è®¾è®¡ï¼Œå› ä¸ºå…¶æœ¬èº«å°±æ˜¯é€»è¾‘çš„ï¼Œåªæœ‰<code>0</code>å’Œ<code>1</code>ä¸¤ç§é€»è¾‘ã€‚</p><ul><li>ç»„åˆé€»è¾‘ï¼šç”µå¹³è¾“å…¥å’Œç”µå¹³è¾“å‡ºã€‚å…ƒå™¨ä»¶ç»“æ„ç®€å•ï¼Œä½†é—®é¢˜æ˜¯å¦‚æœè¾“å…¥å«æœ‰æ¯›åˆºï¼Œè¾“å‡ºå°±æœ‰æ¯›åˆºã€‚</li></ul><img src='https://i.postimg.cc/C1s5wkTY/20250117215056.jpg' border='0' alt='20250117215056' width="50%"/><figure style="text-align:center;"><img src='https://i.postimg.cc/NMH8DNHD/20250117214654.jpg' border='0' alt='20250117214654' width="50%"/><figcaption>ç»„åˆé€»è¾‘ç”µè·¯çš„æ¯›åˆº</figcaption></figure><ul><li>æ—¶åºé€»è¾‘ï¼šä»¥æ—¶é’Ÿä¸ºé©±åŠ¨æºã€‚ä¸€ä¸ªè§¦å‘å™¨ï¼Œåœ¨æ—¶é’Ÿçš„é©±åŠ¨ï¼ˆè¾¹æ²¿è§¦å‘ï¼‰ä¸‹ï¼Œå°† D è¾“å…¥ç«¯çš„ä¿¡å·é€åˆ° Q ç«¯è¾“å‡ºã€‚</li></ul><img src='https://i.postimg.cc/BbfTVx50/20250117214649.jpg' border='0' alt='20250117214649' width="100%"/><p>è§¦å‘å™¨ä¹Ÿå¯ä»¥å«å¯„å­˜å™¨(register, reg)ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰æ—¶é’Ÿé©±åŠ¨ï¼Œé‚£ä¹ˆQç«¯ä¼šä¿æŒåŸæœ‰çŠ¶æ€ä¸å˜ï¼Œä¹Ÿå°±å¯„å­˜äº†ä¸Šä¸€æ¬¡è§¦å‘æ—¶çš„Dç«¯ä¿¡æ¯ã€‚è€Œç»„åˆé€»è¾‘ï¼Œè¾“å‡ºç«¯æ˜¯æ— æ³•å¯„å­˜ä¿¡æ¯çš„ã€‚</p><p>æ—¶åºé€»è¾‘æ˜¯æ•°å­—ç”µè·¯çš„åŸºç¡€ã€‚10 ç§å…ƒå™¨ä»¶ä¸­ï¼Œåªæœ‰è§¦å‘å™¨å±äºæ—¶åºé€»è¾‘å™¨ä»¶ï¼Œæ‰€ä»¥è§¦å‘å™¨æ˜¯æ•´ä¸ªæ•°å­—ç”µè·¯çš„åŸºç¡€ã€‚ä» RTL çš„åç§°å¯ä»¥çŸ¥æ™“ï¼ŒRTL æ„ä¸ºå¯„å­˜å™¨ä¼ è¾“å±‚ï¼Œç›´è¯‘è¿‡æ¥å°±æ˜¯ï¼šä»ä¸€ä¸ªè§¦å‘å™¨çš„è¾“å‡ºåˆ°å¦ä¸€ä¸ªè§¦å‘å™¨çš„è¾“å…¥ï¼Œé€šè¿‡è§¦å‘å™¨çš„å±‚å±‚ä¼ é€’ï¼Œæœ€ç»ˆå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ•°å­—ç”µè·¯ã€‚</p><p>æ•°å­—ç”µè·¯çš„æ—¶åºåˆ†æï¼Œä¸»è¦æ˜¯åˆ†æä¸¤ä¸ªè§¦å‘å™¨ä¹‹é—´çš„è·¯å¾„å»¶è¿Ÿã€‚</p><p>è¿›è¡Œå‰ä»¿æ—¶ï¼Œçœ‹åˆ°çš„ä»¿çœŸæ³¢å½¢ä¼šå’Œæœ¬å›¾ä¸€æ ·ï¼Œæ˜¯ç†æƒ³çš„ï¼Œè€Œä½¿ç”¨ç‰ˆå›¾ç½‘è¡¨è¿›è¡Œåä»¿æ—¶ï¼Œä»¿çœŸæ³¢å½¢æ˜¯å¸¦å»¶è¿Ÿçš„ã€‚</p><p>ä¸Šå›¾ä¸­è§¦å‘å™¨çš„ç¬¦å·è¡¨ç¤ºï¼Œå®ƒå…±æœ‰4ä¸ªå¼•è„šï¼Œé™¤è¾“å…¥çš„Dç«¯å’Œè¾“å‡ºçš„<code>Q</code>ç«¯å¤–ï¼Œä¸‰è§’å½¢ä½ç½®è¡¨ç¤ºæ—¶é’Ÿï¼Œä¸‹æ–¹çš„<code>rst_n</code>è¡¨ç¤ºå¤ä½ï¼Œå…¶ä¸Šçš„åœ†åœˆè¡¨ç¤º<code>0</code>ç”µå¹³æœ‰æ•ˆï¼Œå³<code>rst_n</code>ç­‰äº<code>0</code>æ—¶ï¼Œå¯„å­˜å™¨å¤„äºå¤ä½çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œ<code>Q</code>ç«¯ä¿æŒ<code>0</code>ï¼Œå³ä½¿æ—¶é’Ÿå’Œ<code>D</code>ç«¯æœ‰åŠ¨ä½œï¼Œ<code>Q</code>ç«¯ä¹Ÿä¸ä¼šå˜åŒ–ï¼Œåªæœ‰å½“<code>rst_n</code>ç­‰äº<code>1</code>æ—¶ï¼Œæ‰è§£é™¤å¤ä½çŠ¶æ€ï¼Œå¯„å­˜å™¨æ–¹èƒ½æ­£å¸¸å·¥ä½œã€‚</p><h2 id="3-å¯ç»¼åˆçš„Verilogè®¾è®¡è¯­æ³•"><a href="#3-å¯ç»¼åˆçš„Verilogè®¾è®¡è¯­æ³•" class="headerlink" title="3. å¯ç»¼åˆçš„Verilogè®¾è®¡è¯­æ³•"></a>3. å¯ç»¼åˆçš„Verilogè®¾è®¡è¯­æ³•</h2><p>èƒ½å˜æˆç”µè·¯çš„Verilogè¡¨è¾¾å«åšå¯ç»¼åˆï¼Œåœ¨è®¾è®¡ç”µè·¯æ—¶ï¼Œåªèƒ½ä½¿ç”¨å¯ç»¼åˆçš„è¯­æ³•è¡¨è¿°ã€‚è€Œåœ¨ä»¿çœŸæ—¶ï¼Œç”±äºåªåœ¨è®¡ç®—æœºä¸Šè¿è¡Œï¼Œä¸ç•™ç‰‡ï¼Œå¯ä½¿ç”¨ä¸èƒ½ç»¼åˆçš„é«˜çº§è¯­æ³•ï¼Œä»¥å¢åŠ è¯­è¨€è¡¨è¾¾çš„çµæ´»åº¦å’Œå¤æ‚åº¦ã€‚</p><p>å¯ç»¼åˆçš„ç”µè·¯è¡¨è¿°åªæœ‰ä¸¤ç§ï¼š</p><ul><li><code>assign</code></li><li><code>always</code></li></ul><p>ä¸é—¨ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> z = a &amp; b;</span><br></pre></td></tr></table></figure><p>è§¦å‘å™¨ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rst_n)</span><br><span class="line">        Q &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Q &lt;= D;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç¬¦å·è¯´æ˜ï¼š</p><ul><li><code>&lt;=</code>: éé˜»å¡èµ‹å€¼ï¼Œå‡¡æ˜¯æ—¶åºé€»è¾‘ï¼Œéƒ½ç”¨éé˜»å¡èµ‹å€¼ï¼›</li><li><code>=</code>: é˜»å¡èµ‹å€¼ï¼Œå‡¡æ˜¯ç»„åˆé€»è¾‘ï¼Œéƒ½ç”¨é˜»å¡èµ‹å€¼ï¼›</li><li><code>@(...)</code>: æ‹¬å·ä¸­çš„åˆ—è¡¨å«æ•æ„Ÿåˆ—è¡¨ï¼Œæ„æ€æ˜¯ï¼Œ<code>always</code>å—è¾“å‡ºçš„<code>Q</code>å¯¹åˆ—è¡¨ä¸­ä¿¡å·ä¿æŒæ•æ„Ÿï¼Œå¦‚æœæ•æ„Ÿä¿¡å·åŠ¨ï¼Œåˆ™Qä¹Ÿä¼šåŠ¨ã€‚</li><li><code>posedge clk</code>: æ„æ€æ˜¯æ—¶é’Ÿçš„ä¸Šå‡æ²¿ï¼›</li><li><code>negedge rst_n</code>: æ„æ€æ˜¯æ—¶é’Ÿçš„ä¸‹é™æ²¿ã€‚</li><li><code>begin</code> &#x2F; <code>end</code>: ç›¸å½“äº C è¯­è¨€ä¸­çš„ <code>&#123;&#125;</code> ï¼Œå¦‚æœè¯­å¥åªæœ‰ä¸€æ¡ï¼Œå¯ä»¥ä¸å†™ <code>begin</code> &#x2F; <code>end</code> ã€‚</li></ul><p><code>always</code>ä¸ä»…å¯ä»¥è¡¨ç¤ºæ—¶åºé€»è¾‘ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºç»„åˆé€»è¾‘ã€‚å¦‚ä¸‹æ˜¯ä¸é—¨çš„å¦ä¸€ç§è¡¨ç¤ºï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    z = a &amp; b;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>@(*)</code>ä¸­çš„<code>*</code>æ˜¯çœç•¥è¡¨è¿°çš„æ•æ„Ÿåˆ—è¡¨ï¼Œç»¼åˆå™¨ä¼šè‡ªåŠ¨åœ¨<code>always</code>å—ä¸­å¯»æ‰¾ä¸è¾“å‡º<code>z</code>ç›¸å…³çš„è¾“å…¥ä¿¡å·ï¼Œè‡ªåŠ¨å¡«å…¥æ•æ„Ÿåˆ—è¡¨ä¸­ã€‚æœ¬ä¾‹ä¸­ï¼Œä¼šè‡ªåŠ¨å°†<code>a</code>å’Œ<code>b</code>ä½œä¸ºè¾“å…¥å¡«å…¥ã€‚è¿™ç§è®©å·¥å…·è‡ªåŠ¨å¡«å…¥çš„æ–¹å¼æ˜¯å¯é ä¸”æ¨èçš„ã€‚</p><p>Verilogçš„è¯­æ³•è§„å¾‹ï¼š</p><ol><li>æ—¶åºé€»è¾‘ï¼Œå¿…é¡»ä½¿ç”¨<code>always</code>å—ï¼Œå¹¶åŒæ—¶ä½¿ç”¨<code>&lt;=</code>éé˜»å¡èµ‹å€¼ã€‚åœ¨å…¶æ•æ„Ÿåˆ—è¡¨ä¸­ï¼Œå¿…é¡»å‡ºç°æ—¶é’Ÿä¿¡å·çš„è¾¹æ²¿å’Œå¤ä½ä¿¡å·çš„è¾¹æ²¿ã€‚</li><li>ç»„åˆé€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨<code>assign</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>always</code>å—ï¼Œä½†æ˜¯å®ƒä»¬çš„èµ‹å€¼æ˜¯<code>=</code>é˜»å¡èµ‹å€¼ã€‚è‹¥ä½¿ç”¨<code>always</code>å—ï¼Œåˆ™æ•æ„Ÿåˆ—è¡¨ä¸­ä½¿ç”¨<code>*</code>ã€‚è‹¥é‡åˆ°æ•æ„Ÿåˆ—è¡¨ä¸­å¸¦æœ‰<code>*</code>ï¼Œåˆ™å¯ä»¥ç›´æ¥åˆ¤å®šä¸ºç»„åˆé€»è¾‘ã€‚</li></ol><p>å†æ¬¡å¼ºè°ƒï¼ŒVerilogçš„è¯­æ³•è¡¨è¾¾ï¼Œæè¿°çš„éƒ½æ˜¯ç”µè·¯ï¼Œå› æ­¤ä¾‹å­ä¸­çš„ <code>z</code>ã€<code>a</code>ã€<code>b</code>ã€<code>clk</code>ã€<code>rst_n</code>ã€<code>Q</code>ã€<code>D</code> éƒ½ç§°ä¸ºä¿¡å·ï¼Œåœ¨ç”µè·¯ä¸­éƒ½æ˜¯å®å®åœ¨åœ¨çš„é‡‘å±è¿çº¿ï¼Œåˆ‡å‹¿ç§°ä¸ºå˜é‡ã€‚</p><h2 id="4-å¯¹å¯„å­˜å™¨çš„æ·±åº¦è§£è¯»"><a href="#4-å¯¹å¯„å­˜å™¨çš„æ·±åº¦è§£è¯»" class="headerlink" title="4. å¯¹å¯„å­˜å™¨çš„æ·±åº¦è§£è¯»"></a>4. å¯¹å¯„å­˜å™¨çš„æ·±åº¦è§£è¯»</h2><p>ä¸€èˆ¬ä¼šä½¿ç”¨æ—¶é’Ÿä¸Šå‡æ²¿æ¥é©±åŠ¨å¯„å­˜å™¨ã€‚å¯¹äºåŒæ ·çš„åŠŸèƒ½éœ€æ±‚ï¼ŒåŒæ²¿è§¦å‘éœ€è¦çš„æ—¶é’Ÿæ…¢ï¼Œä½†è¦æ±‚æ—¶é’Ÿæ˜¯<code>50%</code>å ç©ºæ¯”ï¼Œè€Œå•æ²¿è§¦å‘ï¼Œå¯¹æ—¶é’Ÿçš„è¦æ±‚å¿«ä¸€å€ï¼Œä½†å¯¹æ—¶é’Ÿå½¢çŠ¶çš„è¦æ±‚é™ä½å¾ˆå¤šã€‚</p><p>å¤ä½ä¿¡å·<code>rst_n</code>ï¼Œä»¥<code>0</code>ç”µå¹³ä½œä¸ºå¤ä½ç”µå¹³ï¼Œ1ç”µå¹³è§£å¤ä½ï¼Œæ˜¯é€šç”¨æ ‡å‡†ï¼Œå¾ˆå°‘æœ‰åè¿‡æ¥ä½¿ç”¨çš„ã€‚åŸå› æ˜¯ï¼Œæ•°å­—ç”µè·¯çš„å¤ä½ä¿¡å·æ˜¯æ¨¡æ‹Ÿç”µè·¯ç»™çš„ï¼Œé€šå¸¸ï¼Œæ¨¡æ‹Ÿç”µè·¯å°†å…¶å‘½åä¸º<code>POR(Power On Reset)</code>ï¼Œå³ä¸Šç”µå¤ä½ä¿¡å·ã€‚èŠ¯ç‰‡åˆšé€šç”µæ—¶ï¼Œç”µå‹å°ï¼Œé€æ¸ä¸Šå‡åˆ°è¦æ±‚çš„ç”µå‹ï¼Œä¾‹å¦‚<code>1.8V</code>ï¼Œ<code>POR</code>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç”µå‹ä¸Šå‡çš„æ ‡å¿—ï¼Œæ¨¡æ‹Ÿç”µè·¯æ”¾ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œå°†è¾“å…¥ç”µå‹ä¸<code>0.9V</code>æ¯”è¾ƒï¼Œç”µå‹å°äº<code>0.9V</code>ï¼Œ<code>POR</code>ä¸º<code>0</code>ï¼Œç”µå‹å¤§äº<code>0.9V</code>ï¼Œ<code>POR</code>ä¸º<code>1</code>ã€‚å› è€Œå¤ä½ä¿¡å·ä¸Šç”µæ—¶æ€»æ˜¯å…ˆ<code>0</code>å<code>1</code>ï¼Œæ•°å­—å¯„å­˜å™¨éœ€è¦åœ¨å¤ä½ä¿¡å·ä¸º<code>0</code>çš„é˜¶æ®µä¿æŒå¤ä½æ€ï¼Œä¸èƒ½è¿è¡Œï¼Œå› ä¸ºæ­¤æ—¶èŠ¯ç‰‡ç”µå‹ä¸è¶³ï¼Œä¸èƒ½ä¿è¯æ­£å¸¸è¿è¡Œï¼Œè€Œå¤ä½ä¿¡å·å˜æˆ<code>1</code>ï¼Œè¯´æ˜ä¸Šç”µå®Œæ¯•ï¼Œç”µå‹å……è¶³ï¼Œå¯„å­˜å™¨è§£é™¤å¤ä½è¿›è¡Œæ­£å¸¸è¿è¡Œæ˜¯å®‰å…¨çš„ã€‚</p><p>éœ€è¦ç‰¹åˆ«æ¾„æ¸…çš„æ˜¯è¯­å¥<code>negedge rst_n</code>ï¼Œä½†æ˜¯ç»è¿‡ä»¿çœŸå’Œä¸æ¨¡æ‹Ÿå·¥ç¨‹å¸ˆç¡®è®¤ï¼Œå¤ä½ä¿¡å·å¯¹å¯„å­˜å™¨çš„ä½œç”¨ä¸æ˜¯é€šè¿‡ä¿¡å·æ²¿æ¥é©±åŠ¨çš„ï¼Œè€Œæ˜¯é€šè¿‡ç”µå¹³æ¥é©±åŠ¨ï¼Œä¹Ÿå°±æ˜¯ <code>0</code> ä¿¡å·å…·æœ‰ç»å¯¹æ§åˆ¶æƒï¼Œåªè¦ <code>rst_n</code> ä¸º <code>0</code> ï¼Œé‚£ä¹ˆç«‹å³å¤ä½ã€‚</p><h2 id="5-éé˜»å¡èµ‹å€¼å’Œé˜»å¡èµ‹å€¼çš„åŒºåˆ«"><a href="#5-éé˜»å¡èµ‹å€¼å’Œé˜»å¡èµ‹å€¼çš„åŒºåˆ«" class="headerlink" title="5. éé˜»å¡èµ‹å€¼å’Œé˜»å¡èµ‹å€¼çš„åŒºåˆ«"></a>5. éé˜»å¡èµ‹å€¼å’Œé˜»å¡èµ‹å€¼çš„åŒºåˆ«</h2><p>éé˜»å¡èµ‹å€¼çš„æ„æ€æ˜¯è¯¥å¥è¡¨è¾¾ä¸ä¼šé˜»å¡åç»­è¡¨è¾¾çš„æ‰§è¡Œã€‚å¦‚ä¸‹ä¾‹ä¸­ï¼Œ<code>X &lt;ï¼ 0</code>çš„æ‰§è¡Œï¼Œä¸ä¼šé˜»ç¢åˆ°<code>Y &lt;ï¼ 0</code>çš„æ‰§è¡Œï¼Œå®ƒä»¬æ˜¯åŒæ—¶å‘ç”Ÿçš„ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rst_n)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        X &lt;= <span class="number">0</span>;</span><br><span class="line">        Y &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        X &lt;= A;</span><br><span class="line">        Y &lt;= B;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è€Œé˜»å¡èµ‹å€¼ï¼Œæ„æ€æ˜¯å¦‚æœå‰ä¸€å¥ä¸æ‰§è¡Œï¼Œåä¸€å¥å°±æ— æ³•æ‰§è¡Œï¼Œå‰ä¸€å¥ä¼šé˜»å¡åä¸€å¥ã€‚å¯¹äºå¯ç»¼åˆçš„Verilogæ¥è®²ï¼Œå…¶å®å¹¶ä¸ä¼šé˜»å¡ã€‚åœ¨ä¸‹ä¾‹ä¸­ï¼Œ <code>always</code> å—çš„ç›®çš„æ˜¯åˆ›é€  <code>z</code> å’Œ <code>k</code> ä¸¤ä¸ªä¿¡å·ã€‚ <code>k ï¼ 3 * z</code> å’Œ <code>z ï¼ a &amp; b</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„ç”µè·¯ï¼Œ <code>k ï¼ 3 * z</code> ç”µè·¯ä¸ä¼šè¢« <code>z ï¼ a &amp; b</code> é˜»å¡ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    z = a &amp; b;  <span class="comment">// ä¸é—¨</span></span><br><span class="line">    k = <span class="number">3</span> * z;  <span class="comment">// ä¹˜æ³•å™¨</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æœ¬ä¾‹å¯¹åº”çš„åŸç†å›¾å¦‚å›¾æ‰€ç¤ºï¼š</p><img src='https://i.postimg.cc/MTs1Dhsh/20250117224729.jpg' border='0' alt='20250117224729' width="50%"/><p>å¯è§ï¼Œå¯¹äºç”µè·¯æè¿°æ¥è®²ï¼Œè¯­æ³•åªæ˜¯è¡¨ç¤ºä¸€ç§è¿æ¥å…³ç³»ï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œå…ˆåé¡ºåºçš„è¯´æ³•ï¼Œä½†å¦‚æœæœ¬ä¾‹ä½¿ç”¨éé˜»å¡èµ‹å€¼ï¼Œè¯­æ³•æ£€æŸ¥ä¼šæŠ¥é”™ï¼Œå› æ­¤ï¼Œè¿™æ˜¯ä¸€ç§æƒ¯ç”¨æ–¹æ³•ã€‚é˜»å¡èµ‹å€¼åœ¨Verilogä¸­çœŸæ­£ä½“ç°é˜»å¡ï¼Œæ˜¯åœ¨ä»¿çœŸä½¿ç”¨çš„ä¸å¯ç»¼åˆè¯­æ³•ä¸­ï¼Œåˆ°ç¬¬3ç« å†åšè§£é‡Šã€‚</p><h2 id="6-ç»„åˆé€»è¾‘çš„è¡¨è¾¾å¼"><a href="#6-ç»„åˆé€»è¾‘çš„è¡¨è¾¾å¼" class="headerlink" title="6. ç»„åˆé€»è¾‘çš„è¡¨è¾¾å¼"></a>6. ç»„åˆé€»è¾‘çš„è¡¨è¾¾å¼</h2><p>å¯¹äºä¸€ä¸ªç»„åˆé€»è¾‘ç”µè·¯ï¼Œåº”è¯¥åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ç”¨assignï¼Œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ç”¨alwayså‘¢ï¼Ÿ</p><p>æ¯”è¾ƒç®€å•çš„é€»è¾‘é€‚åˆä½¿ç”¨assignæ–¹å¼ï¼Œè¾ƒä¸ºå¤æ‚çš„é€»è¾‘åº”ä½¿ç”¨alwayså—ã€‚ä¸‹ä¾‹ç»™å‡ºäº†ä¸€ä¸ªé€‚åˆç”¨alwayså—çš„è¾ƒå¤æ‚ä¾‹å­ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (s1)</span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s2)</span><br><span class="line">        a = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s3)</span><br><span class="line">        a = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>åŒæ ·çš„åŠŸèƒ½è‹¥æ”¹ç”¨assignï¼Œåˆ™ä¸ºä¸‹ä¾‹æ‰€ç¤ºã€‚å¾ˆæ˜æ˜¾ï¼Œç”¨alwayså—è¡¨è¾¾æ„æ€æ›´åŠ æ¸…æ™°ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> a = s1 ? <span class="number">1</span> : (s2 ? <span class="number">2</span> : (s3 ? <span class="number">3</span> : <span class="number">0</span>));</span><br></pre></td></tr></table></figure><p>å‰é¢è§£é‡Šäº†æ•æ„Ÿåˆ—è¡¨ä¸­çš„ <code>*</code> åœ¨ç»„åˆé€»è¾‘ <code>always</code> å—ä¸­çš„ä½œç”¨ã€‚å¦‚æœè¯»è€…ä½¿ç”¨è¿‡ä¸€äº›è€IPï¼Œåˆ™å¯èƒ½è¿˜ä¼šçœ‹åˆ°ä¸‹ä¾‹æ‰€ç¤ºçš„è¡¨è¾¾ï¼Œè¿™ç§è¡¨è¾¾å·²éšç€ç»¼åˆå™¨çš„è¿›æ­¥æ¸æ¸è¢«æ·˜æ±°äº†ï¼Œä¸å»ºè®®åˆå­¦è€…ä½¿ç”¨ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(s1 <span class="keyword">or</span> s2 <span class="keyword">or</span> s3)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (s1)</span><br><span class="line">        a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s2)</span><br><span class="line">        a = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s3)</span><br><span class="line">        a = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="7-ç»„åˆé€»è¾‘ä¸­çš„é€‰æ‹©å™¨"><a href="#7-ç»„åˆé€»è¾‘ä¸­çš„é€‰æ‹©å™¨" class="headerlink" title="7. ç»„åˆé€»è¾‘ä¸­çš„é€‰æ‹©å™¨"></a>7. ç»„åˆé€»è¾‘ä¸­çš„é€‰æ‹©å™¨</h2><h3 id="7-1-äºŒé€‰ä¸€-MUX-å¦‚ä½•è¡¨è¾¾ï¼Ÿ"><a href="#7-1-äºŒé€‰ä¸€-MUX-å¦‚ä½•è¡¨è¾¾ï¼Ÿ" class="headerlink" title="7.1. äºŒé€‰ä¸€ MUX å¦‚ä½•è¡¨è¾¾ï¼Ÿ"></a>7.1. äºŒé€‰ä¸€ MUX å¦‚ä½•è¡¨è¾¾ï¼Ÿ</h3><img src='https://i.postimg.cc/L6vnwrjX/20250117225844.jpg' border='0' alt='20250117225844' width="50%"/><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ 1 ç§è¡¨è¾¾ï¼Œ assign å®Œæ•´è¡¨è¾¾</span></span><br><span class="line"><span class="keyword">assign</span> z = (s == <span class="number">1</span>) ? b : a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ 2 ç§è¡¨è¾¾ï¼Œ assign ç®€åŒ–è¡¨è¾¾</span></span><br><span class="line"><span class="keyword">assign</span> z = s ? b : a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ 3 ç§è¡¨è¾¾ï¼Œ always å—è¡¨è¾¾</span></span><br><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (s)</span><br><span class="line">        z = b;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        z = a;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="7-2-å¤šé€‰ä¸€MUXï¼Œåˆè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿ"><a href="#7-2-å¤šé€‰ä¸€MUXï¼Œåˆè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿ" class="headerlink" title="7.2. å¤šé€‰ä¸€MUXï¼Œåˆè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿ"></a>7.2. å¤šé€‰ä¸€MUXï¼Œåˆè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Ÿ</h3><p>å› ä¸ºä½¿ç”¨ <code>assign</code> è¡¨ç¤ºæ˜¾ç„¶ä¼šè¿‡äºå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ç”¨ <code>always</code> å—è¡¨ç¤ºã€‚è¡¨ç¤ºæ–¹æ³•æœ‰ä¸¤ç§ï¼Œæ³¨æ„ä¸¤ç§è¡¨è¾¾ç»¼åˆå‡ºæ¥çš„ç”µè·¯æ˜¯ä¸åŒçš„ã€‚</p><p>å…¶ä¸€å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="number">0</span>)</span><br><span class="line">        z = a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">1</span>)</span><br><span class="line">        z = b;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">2</span>)</span><br><span class="line">        z = c;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">3</span>)</span><br><span class="line">        z = d;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">4</span>)</span><br><span class="line">        z = e;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">5</span>)</span><br><span class="line">        z = f;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        z = a; <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç»¼åˆå‡ºæ¥çš„ç”µè·¯å¦‚å›¾æ‰€ç¤ºï¼š</p><img src='https://i.postimg.cc/x84BbfW8/20250117230859.jpg' border='0' alt='20250117230859' width="100%"/><p>å¯è§ï¼Œä½¿ç”¨ <code>if</code> è¡¨è¿°çš„é€‰æ‹©å…³ç³»ï¼Œç»¼åˆçš„ç”µè·¯æ˜¯ä¸€å±‚ä¸€å±‚é€æ¸å±•å¼€çš„ï¼Œå†™åœ¨ <code>if</code> æœ€å‰é¢çš„è¯­å¥ï¼ŒæŒæ¡ç€æœ€ç»ˆçš„é€‰æ‹©æƒï¼Œå› è€Œä¼˜å…ˆçº§æœ€é«˜ï¼Œå†å¾€åä¼˜å…ˆçº§é€å±‚ä¸‹é™ï¼Œè€Œä½¿ç”¨ <code>case</code> è¡¨è¿°çš„MUXï¼Œæ¯ä¸ªé€‰æ‹©éƒ½æ˜¯å¹¶åˆ—çš„ï¼Œä¼˜å…ˆçº§ç›¸åŒï¼Œè§ä¸‹æ–‡ã€‚</p><p>å…¶äºŒå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">case</span> (s)</span><br><span class="line">        <span class="number">0</span>: z = a;</span><br><span class="line">        <span class="number">1</span>: z = b;</span><br><span class="line">        <span class="number">2</span>: z = c;</span><br><span class="line">        <span class="number">3</span>: z = d;</span><br><span class="line">        <span class="number">4</span>: z = e;</span><br><span class="line">        <span class="number">5</span>: z = f;</span><br><span class="line">        <span class="keyword">default</span>: z = a; <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>æ‰€ç»¼åˆçš„ç”µè·¯å¦‚å›¾æ‰€ç¤ºï¼š</p><img src='https://i.postimg.cc/PrfqW20k/20250117230221.jpg' border='0' alt='20250117230221' width="30%"/><p>ä½¿ç”¨ <code>if</code> è¡¨è¿°ï¼Œæœ‰å¯èƒ½å‡ºç°éšè—é€»è¾‘ï¼Œå³è®¾è®¡è€…æ²¡æœ‰è€ƒè™‘åˆ°ï¼Œä½†å®é™…ä¼šè¢«ç»¼åˆå‡ºæ¥çš„é€»è¾‘é—¨ã€‚éšè—é€»è¾‘æ˜¯è®¾è®¡çš„éšæ‚£ï¼Œè®¾è®¡è€…åœ¨å†™ä»£ç æ—¶åº”è¯¥æ¸…æ¥šå…¶é€»è¾‘å«ä¹‰ï¼Œå°½é‡é¿å…å‡ºç°éšè—é€»è¾‘ã€‚ä¸ºäº†é¿å…è®¾è®¡ä¸­å‡ºç°éšè—é€»è¾‘ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­å¾€å¾€ä¼šæå€¡ä½¿ç”¨ <code>case</code> è¯­å¥æ¥è¡¨è¾¾ã€‚</p><p>ä¸‹ä¾‹ä¸­åæ˜ å‡º <code>if</code> çš„ä¼˜å…ˆçº§ç‰¹å¾ï¼Œæ¡ä»¶ <code>s &lt; 5</code> åŒ…å« <code>s ï¼ï¼ 4</code> çš„æƒ…å†µï¼Œå› ä¸º <code>s &lt; 5</code> ä¼˜å…ˆï¼Œå› è€Œå½“ <code>sï¼ï¼4</code> æ—¶ï¼Œ <code>z</code> çš„èµ‹å€¼æ˜¯ <code>a</code> è€Œä¸æ˜¯ <code>b</code> ã€‚å¦‚æœè®¾è®¡æ„å›¾æ˜¯è¦åœ¨ <code>s ï¼ï¼ 4</code> æ—¶ä½¿ <code>z ï¼ b</code> ï¼Œåˆ™åº”å½“å°†å…¶å†™åœ¨ <code>s &lt; 5</code> ä¹‹å‰ã€‚</p><!--  --><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (s &lt; <span class="number">5</span>)</span><br><span class="line">        z = a;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (s == <span class="number">4</span>)</span><br><span class="line">        z = b;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        z = c;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>caseæœ‰ä¸€ç§å˜ä½“æ˜¯ <code>casez</code> ï¼Œå®ƒå¯ä»¥æ‹“å±•caseçš„ä½¿ç”¨èŒƒå›´ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @(*)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">casez</span>(s)</span><br><span class="line">        <span class="number">16&#x27;b00011</span>???????????: z = a;</span><br><span class="line">        <span class="number">16&#x27;b10111111</span>????<span class="number">0000</span>: z = b;</span><br><span class="line">        <span class="number">16&#x27;b1111</span>?<span class="number">001000</span>?????: z = c;</span><br><span class="line">        <span class="keyword">default</span>: z = d;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œé—®å·çš„æ„æ€æ˜¯0æˆ–1éƒ½èƒ½åŒ¹é…ï¼Œç±»ä¼¼è®¡ç®—æœºè¯­è¨€ä¸­çš„é€šé…ç¬¦ã€‚</p><p>è™½ç„¶å¾ˆå¤šé¡¹ç›®æå€¡ä½¿ç”¨ <code>case</code> æˆ– <code>casez</code> æ¥è¡¨è¿°é€‰æ‹©å™¨ï¼Œä½†ç©¶ç«Ÿæ˜¯ä½¿ç”¨ <code>if</code> è¿˜æ˜¯ <code>case</code> ï¼Œä»ç„¶å–å†³äºè¡¨è¾¾çš„éœ€è¦ã€‚æ€»ä½“è€Œè¨€ï¼Œ <code>case</code> ä¾¿äºåˆ¤æ–­æ˜¯å¦ç›¸ç­‰çš„æƒ…å†µï¼Œè€Œ <code>if</code> é€‚åˆåˆ¤æ–­å¤§äºæˆ–å°äºå…³ç³»ï¼Œä¸åŒæƒ…å†µç”¨ä¸åŒçš„è¡¨è¾¾ï¼Œå¯ä»¥ä½¿Verilogé€»è¾‘æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´ä¾¿äºç»´æŠ¤ã€‚</p><p>æ³¨æ„ç»„åˆé€»è¾‘ä¸­çš„ <code>if</code> å’Œ <code>else if</code> ï¼Œæœ€åå¿…é¡»è·Ÿä¸€å¥ <code>else</code> ï¼Œä½¿æ•´ä½“é€»è¾‘å®Œæ•´ã€‚è‹¥æ²¡æœ‰elseï¼Œåˆ™è¯¥ç”µè·¯ä¼šç»¼åˆå‡ºä¸€ä¸ªé”å­˜å™¨(<code>Latch</code>)ã€‚é”å­˜å™¨ä¸å±äº10ç§åŸºæœ¬å…ƒå™¨ä»¶ä¹‹ä¸€ã€‚åœ¨è®¾è®¡ä¸­ï¼Œå‡¡æœ‰å¯„å­˜éœ€æ±‚ï¼Œåº”å°½é‡ä½¿ç”¨è§¦å‘å™¨ï¼Œé¿å…ä½¿ç”¨é”å­˜å™¨ï¼Œç‰¹åˆ«è¦é¿å…ä¸å†™ <code>else</code> å¼•èµ·çš„éšè—é€»è¾‘ã€‚</p><h2 id="8-Verilogä¸­çš„forå¾ªç¯"><a href="#8-Verilogä¸­çš„forå¾ªç¯" class="headerlink" title="8. Verilogä¸­çš„forå¾ªç¯"></a>8. Verilogä¸­çš„forå¾ªç¯</h2><p>å…³é”®å­—ï¼š</p><ul><li><code>for</code></li><li><code>generate</code> &#x2F; <code>endgenerate</code> &#x2F; <code>genvar</code></li><li><code>integer</code>: æ˜¯ç¼–è¯‘æ—¶çš„å˜é‡ï¼Œä¸æ˜¯ä¿¡å·ï¼Œä¸ä¼šè¢«ç»¼åˆæˆç”µè·¯æˆ–é‡‘å±è¿çº¿ã€‚å¦‚æœå˜é‡ <code>ii</code> å£°æ˜ä¸º <code>wire</code> æˆ– <code>reg</code> ï¼Œç„¶åç”¨ <code>a[ii]</code> è¡¨ç¤ºä¸€ä¸ªä¿¡å·ï¼Œåˆ™è¯­æ³•ä¸èƒ½ç»¼åˆä¸ºç”µè·¯ã€‚ä½†æ˜¯ <code>ii</code> å£°æ˜ä¸º <code>integer</code> ï¼Œé‚£ä¹ˆ <code>a[ii]</code> å°†è¢«ç»¼åˆæˆä¿¡å·ã€‚</li></ul><h2 id="9-Verilogä¸­çš„æ•°å€¼è¡¨ç¤ºæ–¹æ³•"><a href="#9-Verilogä¸­çš„æ•°å€¼è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="9. Verilogä¸­çš„æ•°å€¼è¡¨ç¤ºæ–¹æ³•"></a>9. Verilogä¸­çš„æ•°å€¼è¡¨ç¤ºæ–¹æ³•</h2><p> æ•°å€¼ä¸€èˆ¬ä¸ç›´æ¥å†™ï¼Œå¦‚æœç›´æ¥å†™ï¼Œåˆ™å·¥å…·ä¼šç†è§£ä¸ºåè¿›åˆ¶32æ¯”ç‰¹æ•°ï¼Œä½†å®é™…ä¸­çš„ä¿¡å·ä½å®½å¤šç§å¤šæ ·ï¼Œé€‰ç”¨å“ªç§è¿›åˆ¶è¡¨ç¤ºæ•°å€¼ä¹Ÿæœ‰å¤šç§é€‰æ‹©ï¼Œå› æ­¤éœ€è¦å°†è¿™ä¸¤æ–¹é¢äºˆä»¥è§„å®šã€‚</p><table><thead><tr><th>è¿›åˆ¶åˆ¶</th><th>ç¬¦å·å·</th><th>ä¸¾ä¾‹</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>äºŒè¿›åˆ¶</td><td>b</td><td>4â€™b0110</td><td>4 æ¯”ç‰¹æ•°ï¼Œç”¨äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 0110</td></tr><tr><td>åè¿›åˆ¶</td><td>d</td><td>8â€™d3</td><td>8 æ¯”ç‰¹æ•°ï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºä¸º 3</td></tr><tr><td>åå…­è¿›åˆ¶</td><td>h</td><td>15â€™h1abc</td><td>15 æ¯”ç‰¹æ•°ï¼Œç”¨åå…­è¿›åˆ¶è¡¨ç¤ºä¸º 1abc</td></tr></tbody></table><p> ç‰¹æ®Šçš„æ•°å€¼è¡¨ç¤ºæ–¹æ³•ï¼š </p><p> <code>&#123;5&#123;1&#39;b0&#125;&#125;</code> è¡¨ç¤º5ä¸ªæ¯”ç‰¹0ï¼Œå†å¦‚ <code>&#123;4&#123;1&#39;b1&#125;&#125;</code> è¡¨ç¤º4ä¸ªæ¯”ç‰¹1ã€‚è¿™ç§è¡¨ç¤ºä¸€èˆ¬ä¸ç”¨ï¼Œä½†æ˜¯å®ƒæœ‰ä¼˜ç‚¹ï¼Œä¸Šä¾‹ä¸­çš„æ¯”ç‰¹æ•°é‡5å’Œ4å¯ä»¥ç”¨å‚æ•°æ›¿ä»£ï¼Œè‹¥Verilogä¸­æœ‰ä¸€ä¸ªå‚æ•° <code>kkk</code> ï¼Œåˆ™å¯ä»¥å†™ä¸º <code>&#123;(kkk)&#123;1&#39;b0&#125;&#125;</code> ï¼Œç”šè‡³å¯ä»¥å†™æˆç”¨è®¡ç®—å¼è¡¨ç¤ºçš„ä½å®½ï¼Œå¦‚ <code>&#123;(kkkï¼‹2)&#123;1&#39;b0&#125;&#125;</code> ã€‚æ³¨æ„ï¼Œkkkæ˜¯å‚æ•°ï¼Œä¸æ˜¯ä¿¡å·ï¼Œå®ƒä¸æ˜¯ç”µè·¯ï¼Œè€Œæ˜¯ä¸€ç§ç¼–è¯‘æ—¶ä½¿ç”¨çš„å˜é‡ã€‚</p><p> è¿™ç§è¡¨ç¤ºæ–¹æ³•è¿˜å¯ä»¥å†™ä¸º <code>&#123;å¸¸æ•°&#123;é€»è¾‘è¡¨è¾¾å¼&#125;&#125;</code> çš„å½¢å¼ï¼Œå¦‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> int_clr = &#123;<span class="number">2</span>&#123;(apb_addr = = <span class="number">4&#x27;d7</span>) &amp; wr_en&#125;&#125; &amp; apb_wdat[<span class="number">1</span> : <span class="number">0</span>];</span><br></pre></td></tr></table></figure><p>æ­¤ä¾‹çš„ç›®çš„æ˜¯ä½¿ç”¨APBæ€»çº¿é…ç½®ä¸¤ä¸ªåªå†™ä¿¡å·ï¼ˆwrite-onlyä¿¡å·ï¼‰â€‹ï¼Œè¿™ä¸¤ä¸ªä¿¡å·åˆç§°ä¸º <code>int_clr</code> ï¼Œç­‰å¼çš„å³è¾¹ï¼Œä»…å½“åœ°å€ <code>apb_addr</code> ç­‰äº7ï¼Œå¹¶ä¸”åœ¨APBæ€»çº¿ä¸Šå‘ç”Ÿå†™æ“ä½œæ—¶ï¼ŒAPBå†™å…¥çš„ä¸¤æ¯”ç‰¹æ•°æ® <code>apb_wdat[1:0]</code> æ‰ä¼šè¢«é…ç½®åˆ°int_clrä¸­ï¼Œå¦åˆ™int_clrå°±æ˜¯0ã€‚é—®é¢˜åœ¨äºï¼Œ <code>(apb_addrï¼ï¼4&#39;d7)&amp;wr_en</code> æ˜¯ä¸€æ¯”ç‰¹ï¼Œä¸èƒ½è·Ÿ <code>apb_wdat[1:0]</code> æŒ‰ä½æ±‚ä¸ï¼Œå› è€Œéœ€è¦å°†ä¸€æ¯”ç‰¹å¤åˆ¶ä¸ºä¸¤æ¯”ç‰¹ï¼Œå³ <code>&#123;2&#123;(apb_addrï¼ï¼4&#39;d7)&amp;wr_en&#125;&#125;</code> ã€‚</p><p>å¯¹äºå…¶ä»–è¾…åŠ©å˜é‡ï¼Œå¯ä»¥ç›´æ¥å†™æ•°å­—ï¼Œä¾‹å¦‚åœ¨forå¾ªç¯ä¸­è®²è¿°çš„ <code>genvar ii</code> ï¼Œiiåªæ˜¯ä¸ªå˜é‡ï¼Œæ²¡æœ‰å¯¹åº”çš„ç”µè·¯ï¼Œé‚£ä¹ˆforå¾ªç¯èµ‹å€¼å°±ä¸éœ€è¦å¸¦ä½å®½ å’Œè¿›åˆ¶äº†ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(ii = <span class="number">0</span>;ii&lt;<span class="number">100</span>;ii = ii + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æ³¨æ„Verilogä¸­ï¼Œå¦‚æœå•å†™aã€bã€cã€dã€eã€fã€xã€zï¼Œè¡¨ç¤ºçš„æ˜¯ä¿¡å·åï¼Œä¸èƒ½ä½œä¸ºæ•°å€¼ï¼Œå¦‚æœæƒ³è¡¨ç¤ºåå…­è¿›åˆ¶çš„æ•°å€¼ï¼Œåˆ™å¯å†™ä¸º4â€™haç­‰ï¼Œ1â€™bxè¡¨ç¤ºæœªçŸ¥æ€ï¼Œ1â€™bzè¡¨ç¤ºé«˜é˜»æ€ã€‚</p><h2 id="10-ä¿¡å·çš„çŠ¶æ€ç±»å‹"><a href="#10-ä¿¡å·çš„çŠ¶æ€ç±»å‹" class="headerlink" title="10. ä¿¡å·çš„çŠ¶æ€ç±»å‹"></a>10. ä¿¡å·çš„çŠ¶æ€ç±»å‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 1 x z</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ</p><ul><li><p>0å’Œ1æ˜¯æ•°å­—ç”µè·¯æœ¬èº«çš„çŠ¶æ€ï¼Œå®ƒçš„æœ¬æºæ˜¯é›¶ç”µå¹³å’ŒVDDç”µå¹³ã€‚</p><p>  VDDï¼Œ Voltage Drain, å…¶ä¸­ Drain è¡¨ç¤ºæ¼æï¼Œæ˜¯ä¸€ä¸ªç”µæºå¼•è„šï¼Œç”¨æ¥æä¾›æ­£ç”µå‹ç»™ç”µè·¯ä¸­çš„å…ƒä»¶ã€‚ç”±äºæ™¶ä½“ç®¡çš„è®¾è®¡é€šå¸¸åŒ…å«ä¸¤ä¸ªæ¼æï¼ˆæºæå’Œæ¼æï¼‰ï¼Œæ‰€ä»¥åœ¨ä¸€äº›å‘½åè§„åˆ™ä¸­ï¼Œä¸ºäº†åŒºåˆ†æ­£ç”µæºå’Œè´Ÿç”µæºï¼Œä½¿ç”¨äº†ä¸¤ä¸ª Dï¼Œå¹¶ä¸”VDD ä»£è¡¨æ­£ç”µæºç”µå‹ï¼ŒVSSï¼ˆVoltage Sourceï¼‰ä»£è¡¨åœ°çº¿æˆ–è´Ÿç”µæºã€‚ æ•´ä¸ªèŠ¯ç‰‡çš„ç”µæºå¸¸ç§°ä¸ºVCCï¼ŒèŠ¯ç‰‡çš„åœ°å¸¸æ ‡æ³¨ä¸ºVSSã€‚</p><p>  ä¸åŒå·¥è‰ºå’Œå…ƒå™¨ä»¶åº“éœ€è¦çš„VDDä¸åŒï¼Œä¾‹å¦‚0.9Vã€1.8Vã€3.3Vç­‰ï¼Œè€ŒåŒä¸€ä¸ªå…ƒå™¨ä»¶åº“ä¸­çš„æ‰€æœ‰å…ƒå™¨ä»¶ï¼Œå…¶éœ€è¦çš„ä¾›ç”µç”µå‹VDDä¸€èˆ¬ç›¸åŒçš„ï¼Œåªæœ‰I&#x2F;Oå™¨ä»¶ç­‰å°‘æ•°å…ƒå™¨ä»¶ï¼Œå…¶è¾“å…¥ç«¯å’Œæ§åˆ¶ç«¯æ˜¯æ¯”è¾ƒä½çš„ç”µå‹ï¼Œè€Œè¾“å‡ºç«¯å£å´æ˜¯è¾ƒé«˜çš„ç”µå‹ã€‚</p><p>  æ•°å­—0å’Œ1å¯¹åº”çš„ç”µå¹³ä¸ä¼šç‰¹åˆ«ä¸¥æ ¼ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªæµ®åŠ¨èŒƒå›´ï¼Œé€šå¸¸ä¿¡å·ç”µå¹³ä½äºVDDçš„30%ï¼Œå°±è¢«è®¤ä¸ºæ˜¯0ï¼Œé«˜äºVDDçš„70%ï¼Œå°±è¢«è®¤ä¸ºæ˜¯1ã€‚</p></li><li><p>zæ€æ˜¯é«˜é˜»æ€ã€‚</p><p>  å¦‚æœä¸€é¢—èŠ¯ç‰‡ä¸é€šç”µï¼Œåˆ™å®ƒæ‰€æœ‰çš„å¼•è„šå°±éƒ½æ˜¯é«˜é˜»æ€ã€‚å¯è§ï¼Œé«˜é˜»æ€çš„å®é™…æ„ä¹‰å°±æ˜¯ä¸ä¼šå¹²æ‰°åˆ°å…¶ä»–ä¿¡å·ä¼ è¾“çš„çŠ¶æ€ï¼Œä¾‹å¦‚æŸä¿¡å·Aæ˜¯é«˜é˜»æ€ï¼ŒæŸä¿¡å·Bä¸æ˜¯é«˜é˜»æ€ï¼Œé‚£ä¹ˆä¿¡å·Aå åŠ åˆ°ä¿¡å·Bä¸Šï¼ˆå¯ä»¥æƒ³è±¡ä¸ºä¸¤æ ¹ä¿¡å·çº¿è¢«æ‹§åœ¨ä¸€èµ·ï¼‰â€‹ï¼Œç»“æœä»ç„¶æ˜¯Bï¼Œè€ŒAæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚</p><p>  ä¸€èˆ¬æ¥è®²ï¼Œä¸€ä¸ªæœ‰ç€åŒå‘ä¼ è¾“åŠŸèƒ½çš„å¼•è„šï¼Œå¦‚æœè®¾ç½®ä¸ºè¾“å…¥æ¨¡å¼ï¼Œå°±å¯ä»¥è®¤ä¸ºè¿™ä¸ªå¼•è„šå¤„äºé«˜é˜»æ€ï¼Œæ„æ€æ˜¯å®ƒå¯¹ç”µè·¯æ¿ä¸Šä¸å®ƒç›¸è¿çš„å…ƒå™¨ä»¶æ²¡æœ‰ä»»ä½•å½±å“ï¼Œè¿™äº›ç›¸è¿å…ƒå™¨ä»¶å¦‚æœè¦å¯¹æœ¬èŠ¯ç‰‡è¾“å‡º0æˆ–1ï¼Œå°±å¯ä»¥ç›´æ¥é¡ºç€è¯¥é«˜é˜»æ€å¼•è„šè¾“å…¥ï¼Œè€Œä¸ä¼šè¢«å¹²æ‰°æˆ–é˜»æŒ¡ã€‚</p><p>  åœ¨FPGAçš„Verilogè¡¨è¿°ä¸­ï¼Œå¯ä»¥å¾ˆå½¢è±¡åœ°å°†FPGAçš„å¼•è„šæè¿°ä¸ºå¦‚ä¸‹è¯­å¥ï¼Œå…¶ä¸­bæ˜¯FPGAçš„å¼•è„šï¼Œæ‰€ä»¥å£°æ˜ä¸ºinoutç±»å‹ï¼Œoeæ˜¯è¯¥å¼•è„šçš„æ–¹å‘é€‰æ‹©ï¼Œè‹¥oeä¸º1ï¼Œåˆ™bä¸ºè¾“å‡ºæ¨¡å¼ï¼Œå°†ä¿¡å·aè¾“å‡ºåˆ°FPGAå¤–é¢ï¼Œè€Œå½“oeä¸º0æ—¶ï¼Œæ˜¯é«˜é˜»æ€ï¼Œå³è¾“å…¥æ¨¡å¼ï¼Œå¤–é¢çš„ä¿¡å·ä»bå¼•è„šå¯ä»¥è¿›æ¥åä¸ä¿¡å·cå½¢æˆäº†ç»„åˆé€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>  <figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inout</span> b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> b = oe ? a : <span class="number">1&#x27;bz</span></span><br><span class="line"><span class="keyword">assign</span> d = b ^ c;</span><br></pre></td></tr></table></figure><p>  æ³¨æ„ä¸Šä¾‹ä¸­å¼•ç”¨FPGAçš„è¯­æ³•åªæ˜¯ä¸ºäº†è¯´æ˜zæ€çš„å«ä¹‰ã€‚ICè®¾è®¡ä¸­å¯¹å¼•è„šçš„è®¾è®¡ä¸åƒFPGAè¿™ä¹ˆç®€å•ï¼Œéœ€è¦ä¾‹åŒ–ä¸€ä¸ªå¼•è„šæ¨¡å—ï¼Œåœ¨ä»£ç ä¸­ä¸ä¼šå‡ºç°1â€™bzæ•°å€¼ã€‚</p><p>  <strong>åšä¸»æ³¨1ï¼š</strong></p><p>  åœ¨é›†æˆç”µè·¯ï¼ˆICï¼‰ä¸­ï¼Œé«˜é˜»æ€ï¼ˆHigh Impedance Stateï¼Œç®€ç§° Hi-Zï¼‰æ˜¯æŒ‡ä¸€ä¸ªç”µè·¯è¾“å‡ºå¼•è„šå¤„äºæ²¡æœ‰è¾“å‡ºé©±åŠ¨ä¿¡å·çš„çŠ¶æ€ï¼Œå³è¯¥å¼•è„šæ—¢ä¸æä¾›é«˜ç”µå¹³ï¼ˆVDDï¼‰ä¹Ÿä¸æä¾›ä½ç”µå¹³ï¼ˆGNDï¼‰ï¼Œè€Œæ˜¯å¤„äºä¸€ç§â€œæ‚¬ç©ºâ€çŠ¶æ€ï¼Œå‡ ä¹ä¸æ¶ˆè€—ç”µæµï¼Œåƒæ˜¯æ–­å¼€äº†ã€‚é«˜é˜»æ€é€šå¸¸ç”¨äºå¤šè·¯å¤ç”¨ï¼ˆbusï¼‰æˆ–ä¸‰æ€æ€»çº¿ï¼ˆtri-state busï¼‰ç­‰åº”ç”¨ä¸­ï¼Œå…è®¸å¤šä¸ªè®¾å¤‡å…±äº«åŒä¸€æ¡æ€»çº¿è€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</p><p>  é«˜é˜»æ€çš„å®ç°<br>  é«˜é˜»æ€é€šå¸¸é€šè¿‡ <strong>ä¸‰æ€é—¨ï¼ˆTri-state Gateï¼‰</strong> æ¥å®ç°ã€‚ä¸‰æ€é—¨æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„é€»è¾‘é—¨ï¼Œå®ƒå…·æœ‰ä¸‰ä¸ªè¾“å‡ºçŠ¶æ€ï¼š</p><p>  é«˜ç”µå¹³ï¼ˆé€»è¾‘ 1ï¼‰<br>  ä½ç”µå¹³ï¼ˆé€»è¾‘ 0ï¼‰<br>  é«˜é˜»æ€ï¼ˆHi-Zï¼‰<br>  å…·ä½“æ¥è¯´ï¼Œé«˜é˜»æ€æ˜¯é€šè¿‡åœ¨è¾“å‡ºç«¯å¢åŠ ä¸€ä¸ªé«˜é˜»æŠ—çš„ç”µè·¯æ¥å®ç°çš„ï¼Œè¿™ä¸ªé«˜é˜»æŠ—å€¼é€šå¸¸éå¸¸å¤§ï¼Œä»¥è‡³äºè¯¥å¼•è„šå¯¹å¤–éƒ¨ç”µè·¯å‡ ä¹æ²¡æœ‰å½±å“ã€‚ä¸‰æ€é—¨çš„å·¥ä½œåŸç†å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><p>  å¼€å…³å‹è®¾è®¡ï¼š</p><p>  P-Channel MOSFETï¼ˆPMOSï¼‰ å’Œ N-Channel MOSFETï¼ˆNMOSï¼‰ ç»„æˆçš„ç”µè·¯å¯ä»¥æ ¹æ®æ§åˆ¶ä¿¡å·å†³å®šæ˜¯å¦æ¥é€šè¾“å‡ºã€‚å¦‚æœä¸‰æ€é—¨å¤„äºâ€œé«˜é˜»æ€â€æ—¶ï¼ŒMOSFET ä»¬å¹¶ä¸ä¼šå¯¼é€šï¼Œä»è€Œä½¿è¾“å‡ºå¼•è„šå¤„äºé«˜é˜»æŠ—çŠ¶æ€ã€‚<br>  æ§åˆ¶ä¿¡å·ï¼š</p><p>  ä¸‰æ€é—¨çš„è¾“å‡ºé€šå¸¸ç”±ä¸€ä¸ªæ§åˆ¶ä¿¡å·æ¥æ§åˆ¶ã€‚å½“æ§åˆ¶ä¿¡å·ä¸ºâ€œä½¿èƒ½â€çŠ¶æ€æ—¶ï¼Œè¾“å‡ºå¼•è„šä¼šé©±åŠ¨é«˜æˆ–ä½ç”µå¹³ï¼›è€Œå½“æ§åˆ¶ä¿¡å·ä¸ºâ€œç¦ç”¨â€çŠ¶æ€æ—¶ï¼Œè¾“å‡ºå¼•è„šè¿›å…¥é«˜é˜»æ€ï¼ŒåŸºæœ¬ä¸å¤–éƒ¨ç”µè·¯æ–­å¼€è¿æ¥ã€‚<br>  åŒå‘æ€»çº¿ï¼š</p><p>  åœ¨å¤šè·¯å¤ç”¨çš„åœºæ™¯ä¸­ï¼Œå¤šä¸ªè®¾å¤‡å¯èƒ½éœ€è¦å…±äº«åŒä¸€æ¡æ•°æ®æ€»çº¿ã€‚ä¸ºäº†é¿å…å¤šä¸ªè®¾å¤‡åŒæ—¶é©±åŠ¨æ€»çº¿äº§ç”Ÿå†²çªï¼Œè®¾å¤‡åœ¨ä¸è¾“å‡ºæ•°æ®æ—¶ä¼šè¿›å…¥é«˜é˜»æ€ï¼Œä¸å½±å“å…¶ä»–è®¾å¤‡çš„ä¿¡å·ä¼ è¾“ã€‚<br>  é«˜é˜»æ€çš„ä½œç”¨<br>  å¤šè·¯å¤ç”¨ï¼šé«˜é˜»æ€å…è®¸å¤šä¸ªç”µè·¯å…±äº«åŒä¸€æ€»çº¿ã€‚åªæœ‰ä¸€ä¸ªç”µè·¯åœ¨æŸä¸ªæ—¶é—´ç‚¹è¾“å‡ºæ•°æ®ï¼Œå…¶ä»–ç”µè·¯è¿›å…¥é«˜é˜»æ€ï¼Œé˜²æ­¢å†²çªã€‚</p><p>  æ€»çº¿å†²çªä¿æŠ¤ï¼šé€šè¿‡å°†ä¸å‚ä¸é€šä¿¡çš„è®¾å¤‡ç½®äºé«˜é˜»æ€ï¼Œé¿å…äº†å¤šä¸ªè®¾å¤‡åœ¨åŒä¸€æ—¶é—´å°è¯•é©±åŠ¨æ€»çº¿çš„å†²çªã€‚</p><p>  èŠ‚çœç”µåŠ›ï¼šé€šè¿‡åœ¨ä¸éœ€è¦è¾“å‡ºä¿¡å·æ—¶å°†è¾“å‡ºç½®äºé«˜é˜»æ€ï¼Œå¯ä»¥é™ä½åŠŸè€—ï¼Œå› ä¸ºåœ¨é«˜é˜»æ€ä¸‹è¾“å‡ºå¼•è„šå‡ ä¹ä¸æ¶ˆè€—ç”µæµã€‚</p><p>  ä¸¾ä¾‹è¯´æ˜<br>  ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯åœ¨ Tri-state Busï¼ˆä¸‰æ€æ€»çº¿ï¼‰ä¸­ï¼Œå¤šä¸ªè®¾å¤‡é€šè¿‡æ§åˆ¶ä¿¡å·æ¥å†³å®šæ˜¯å¦é©±åŠ¨æ€»çº¿ã€‚å¦‚æœè®¾å¤‡ä¸éœ€è¦å‘é€æ•°æ®ï¼Œå®ƒä¼šå°†è¾“å‡ºç½®äºé«˜é˜»æ€ï¼Œå…è®¸å…¶ä»–è®¾å¤‡ä½¿ç”¨æ€»çº¿ã€‚</p><p>  æ€»ç»“æ¥è¯´ï¼Œé«˜é˜»æ€çš„å®ç°ä¾èµ–äºä¸‰æ€é—¨ï¼ˆTri-state Gateï¼‰ï¼Œå®ƒé€šè¿‡æ§åˆ¶MOSFETå¼€å…³æ¥ä½¿è¾“å‡ºå¤„äºéé©±åŠ¨çŠ¶æ€ï¼Œä»è€Œè®©å…¶ä»–ç”µè·¯å¯ä»¥å…±äº«åŒä¸€ä¸ªå¼•è„šæˆ–æ€»çº¿ã€‚</p><p>  <strong>åšä¸»æ³¨2ï¼š</strong></p><p>  åœ¨æ•°å­—ç”µè·¯ä¸­ï¼Œinout å¼•è„šæ˜¯æŒ‡ä¸€ä¸ªæ—¢å¯ä»¥ä½œä¸ºè¾“å…¥ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¾“å‡ºç«¯å£çš„å¼•è„šã€‚å®ƒé€šå¸¸ç”¨äºå¤šè·¯å¤ç”¨ï¼ˆbusï¼‰æˆ–åŒå‘æ•°æ®ä¼ è¾“çš„åœºåˆï¼Œå…è®¸ä¸€ä¸ªå¼•è„šåœ¨ä¸åŒæ—¶é—´æ ¹æ®éœ€è¦åœ¨è¾“å…¥å’Œè¾“å‡ºä¹‹é—´åˆ‡æ¢ã€‚ä¸ºäº†åœ¨åŒä¸€å¼•è„šä¸ŠåŒæ—¶æ”¯æŒè¾“å…¥å’Œè¾“å‡ºï¼Œé€šå¸¸ä½¿ç”¨ ä¸‰æ€é€»è¾‘ï¼ˆTri-state logicï¼‰æ¥æ§åˆ¶æ•°æ®çš„æµå‘ã€‚</p><p>  inout å¼•è„šçš„å®ç°æ–¹å¼<br>  inout å¼•è„šçš„å®ç°ä¾èµ–äºå‡ ä¸ªå…³é”®çš„è®¾è®¡åŸåˆ™å’Œç»„ä»¶</p><p>  ä¸‰æ€ç¼“å†²å™¨ï¼ˆTri-state Bufferï¼‰ï¼š</p><p>  åœ¨ inout å¼•è„šä¸Šï¼Œé€šå¸¸ä½¿ç”¨ ä¸‰æ€ç¼“å†²å™¨ï¼ˆTri-state bufferï¼‰æ¥æ§åˆ¶è¯¥å¼•è„šæ˜¯å¤„äºè¾“å…¥ã€è¾“å‡ºè¿˜æ˜¯é«˜é˜»æ€ã€‚ä¸‰æ€ç¼“å†²å™¨çš„ä½œç”¨æ˜¯é€šè¿‡æ§åˆ¶ä¿¡å·æ¥å†³å®šè¯¥å¼•è„šçš„çŠ¶æ€ã€‚<br>  å½“å¼•è„šä½œä¸º è¾“å‡º æ—¶ï¼Œç¼“å†²å™¨å°†æ•°æ®ä¼ é€’åˆ°å¼•è„šã€‚<br>  å½“å¼•è„šä½œä¸º è¾“å…¥ æ—¶ï¼Œç¼“å†²å™¨å°†å¼•è„šä¸Šçš„ç”µå‹ä¿¡å·ä¼ é€åˆ°å†…éƒ¨ç”µè·¯ã€‚<br>  å½“å¼•è„šå¤„äº é«˜é˜»æ€ï¼ˆHi-Zï¼‰æ—¶ï¼Œç¼“å†²å™¨æ–­å¼€ä¸å¼•è„šçš„è¿æ¥ï¼Œä½¿å¾—è¯¥å¼•è„šå¯¹å¤–éƒ¨ç”µè·¯â€œé€æ˜â€ï¼Œå³ä¸å½±å“ç”µè·¯ã€‚<br>  æ§åˆ¶ä¿¡å·ï¼š</p><p>  inout å¼•è„šçš„åˆ‡æ¢é€šå¸¸ç”±æ§åˆ¶ä¿¡å·ï¼ˆä¾‹å¦‚ï¼Œæ–¹å‘æ§åˆ¶ä¿¡å·ï¼‰æ¥å†³å®šï¼ŒæŒ‡ç¤ºè¯¥å¼•è„šæ˜¯ä½œä¸ºè¾“å…¥ä½¿ç”¨è¿˜æ˜¯ä½œä¸ºè¾“å‡ºä½¿ç”¨ã€‚<br>  æ§åˆ¶ä¿¡å·ä¸€èˆ¬æ˜¯ç”±é€»è¾‘ç”µè·¯ç”Ÿæˆï¼Œå½“ç”µè·¯éœ€è¦è¾“å‡ºæ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡å·ä¼šä½¿å¼•è„šæˆä¸ºè¾“å‡ºï¼›è€Œå½“ç”µè·¯éœ€è¦æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡å·ä¼šä½¿å¼•è„šæˆä¸ºè¾“å…¥ã€‚<br>  åŒå‘æ€»çº¿è®¾è®¡ï¼š</p><p>  inout å¼•è„šå¸¸ç”¨äºæ€»çº¿è®¾è®¡ï¼Œå…¶ä¸­å¤šä¸ªè®¾å¤‡å…±äº«åŒä¸€æ¡æ€»çº¿ã€‚æ¯ä¸ªè®¾å¤‡å¯ä»¥åœ¨éœ€è¦æ—¶å‘æ€»çº¿å‘é€æ•°æ®ï¼Œè€Œåœ¨ä¸éœ€è¦æ—¶é€šè¿‡å°†è¾“å‡ºè®¾ä¸ºé«˜é˜»æ€æ¥é¿å…ä¸å…¶ä»–è®¾å¤‡çš„å†²çªã€‚<br>  ä¾‹å¦‚ï¼Œæ•°æ®æ€»çº¿ï¼ˆData Busï¼‰å¯èƒ½ç”±å¤šä¸ªè®¾å¤‡å…±äº«ã€‚å½“ä¸€ä¸ªè®¾å¤‡ä¸åœ¨å‘é€æ•°æ®æ—¶ï¼Œå®ƒä¼šå°†å…¶ inout å¼•è„šè®¾ä¸ºé«˜é˜»æ€ï¼Œç¡®ä¿åªæœ‰å‘é€è®¾å¤‡å½±å“æ€»çº¿ä¿¡å·ã€‚</p><p>  å·¥ä½œåŸç†</p><p>  è¾“å‡ºæ¨¡å¼ï¼š</p><p>  å½“inout å¼•è„šä½œä¸ºè¾“å‡ºæ—¶ï¼Œç›¸å…³çš„ä¸‰æ€ç¼“å†²å™¨è¿æ¥åˆ°è¯¥å¼•è„šï¼Œå¹¶é©±åŠ¨ç”µå¹³ï¼ˆé«˜æˆ–ä½ï¼‰ã€‚æ­¤æ—¶ï¼Œæ§åˆ¶ä¿¡å·å°†å¼•è„šè®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼ï¼Œå¹¶ä¸”å…¶ä»–è¿æ¥åˆ°è¯¥å¼•è„šçš„ç”µè·¯ä¼šå¤„äºæ–­å¼€çŠ¶æ€ã€‚</p><p>  è¾“å…¥æ¨¡å¼ï¼š</p><p>  å½“ inout å¼•è„šä½œä¸ºè¾“å…¥æ—¶ï¼Œç¼“å†²å™¨è¿›å…¥é«˜é˜»æ€ï¼ˆHi-Zï¼‰ï¼Œå³å¼•è„šçš„çŠ¶æ€ä¸å†ç”±è¾“å‡ºé€»è¾‘é©±åŠ¨ï¼Œè½¬è€Œæ¥æ”¶å¤–éƒ¨ä¿¡å·ã€‚æ­¤æ—¶ï¼Œåªæœ‰è¿æ¥åˆ°å¼•è„šçš„å…¶ä»–è®¾å¤‡ä¼šé©±åŠ¨è¯¥å¼•è„šçš„ç”µå¹³ã€‚<br>  é«˜é˜»æ€ï¼š</p><p>  å½“å¼•è„šä¸éœ€è¦è¾“å‡ºæ•°æ®æ—¶ï¼Œä¸‰æ€ç¼“å†²å™¨å°†è¿›å…¥ é«˜é˜»æ€ï¼Œä½¿è¯¥å¼•è„šå¯¹å…¶ä»–ç”µè·¯æ²¡æœ‰å½±å“ã€‚è¿™æ ·ï¼Œå¤šä¸ªè®¾å¤‡å°±å¯ä»¥å…±äº«åŒä¸€ä¸ªå¼•è„šæˆ–æ€»çº¿è€Œä¸ä¼šå‘ç”Ÿç”µå¹³å†²çªã€‚<br>  åº”ç”¨ç¤ºä¾‹<br>  åŒå‘æ•°æ®æ€»çº¿ï¼š</p><p>  å‡è®¾æœ‰å¤šä¸ªè®¾å¤‡å…±äº«ä¸€æ¡æ•°æ®æ€»çº¿ã€‚æ¯ä¸ªè®¾å¤‡çš„ inout å¼•è„šå¯ä»¥ä½œä¸ºæ•°æ®çš„è¾“å…¥ç«¯æˆ–è¾“å‡ºç«¯ã€‚åœ¨æŸä¸ªæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªè®¾å¤‡å‘æ€»çº¿å‘é€æ•°æ®ï¼Œå…¶ä»–è®¾å¤‡åˆ™å°†å…¶å¼•è„šè®¾ä¸ºé«˜é˜»æ€ï¼Œé¿å…å¹²æ‰°ã€‚<br>  åŒå‘ä¿¡å·ä¼ è¾“ï¼š</p><p>  åœ¨é€šä¿¡åè®®ä¸­ï¼Œinout å¼•è„šå¯ç”¨äºåŒå‘ä¿¡å·ä¼ è¾“ã€‚ä¾‹å¦‚ï¼ŒIÂ²Cæ€»çº¿å°±ä½¿ç”¨ inout å¼•è„šï¼Œå…¶ä¸­ä¸€ä¸ªè®¾å¤‡åœ¨æŸä¸ªæ—¶åˆ»å‘é€ä¿¡å·ï¼Œè€Œå¦ä¸€ä¸ªè®¾å¤‡åˆ™æ¥æ”¶ä¿¡å·ã€‚<br>  èŠ¯ç‰‡é—´é€šä¿¡ï¼š</p><p>  åœ¨å¤šèŠ¯ç‰‡ç³»ç»Ÿä¸­ï¼Œinout å¼•è„šå¯ç”¨äºèŠ¯ç‰‡ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œå…è®¸ä¸åŒèŠ¯ç‰‡åœ¨ä¸åŒæ—¶åˆ»æ§åˆ¶åŒä¸€å¼•è„šçš„è¾“å…¥å’Œè¾“å‡ºè¡Œä¸ºã€‚<br>  æ€»ç»“<br>  inout å¼•è„šé€šè¿‡ä¸‰æ€ç¼“å†²å™¨å’Œæ§åˆ¶ä¿¡å·çš„ç»„åˆï¼Œå®ç°äº†åŒä¸€å¼•è„šå¯ä»¥åœ¨è¾“å…¥å’Œè¾“å‡ºä¹‹é—´åˆ‡æ¢çš„åŠŸèƒ½ã€‚é€šè¿‡å°†è¾“å‡ºç½®äºé«˜é˜»æ€ï¼Œå¯ä»¥ä½¿å¾—è¯¥å¼•è„šä¸ä¼šå¹²æ‰°å…¶ä»–ç”µè·¯æˆ–è®¾å¤‡ï¼Œä½¿å…¶é€‚ç”¨äºæ€»çº¿ç³»ç»Ÿæˆ–åŒå‘é€šä¿¡çš„è®¾è®¡ä¸­ã€‚</p></li><li><p>xæ€çš„å«ä¹‰æ˜¯æœªçŸ¥æ€ã€‚</p><p>  æœ‰4ç§æƒ…å†µä¼šäº§ç”ŸæœªçŸ¥æ€ï¼š</p><ul><li>å…¶ä¸€æ˜¯èŠ¯ç‰‡å·²ä¸Šç”µä½†å¤ä½ä¿¡å·æœªè¿›è¡Œå¤ä½çš„æƒ…å†µï¼›</li><li>å…¶äºŒæ˜¯åŒå‘å¼•è„šä¿¡å·å†²çªï¼Œå› ä¸ºæ²¡æ§åˆ¶å¥½ï¼Œå¯¼è‡´æœ‰ä¸€è·¯ä¿¡å·é€šè¿‡å¼•è„šè¾“å…¥ï¼Œå¦ä¸€è·¯ä¿¡å·é€šè¿‡ç›¸åŒçš„å¼•è„šè¾“å‡ºï¼›</li><li>å…¶ä¸‰æ˜¯èŠ¯ç‰‡ä¸­ä¸€ä¸ªå…ƒå™¨ä»¶çš„æŸä¸ªè¾“å…¥ç«¯ä¸ºxæ€ï¼Œäºæ˜¯è¾“å‡ºå°±è·Ÿç€å˜æˆäº†xæ€ï¼Œè¿™å°±æ˜¯æ‰€è°“xæ€çš„ä¼ æ’­ï¼›</li><li>ç¬¬å››æ˜¯è§¦å‘å™¨çš„æ—¶åºä¸æ»¡è¶³ï¼Œäº§ç”Ÿäº†äºšç¨³æ€ï¼Œä»è€Œè¡¨ç¤ºä¸ºxæ€ã€‚</li></ul><p>  ä¸Šè¿°4ç§æƒ…å†µåœ¨ä»¿çœŸä¸­éƒ½èƒ½çœ‹åˆ°ï¼Œä½†å®é™…ä¸­ï¼Œç¬¬1ç§æƒ…å†µåŸºæœ¬ä¸ä¼šå‡ºç°ï¼Œé™¤éæ¨¡æ‹Ÿç”µè·¯è®¾è®¡æœ‰è¯¯ï¼Œå…¶ä»–3ç§åœ¨æ•°å­—è®¾è®¡æœ‰ç¼ºé™·æ—¶ä¼šå‡ºç°ï¼Œå®é™…åœ¨æµ‹é‡å…¶ç”µå‹æ—¶ä¼šå‡ºç°ä¸ç¨³å®šæˆ–éé¢„æœŸçš„é—®é¢˜ã€‚åœ¨å¯ç»¼åˆçš„Verilogä¸­ï¼Œä¸ä¼šå‡ºç°1â€™bxæ•°å€¼ï¼Œå› ä¸ºæ²¡æœ‰ä¸€ä¸ªè®¾è®¡ä¼šæ•…æ„å°†ä¸€ä¸ªé”™è¯¯å¼•å…¥RTLä¸­ï¼Œæ‰€æœ‰çš„é”™è¯¯éƒ½æ˜¯æ„å¤–å‘ç”Ÿçš„ã€‚è¯¥ç¬¦å·åœ¨ä»¿çœŸè„šæœ¬å’Œä»¿çœŸæ³¢å½¢ä¸­å¯èƒ½å‡ºç°ã€‚</p></li></ul><h2 id="ç”µå¹³ä¿¡å·ä¸è„‰å†²ä¿¡å·"><a href="#ç”µå¹³ä¿¡å·ä¸è„‰å†²ä¿¡å·" class="headerlink" title="ç”µå¹³ä¿¡å·ä¸è„‰å†²ä¿¡å·"></a>ç”µå¹³ä¿¡å·ä¸è„‰å†²ä¿¡å·</h2><p>ç”µå¹³ä¿¡å·ä¹Ÿå«Latchä¿¡å·ï¼Œå³ä¸€ä¸ªä¿¡å·æŒç»­å¤šä¸ªæ—¶é’Ÿå‘¨æœŸéƒ½ä¸€ç›´ä¿æŒä¸º1çš„ä¿¡å·ã€‚</p><p>è„‰å†²ä¿¡å·å°±æ˜¯åªæŒç»­ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸçš„ä¿¡å·ã€‚</p><p>å·¥ç¨‹å¸ˆåœ¨äº¤æµæ—¶ï¼Œå¯¹äºç”µå¹³ä¿¡å·aå¸¸ç”¨çš„è¯´æ³•æ˜¯â€œå°†aç»™Latchä½â€â€‹ï¼Œå¯¹äºè„‰å†²ä¿¡å·bå¸¸ç”¨çš„è¯´æ³•æ˜¯â€œæ‰“ä¸€ä¸ªè„‰å†²bâ€â€‹ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> IC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬1ç«  æ•°å­—ICè®¾è®¡æµç¨‹</title>
      <link href="/blog/2025/01/15/IC/1.%E6%95%B0%E5%AD%97IC%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B/"/>
      <url>/blog/2025/01/15/IC/1.%E6%95%B0%E5%AD%97IC%E8%AE%BE%E8%AE%A1%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‚è€ƒ"><a href="#1-å‚è€ƒ" class="headerlink" title="1. å‚è€ƒ"></a>1. å‚è€ƒ</h2><p>ç™½æ æ—¸. æ•°å­—ICè®¾è®¡å…¥é—¨ï¼ˆå¾®è¯¾è§†é¢‘ç‰ˆï¼‰[M]. åŒ—äº¬: æ¸…åå¤§å­¦å‡ºç‰ˆç¤¾ï¼Œ2023-09-01:ç¬¬1ç« .</p><h2 id="2-æ•°å­—ICè®¾è®¡æµç¨‹"><a href="#2-æ•°å­—ICè®¾è®¡æµç¨‹" class="headerlink" title="2. æ•°å­—ICè®¾è®¡æµç¨‹"></a>2. æ•°å­—ICè®¾è®¡æµç¨‹</h2><h3 id="2-1-ä¸‰ä¸ªä¸»è¦æµç¨‹ï¼š"><a href="#2-1-ä¸‰ä¸ªä¸»è¦æµç¨‹ï¼š" class="headerlink" title="2.1. ä¸‰ä¸ªä¸»è¦æµç¨‹ï¼š"></a>2.1. ä¸‰ä¸ªä¸»è¦æµç¨‹ï¼š</h3><ol><li><p>å‰ç«¯è®¾è®¡: ç”¨ Verilog ç¼–å†™ RTL è®¾è®¡æ–‡ä»¶ï¼ˆRegister Transfer Levelï¼ŒRTLï¼Œå¯„å­˜å™¨ä¼ è¾“å±‚ï¼‰ã€‚</p></li><li><p>ç»¼åˆï¼ˆSynthesisï¼‰ï¼šå°† RTL è½¬æ¢ä½å®é™…ç”µå­å…ƒå™¨ä»¶çš„è¿æ¥ã€‚è¾“å‡ºæ–‡ä»¶ç§°ä¸ºç½‘è¡¨ï¼ˆnetlistï¼‰ï¼Œä¹Ÿæ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ã€‚</p></li><li><p>åç«¯å¸ƒå±€å¸ƒçº¿ï¼ˆPRï¼‰ï¼šå°†ç½‘è¡¨å˜ä¸ºå®é™…ç”µè·¯å›¾ï¼Œç±»ä¼¼ PCB å›¾ï¼Œç§°ä¸ºç‰ˆå›¾ï¼ˆLayoutï¼‰ã€‚ç‰ˆå›¾æ˜¯æ™¶åœ†å‚ï¼ˆFoundryï¼‰èƒ½è¯†åˆ«çš„é€šç”¨æ ¼å¼ã€‚</p><p> ç‰ˆå›¾çš„ç»˜åˆ¶ï¼š</p><ul><li>å¸ƒå±€ï¼ˆPlaceï¼‰ï¼šå…ƒå™¨ä»¶å¦‚ä½•æ‘†æ”¾ï¼›</li><li>å¸ƒçº¿ï¼ˆRouteï¼‰ï¼šå…ƒå™¨ä»¶å¦‚ä½•è¿æ¥ã€‚</li></ul><p> æ•°å­—ç‰ˆå›¾çš„ç»˜åˆ¶å¤§éƒ¨åˆ†ç”±è®¡ç®—æœºè‡ªåŠ¨å®Œæˆï¼Œç§°ä¸ºè‡ªåŠ¨å¸ƒå±€å¸ƒçº¿ï¼ˆAutomatic Place and Routeï¼ŒAPRï¼‰ï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿç§°ä¸º PR ã€‚</p><p> æµç‰‡ï¼ˆTapeOutï¼‰ï¼šFoundry æ ¹æ®ç‰ˆå›¾åˆ¶é€ èŠ¯ç‰‡ã€‚</p></li></ol><h3 id="2-2-éªŒæ”¶å’ŒéªŒè¯ï¼ˆSignOffï¼‰ï¼š"><a href="#2-2-éªŒæ”¶å’ŒéªŒè¯ï¼ˆSignOffï¼‰ï¼š" class="headerlink" title="2.2. éªŒæ”¶å’ŒéªŒè¯ï¼ˆSignOffï¼‰ï¼š"></a>2.2. éªŒæ”¶å’ŒéªŒè¯ï¼ˆSignOffï¼‰ï¼š</h3><p>å¯¹è´¨é‡è¿›è¡ŒæŠŠæ§å’Œæœ€ç»ˆéªŒæ”¶ã€‚</p><p>å‰ä»¿çœŸï¼šæ£€æŸ¥ RTL è®¾è®¡æ–‡ä»¶ï¼›ç”¨æµ‹è¯•å¹³å°ï¼ˆTestbenchï¼‰æ–‡ä»¶å¯¹å®é™…åº”ç”¨ç¯å¢ƒä»¿çœŸã€‚è¿™æ˜¯åœ¨ç‰ˆå›¾æˆå‹ä¹‹å‰ï¼Œç§°ä¸ºå‰ä»¿ã€‚ä¸€æ—¦å‘ç°é”™è¯¯ï¼ŒéªŒè¯äººå‘˜ä¼šåé¦ˆç»™è®¾è®¡è€…ä¿®æ”¹ï¼Œå¦‚æ­¤åå¤è¿­ä»£ï¼Œç›´è‡³äº¤ä»˜åˆ°ç»¼åˆé˜¶æ®µçš„ RTL æ–‡ä»¶éƒ½æ˜¯åˆæ ¼çš„ã€‚</p><p>SignOff æ£€æŸ¥ï¼šæ£€æŸ¥ç‰ˆå›¾è®¾è®¡ï¼›å¯¹æ—¶åºå’ŒåŠŸè€—æ£€æŸ¥ã€‚å¦‚æœæ£€æŸ¥ä¸è¿‡ï¼Œé¦–å…ˆæ˜¯æ•°å­—åç«¯å·¥ç¨‹å¸ˆè‡ªå·±åŠªåŠ›ï¼Œé‡æ–°ç»˜åˆ¶ç‰ˆå›¾æˆ–å¾®è°ƒå…ƒå™¨ä»¶ä½ç½®ï¼Œè‹¥æ— æ³•è¾¾åˆ°ç›®çš„ï¼Œå†ä¿®æ”¹ç»¼åˆç­–ç•¥ï¼Œé‡æ–°ç»¼åˆã€‚è‹¥ä»æ— æ³•è¾¾åˆ°ç›®çš„ï¼Œåˆ™åé¦ˆåˆ°å‰ç«¯ IC è®¾è®¡ï¼Œåœ¨ RTL ä¸Šè°ƒæ•´ã€‚</p><p>åä»¿çœŸï¼šåœ¨ SignOff åˆæ ¼åï¼Œéœ€è¦å°†ç½‘è¡¨å’Œå»¶è¿Ÿä¿¡æ¯æäº¤ç»™éªŒè¯äººå‘˜ï¼Œè¿›è¡Œåä»¿ã€‚å¯¹æˆå‹ç‰ˆå›¾çš„æ—¶åºè¿›è¡Œæœ€åéªŒè¯å’ŒéªŒæ”¶ã€‚åä»¿å°±æ˜¯ç‰ˆå›¾æˆå‹ä¹‹åçš„ä»¿çœŸã€‚</p><h3 id="2-3-å¯æµ‹æ€§è®¾è®¡ï¼ˆDesign-For-Testï¼ŒDFTï¼‰"><a href="#2-3-å¯æµ‹æ€§è®¾è®¡ï¼ˆDesign-For-Testï¼ŒDFTï¼‰" class="headerlink" title="2.3. å¯æµ‹æ€§è®¾è®¡ï¼ˆDesign For Testï¼ŒDFTï¼‰"></a>2.3. å¯æµ‹æ€§è®¾è®¡ï¼ˆDesign For Testï¼ŒDFTï¼‰</h3><p>ä¸€ä¸ªé™„å±å·¥åºï¼ŒåŸç†æ˜¯åœ¨èŠ¯ç‰‡ä¸­åŠ å…¥ä¸ä¸»è¦åŠŸèƒ½æ— å…³çš„é™„å±ç”µè·¯ï¼Œç”¨äºåœ¨èŠ¯ç‰‡çš„ç”Ÿäº§è¿‡ç¨‹ä¸­ä½¿ç”¨ TestBench å¿«é€Ÿåˆ¤æ–­èŠ¯ç‰‡åŠŸèƒ½çš„å®Œå¥½è¡Œã€å†…éƒ¨ç»“æ„çš„æ­£å¸¸æ€§ã€‚</p><p>å¦‚æœèŠ¯ç‰‡ä¸­åŒ…å« DFT ç”µè·¯ï¼Œåˆ™ TestBench å¯ä»¥å‘èŠ¯ç‰‡çš„æŸäº›å¼•è„šå‘é€äº‹å…ˆå‡†å¤‡å¥½çš„æµ‹è¯•å‘é‡ï¼Œåœ¨èŠ¯ç‰‡çš„å¦ä¸€äº›å¼•è„šä¸Šé‡‡æ ·èŠ¯ç‰‡å¯¹æµ‹è¯•å‘é‡çš„ååº”ã€‚å°†äº‹å…ˆå‡†å¤‡å¥½çš„é¢„æœŸæ•ˆæœä¸å®é™…é‡‡æ ·åˆ°çš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œä»è€Œåˆ¤æ–­å†…éƒ¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p><p>DFT åŠŸèƒ½ä¹Ÿå¸¸å¸¸è¢«ç§°ä¸ºæ‰«æï¼ˆScanï¼‰ï¼Œå³ç”¨ TestBench æ‰«æèŠ¯ç‰‡å†…éƒ¨ä¹‹æ„ã€‚DFT çš„æ£€æŸ¥å¯¹è±¡æ˜¯ç”Ÿäº§å·®é”™é€ æˆçš„èŠ¯ç‰‡æŸåï¼Œå®ƒä¸èƒ½æ£€æŸ¥è®¾è®¡é—®é¢˜ã€‚è®¾è®¡é—®é¢˜åº”è¯¥äº¤ç»™éªŒè¯å·¥åºã€‚</p><p>DFT å¯¹èŠ¯ç‰‡æ¥è¯´ä¸æ˜¯å¿…éœ€çš„ï¼Œä¸€äº›ä½æˆæœ¬çš„èŠ¯ç‰‡æ²¡æœ‰æ’å…¥ DFT ç”µè·¯ï¼Œåœ¨è®¾è®¡æµç¨‹ä¸­ï¼Œç›´æ¥ä»ç”µè·¯ç»¼åˆè¿‡æ¸¡åˆ°åç«¯è®¾è®¡ã€‚</p><h3 id="2-4-å‰ç«¯è®¾è®¡-VS-åç«¯è®¾è®¡"><a href="#2-4-å‰ç«¯è®¾è®¡-VS-åç«¯è®¾è®¡" class="headerlink" title="2.4. å‰ç«¯è®¾è®¡ VS åç«¯è®¾è®¡"></a>2.4. å‰ç«¯è®¾è®¡ VS åç«¯è®¾è®¡</h3><ul><li>å‰ç«¯è®¾è®¡ï¼šæŠ½è±¡ç”µè·¯ï¼Œåªæè¿°åŠŸèƒ½ï¼Œä¸æ˜¯å…·ä½“ç”µè·¯ã€‚</li><li>åç«¯è®¾è®¡ï¼šå…·ä½“ç”µè·¯ï¼Œä¸ä»…è¦çŸ¥é“å“ªäº›å…ƒå™¨ä»¶ï¼Œè¿˜è¦ç¡®è®¤è¿™äº›å…ƒå™¨ä»¶çš„æ‘†æ”¾ä½ç½®ã€‚</li></ul><p>ç»¼åˆæ˜¯å‰ç«¯å’Œåç«¯çš„åˆ†ç•Œçº¿ï¼Œç»¼åˆä¹‹å‰æ²¡æœ‰å…ƒå™¨ä»¶è€Œåªæœ‰åŠŸèƒ½ï¼›ç»¼åˆä¹‹åï¼Œè®¾è®¡æ‰æœ‰äº†å…·ä½“åŒ–çš„å…ƒå™¨ä»¶ã€‚</p><p>å½“ç„¶ï¼Œå‰ç«¯å·¥ç¨‹å¸ˆå¾€å¾€å¼ºè°ƒå¿ƒä¸­æœ‰ç”µè·¯ï¼Œå¹¶éå®é™…ç”µè·¯ï¼Œè€Œæ˜¯å¿ƒä¸­æœ‰åŠŸèƒ½ç›¸ä¼¼çš„æ¦‚å¿µæ€§ç”µè·¯ã€‚è¿™æ ·å¯ä»¥è®¤æ¸…è®¾è®¡æ¶æ„ï¼Œå¹¶é¿å…æ½œåœ¨çš„è®¾è®¡éšæ‚£ã€‚</p><h2 id="3-æ¨¡æ‹ŸICè®¾è®¡æµç¨‹"><a href="#3-æ¨¡æ‹ŸICè®¾è®¡æµç¨‹" class="headerlink" title="3. æ¨¡æ‹ŸICè®¾è®¡æµç¨‹"></a>3. æ¨¡æ‹ŸICè®¾è®¡æµç¨‹</h2><ol><li><p>ç»˜åˆ¶åŸç†å›¾ï¼ˆSchematicï¼‰</p><p> æ‰‹åŠ¨ç»˜åˆ¶ã€‚</p></li><li><p>åŸç†å›¾ä»¿çœŸ</p><p> ä¸€èˆ¬ç”±åŸç†å›¾è®¾è®¡è€…äº²è‡ªå®Œæˆã€‚åŸå› æ˜¯æ¨¡æ‹Ÿç”µè·¯çš„è®¾è®¡å‚æ•°é€‰æ‹©èŒƒå›´å®½æ³›ï¼Œéœ€è¦éªŒè¯çš„åœºæ™¯ä¹Ÿå¤æ‚ï¼Œä»¿çœŸéªŒæ”¶æ ‡å‡†ä¸ååˆ†æ˜ç¡®ã€‚è¿™å°±éœ€è¦è®¾è®¡è€…æ­å»ºå…³é”®çš„åº”ç”¨ç¯å¢ƒå’Œåœºæ™¯ï¼Œå¯¹ç”µè·¯ä¸Šäº§ç”Ÿçš„ååº”åšå‡ºåˆ¤æ–­ï¼Œéšæ—¶è°ƒæ•´ç”µè·¯ç»“æ„å’Œå‚æ•°ã€‚</p></li><li><p>ç»˜åˆ¶ç‰ˆå›¾ï¼ˆæ ¹æ®åŸç†å›¾ï¼‰</p><p> æ‰‹åŠ¨ç»˜åˆ¶ã€‚</p><p> æ¨¡æ‹Ÿç‰ˆå›¾å·¥ç¨‹å¸ˆå’Œæ¨¡æ‹ŸICè®¾è®¡å¸ˆä¸€èˆ¬æ˜¯åˆ†å¼€çš„ä¸¤ä¸ªèŒä¸šã€‚</p><p> æ¨¡æ‹ŸICè®¾è®¡å¸ˆä¸€èˆ¬ä¹Ÿéƒ½æŒæ¡ä¸€äº›ç»˜åˆ¶ç‰ˆå›¾çš„æ–¹æ³•ï¼Œå•ç†Ÿç»ƒç¨‹åº¦ä»¥åŠå¯¹ä¸€äº›ç‰©ç†é—®é¢˜çš„å¤„ç†æ–¹é¢ï¼Œéœ€è¦æ±‚åŠ©ä¸“ä¸šçš„ç‰ˆå›¾å·¥ç¨‹å¸ˆã€‚</p><p> æ¨¡æ‹Ÿç‰ˆå›¾å·¥ç¨‹å¸ˆå¯ä»¥æ ¹æ®åŸç†å›¾åŠé€šç”¨çš„ç»˜å›¾è§„åˆ™ç›´æ¥ç»˜åˆ¶ã€‚ä½†æ˜¯å¯¹è¯¸å¦‚ç¤¾è¯„ç”µè·¯åŠé«˜åŠŸç‡ç®¡ä¹‹ç±»æœ‰ç€ç‰¹æ®Šè¦æ±‚çš„è®¾è®¡ï¼Œç‰ˆå›¾å·¥ç¨‹å¸ˆéœ€è¦ä¸æ¨¡æ‹ŸICè®¾è®¡å¸ˆè¿›è¡Œå……åˆ†æ²Ÿé€šï¼Œåœ¨æ¨¡æ‹ŸICè®¾è®¡å¸ˆçš„ååŠ©ä¸‹è¿›è¡Œç»˜åˆ¶ã€‚</p></li><li><p>æŠ½å–å¯„ç”Ÿå‚æ•°</p></li><li><p>ç‰ˆå›¾åä»¿</p></li><li><p>è®¾è®¡è§„åˆ™æ£€æŸ¥ï¼ˆDesign Rule Checkï¼ŒDRCï¼‰</p></li><li><p>ç‰ˆå›¾å’ŒåŸç†å›¾çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆLayout Versus Schematicsï¼ŒLVSï¼‰</p></li><li><p>æµç‰‡</p></li></ol><p>æ¨¡æ‹ŸICè®¾è®¡æ²¡æœ‰é‚£ä¹ˆå¤šè‡ªåŠ¨åŒ–æˆåˆ†ï¼Œéœ€è¦æ‰‹åŠ¨ç»˜åˆ¶åŸç†å›¾ã€ç‰ˆå›¾ï¼Œç”µé˜»ã€ç”µå®¹ç­‰å…ƒå™¨ä»¶éœ€è¦äººå·¥ç¡®å®šã€‚</p><p>æ¨¡æ‹ŸICä»¿çœŸï¼Œæ— æ³•åƒæ•°å­—ICé‚£æ ·é€šè¿‡ä»¿çœŸéªŒè¯å’ŒFPGAéªŒè¯ä¸¤ç§æ–¹æ³•æ¥ç›¸äº’å°è¯è®¾è®¡æ•ˆæœã€‚æ¨¡æ‹Ÿä»¿çœŸé€Ÿåº¦æ…¢ã€æƒ…å†µå¤šï¼Œå¾ˆéš¾è¦†ç›–çœŸæ˜¯ä½¿ç”¨ä¸­å¯èƒ½é‡åˆ°çš„å…¨éƒ¨æƒ…å†µï¼Œå› æ­¤ï¼Œæ¨¡æ‹Ÿè®¾è®¡å…·æœ‰å¾ˆé«˜çš„ä¸ç¡®å®šï¼ŒèŠ¯ç‰‡çš„å®é™…æ•ˆæœä¸ä»¿çœŸç»“æœå­˜åœ¨æ˜æ˜¾å·®è·æ˜¯ç»å¸¸å‘ç”Ÿçš„ã€‚</p><p>ä½†æ˜¯æ¨¡æ‹Ÿç”µè·¯ä¹Ÿæœ‰ä¸€äº›æ— æ³•è¢«æ•°å­—ç”µè·¯å–ä»£çš„ç‰¹æ€§ã€‚</p><p>å¯ä»¥æƒ³è±¡ï¼Œæ•°å­—ç”µè·¯åªéœ€è¦å¤„ç† 0 å’Œ 1 ä¸¤ç§ä¿¡å·ï¼Œä½†æ˜¯æ¨¡æ‹Ÿç”µè·¯çš„æ•°å€¼åŸŸæ˜¯å®æ•°åŸŸï¼ŒåŒ…æ‹¬æ‰€æœ‰è¿ç»­çš„æ•´æ•°ã€æµ®ç‚¹æ•°ã€æ­£è´Ÿæ•°ï¼Œæ•°æ®æœ‰æ— ç©·ä¸ªã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯å¾ˆå°çš„ç”µè·¯ï¼Œå…ƒå™¨ä»¶æ•°é‡ä¸å¤šï¼Œä¹Ÿéœ€è¦è®¾è®¡è€…å’Œä»¿çœŸè€…ä»æ•°å€¼åŸŸä¸­æŒ‘é€‰ä¸€éƒ¨ä»½å€¼ä½œä¸ºè®¾è®¡å’Œä»¿çœŸä¸­ç”¨åˆ°çš„å€¼ï¼Œç»å¯¹ä¸å¯èƒ½è¦†ç›–æ‰€æœ‰æƒ…å†µã€‚</p><h2 id="4-èŠ¯ç‰‡æ•´ä½“è§„åˆ’"><a href="#4-èŠ¯ç‰‡æ•´ä½“è§„åˆ’" class="headerlink" title="4. èŠ¯ç‰‡æ•´ä½“è§„åˆ’"></a>4. èŠ¯ç‰‡æ•´ä½“è§„åˆ’</h2><p>ç‰ˆå›¾å¸ƒå±€è§„åˆ’ï¼ˆFloorPlanï¼‰ï¼šå°†èŠ¯ç‰‡æ•´ä½“è§„åˆ’ï¼Œä»¥åŠå†…éƒ¨æ•°å­—ã€æ¨¡æ‹Ÿç”µè·¯çš„ä½ç½®ã€é¢ç§¯ã€å½¢çŠ¶ç­‰ç‰¹å¾çš„è§„åˆ’ã€‚</p><figure style="text-align:center;"><img TODO width="50%"/><figcaption>FloorPlanç¤ºä¾‹</figcaption></figure><ul><li>Pad: FloorPlançš„å‘¨å›´æ˜¯èŠ¯ç‰‡å¼•è„š(Pad)ã€‚Padå®é™…æŒ‡çš„æ˜¯èŠ¯ç‰‡å¼•è„šä¹‹å¤–çš„ä¸€å—é‡‘å±ã€‚</li><li>IO: åŒ…æ‹¬Padå’Œå†…éƒ¨é€»è¾‘åœ¨å†…çš„æ•´ä¸ªå¼•è„šè®¾è®¡ã€‚</li></ul><p>ä¸€ä¸ªå®Œæ•´çš„å¼•è„šè®¾è®¡å¦‚å›¾ï¼š</p><img src="https://i.postimg.cc/MKfPd9z4/20250116222905.jpg" alt="20250116222905" width="50%"/><ul><li>å°è£…: èŠ¯ç‰‡å¤–é¢çš„å¡‘æ–™å£³å­ç§°ä¸ºèŠ¯ç‰‡çš„å°è£…ï¼Œå¤§ä½“åˆ†ä¸ºä¸¤ç§ï¼šæ’é’ˆå¼ï¼ˆå¼•è„šå¦‚é’ˆï¼‰ã€è¡¨è´´å¼ï¼ˆå¼•è„šæ‰å¹³ï¼‰ã€‚</li></ul><h2 id="5-ICè®¾è®¡å·¥å…·"><a href="#5-ICè®¾è®¡å·¥å…·" class="headerlink" title="5. ICè®¾è®¡å·¥å…·"></a>5. ICè®¾è®¡å·¥å…·</h2><p>EDA å…¬å¸ï¼šç”µå­è®¾è®¡è‡ªåŠ¨åŒ–ï¼ˆElectronic Design Automationï¼‰å…¬å¸ï¼Œç²—ç•¥æ¥è¯´ï¼Œæ•°å­—è®¾è®¡å¸¸ç”¨ Synopsys ï¼Œæ¨¡æ‹Ÿè®¾è®¡å¸¸ç”¨ Cadence ï¼Œ Mentor åœ¨ä¸€äº›ç»†åˆ†é¢†åŸŸæœ‰ä¼˜åŠ¿ã€‚</p><table><thead><tr><th>æ•°å­—&#x2F;æ¨¡å—</th><th>æ•°å­—æµç¨‹</th><th>å¸¸ç”¨è½¯ä»¶</th><th>å…¶ä»–è½¯ä»¶</th></tr></thead><tbody><tr><td>æ•°å­—</td><td>RTL ç¼–å†™</td><td>Vim&#x2F;Gvim</td><td>æ™®é€šæ–‡æœ¬ç¼–è¾‘å™¨</td></tr><tr><td>æ•°å­—</td><td>ä»¿çœŸ</td><td>VCS (Synopsys)</td><td>Incisive (Cadence)</td></tr><tr><td>æ•°å­—</td><td>çœ‹æ³¢å½¢</td><td>Verdi (Synopsys)</td><td>DVE (Synopsys)</td></tr><tr><td>æ•°å­—</td><td>è®¾è®¡æ£€æŸ¥</td><td>Spyglass (Synopsys)</td><td>Simvision (Cadence)</td></tr><tr><td>æ•°å­—</td><td>ç»¼åˆ</td><td>DC (Synopsys)</td><td>ModelSim (Mentor)</td></tr><tr><td>æ•°å­—</td><td>æ—¶åºä»¿çœŸ</td><td>PT (Synopsys)</td><td>nLint (Cadence)</td></tr><tr><td>æ•°å­—</td><td>è‡ªåŠ¨å¸ƒå±€å¸ƒçº¿</td><td>ICC2 (Synopsys)</td><td>Genus (Cadence)</td></tr><tr><td>æ•°å­—</td><td>è®¾è®¡ç‰ˆå›¾å½¢å¼éªŒè¯</td><td>Formality (Synopsys)</td><td>Tempus (Cadence)</td></tr><tr><td>æ•°å­—</td><td>æå–å¯„ç”Ÿå‚æ•°</td><td>StarRC (Synopsys)</td><td></td></tr><tr><td>æ¨¡æ‹Ÿ</td><td>åŸç†å›¾&#x2F;ç‰ˆå›¾&#x2F;ä»¿çœŸç­‰</td><td>Virtuoso (Cadence)</td><td>Calibre (Mentor)</td></tr><tr><td>æ¨¡æ‹Ÿ</td><td>å¯„ç”Ÿæå–&#x2F;DRC&#x2F;LVS</td><td>Calibre (Mentor)</td><td></td></tr></tbody></table><p>ä»¿çœŸåŠ é€Ÿå™¨ï¼š <strong>Palladium</strong> (Cadence) ã€ <strong>ZeBu</strong> (Synopsys) ã€‚</p><h3 id="5-1-æ•°å­—ICè®¾è®¡å·¥å…·"><a href="#5-1-æ•°å­—ICè®¾è®¡å·¥å…·" class="headerlink" title="5.1. æ•°å­—ICè®¾è®¡å·¥å…·"></a>5.1. æ•°å­—ICè®¾è®¡å·¥å…·</h3><p>RTL ä»¿çœŸå·¥å…·ï¼šæœ‰ Synopsys çš„ VCS ï¼ŒCadence çš„ Incisive ï¼ˆä¹Ÿå« irun ï¼‰ã€‚è¿™äº›å·¥å…·å¯ä»¥èƒœä»»å‰ä»¿ã€åä»¿ã€UVM æ¶æ„ï¼ˆUniversal Verification Methodologyï¼Œé€šç”¨éªŒè¯æ–¹æ³•å­¦ï¼‰çš„ä»¿çœŸã€‚Cadence çš„ irun ä¸æ¨¡æ‹Ÿè®¾è®¡å·¥å…· Virtuoso å·¥å…·ä¸­é›†æˆçš„ AMS ä»¿çœŸå·¥å…·ç›¸ç»“åˆï¼Œæ”¯æŒæ•°å­—æ¨¡æ‹Ÿç”µè·¯æ··åˆä»¿çœŸã€‚</p><p>æ³¢å½¢æŸ¥çœ‹å·¥å…·ï¼šä¸€èˆ¬é›†æˆåœ¨ä»¿çœŸå·¥å…·ä¸­ã€‚VCS çš„æ³¢å½¢è½¯ä»¶å« DVE ï¼Œ Incisive çš„æ³¢å½¢è½¯ä»¶å« SimVision ã€‚ä½†åœ¨è¿™ä¸ªé¢†åŸŸï¼Œä¸€å®¶åä¸º Novas çš„å…¬å¸çš„è½¯ä»¶ï¼Œä»¥å…¶æ˜å¿«çš„ç•Œé¢ã€æ–¹ä¾¿çš„åŠŸèƒ½ã€å¿«æ·çš„æ“ä½œï¼Œå¼‚å†›çªèµ·ï¼Œå¾—åˆ°äº†å¹¿æ³›çš„è®¤å¯ï¼Œå®ƒå°±æ˜¯ Verdi ï¼ˆä»¥éŸ³ä¹å®¶å¨å°”ç¬¬çš„åå­—å‘½åï¼Œå‰èº«å« Debussy ï¼Œä»¥éŸ³ä¹å®¶å¾·å½ªè¥¿çš„åå­—å‘½åï¼‰ã€‚ Verdi ç°å·²è¢« Synopsys æ”¶è´­ã€‚ Mentor çš„ä»¿çœŸå’Œçœ‹æ³¢å½¢è½¯ä»¶å« ModelSim ï¼Œä¸»è¦ç”¨äº FPGA åŠŸèƒ½çš„ä»¿çœŸã€‚</p><p>RTL è¯­æ³•æ£€æŸ¥å·¥å…·ï¼š Atrenta å…¬å¸çš„ Sypyglass ï¼Œå¯ä»¥æ£€æŸ¥è¯­æ³•ã€è·¨æ—¶é’ŸåŸŸå¤„ç†æ–¹æ¡ˆçš„å¯é æ€§ï¼Œç”šè‡³å¯ä»¥åœ¨å†…éƒ¨æ‰§è¡Œç»¼åˆã€åŠŸè€—è¯„ä¼°å’Œç®€å•çš„å¸ƒå±€å¸ƒçº¿ï¼Œä½¿å®ƒèƒ½å…¨æ–¹ä½åœ°ç»™å‡ºè®¾è®¡å»ºè®®ã€‚ç°å·²è¢« Synopsys æ”¶è´­ã€‚ Cadence çš„å¯¹åº”æ£€æŸ¥å·¥å…·æ˜¯ nLint ã€‚</p><p>ç»¼åˆå·¥å…·ï¼šå³å°† RTL è½¬åŒ–ä¸ºå®é™…ç”µè·¯çš„å·¥å…·ï¼Œå¸¸ç”¨çš„çš„æœ‰ Synopsys çš„ Design Compiler (DC) ï¼Œè¯¥å·¥å…·å†…éƒ¨è¿˜æœ‰ä¸€äº› Synopsys å¼€å‘çš„åº“ï¼Œèƒ½å¤Ÿå¸®åŠ©è®¾è®¡è€…å‡å°é¢ç§¯ï¼Œæé«˜æ€§èƒ½ï¼Œä¾‹å¦‚åŠ æ³•å™¨ã€ä¹˜æ³•å™¨ç­‰ï¼Œè¿™äº›è®¾è®¡å¥½çš„å­æ¨¡å—åœ¨ DC ä¸­è¢«ç§°ä¸º DesignWare (DW) ã€‚å¯ä»¥æ˜¯è®©å·¥å…·è‡ªåŠ¨ä» RTL ä¸­è¯†åˆ«å‡ºå¯ç”¨ DW æ›¿æ¢çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥æ˜¯è®¾è®¡è€…æ‰‹åŠ¨ä¾‹åŒ– DW æ¨¡å—ã€‚ Cadence ç›¸åº”çš„å·¥å…·å« Genus ï¼ˆåŸåå« RTL Compiler ï¼‰ã€‚</p><p>ç‰ˆå›¾è‡ªåŠ¨å¸ƒå±€å¸ƒçº¿è½¯ä»¶ï¼š Synopsys æœ‰ ICC2 ï¼ˆæ—§ç‰ˆä¸º ICC ï¼‰ï¼Œ Cadence æœ‰ Innovus ï¼ˆåŸå Encounter ï¼‰ï¼Œä¸¤ä¸ªè½¯ä»¶éƒ½è¢«å¹¿æ³›ä½¿ç”¨ã€‚ç”±äºä¸¤ä¸ªè½¯ä»¶çš„æ“ä½œå‘½ä»¤ä¸åŒï¼Œåç«¯å·¥ç¨‹å¸ˆå¾€å¾€åªæŒæ¡å…¶ä¸­ä¸€ç§ã€‚ Synopsys ä¸ºäº†å¢å¼ºå®¢æˆ·çš„é»æ€§ï¼Œå¼€å‘äº†ä¸€ä¸ªé“¶æ²³ï¼ˆ MilkyWay ï¼‰æµç¨‹ï¼Œä»å‰ç«¯åˆ°åç«¯ï¼Œé€šè¿‡ä¸“ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ (db) ä¼ è¾“ï¼Œå ç”¨ç©ºé—´å°ï¼Œå¤„ç†æ•ˆç‡é«˜ï¼Œä½†ä¹Ÿæœ‰è®¸å¤šå…¬å¸ä½¿ç”¨ DC ç»¼åˆï¼Œå†å°†ç½‘è¡¨å¯¼å…¥ Innovus è¿›è¡Œå¸ƒå±€å¸ƒçº¿ã€‚</p><p>SignOff å·¥å…·ï¼šå³å¯¹æ•´ä¸ªè®¾è®¡çš„æ—¶åºã€åŠŸè€—è¯„ä¼°ã€‚ Synopsys çš„ Prime Time (PT) ï¼Œ Cadence çš„ Tempus ã€‚ç›®å‰ï¼Œ PT å·²ç»ç§°ä¸ºä¸šå†… SignOff çš„æ ‡å‡†ã€‚å®é™…ä¸Šï¼Œæ—¶åºåˆ†æåœ¨ DC ä¸­ä¹Ÿèƒ½åšï¼Œä½†ä¸¤è€…åœ¨åˆ†ææ–¹æ³•ã€ç»†èŠ‚è€ƒè™‘å…¨é¢åº¦ã€åˆ†æé€Ÿåº¦ç­‰æ–¹é¢å­˜åœ¨å·®å¼‚ã€‚åœ¨ç»¼åˆæ—¶ä½¿ç”¨ DC æ£€æŸ¥ï¼Œè€Œåœ¨ SignOff æ—¶ï¼Œä½¿ç”¨ PT æ£€æŸ¥ã€‚</p><p>å½¢å¼éªŒè¯å·¥å…·ï¼šä¹Ÿç§°ä¸ºé€»è¾‘ç­‰æ•ˆè¡Œæ£€æŸ¥ï¼ˆ Logic Equivalece Check, LEC ï¼‰ï¼Œå°† RTL å’Œç½‘è¡¨è¿›è¡Œä¸€ä¸€å¯¹ç…§ã€‚å› ä¸ºä» RTL åˆ°ç»¼åˆç½‘è¡¨ï¼Œä»¥åŠä»ç»¼åˆç½‘è¡¨åˆ°åç«¯ç½‘è¡¨çš„è¿‡ç¨‹ï¼Œå¯èƒ½æ„å¤–åœ°æ”¹å˜åŸæœ‰åŠŸèƒ½å’Œè®¾è®¡æ„å›¾ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œæ£€æŸ¥ã€‚ Synopsys çš„å·¥å…·æ—¶ Formality ï¼Œ Candence çš„å·¥å…·æ˜¯ Conformal ã€‚</p><p>å¯„ç”Ÿå‚æ•°çš„æå–å·¥å…·ï¼šè¿›å…¥è®¾è®¡ç‰ˆå›¾é˜¶æ®µï¼Œå¯ä»¥ç¡®å®šèµ°çº¿çš„å»¶è¿Ÿã€‚è¯¥å€¼å—ä¿¡å·è´Ÿè½½ã€çº¿è·¯é•¿çŸ­ã€ç²—ç»†ã€å‘¨å›´çº¿è·¯ç­‰å¤šé‡å½±å“ï¼Œéœ€è¦ç”¨æ¨¡å‹å’ŒæŸ¥è¡¨è¿›è¡Œè®¡ç®—ï¼Œæ‰èƒ½å¾—åˆ°ç¡®åˆ‡çš„å€¼ã€‚è¯¥è¿‡ç¨‹ç§°ä¸ºå¯„ç”Ÿå‚æ•°çš„æå–ã€‚ä¸€èˆ¬ä½¿ç”¨ Synopsys çš„ StarRC ã€‚æå–å‡ºæ¥çš„ä¿¡æ¯å¯ç”¨äº PT è¿›è¡Œ SignOff ã€‚</p><p>ä¸Šè¿°å·¥å…·ï¼Œæœ€ä¸»è¦çš„æ§åˆ¶è¯­æ³•æ˜¯ TCL è¯­è¨€ï¼Œ EDA å·¥å…·å¤§å¤šä»¥è¯¥è¯­è¨€ä¸ºåŸºç¡€ï¼Œæ‰©å±•å‡ºå„ç§ä¸“ç”¨å‘½ä»¤ã€‚</p><p>é™¤äº†ä»¥ä¸Šæ•°å­—è®¾è®¡å·¥å…·ï¼Œè¿˜æœ‰ä¸€äº›æ›´åŠ ç»†åˆ†çš„å·¥å…·ç±»å‹ï¼Œæ¯”å¦‚ä»¿çœŸåŠ é€Ÿå™¨ï¼Œæœ‰ Cadence çš„ Palladium ã€ Synopsys çš„ ZeBu ã€‚</p><h3 id="5-2-æ¨¡æ‹ŸICè®¾è®¡å·¥å…·"><a href="#5-2-æ¨¡æ‹ŸICè®¾è®¡å·¥å…·" class="headerlink" title="5.2. æ¨¡æ‹ŸICè®¾è®¡å·¥å…·"></a>5.2. æ¨¡æ‹ŸICè®¾è®¡å·¥å…·</h3><p>ä¸»è¦æ˜¯ Cadence çš„ Virtuoso ã€‚ä¸æ•°å­—è®¾è®¡ä¸­ç¹å¤šçš„å·¥å…·ä¸åŒï¼Œ Virtuoso èƒ½æ»¡è¶³å¤§éƒ¨åˆ†è®¾è®¡éœ€æ±‚ï¼Œä¾‹å¦‚ç»˜åˆ¶å¹¶ä»¿çœŸåŸç†å›¾ã€ç»˜åˆ¶å¹¶ä»¿çœŸç‰ˆå›¾ã€æ•°æ¨¡æ··åˆä»¿çœŸç­‰ã€‚å®é™…ä¸Šï¼Œ Virtuoso æ›´åƒé›†æˆå¼€å‘ç¯å¢ƒï¼ˆ Integrated Development Environment, IDE ï¼‰ï¼Œå®ƒåŒ…å«å¾ˆå¤šç‹¬ç«‹çš„è®¾è®¡å·¥å…·ï¼Œå¦‚ä»¿çœŸå·¥å…· Spectre ç­‰ã€‚</p><p>SignOff å·¥å…·ï¼šMentor çš„ Calibre å¯ä»¥ç”¨æ¥æå–å¯„ç”Ÿå‚æ•°ã€è¿›è¡Œ DRC å’Œ LVS æ£€æŸ¥ã€‚</p><h3 id="5-3-èŒä½ã€åˆ†å·¥ä¸å·¥å…·"><a href="#5-3-èŒä½ã€åˆ†å·¥ä¸å·¥å…·" class="headerlink" title="5.3. èŒä½ã€åˆ†å·¥ä¸å·¥å…·"></a>5.3. èŒä½ã€åˆ†å·¥ä¸å·¥å…·</h3><table><thead><tr><th>å¤§èŒä½</th><th>ç»†åˆ†èŒä½</th><th>åŠŸèƒ½</th><th>å¸¸ç”¨å·¥å…·</th></tr></thead><tbody><tr><td>æ•°å­—</td><td>æ•°å­— IC è®¾è®¡</td><td>è®¾è®¡èŠ¯ç‰‡ä¸­çš„æ•°å­—ç”µè·¯</td><td>Vim, VCS, Verdi, Spyglass, DC ç­‰</td></tr><tr><td>æ•°å­—</td><td>æ•°å­— IC éªŒè¯</td><td>éªŒè¯èŠ¯ç‰‡ä¸­çš„æ•°å­—ç”µè·¯åŠŸèƒ½</td><td>VCS, Verdi ç­‰</td></tr><tr><td>æ•°å­—</td><td>æ•°å­— IC åç«¯</td><td>å°†æŠ½è±¡ç”µè·¯è½¬æ¢ä¸ºç‰ˆå›¾</td><td>ICC2, Innovus, Calibre, PT ç­‰</td></tr><tr><td>æ•°å­—</td><td>å…¶ä»–èŒä½, å¦‚ SignOff, DFT ç­‰</td><td>è´Ÿè´£åœ¨æ•°å­—ç”µè·¯ä¸­æ’å…¥ DFTã€å¯¹æœ€ç»ˆçš„ç‰ˆå›¾è¿›è¡Œæ—¶åºã€é¢ç§¯ã€åŠŸè€—çš„æ£€æŸ¥ç­‰</td><td>DC, PT, Formality ç­‰</td></tr><tr><td>æ¨¡æ‹Ÿ</td><td>æ¨¡æ‹Ÿ IC è®¾è®¡</td><td>è®¾è®¡èŠ¯ç‰‡ä¸­çš„æ¨¡æ‹Ÿç”µè·¯</td><td>Virtuoso ç­‰</td></tr><tr><td>æ¨¡æ‹Ÿ</td><td>æ¨¡æ‹Ÿç‰ˆå›¾</td><td>å°†ç”µè·¯åŸç†å›¾åšæˆç‰ˆå›¾</td><td>Virtuoso, Calibre ç­‰</td></tr><tr><td>è½¯ä»¶</td><td>åµŒå…¥å¼è½¯ä»¶å·¥ç¨‹å¸ˆ</td><td>(1) å‚ä¸èŠ¯ç‰‡å¼€å‘&#x2F;éªŒè¯ (2) å‚ä¸ SDK (3) å‚ä¸èŠ¯ç‰‡åº”ç”¨æ–¹æ¡ˆ</td><td>Keil, SourceInsight, Visual Studio ç­‰</td></tr><tr><td>è½¯ä»¶æ–¹æ¡ˆ</td><td>æµ‹è¯•å·¥ç¨‹å¸ˆ</td><td>(1) å¯¹èŠ¯ç‰‡è®¾è®¡æ€§èƒ½çš„æµ‹è¯• (2) èŠ¯ç‰‡é‡äº§æµ‹è¯•</td><td>å…¼ç”¨è½¯ä»¶å’Œç¡¬ä»¶å·¥å…·</td></tr><tr><td>ç¡¬æ–¹æ¡ˆ</td><td>åº”ç”¨å·¥ç¨‹å¸ˆ</td><td>åšç”µè·¯æ¿ï¼Œä¸ºèŠ¯ç‰‡æ‰¾åˆ°åˆé€‚çš„åº”ç”¨åœºæ™¯</td><td>Pads, Altium Designer, Cadence ç­‰</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ç®¡ç†</span><br><span class="line">â”œâ”€â”€ ç ”å‘</span><br><span class="line">â”‚   â”œâ”€â”€ æ•°å­—ICè®¾è®¡</span><br><span class="line">â”‚   â”œâ”€â”€ æ•°å­—ICéªŒè¯</span><br><span class="line">â”‚   â””â”€â”€ æ•°å­—åç«¯</span><br><span class="line">â”‚   â””â”€â”€ æ¨¡æ‹ŸICè®¾è®¡</span><br><span class="line">â”‚       â””â”€â”€ æ¨¡æ‹Ÿç‰ˆå›¾</span><br><span class="line">â”œâ”€â”€ æµ‹è¯•</span><br><span class="line">â”‚   â”œâ”€â”€ ç ”å‘ç±»æµ‹è¯•</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ æ–¹æ¡ˆæµ‹è¯•</span><br><span class="line">â”‚   â”‚   â””â”€â”€ é‡äº§æµ‹è¯•</span><br><span class="line">â”‚   â””â”€â”€ å®¢æˆ·æµ‹è¯•</span><br><span class="line">â”œâ”€â”€ é”€å”®</span><br><span class="line">â””â”€â”€ æ–¹æ¡ˆ</span><br><span class="line">    â”œâ”€â”€ ç¡¬ä»¶æ–¹æ¡ˆ</span><br><span class="line">    â””â”€â”€ è½¯ä»¶æ–¹æ¡ˆ</span><br></pre></td></tr></table></figure><h3 id="5-4-EDA-ä¸-Foundry-çš„å…³ç³»"><a href="#5-4-EDA-ä¸-Foundry-çš„å…³ç³»" class="headerlink" title="5.4. EDA ä¸ Foundry çš„å…³ç³»"></a>5.4. EDA ä¸ Foundry çš„å…³ç³»</h3><p>æ™®é€šè½¯ä»¶å…¬å¸æ— åŠ›å¼€å‘ EDA è½¯ä»¶ã€‚å› ä¸º EDA å‚å•†éœ€è¦å’Œ Foundry å‚å•†ç´§å¯†åˆä½œï¼Œæ‰èƒ½è·å¾—æœ‰å…³çš„ç”Ÿäº§ç»†èŠ‚æ•°æ®ï¼Œä»è€Œå¸®åŠ©ç”¨æˆ·è¿›è¡Œæ›´åŠ å‡†ç¡®çš„ä»¿çœŸã€å¯„ç”Ÿå‚æ•°çš„æå–ã€è§„åˆ™çš„æ£€æŸ¥ã€‚ä¸åŒçš„ EDA å·¥å…·æŠ½å–çš„å¯„ç”Ÿå‚æ•°å¯èƒ½ä¸åŒï¼ŒåŸå› å¯èƒ½æ˜¯ä¸åŒçš„å·¥å…·è·å¾—çš„å·¥è‰ºæ•°æ®ä¸åŒã€‚</p><p>å›½å†… EDA å‚å•†è¦æƒ³æ‰“ç ´å„æ–­ï¼Œä¸ä»…è¦é è½¯ä»¶æŠ€æœ¯ï¼Œè¿˜è¦ä¸å„å¤§ Foundry å‚è¾¾æˆæˆ˜ç•¥åˆä½œï¼Œå…±äº«å·¥è‰ºæ•°æ®ï¼Œæ‰èƒ½åšå‡ºæœ‰å®ç”¨ä»·å€¼çš„ EDA å·¥å…·ã€‚</p><h2 id="6-æ¦‚å¿µ"><a href="#6-æ¦‚å¿µ" class="headerlink" title="6. æ¦‚å¿µ"></a>6. æ¦‚å¿µ</h2><h3 id="6-1-å¯„å­˜å™¨ï¼š"><a href="#6-1-å¯„å­˜å™¨ï¼š" class="headerlink" title="6.1. å¯„å­˜å™¨ï¼š"></a>6.1. å¯„å­˜å™¨ï¼š</h3><p>registerï¼Œè¿™æ˜¯å¯¹åŠŸèƒ½å¼ºè°ƒçš„åç§°ï¼Œå…¶ç‰©ç†å®ä½“å¾ˆå¤šï¼Œæ¯”å¦‚è§¦å‘å™¨ (Flip-Flop, FF)å’Œé”å­˜å™¨(Latch)ç­‰ç­‰ã€‚åœ¨æ•°å­—è®¾è®¡ä¸­ï¼Œä¸»è¦æå€¡è§¦å‘å™¨ã€‚</p><p>å¯„å­˜å™¨æ˜¯å—æ§äºæ—¶é’Ÿæ²¿çš„å…ƒå™¨ä»¶ï¼Œ Foundry ä¼šåœ¨æ ‡å‡†å•å…ƒåº“ä¸­æä¾›å¤šç§å¯„å­˜å™¨ã€‚</p><p>è§¦å‘å™¨æ˜¯ç”±è¾¹æ²¿ä¿¡å·è€Œéç”µå¹³ä¿¡å·å¯¼è‡´æ•°æ®å­˜å‚¨çš„ã€‚è§¦å‘æºä¸€èˆ¬æ˜¯æ—¶é’Ÿä¿¡å·ã€‚</p><p>é”å­˜å™¨è¾ƒå°‘ä½¿ç”¨ï¼Œå®ƒä¸€èˆ¬ä»¥éæ—¶é’Ÿä¿¡å·ä¸ºå­˜å‚¨æ§åˆ¶ï¼Œé ç”µå¹³è§¦å‘ã€‚ä¸€èˆ¬ä¸è¿æ¥æ—¶é’Ÿï¼Œåªæ˜¯è¿æ¥ä¸€æ ¹æ™®é€šçš„ä¿¡å·çº¿ã€‚è¿™ç§é”å­˜å™¨ä¸€èˆ¬å¾ˆå°‘è¢«çº³å…¥æ—¶é’Ÿè®¡ç®—ä¸­ï¼Œå› ä¸ºå®ƒæ—¢ä¸å±äºç»„åˆé€»è¾‘ï¼Œåˆæ— æ³•åƒè§¦å‘å™¨ä¸€æ ·ä½œä¸ºæ—¶åºè·¯å¾„çš„èµ·ç»ˆç‚¹ï¼Œæ‰€ä»¥æ—¶åºä¸Šæ— æ³•é€šè¿‡å·¥å…·ä¿è¯ï¼Œåªèƒ½é€šè¿‡å·¥ç¨‹å¸ˆæ¥ä¿è¯ã€‚</p><p>æœ¬ä¹¦è¯´çš„å¯„å­˜å™¨ï¼ŒåŸºæœ¬å¯ä»¥æ›¿æ¢ä¸ºè§¦å‘å™¨ã€‚åœ¨æ•°å­—èŠ¯ç‰‡ EDA å·¥å…·é“¾ä¸­ï¼Œä¸¤ä¸ªæ¦‚å¿µä¹Ÿæ˜¯æ··ç”¨çš„ï¼Œä¸€ä¸ª reg æ—¢å¯ä»¥æŒ‡å¯„å­˜å™¨ï¼Œä¹Ÿå¯ä»¥æŒ‡è§¦å‘å™¨ã€‚å¦å¤–ï¼Œæ‰€è°“æ—¶åºé€»è¾‘é—¨ç”µè·¯ï¼Œä¹ŸåŸºæœ¬ç­‰åŒäºè§¦å‘å™¨ã€‚</p><h3 id="6-2-è®¾è®¡-Design-çš„è¾¹ç•Œ"><a href="#6-2-è®¾è®¡-Design-çš„è¾¹ç•Œ" class="headerlink" title="6.2. è®¾è®¡(Design)çš„è¾¹ç•Œ"></a>6.2. è®¾è®¡(Design)çš„è¾¹ç•Œ</h3><img src="https://i.postimg.cc/gjQMGZHN/20250116211433.jpg" alt="20250116211433" width="50%"/><ul><li><p>Padï¼šèŠ¯ç‰‡ï¼ˆå°è£…ï¼‰ä¹‹å¤–çš„å¼•è„šã€‚</p></li><li><p>å…ƒå™¨ä»¶ï¼šæŒ‡èŠ¯ç‰‡å†…çš„ç»„åˆé€»è¾‘é—¨ç”µè·¯åŠæ—¶åºé€»è¾‘é—¨ç”µè·¯ã€‚è¿™äº›æ ‡å‡†çš„å…ƒå™¨ä»¶ä¹Ÿè¢«ç§°ä¸ºæ ‡å‡†å•å…ƒ(Standard Cell)ã€‚å…ƒå™¨ä»¶ä¹Ÿç§°ä¸ºé€»è¾‘é—¨ã€‚</p></li><li><p>æ ‡å‡†å•å…ƒåº“&#x2F;å·¥è‰ºåº“ï¼šå…ƒå™¨ä»¶çš„é›†åˆã€‚</p></li><li><p>I&#x2F;O: å¦‚å‰â€œFloorPlanâ€å¯¹IOçš„è§£é‡Šï¼ŒI&#x2F;Oæ˜¯åŒ…æ‹¬Padå’Œå†…éƒ¨é€»è¾‘åœ¨å†…çš„æ•´ä¸ªå¼•è„šè®¾è®¡ã€‚åœ¨æ ‡å‡†å•å…ƒåº“ä¸­æ˜¯ä¸€ç§æ ‡å‡†å•å…ƒï¼Œä½†æ˜¯å®ƒæ¯”è¾ƒç‰¹æ®Šï¼Œå¯èƒ½ä¸å…¶ä»–æ ‡å‡†å•å…ƒä¸æ”¾åœ¨åŒä¸€ä¸ªæ ‡å‡†å•å…ƒåº“ä¸­ã€‚é©±åŠ¨ç”µå¹³ä¹Ÿå¯èƒ½ä¸åŒã€‚</p></li><li><p>é€šç”¨å•å…ƒåº“: åœ¨ç»¼åˆæ—¶ï¼Œæœ‰ä¸€ä¸ªä¸­é—´æ­¥éª¤æ˜¯å°† RTL æŠ½è±¡é€»è¾‘å…ˆæ˜ å°„ä¸º<strong>é€šç”¨å•å…ƒ(Generic Boolean)<strong>ï¼Œç„¶åæ˜ å°„åˆ°</strong>æ ‡å‡†å•å…ƒ</strong>ã€‚é€šç”¨å•å…ƒä¸å·¥è‰ºæ— å…³ï¼Œä¹Ÿä¸åŒ…å«ç‰©ç†ç‰¹æ€§ï¼Œåªæœ‰åŠŸèƒ½å±æ€§ï¼Œä¸ RTL æè¿°ç±»ä¼¼ã€‚è€Œæ ‡å‡†å•å…ƒæ—¢æœ‰åŠŸèƒ½å±æ€§ï¼Œåˆæœ‰å»¶è¿Ÿã€ç”µå‹ç­‰å·¥è‰ºå±æ€§ï¼Œä¸å·¥è‰ºå’Œ Foundry ç›¸å…³ã€‚</p></li><li><p>lefæ–‡ä»¶: Library Exchange Format. æè¿°ç‰¹å®šæµç‰‡å·¥è‰ºä¸‹å…ƒå™¨ä»¶çš„ç‰©ç†å±æ€§ã€‚</p></li><li><p>libæ–‡ä»¶: Library. æè¿°ç‰¹å®šæµç‰‡å·¥è‰ºä¸‹å…ƒå™¨ä»¶çš„åŠŸèƒ½å±æ€§ã€‚libæ–‡ä»¶å¸¸å¸¸è¦è¢«ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶çš„dbæ–‡ä»¶æ‰èƒ½åœ¨æŸäº›EDAå·¥å…·ä¸Šä½¿ç”¨ã€‚ lef å’Œ lib æ–‡ä»¶éƒ½æ˜¯æŠ€æœ¯åº“ã€‚</p><p>  æ•°å­—è®¾è®¡åªèƒ½åœ¨ Foundry æä¾›çš„å·²æœ‰çš„é€‰é¡¹ä¸­æŒ‘é€‰å…ƒå™¨ä»¶ã€‚</p></li><li><p>defæ–‡ä»¶: Design Exchange Format. è®¾è®¡é™¤äº† RTL å¤–ï¼Œä¹Ÿå¯ä»¥å¸¦æœ‰ç‰©ç†ä¿¡æ¯ï¼Œä¿å­˜ä¸º def æ–‡ä»¶ï¼ŒåŸºç¡€å†…å®¹æ˜¯è®¾è®¡çš„å½¢çŠ¶å’Œå°ºå¯¸ï¼Œæ‰©å±•å†…å®¹åŒ…æ‹¬ç«¯å£çš„åˆ†å¸ƒä½ç½®ã€RAMå’ŒROMç­‰ç¡¬æ ¸çš„æ”¾ç½®ä½ç½®ã€å†…éƒ¨å…ƒå™¨ä»¶çš„æ”¾ç½®å’Œå¸ƒçº¿ä½ç½®ç­‰ã€‚ RTL å’Œ def ç»Ÿç§°ä¸ºè®¾è®¡ã€‚</p></li></ul><p>è‡ªå·±å†™çš„æ¨¡å—å¯ä»¥ç§°ä¸ºè®¾å¤‡(Device)æˆ–æ¨¡å—(Module)ã€‚</p><p>ç”¨è®¾å¤‡ä¸€è¯ä¸»è¦å¼ºè°ƒå®ƒå…·å¤‡ç›¸å¯¹ç‹¬ç«‹çš„åŠŸèƒ½ï¼Œåœ¨ä»‹ç»SoCæ¶æ„ç­‰ä¸Šå±‚é€»è¾‘æ—¶è¾ƒä¸ºå¸¸ç”¨ï¼Œè®¾å¤‡ä¹Ÿç»å¸¸è¢«æ›¿æ¢ä¸ºå•å…ƒ(Unit)ä¸€è¯ï¼Œå®ƒæŒ‡äººä¸ºè®¾è®¡çš„å•å…ƒï¼Œè€Œéæ ‡å‡†å•å…ƒã€‚ä¸€ä¸ªè®¾è®¡å¯ä»¥åŒ…å«å¾ˆå¤šä¸ªè®¾å¤‡ã€‚</p><p>ç”¨æ¨¡å—ä¸€è¯ï¼Œä¸»è¦å¼ºè°ƒå®ƒåœ¨è®¾è®¡æ–‡ä»¶ç»“æ„ä¸Šçš„ç‹¬ç«‹æ€§ï¼Œåœ¨ä»‹ç»é€šç”¨è®¾è®¡å’Œåº•å±‚é€»è¾‘æ—¶è¾ƒä¸ºå¸¸ç”¨ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> IC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VPNè®¾ç½®</title>
      <link href="/blog/2025/01/14/VPN%E8%AE%BE%E7%BD%AE/"/>
      <url>/blog/2025/01/14/VPN%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="VMWare-çš„-Linux-è™šæ‹Ÿæœºå…±äº«-Windows-ä¸»æœºçš„-VPN"><a href="#VMWare-çš„-Linux-è™šæ‹Ÿæœºå…±äº«-Windows-ä¸»æœºçš„-VPN" class="headerlink" title="VMWare çš„ Linux è™šæ‹Ÿæœºå…±äº« Windows ä¸»æœºçš„ VPN"></a>VMWare çš„ Linux è™šæ‹Ÿæœºå…±äº« Windows ä¸»æœºçš„ VPN</h2><p>æ–¹æ¡ˆ 2ï¼šNAT æ¨¡å¼ + Windows ç½‘ç»œå…±äº«<br>å¦ä¸€ç§æ–¹å¼æ˜¯ä¿æŒ VMware ä½¿ç”¨ NAT æ¨¡å¼ï¼Œå¹¶é€šè¿‡ Windows ä¸»æœºçš„ç½‘ç»œå…±äº«åŠŸèƒ½ï¼Œå°† VPN æµé‡å…±äº«ç»™è™šæ‹Ÿæœºã€‚</p><p>æ­¥éª¤ï¼š<br>åœ¨ Windows ä¸Šå¯ç”¨ç½‘ç»œå…±äº«ï¼š</p><p>ç¡®ä¿ Clash åœ¨ Windows ä¸»æœºä¸Šè¿è¡Œï¼Œå¹¶å·²è¿æ¥åˆ° VPNã€‚<br>æ‰“å¼€ æ§åˆ¶é¢æ¿ &gt; ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒ &gt; æ›´æ”¹é€‚é…å™¨è®¾ç½®ã€‚<br>å³é”®ç‚¹å‡»ä½ çš„ VPN è¿æ¥ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªä»¥ Ethernet å¼€å¤´çš„é€‚é…å™¨ï¼‰ï¼Œé€‰æ‹© å±æ€§ã€‚<br>åœ¨ å…±äº« æ ‡ç­¾é¡µï¼Œå‹¾é€‰ å…è®¸å…¶ä»–ç½‘ç»œç”¨æˆ·é€šè¿‡æ­¤è®¡ç®—æœºçš„ Internet è¿æ¥è¿æ¥ã€‚<br>é€‰æ‹©è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘ç»œé€‚é…å™¨ï¼ˆä¾‹å¦‚ VMware çš„ VMnet8 é€‚é…å™¨ï¼‰ï¼Œç„¶åç‚¹å‡»ç¡®å®šã€‚<br>é…ç½®è™šæ‹Ÿæœºç½‘ç»œä¸º NATï¼š</p><p>åœ¨ VMware ä¸­ï¼Œç¡®ä¿è™šæ‹Ÿæœºçš„ç½‘ç»œé€‚é…å™¨è®¾ç½®ä¸º NATï¼ˆè¿™é€šå¸¸æ˜¯é»˜è®¤è®¾ç½®ï¼‰ã€‚<br>åœ¨ NAT æ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºä¼šé€šè¿‡ Windows ä¸»æœºè®¿é—®ç½‘ç»œï¼Œä½†æµé‡ä¼šè¢«è·¯ç”±åˆ°å…±äº«çš„ç½‘ç»œé€‚é…å™¨ã€‚<br>éªŒè¯è™šæ‹Ÿæœºæ˜¯å¦å¯ä»¥é€šè¿‡ VPN è®¿é—®ç½‘ç»œï¼š</p><p>å¯åŠ¨è™šæ‹Ÿæœºï¼Œæµ‹è¯•ç½‘ç»œè¿æ¥ã€‚<br>å¦‚æœè™šæ‹Ÿæœºè¿æ¥æˆåŠŸå¹¶é€šè¿‡ VPN è®¿é—®äº’è”ç½‘ï¼Œé‚£ä¹ˆé…ç½®å°±å®Œæˆäº†ã€‚</p><h2 id="WSL1-é€šè¿‡ä¸»æœºçš„-clash-å®¢æˆ·ç«¯è®¿é—®ç½‘ç»œ"><a href="#WSL1-é€šè¿‡ä¸»æœºçš„-clash-å®¢æˆ·ç«¯è®¿é—®ç½‘ç»œ" class="headerlink" title="WSL1 é€šè¿‡ä¸»æœºçš„ clash å®¢æˆ·ç«¯è®¿é—®ç½‘ç»œ"></a>WSL1 é€šè¿‡ä¸»æœºçš„ clash å®¢æˆ·ç«¯è®¿é—®ç½‘ç»œ</h2><h3 id="æ–¹æ³•ä¸€ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆé€‚ç”¨äºæ™®é€šç½‘ç»œè¯·æ±‚ï¼‰"><a href="#æ–¹æ³•ä¸€ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆé€‚ç”¨äºæ™®é€šç½‘ç»œè¯·æ±‚ï¼‰" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆé€‚ç”¨äºæ™®é€šç½‘ç»œè¯·æ±‚ï¼‰"></a>æ–¹æ³•ä¸€ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆé€‚ç”¨äºæ™®é€šç½‘ç»œè¯·æ±‚ï¼‰</h3><p>é€‚åˆ curlã€wgetã€aptã€pipã€git ç­‰å‘½ä»¤è¡Œå·¥å…·èµ°ä»£ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export http_proxy=http://127.0.0.1:7890&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export https_proxy=http://127.0.0.1:7890&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export all_proxy=socks5://127.0.0.1:7890&#x27;</span> &gt;&gt; ~/.bashrc</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>éªŒè¯ä»£ç†æ˜¯å¦æœ‰æ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl cip.cc</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç½‘ç«™ä¼šè¿”å›ä½ çš„å…¬ç½‘ IPã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://www.google.com</span><br></pre></td></tr></table></figure><p>åº”è¯¥ä¼šè¿”å›ç½‘é¡µã€‚</p><p><strong>ä¸´æ—¶å¼€å¯ï¼š</strong></p><p>å¦‚æœä½ åªæƒ³æš‚æ—¶èµ°ä»£ç†ä¸€æ¬¡ï¼Œä¸æƒ³æ”¹ .bashrcï¼Œä½ å¯ä»¥ç›´æ¥è¿™æ ·è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_proxy=http://127.0.0.1:7890 https_proxy=http://127.0.0.1:7890 curl https://www.google.com</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨-proxychains-å…¨å±€è½¬å‘ï¼ˆé€‚ç”¨äºæ‰€æœ‰ç¨‹åºï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶ï¼‰"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨-proxychains-å…¨å±€è½¬å‘ï¼ˆé€‚ç”¨äºæ‰€æœ‰ç¨‹åºï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶ï¼‰" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨ proxychains å…¨å±€è½¬å‘ï¼ˆé€‚ç”¨äºæ‰€æœ‰ç¨‹åºï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶ï¼‰"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨ proxychains å…¨å±€è½¬å‘ï¼ˆé€‚ç”¨äºæ‰€æœ‰ç¨‹åºï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶ï¼‰</h3><p>å®‰è£… proxychainsï¼Œè®©ä»»æ„ç¨‹åºèµ° Clash çš„ä»£ç†ã€‚</p><ol><li>å®‰è£… proxychains</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install proxychains -y</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–è¾‘é…ç½® &#x2F;etc&#x2F;proxychains.conf</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure><p>åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸€è¡Œæˆ–ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">socks5</span>  <span class="number">127.0.0.1</span> <span class="number">7890</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šä¸è¦æ”¹æˆ httpï¼Œè¦ç”¨ socks5ã€‚</p><p>ä½¿ç”¨ proxychainsï¼ˆåªä»£ç†ä½ æƒ³ä»£ç†çš„ç¨‹åºï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains curl https://www.google.com</span><br></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼š</p><ul><li>ç²¾å‡†æ§åˆ¶å“ªäº›ç¨‹åºèµ°ä»£ç†ã€‚</li><li>ä¸å½±å“ç³»ç»Ÿå…¶ä»–è®¾ç½®ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¯æ¬¡éƒ½è¦æ‰‹åŠ¨åŠ  proxychainsã€‚</li></ul><h3 id="æ–¹æ³•ä¸‰ï¼šä¸ºå•ç‹¬çš„ç¨‹åºé…ç½®ä»£ç†"><a href="#æ–¹æ³•ä¸‰ï¼šä¸ºå•ç‹¬çš„ç¨‹åºé…ç½®ä»£ç†" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šä¸ºå•ç‹¬çš„ç¨‹åºé…ç½®ä»£ç†"></a>æ–¹æ³•ä¸‰ï¼šä¸ºå•ç‹¬çš„ç¨‹åºé…ç½®ä»£ç†</h3><ol><li>é…ç½® git ä½¿ç”¨ä»£ç†</li></ol><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è®¾ç½®å…¨å±€ä»£ç†ï¼ˆåªè®¾ç½®ä¸€æ¬¡å³å¯ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy http://127.0.0.1:7890</span><br><span class="line">git config --global https.proxy http://127.0.0.1:7890</span><br></pre></td></tr></table></figure><p>è‹¥ä½ ä¹‹åæƒ³å…³é—­ git ä»£ç†ï¼Œå¯è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --<span class="built_in">unset</span> http.proxy</span><br><span class="line">git config --global --<span class="built_in">unset</span> https.proxy</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½® pip ä½¿ç”¨ä»£ç†</li></ol><p>åœ¨ä¸»ç›®å½•åˆ›å»º pip é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/.config/pip</span><br><span class="line">vim ~/.config/pip/pip.conf</span><br></pre></td></tr></table></figure><p>æ·»åŠ å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[global]</span></span><br><span class="line"><span class="attr">proxy</span> = http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">7890</span></span><br></pre></td></tr></table></figure><ol start="3"><li>é…ç½® apt ä½¿ç”¨ä»£ç†</li></ol><p>ç¼–è¾‘ apt çš„é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/apt/apt.conf.d</span><br><span class="line">sudo nano /etc/apt/apt.conf.d/99proxy</span><br></pre></td></tr></table></figure><p>ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼ˆå‡è®¾ HTTP ä»£ç†ç«¯å£æ˜¯ 7890ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Acquire::http::Proxy <span class="string">&quot;http://127.0.0.1:7890&quot;</span>;</span><br><span class="line">Acquire::https::Proxy <span class="string">&quot;http://127.0.0.1:7890&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•å››ï¼šé…ç½®-iptables-redsocksï¼ˆå®ç°çœŸæ­£çš„å…¨å±€è½¬å‘ï¼‰"><a href="#æ–¹æ³•å››ï¼šé…ç½®-iptables-redsocksï¼ˆå®ç°çœŸæ­£çš„å…¨å±€è½¬å‘ï¼‰" class="headerlink" title="æ–¹æ³•å››ï¼šé…ç½® iptables + redsocksï¼ˆå®ç°çœŸæ­£çš„å…¨å±€è½¬å‘ï¼‰"></a>æ–¹æ³•å››ï¼šé…ç½® iptables + redsocksï¼ˆå®ç°çœŸæ­£çš„å…¨å±€è½¬å‘ï¼‰</h3><p>é€‚åˆé«˜çº§ç”¨æˆ·ï¼ŒWSL2 ä½¿ç”¨ TUN æ¨¡å¼å®ç°ç³»ç»Ÿçº§å…¨å±€ä»£ç†ã€‚è¿™æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®åœ¨éœ€è¦æ‰€æœ‰æµé‡å¼ºåˆ¶èµ°ä»£ç†æ—¶ä½¿ç”¨ã€‚TODO</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¿æ®µæ ‘</title>
      <link href="/blog/2024/09/28/Segment-Tree/"/>
      <url>/blog/2024/09/28/Segment-Tree/</url>
      
        <content type="html"><![CDATA[<p>çº¿æ®µæ ‘ï¼ˆSegment Treeï¼‰æ˜¯ä¸€ç§å°†æ•°ç»„åŒºé—´å­˜å‚¨ä¸ºæ ‘çš„æ•°æ®ç»“æ„ <a href="https://cp-algorithms.com/data_structures/segment_tree.html">^1</a>ã€‚</p><h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><p>æŸ¥è¯¢è¿ç»­å­æ•°ç»„ æˆ– æŸ¥è¯¢èŒƒå›´å†…çš„æœ€å°å…ƒç´ ï¼šO(logn)</p><h2 id="æœ€ç®€å•å½¢å¼çš„çº¿æ®µæ ‘"><a href="#æœ€ç®€å•å½¢å¼çš„çº¿æ®µæ ‘" class="headerlink" title="æœ€ç®€å•å½¢å¼çš„çº¿æ®µæ ‘"></a>æœ€ç®€å•å½¢å¼çš„çº¿æ®µæ ‘</h2><h2 id="é«˜é˜¶ç‰ˆæœ¬çš„çº¿æ®µæ ‘"><a href="#é«˜é˜¶ç‰ˆæœ¬çš„çº¿æ®µæ ‘" class="headerlink" title="é«˜é˜¶ç‰ˆæœ¬çš„çº¿æ®µæ ‘"></a>é«˜é˜¶ç‰ˆæœ¬çš„çº¿æ®µæ ‘</h2><p>TODO</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://oi-wiki.org/ds/seg/#%E5%AE%9E%E7%8E%B0">OI wiki</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shared_ptr çš„å®ç°</title>
      <link href="/blog/2024/09/26/Implementation-of-shared-ptr/"/>
      <url>/blog/2024/09/26/Implementation-of-shared-ptr/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚è€ƒæºç "><a href="#å‚è€ƒæºç " class="headerlink" title="å‚è€ƒæºç "></a>å‚è€ƒæºç </h2><blockquote><p>&#x2F;usr&#x2F;include&#x2F;c++&#x2F;11&#x2F;bits&#x2F;shared_ptr_base.h<br>&#x2F;usr&#x2F;include&#x2F;c++&#x2F;11&#x2F;bits&#x2F;shared_ptr.h</p></blockquote><p>åšå®¢ï¼š<a href="https://zhiqiang.org/coding/std-shared-ptr.html">https://zhiqiang.org/coding/std-shared-ptr.html</a></p><h2 id="std-shared-ptr-çš„æ€§è´¨"><a href="#std-shared-ptr-çš„æ€§è´¨" class="headerlink" title="std::shared_ptr çš„æ€§è´¨"></a><code>std::shared_ptr</code> çš„æ€§è´¨</h2><ol><li>å¤åˆ¶æ„é€ ã€ææ„æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ol><p>æ ‡å‡†åº“ä½¿ç”¨åŸå­æ“ä½œå®ç°æ— é”çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p><ol start="2"><li>å†™æ“ä½œï¼ˆä¾‹å¦‚ <code>reset</code> ã€ èµ‹å€¼ <code>operator=</code> ï¼‰æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</li></ol><p>å†™æ“ä½œå’Œå¤åˆ¶æ„é€ ã€ææ„çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼š</p><ul><li>å¤åˆ¶æ„é€ ã€ææ„å‡½æ•°ä¸­ï¼Œå•ä¸ªçº¿ç¨‹åªå¤„ç†ä¸€ä¸ªå¯¹è±¡ï¼Œå¤åˆ¶æ„é€ å‡½æ•°å°†å…¶ä»–å¯¹è±¡å¤åˆ¶è¿‡æ¥ä¹‹åï¼Œä¸ä¼šæ”¹åŠ¨å…¶ä»–å¯¹è±¡çš„èµ„æºï¼ˆå¼•ç”¨è®¡æ•°ã€æ‰€ç®¡ç†çš„å†…å­˜ï¼‰ã€‚</li><li>ä½†æ˜¯å†™æ“ä½œå¯èƒ½å¤šä¸ªçº¿ç¨‹éƒ½åœ¨å¤„ç†è¯¥ shared_ptr ã€‚ä¾‹å¦‚å¤šä¸ªçº¿ç¨‹éƒ½å¯¹åŒä¸€ä¸ª shared_ptr è¿›è¡Œèµ‹å€¼ï¼š</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shared_ptr&lt;<span class="type">int</span>&gt; sp1 = <span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">1</span>);</span><br><span class="line">sp1 = sp2; <span class="comment">// çº¿ç¨‹ 1</span></span><br><span class="line">sp1 = sp3; <span class="comment">// çº¿ç¨‹ 2</span></span><br></pre></td></tr></table></figure><p>å¯¹æ¯”æºç åˆ†æï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">     __shared_count&amp;</span><br><span class="line">     <span class="keyword">operator</span>=(<span class="type">const</span> __shared_count&amp; __r) <span class="keyword">noexcept</span></span><br><span class="line">     &#123;</span><br><span class="line">_Sp_counted_base&lt;_Lp&gt;* __tmp = __r._M_pi;</span><br><span class="line"><span class="keyword">if</span> (__tmp != _M_pi)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> (__tmp != <span class="literal">nullptr</span>)</span><br><span class="line">      __tmp-&gt;_M_add_ref_copy();</span><br><span class="line">    <span class="keyword">if</span> (_M_pi != <span class="literal">nullptr</span>)</span><br><span class="line">      _M_pi-&gt;_M_release(); <span class="comment">// æ³¨æ„ï¼šçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 æŒæœ‰ç›¸åŒçš„ _M_piï¼</span></span><br><span class="line">    _M_pi = __tmp; <span class="comment">// æ³¨æ„ï¼šçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 æŒæœ‰ç›¸åŒçš„ _M_piï¼</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­ä¸¤ä¸ªâ€œæ³¨æ„â€å¯èƒ½åŒæ—¶åœ¨å‘ç”Ÿï¼Œä¾‹å¦‚ï¼š<br>çº¿ç¨‹ 1 release çš„æ—¶å€™ï¼Œçº¿ç¨‹ 2 åœ¨ç»™ _M_pi èµ‹å€¼ï¼›<br>æˆ–è€…ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶åœ¨ release æˆ–åŒæ—¶åœ¨ç»™ _M_pi èµ‹å€¼ã€‚</p><h2 id="è¦ç‚¹"><a href="#è¦ç‚¹" class="headerlink" title="è¦ç‚¹"></a>è¦ç‚¹</h2><ol><li>ç®¡ç†çš„å†…å­˜å’Œå¼•ç”¨è®¡æ•°éƒ½åº”è¯¥åŠ¨æ€åˆ†é…åˆ°å †ï¼ˆ heap ï¼‰ä¸Šï¼Œè¿™æ ·å¤šä¸ª shared_ptr å¯¹è±¡æ‰èƒ½æ›´æ–°åŒä¸€ä»½æ•°æ®ã€‚</li><li>éœ€è¦åŒæ—¶ç»´æŠ¤å¼ºå¼•ç”¨è®¡æ•°å’Œå¼±å¼•ç”¨è®¡æ•°ã€‚</li><li>å¼•ç”¨è®¡æ•°æœ¬èº«åº”è¯¥æ˜¯ä¸€ä¸ªæ§åˆ¶å—ç±»ï¼Œä½¿ç”¨ <code>delete this</code> æ¥è‡ªåŠ¨åˆ é™¤ï¼ˆææ„ï¼‰å¼•ç”¨è®¡æ•°ã€‚</li></ol><p>æ°¸è¿œä¸è¦æ‰‹åŠ¨ <code>delete use_count</code>ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹å¯èƒ½æ­¤æ—¶æ­£åœ¨ä½¿ç”¨è¯¥èµ„æºï¼Œä¾‹å¦‚è§£å¼•ç”¨ <code>*use_count</code>ã€‚</p><figure class="highlight cpp"><figcaption><span>SharedPtr.hpp</span><a href="/blog/downloads/code/SharedPtr.hpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;_Lock_policy _Lp = __default_lock_policy&gt;</span><br><span class="line">    <span class="keyword">class</span> _Sp_counted_base</span><br><span class="line">    : <span class="keyword">public</span> _Mutex_base&lt;_Lp&gt;</span><br><span class="line">    {</span><br><span class="line">      <span class="type">void</span></span><br><span class="line">      _M_add_ref_copy()</span><br><span class="line">      { __gnu_cxx::__atomic_add_dispatch(&amp;_M_use_count, <span class="number">1</span>); }</span><br><span class="line"></span><br><span class="line">      <span class="type">void</span></span><br><span class="line">      _M_release() <span class="keyword">noexcept</span></span><br><span class="line">      {</span><br><span class="line">        <span class="comment">// Be race-detector-friendly.  For more info see bits/c++config.</span></span><br><span class="line">        _GLIBCXX_SYNCHRONIZATION_HAPPENS_BEFORE(&amp;_M_use_count);</span><br><span class="line"><span class="keyword">if</span> (__gnu_cxx::__exchange_and_add_dispatch(&amp;_M_use_count, <span class="number">-1</span>) == <span class="number">1</span>)</span><br><span class="line">  {</span><br><span class="line">            _GLIBCXX_SYNCHRONIZATION_HAPPENS_AFTER(&amp;_M_use_count);</span><br><span class="line">    _M_dispose();</span><br><span class="line">    <span class="comment">// There must be a memory barrier between dispose() and destroy()</span></span><br><span class="line">    <span class="comment">// to ensure that the effects of dispose() are observed in the</span></span><br><span class="line">    <span class="comment">// thread that runs destroy().</span></span><br><span class="line">    <span class="comment">// See http://gcc.gnu.org/ml/libstdc++/2005-11/msg00136.html</span></span><br><span class="line">    <span class="keyword">if</span> (_Mutex_base&lt;_Lp&gt;::_S_need_barriers)</span><br><span class="line">      {</span><br><span class="line">__atomic_thread_fence (__ATOMIC_ACQ_REL);</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Be race-detector-friendly.  For more info see bits/c++config.</span></span><br><span class="line">            _GLIBCXX_SYNCHRONIZATION_HAPPENS_BEFORE(&amp;_M_weak_count);</span><br><span class="line">    <span class="keyword">if</span> (__gnu_cxx::__exchange_and_add_dispatch(&amp;_M_weak_count,</span><br><span class="line">       <span class="number">-1</span>) == <span class="number">1</span>)</span><br><span class="line">              {</span><br><span class="line">                _GLIBCXX_SYNCHRONIZATION_HAPPENS_AFTER(&amp;_M_weak_count);</span><br><span class="line">        _M_destroy();</span><br><span class="line">              }</span><br><span class="line">  }</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">      _Sp_counted_base(_Sp_counted_base <span class="type">const</span>&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">      _Sp_counted_base&amp; <span class="keyword">operator</span>=(_Sp_counted_base <span class="type">const</span>&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// using _Atomic_word = int;</span></span><br><span class="line">      _Atomic_word  _M_use_count;     <span class="comment">// #shared</span></span><br><span class="line">      _Atomic_word  _M_weak_count;    <span class="comment">// #weak + (#shared != 0)</span></span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span>&lt;_Lock_policy _Lp&gt;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">__shared_count</span></span><br><span class="line">    {</span><br><span class="line">      _Sp_counted_base&lt;_Lp&gt;*  _M_pi; <span class="comment">// å¼•ç”¨è®¡æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">      __shared_count(<span class="type">const</span> __shared_count&amp; __r) <span class="keyword">noexcept</span></span><br><span class="line">      : _M_pi(__r._M_pi)</span><br><span class="line">      {</span><br><span class="line"><span class="keyword">if</span> (_M_pi != <span class="literal">nullptr</span>)</span><br><span class="line">  _M_pi-&gt;_M_add_ref_copy(); <span class="comment">// <span class="doctag">TODO:</span> æœ‰æ²¡æœ‰å¯èƒ½æ­¤æ—¶çš„ _M_pi æ‰€å¼•å¯¹è±¡å·²ç»è¢«é‡Šæ”¾äº†å‘¢</span></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      ~__shared_count() <span class="keyword">noexcept</span></span><br><span class="line">      {</span><br><span class="line"><span class="keyword">if</span> (_M_pi != <span class="literal">nullptr</span>)</span><br><span class="line">  _M_pi-&gt;_M_release(); <span class="comment">// æ²¡æœ‰ç›´æ¥ delete _M_piï¼Œ</span></span><br><span class="line">                           <span class="comment">// è€Œæ˜¯ä½¿ç”¨ _M_pi çš„æˆå‘˜å‡½æ•°æ¥é‡Šæ”¾å®ƒã€‚</span></span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line">      __shared_count&amp;</span><br><span class="line">      <span class="keyword">operator</span>=(<span class="type">const</span> __shared_count&amp; __r) <span class="keyword">noexcept</span></span><br><span class="line">      {</span><br><span class="line">_Sp_counted_base&lt;_Lp&gt;* __tmp = __r._M_pi;</span><br><span class="line"><span class="keyword">if</span> (__tmp != _M_pi)</span><br><span class="line">  {</span><br><span class="line">    <span class="keyword">if</span> (__tmp != <span class="literal">nullptr</span>)</span><br><span class="line">      __tmp-&gt;_M_add_ref_copy();</span><br><span class="line">    <span class="keyword">if</span> (_M_pi != <span class="literal">nullptr</span>)</span><br><span class="line">      _M_pi-&gt;_M_release(); <span class="comment">// æ²¡æœ‰ç›´æ¥ delete _M_piï¼Œ</span></span><br><span class="line">                               <span class="comment">// è€Œæ˜¯ä½¿ç”¨ _M_pi çš„æˆå‘˜å‡½æ•°æ¥é‡Šæ”¾å®ƒã€‚</span></span><br><span class="line">    _M_pi = __tmp;</span><br><span class="line">  }</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">      }</span><br><span class="line">    };</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://gcc.gnu.org/onlinedocs/libstdc++/manual/ext_concurrency.html">https://gcc.gnu.org/onlinedocs/libstdc++/manual/ext_concurrency.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ çš„ bool å’Œ int</title>
      <link href="/blog/2024/09/17/cpp/C++%E7%9A%84bool%E5%92%8Cint/"/>
      <url>/blog/2024/09/17/cpp/C++%E7%9A%84bool%E5%92%8Cint/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æµ‹è¯•leetcodeçš„ <a href="https://leetcode.cn/problems/bus-routes/description/">815.å…¬äº¤è·¯çº¿</a> ä¸€é¢˜æ—¶ï¼Œå‘ç°ä¸€ä¸ªç°è±¡ï¼Œå½“æˆ‘ä½¿ç”¨<code>vector&lt;vector&lt;bool&gt;&gt;</code>ä½œä¸ºå›¾çš„é‚»æ¥çŸ©é˜µçš„ç±»å‹æ—¶ï¼Œè¿è¡Œé€Ÿåº¦æ¯”ä½¿ç”¨<code>vector&lt;vector&lt;int&gt;&gt;</code>æ…¢äº†è¿‘1å€ã€‚ä½¿ç”¨<code>bool</code>è¿è¡Œé€Ÿåº¦ä¸º600mså·¦å³ï¼Œä½¿ç”¨<code>int</code>æ—¶è¿è¡Œé€Ÿåº¦ä¸º300mså·¦å³ã€‚</p><p>ä»¥ä¸‹æ˜¯ChatGPTçš„å›ç­”ï¼š</p><p>åœ¨C++ä¸­ï¼Œboolç±»å‹å¹¶ä¸ä¸€å®šæ¯”intç±»å‹æ…¢ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„æ€§èƒ½è¡¨ç°å¯èƒ½æœ‰æ‰€ä¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸æ€§èƒ½å·®å¼‚ç›¸å…³çš„è€ƒè™‘ï¼š</p><ol><li>å†…å­˜å¤§å°<br>boolç±»å‹åœ¨æ ‡å‡†ä¸­åªéœ€è¦è¡¨ç¤º trueï¼ˆé0ï¼‰å’Œ falseï¼ˆ0ï¼‰ï¼Œé€šå¸¸å ç”¨1ä¸ªå­—èŠ‚ï¼ˆ8ä½ï¼‰ï¼Œè€Œ int é€šå¸¸å ç”¨4ä¸ªå­—èŠ‚ï¼ˆ32ä½ï¼‰ã€‚å› æ­¤ï¼Œboolç±»å‹å¯ä»¥èŠ‚çœå†…å­˜ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¸¦æ¥ç¼“å­˜æ•ˆç‡çš„æå‡ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§é‡å¸ƒå°”å€¼æ—¶ï¼ˆä¾‹å¦‚å¸ƒå°”æ•°ç»„ï¼‰ã€‚</li><li>å¯¹é½å’Œå†…å­˜è®¿é—®<br>åœ¨æŸäº›æ¶æ„ä¸Šï¼Œå¤„ç†å•å­—èŠ‚çš„boolç±»å‹æ—¶ï¼Œå¯èƒ½ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå› ä¸ºå¤„ç†å™¨é€šå¸¸ä¼˜åŒ–å¯¹é½è®¿é—®ã€‚å¦‚æœå†…å­˜æ²¡æœ‰æ­£ç¡®å¯¹é½ï¼Œå¤„ç†å™¨å¯èƒ½éœ€è¦é¢å¤–çš„æ“ä½œæ¥å¤„ç†éå¯¹é½çš„å­—èŠ‚ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œintçš„å¯¹é½é€šå¸¸ä¸ç³»ç»Ÿçš„å†…å­˜æ€»çº¿å¯¹é½æ›´å¥½ï¼ˆå¦‚32ä½æˆ–64ä½ç³»ç»Ÿä¸Šï¼‰ï¼Œå› æ­¤è¯»å–å’Œå†™å…¥å¯èƒ½æ›´é«˜æ•ˆã€‚</li><li>æŒ‡ä»¤é›†å’Œæ“ä½œ<br>ç°ä»£å¤„ç†å™¨åœ¨å¤„ç†å¸ƒå°”å€¼æ—¶é€šå¸¸ä¼šå°†å…¶æ‰©å±•ä¸ºå®Œæ•´çš„å¯„å­˜å™¨å¤§å°ï¼ˆä¾‹å¦‚32ä½æˆ–64ä½ï¼‰ã€‚å› æ­¤ï¼Œè™½ç„¶boolç±»å‹çš„å­˜å‚¨å¯èƒ½æ›´å°ï¼Œä½†åœ¨å®é™…æ“ä½œä¸­ï¼Œå¤„ç†å™¨å¯èƒ½å°†å®ƒæå‡ä¸ºintæˆ–æ›´å¤§çš„ç±»å‹æ¥æ‰§è¡Œé€»è¾‘æ“ä½œã€‚å¤„ç†å¸ƒå°”å€¼å¯èƒ½æ¶‰åŠéšå¼ç±»å‹è½¬æ¢ï¼Œè¿™åœ¨æŸäº›æç«¯æƒ…å†µä¸‹å¯èƒ½å¸¦æ¥å¼€é”€ã€‚</li><li>å¯„å­˜å™¨ä½¿ç”¨<br>int ç±»å‹å¯ä»¥ç›´æ¥æ˜ å°„åˆ°å¤„ç†å™¨å¯„å­˜å™¨ä¸­è¿›è¡Œæ“ä½œï¼Œè€Œ bool ç±»å‹çš„æ“ä½œæœ‰æ—¶å¯èƒ½ä¼šæ¶‰åŠé¢å¤–çš„é€»è¾‘è¿ç®—ï¼ˆå¦‚æ©ç æ“ä½œï¼‰ä»¥ç¡®ä¿å¸ƒå°”å€¼çš„æ­£ç¡®æ€§ã€‚</li><li>ç¼–è¯‘å™¨ä¼˜åŒ–<br>ç°ä»£ç¼–è¯‘å™¨åœ¨ä¼˜åŒ–æ—¶ä¼šè€ƒè™‘åˆ°boolä¸intçš„å·®å¼‚ï¼Œå¹¶å°½é‡ä¼˜åŒ–ä»£ç ï¼Œå› æ­¤åœ¨å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸‹ï¼Œä½ ä¸ä¼šæ„Ÿå—åˆ°æ˜¾è‘—çš„æ€§èƒ½å·®å¼‚ã€‚ä½†åœ¨ä¸€äº›ç‰¹å®šçš„åœºåˆï¼ˆå¦‚å¤§è§„æ¨¡æ•°ç»„ã€é¢‘ç¹å†…å­˜è®¿é—®ç­‰ï¼‰ï¼Œboolç±»å‹çš„ä½¿ç”¨ç¡®å®å¯èƒ½å¸¦æ¥æ€§èƒ½å½±å“ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å™¨éœ€è¦å¯¹é½æˆ–æ‰§è¡Œé¢å¤–çš„æ“ä½œæ—¶ã€‚<br>æ€»ç»“<br>boolç±»å‹é€šå¸¸å¹¶ä¸ä¼šæ¯”intæ…¢ï¼Œå®é™…çš„æ€§èƒ½å·®å¼‚å–å†³äºå¹³å°ã€å†…å­˜å¯¹é½ã€ç¼–è¯‘å™¨ä¼˜åŒ–ä»¥åŠåº”ç”¨åœºæ™¯ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå·®å¼‚æ˜¯å¾®ä¸è¶³é“çš„ï¼Œä½†åœ¨å¯¹æ€§èƒ½éå¸¸æ•æ„Ÿçš„ç¨‹åºä¸­ï¼Œè¿™ç§å·®å¼‚å¯èƒ½ä¼šæ˜¾ç°ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bash Debugging</title>
      <link href="/blog/2024/09/06/linux/bash%E8%B0%83%E8%AF%95/"/>
      <url>/blog/2024/09/06/linux/bash%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯ç”¨è°ƒè¯•æ¨¡å¼"><a href="#å¯ç”¨è°ƒè¯•æ¨¡å¼" class="headerlink" title="å¯ç”¨è°ƒè¯•æ¨¡å¼"></a>å¯ç”¨è°ƒè¯•æ¨¡å¼</h2><ol><li>å‘½ä»¤è¡Œå¯ç”¨è°ƒè¯•ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½¿ç”¨ -x å’Œ -v é€‰é¡¹è¿è¡Œ main.sh è„šæœ¬ã€‚</span></span><br><span class="line">bash -xv main.sh</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè°ƒè¯•è¾“å‡ºæ˜¯é€šè¿‡ <code>stderr</code> ï¼Œåœ¨è¯•å›¾é‡å®šå‘æ—¶è¦æ³¨æ„ã€‚</p><ol start="2"><li>åœ¨è„šæœ¬ä¸­å¯ç”¨è°ƒè¯•ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -xv</span><br></pre></td></tr></table></figure><table><thead><tr><th>Short notation</th><th>Long notation</th><th>Result</th></tr></thead><tbody><tr><td>set -f</td><td>set -o noglob</td><td>Disable file name generation using metacharacters (globbing).</td></tr><tr><td>set -v</td><td>set -o verbose</td><td>Prints shell input lines as they are read.</td></tr><tr><td>set -x</td><td>set -o xtrace</td><td>Print command traces before executing command.</td></tr></tbody></table><p>å‚è€ƒ<a href="https://tldp.org/LDP/Bash-Beginners-Guide/html/sect_02_03.html">é“¾æ¥</a></p><p>å…¶ä»–é€‰é¡¹ï¼š</p><ul><li><code>set +e</code>ï¼šå¿½ç•¥é”™è¯¯ç»§ç»­è¿è¡Œï¼ˆbashï¼‰ã€‚</li><li><code>set -e</code>ï¼šé‡é”™åœæ­¢æ‰§è¡Œï¼ˆbashï¼‰ã€‚</li></ul><ol start="3"><li>ç¯å¢ƒå˜é‡ <code>PS4</code></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS4=<span class="string">&#x27;+ $&#123;LINENO&#125;: &#x27;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥æ­é…ä½¿ç”¨ <code>PS4</code> ç¯å¢ƒå˜é‡ï¼Œä»¥åœ¨è°ƒè¯•è¾“å‡ºä¸­æ‰“å°å‘½ä»¤æ‰€åœ¨çš„æ–‡ä»¶è¡Œå·ã€‚</p><p><code>PS4</code> æ˜¯ä¸€ä¸ª Bash ç¯å¢ƒå˜é‡ï¼Œç”¨äºå®šä¹‰è°ƒè¯•æ¨¡å¼ä¸‹çš„æç¤ºç¬¦æ ¼å¼ã€‚<br>å½“ä½ å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼ˆé€šè¿‡ <code>set -x</code>ï¼‰æ—¶ï¼ŒBash ä¼šåœ¨æ¯ä¸€è¡Œæ‰§è¡Œä¹‹å‰æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œè€Œ PS4 å†³å®šäº†è¿™äº›è°ƒè¯•ä¿¡æ¯çš„æ ¼å¼ã€‚<br><code>$LINENO</code>è¡¨ç¤ºæ‰“å°è¡Œå·ã€‚</p><h2 id="trap-DEBUG"><a href="#trap-DEBUG" class="headerlink" title="trap DEBUG"></a><code>trap DEBUG</code></h2><p>è®¾ç½®DEBUGé™·é˜±ï¼Œè¯¥é™·é˜±åœ¨æ¯ä¸€æ¡â€œç®€å•è¯­å¥â€æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> -o functrace</span><br><span class="line">track_var=<span class="string">&quot;my_var&quot;</span></span><br><span class="line">old_value=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="title">check_var_change</span></span>() &#123;</span><br><span class="line">    new_value=<span class="string">&quot;<span class="variable">$&#123;!track_var&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$new_value</span>&quot;</span> != <span class="string">&quot;<span class="variable">$old_value</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$track_var</span> changed to \&quot;<span class="variable">$new_value</span>\&quot; at <span class="variable">$BASH_LINENO</span>&quot;</span></span><br><span class="line">        old_value=<span class="string">&quot;<span class="variable">$new_value</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">trap</span> check_var_change DEBUG</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šç›‘æ§<code>my_var</code>å˜é‡çš„å˜åŒ–ï¼Œå¦‚æœå˜åŒ–ï¼Œåˆ™æ‰“å°æ–°å€¼ã€‚</p><p>æ³¨æ„ï¼šå®é™…æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ç°<code>trap</code>ç›‘æ§å˜é‡å˜åŒ–ä¼¼ä¹ä¼šå»¶è¿Ÿï¼Œè€Œ<code>set -x</code>æ‰“å°çš„ä¿¡æ¯æ˜¯å¯é çš„ã€‚</p><h2 id="ç‰¹æ®Šå˜é‡"><a href="#ç‰¹æ®Šå˜é‡" class="headerlink" title="ç‰¹æ®Šå˜é‡"></a>ç‰¹æ®Šå˜é‡</h2><p>å‚è€ƒï¼š<a href="https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html">https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html</a></p><ul><li><code>BASH_LINENO</code>: è¿™æ˜¯ä¸€ä¸ªæ•°ç»„å˜é‡ï¼Œâ€Œç”¨äºè¡¨ç¤ºå½“å‰æ‰§è¡Œçš„è„šæœ¬æˆ–å‡½æ•°ä¸­æ¯ä¸€è¡Œçš„è¡Œå·ã€‚â€Œå®ƒç‰¹åˆ«é€‚ç”¨äºè°ƒè¯•ï¼Œâ€Œå› ä¸ºå®ƒå¯ä»¥è¿½è¸ªåˆ°å‡½æ•°è°ƒç”¨æ ˆä¸­æ¯ä¸€å±‚çš„è¡Œå·ã€‚â€Œé€šè¿‡è®¿é—®BASH_LINENOæ•°ç»„çš„ä¸åŒç´¢å¼•ï¼Œâ€Œå¯ä»¥è·å–åˆ°ä¸åŒå‡½æ•°è°ƒç”¨å±‚çº§å¯¹åº”çš„è¡Œå·ä¿¡æ¯â€Œã€‚</li><li><code>LINENO</code>: è·å–å½“å‰è„šæœ¬è¡Œå·â€Œï¼Œâ€Œè€Œä¸æ¶‰åŠå‡½æ•°è°ƒç”¨æ ˆçš„è¿½è¸ªâ€Œã€‚</li><li><code>FUNCNAME</code>: å‡½æ•°å</li><li><code>BASH_SOURCE</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>File Exists</title>
      <link href="/blog/2024/09/06/linux/File-Exists/"/>
      <url>/blog/2024/09/06/linux/File-Exists/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h1><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><ul><li><code>access</code></li><li><code>stat</code></li><li><code>inotify_node</code></li><li><code>opendir</code></li><li><code>readdir</code></li></ul><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>æ–‡ä»¶ç³»ç»Ÿå¹¶ä¸ä¼šå®æ—¶åˆ·æ–°ç¼“å­˜ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚è¿™ä¼šå¯¼è‡´æ–‡ä»¶å³ä½¿å·²ç»åˆ›å»ºï¼Œ<code>access</code>æˆ–<code>stat</code>å‡½æ•°ä¾ç„¶è¿”å›â€No such fileâ€ã€‚<br>ä½†æ˜¯<code>ls</code>å¯ä»¥çœ‹åˆ°æ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸º<code>ls</code>å’Œ<code>access</code>å‡½æ•°çš„å®ç°æœºåˆ¶ä¸åŒã€‚</p><p>ä¾‹å¦‚ï¼š</p><p>åœ¨<code>NFS</code>æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œåˆ›å»ºæ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨<code>stat</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶ï¼Œ<code>stat</code>ä¼šæŠ¥å‘Šâ€œæ–‡ä»¶ä¸å­˜åœ¨â€ã€‚<br>åˆ é™¤æ–‡ä»¶ä¹‹åç«‹å³è°ƒç”¨<code>stat</code>å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶ï¼Œå‘ç°<code>stat</code>ä¾ç„¶å¯ä»¥çœ‹åˆ°è¯¥æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ”¹ç”¨<code>readdir</code>æ¥è¯»å–ç›®å½•ï¼Œå› ä¸ºç›®å½•ä¼šè¢«æ›´å¿«åœ°æ›´æ–°ç¼“å­˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c/cpp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>libtirpc Usage</title>
      <link href="/blog/2024/07/08/libtirpc-Usage/"/>
      <url>/blog/2024/07/08/libtirpc-Usage/</url>
      
        <content type="html"><![CDATA[<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul><li><a href="https://www.ibm.com/docs/en/i/7.3?topic=communications-using-sun-ti-rpc-develop-distributed-applications">TI-RPC</a></li><li><a href="https://www.ibm.com/docs/en/aix/7.1?topic=call-rpc-language">RPC language</a></li><li><a href="https://docs.oracle.com/cd/E19683-01/816-1435/xdrproto-61652/index.html">XDR Protocol</a></li><li><a href="https://www.ibm.com/docs/en/i/7.3?topic=applications-using-rpcgen-compiler">PRC Compiler</a></li><li><a href="https://docs.oracle.com/cd/E19683-01/816-1435/rpcgenpguide-21470/index.html">rpcgen</a></li><li><a href="https://docs-archive.freebsd.org/44doc/psd/22.rpcgen/paper.pdf">rpcgen programming guide</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> rpcgen</span><br><span class="line">/bin/rpcgen</span><br><span class="line">$ rpcgen</span><br><span class="line">usage: rpcgen infile</span><br><span class="line">        rpcgen [-abkCLNTM][-Dname[=value]] [-i size] [-I [-K seconds]] [-Y path] infile</span><br><span class="line">        rpcgen [-c | -h | -l | -m | -t | -Sc | -Ss | -Sm] [-o outfile] [infile]</span><br><span class="line">        rpcgen [-s nettype]* [-o outfile] [infile]</span><br><span class="line">        rpcgen [-n netid]* [-o outfile] [infile]</span><br><span class="line">options:</span><br><span class="line">-a              generate all files, including samples</span><br><span class="line">-b              backward compatibility mode (generates code <span class="keyword">for</span> SunOS 4.1)</span><br><span class="line">-c              generate XDR routines</span><br><span class="line">-C              ANSI C mode</span><br><span class="line">-Dname[=value]  define a symbol (same as <span class="comment">#define)</span></span><br><span class="line">-h              generate header file</span><br><span class="line">-i size         size at <span class="built_in">which</span> to start generating inline code</span><br><span class="line">-I              generate code <span class="keyword">for</span> inetd support <span class="keyword">in</span> server (<span class="keyword">for</span> SunOS 4.1)</span><br><span class="line">-K seconds      server exits after K seconds of inactivity</span><br><span class="line">-l              generate client side stubs</span><br><span class="line">-L              server errors will be printed to syslog</span><br><span class="line">-m              generate server side stubs</span><br><span class="line">-M              generate MT-safe code</span><br><span class="line">-n netid        generate server code that supports named netid</span><br><span class="line">-N              supports multiple arguments and call-by-value</span><br><span class="line">-o outfile      name of the output file</span><br><span class="line">-s nettype      generate server code that supports named nettype</span><br><span class="line">-Sc             generate sample client code that uses remote procedures</span><br><span class="line">-Ss             generate sample server code that defines remote procedures</span><br><span class="line">-Sm             generate makefile template </span><br><span class="line">-t              generate RPC dispatch table</span><br><span class="line">-T              generate code to support RPC dispatch tables</span><br><span class="line">-Y path         directory name to find C preprocessor (cpp)</span><br><span class="line"></span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/libc/bugs.html&gt;.</span><br></pre></td></tr></table></figure><p>Note:</p><p><code>%</code> å¯ä»¥ç”¨æ¥è½¬ä¹‰æŸè¡Œï¼Œä»»ä½•å¥é¦–å¸¦æœ‰ <code>%</code> çš„è¡Œå°†è¢«è§†ä½œå­—ç¬¦ä¸²ï¼Œç›´æ¥æ”¾å…¥åˆ°è¾“å‡ºæ–‡ä»¶ä¸­ã€‚<br>æ³¨æ„ï¼š<code>rpcgen</code> å¯èƒ½æ”¹å˜è¯¥è¡Œçš„ä½ç½®ï¼Œæ‰€ä»¥åº”è¯¥åœ¨è¾“å‡ºæ–‡ä»¶ä¸­å¯¹è¿™äº›è¡Œè¿›è¡Œä»”ç»†æ£€æŸ¥ã€‚</p><p><code>rpcgen</code> provides an additional preprocessing feature: any line that begins with a percent sign (<code>%</code>) is passed directly to the output file, with no action on the lineâ€™s content. Use caution because <code>rpcgen</code> does not always place the lines where you intend. Check the output source file and, if needed, edit it.</p><p>ä¾‹å¦‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;abc.h&quot;</span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ <code>rpcgen infile</code> å‘½ä»¤æ—¶ï¼Œç”±äº â€œabc.hâ€ ä¸å­˜åœ¨ï¼Œå¯èƒ½ä¼šæŠ¥é”™ã€‚</p><p>ä½†æ˜¯å¦‚æœåœ¨å¥é¦–æ·»åŠ ä¸€ä¸ª <code>%</code> ç¬¦å·ï¼Œåˆ™å¯ä»¥ç»•è¿‡æ£€æŸ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%#include &quot;abc.h&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hair</title>
      <link href="/blog/2024/05/08/english/Hair/"/>
      <url>/blog/2024/05/08/english/Hair/</url>
      
        <content type="html"><![CDATA[<h2 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h2><p><a href="https://www.youtube.com/watch?v=EzFtsYC4pPg&t=344s">Free English Class! Topic: Hair! ğŸ§”ğŸ½ğŸ’‡âœ‚ï¸ (Lesson Only)</a></p><h2 id="Words-Phrases"><a href="#Words-Phrases" class="headerlink" title="Words&#x2F;Phrases"></a>Words&#x2F;Phrases</h2><p>eyelashes<br>makeup<br>hairstyle&#x2F;hairdo<br>get my hair done<br>hair gel<br>buzz cut<br>helmet<br>When you have a lot of hair, the helmet makes your hair flat.<br>hair colouring</p>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hair </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Multi Thread and Signals</title>
      <link href="/blog/2024/03/22/thread/Multi-Thread-and-Signals/"/>
      <url>/blog/2024/03/22/thread/Multi-Thread-and-Signals/</url>
      
        <content type="html"><![CDATA[<p>From ChatGPT:</p><p>In general, when a program enters a signal handler in a multi-threaded environment, the behavior regarding other threads depends on how the signal handler is set up and the specific signal that is being handled.</p><ol><li>Default Behavior: By default, when a signal is delivered to a process, it interrupt the thread that is currently running and executes the signal handler in the context of that thread. Other threads in the process continue running unless they are also interrupted by signals.</li><li>Thread-Specific Signal Handling: Some signals, such as SIGINT (interrupt signal), SIGTERM (termination signal), or SIGABRT (abort signal), are typically delivered to the entire process, which means they can interrupt any thread. However, other signals, like SIGSEGV (segmentation fault) or SIGILL (illegal signal), are usually delivered to the specific thread that caused the signal.</li><li>Signal Masking: In a multi-threaded program, you can use signal masking (sigprocmask in POSIX systems) to block certain signals in specific threads. This can affect whether a signal handler interrupts a particular thread or not.</li><li>Asynchronous-Signal-Safe Functions: Signal handlers should only execute functions are considered â€œasynchronous-signal-safeâ€ according to POSIX standards. These functions are designed to be safe to call from within a signal handler. Using non-safe functions in a signal handler can lead to undefined behavior.</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> thread </tag>
            
            <tag> signal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TBBå…¥é—¨</title>
      <link href="/blog/2024/02/24/thread/TBB%E5%85%A5%E9%97%A8/"/>
      <url>/blog/2024/02/24/thread/TBB%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ§åˆ¶çº¿ç¨‹æ•°"><a href="#1-æ§åˆ¶çº¿ç¨‹æ•°" class="headerlink" title="1. æ§åˆ¶çº¿ç¨‹æ•°"></a>1. æ§åˆ¶çº¿ç¨‹æ•°</h2><ul><li>Method 1: Use the environment variable <code>TBB_NUM_THREADS</code> for the gloabl setting.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> TBB_NUM_THREADS=4</span><br></pre></td></tr></table></figure><p>TODO: It doesnâ€™t seem to work!</p><ul><li>Method 2: Use <code>tbb::task_arena</code> or <code>tbb::task_scheduler_init</code> (Deprecated).</li></ul><p>TBB will use this setting locally within the scope of the <code>tbb::task_arena</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/pipeline.h&gt;</span></span></span><br><span class="line"><span class="comment">// Deprecated:</span></span><br><span class="line"><span class="comment">// #include &lt;tbb/task_scheduler_init.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/task_arena.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define your pipeline body</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPipeline</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(tbb::flow_control&amp; fc)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Your pipeline logic here</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="comment">// Inform the pipeline that there is no more data</span></span><br><span class="line">        fc.<span class="built_in">stop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Deprecated: tbb::task_scheduler_init init(1);</span></span><br><span class="line">    <span class="function">tbb::task_arena <span class="title">arena</span><span class="params">(<span class="number">4</span>)</span></span>; <span class="comment">// 4 threads</span></span><br><span class="line">    <span class="comment">// Do some tasks:</span></span><br><span class="line">    tbb::<span class="built_in">parallel_pipeline</span>(<span class="comment">/* max_number_of_live_tokens */</span> <span class="number">4</span>, MyPipeline); <span class="comment">// <span class="doctag">FIXME:</span> ä¼¼ä¹éœ€è¦æ”¾å…¥ arena çš„ execute å‡½æ•°ä¸­</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-parallel-for"><a href="#2-parallel-for" class="headerlink" title="2. parallel_for"></a>2. <code>parallel_for</code></h2><p>API: <a href="https://oneapi-spec.uxlfoundation.org/specifications/oneapi/latest/elements/onetbb/source/algorithms/functions/parallel_for_func">parallel_for</a></p><ol><li>ç”¨ <code>my_parallel_for</code> æ¨¡æ‹Ÿ <code>parallel_for</code> çš„å®ç°ï¼š</li></ol><figure class="highlight cpp"><figcaption><span>my_parallel_for.cpp</span><a href="/blog/downloads/code/TBB/my_parallel_for.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/tbb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ parallel_for çš„å†…éƒ¨å®ç°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">my_parallel_for</span><span class="params">(<span class="type">const</span> tbb::blocked_range&lt;<span class="type">size_t</span>&gt;&amp; range, <span class="type">const</span> std::function&lt;<span class="type">void</span>(<span class="type">const</span> tbb::blocked_range&lt;<span class="type">size_t</span>&gt;&amp;)&gt;&amp; body)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (range.<span class="built_in">is_divisible</span>()) {</span><br><span class="line">        <span class="comment">// åˆ†å‰²èŒƒå›´</span></span><br><span class="line">        <span class="function">tbb::blocked_range&lt;<span class="type">size_t</span>&gt; <span class="title">left</span><span class="params">(range.begin(), range.begin() + (range.end() - range.begin()) / <span class="number">2</span>)</span></span>;</span><br><span class="line">        <span class="function">tbb::blocked_range&lt;<span class="type">size_t</span>&gt; <span class="title">right</span><span class="params">(left.end(), range.end())</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€’å½’è°ƒç”¨</span></span><br><span class="line">        tbb::<span class="built_in">parallel_invoke</span>(</span><br><span class="line">            [&amp;] { <span class="built_in">my_parallel_for</span>(left, body); },</span><br><span class="line">            [&amp;] { <span class="built_in">my_parallel_for</span>(right, body); }</span><br><span class="line">        );</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">// å¤„ç†å½“å‰èŒƒå›´</span></span><br><span class="line">        <span class="built_in">body</span>(range);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">data</span><span class="params">(<span class="number">100</span>)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) {</span><br><span class="line">        data[i] = i;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„ parallel_for è¿›è¡Œå¹¶è¡Œå¤„ç†</span></span><br><span class="line">    <span class="built_in">my_parallel_for</span>(tbb::<span class="built_in">blocked_range</span>&lt;<span class="type">size_t</span>&gt;(<span class="number">0</span>, data.<span class="built_in">size</span>()), [&amp;](<span class="type">const</span> tbb::blocked_range&lt;<span class="type">size_t</span>&gt;&amp; r) {</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = r.<span class="built_in">begin</span>(); i != r.<span class="built_in">end</span>(); ++i) {</span><br><span class="line">            data[i] *= <span class="number">2</span>; <span class="comment">// ç¤ºä¾‹æ“ä½œï¼šå°†æ¯ä¸ªå…ƒç´ ä¹˜ä»¥2</span></span><br><span class="line">        }</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; val : data) {</span><br><span class="line">        std::cout &lt;&lt; val &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    }</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><ol start="2"><li>å‘å‡ºä»»åŠ¡çš„çº¿ç¨‹ä¹Ÿä¼šæˆä¸ºå·¥ä½œçº¿ç¨‹ä¹‹ä¸€ï¼Œå¹¶å‚ä¸ä»»åŠ¡çš„æ‰§è¡Œï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight cpp"><figcaption><span>test_parallel_for.cpp</span><a href="/blog/downloads/code/TBB/test_parallel_for.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/tbb.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> tbb;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> std::atomic&lt;<span class="type">int</span>&gt; <span class="title">total_blocks</span><span class="params">(<span class="number">0</span>)</span></span>;  <span class="comment">// Atomic counter to track the number of tasks processed</span></span><br><span class="line"><span class="function"><span class="type">static</span> std::atomic&lt;<span class="type">int</span>&gt; <span class="title">total_blocks2</span><span class="params">(<span class="number">0</span>)</span></span>;  <span class="comment">// Atomic counter to track the number of tasks processed</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Function to process each data element</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">process_data</span><span class="params">(<span class="type">int</span> i, std::mutex&amp; mtx)</span> </span>{</span><br><span class="line">    <span class="comment">// std::this_thread::sleep_for(std::chrono::milliseconds(1));  // Simulate some processing time</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i)</span><br><span class="line">        ;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>) {</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &lt;number_of_elements&gt;&quot;</span></span><br><span class="line">                  &lt;&lt; <span class="string">&quot;&lt;grain_size&gt;&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> num_elements = std::<span class="built_in">stoi</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="type">int</span> grain_size = std::<span class="built_in">stoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    std::mutex mtx;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">data</span><span class="params">(num_elements)</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_elements; ++i) {</span><br><span class="line">        data[i] = i;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// {</span></span><br><span class="line">    <span class="comment">//     std::lock_guard&lt;std::mutex&gt; lock(mtx);</span></span><br><span class="line">    <span class="comment">//     std::cout &lt;&lt; &quot;Main thread ID: &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">// }</span></span><br><span class="line"></span><br><span class="line">    tbb::concurrent_unordered_map&lt;std::thread::id, tbb::concurrent_vector&lt;<span class="type">int</span>&gt;&gt; thread_task_counts;  <span class="comment">// To store task counts for each thread</span></span><br><span class="line">    tbb::concurrent_unordered_map&lt;std::thread::id, tbb::concurrent_vector&lt;<span class="type">int</span>&gt;&gt; thread_task_counts2;  <span class="comment">// To store task counts for each thread</span></span><br><span class="line"></span><br><span class="line">    tbb::<span class="built_in">parallel_for</span>(<span class="number">0</span>, <span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;((data.<span class="built_in">size</span>() + grain_size - <span class="number">1</span>) / grain_size), [&amp;](<span class="type">int</span> i) {</span><br><span class="line">        total_blocks++;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;  <span class="comment">// Thread-local variable to avoid data</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i * grain_size; j &lt; std::<span class="built_in">min</span>(<span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(data.<span class="built_in">size</span>()), (i + <span class="number">1</span>) * grain_size); ++j) {</span><br><span class="line">            <span class="built_in">process_data</span>(i, mtx);</span><br><span class="line">            ++cnt;</span><br><span class="line">        }</span><br><span class="line">        thread_task_counts[std::this_thread::<span class="built_in">get_id</span>()].<span class="built_in">push_back</span>(cnt);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    tbb::<span class="built_in">parallel_for</span>(<span class="built_in">blocked_range</span>&lt;<span class="type">int</span>&gt;(<span class="number">0u</span>, data.<span class="built_in">size</span>(), grain_size), [&amp;](<span class="type">const</span> blocked_range&lt;<span class="type">int</span>&gt;&amp; r) {</span><br><span class="line">        total_blocks2++;</span><br><span class="line">        <span class="type">int</span> cnt = <span class="number">0</span>;  <span class="comment">// Thread-local variable to avoid data</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = r.<span class="built_in">begin</span>(); i &lt; r.<span class="built_in">end</span>(); ++i) {</span><br><span class="line">            <span class="built_in">process_data</span>(i, mtx);</span><br><span class="line">            ++cnt;</span><br><span class="line">        }</span><br><span class="line">        thread_task_counts2[std::this_thread::<span class="built_in">get_id</span>()].<span class="built_in">push_back</span>(cnt);</span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Total blocks processed: &quot;</span> &lt;&lt; total_blocks.<span class="built_in">load</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : thread_task_counts) {</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Thread &quot;</span> &lt;&lt; pair.first &lt;&lt; <span class="string">&quot; processed: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; task_count : pair.second)</span><br><span class="line">            std::cout &lt;&lt; task_count &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; std::endl;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Total blocks2 processed: &quot;</span> &lt;&lt; total_blocks2.<span class="built_in">load</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : thread_task_counts2) {</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Thread &quot;</span> &lt;&lt; pair.first &lt;&lt; <span class="string">&quot; processed: &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; task_count : pair.second)</span><br><span class="line">            std::cout &lt;&lt; task_count &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; std::endl;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./test_parallel_for </span><br><span class="line">Main thread ID: 140220582070080</span><br><span class="line">Processing data: 2 on thread 140220582070080</span><br><span class="line">Processing data: 6 on thread 140220557755968</span><br><span class="line">Processing data: 4 on thread 140220574795328</span><br><span class="line">Processing data: 8 on thread 140220566275648</span><br><span class="line">Processing data: 10 on thread 140220562015808</span><br></pre></td></tr></table></figure><p>å¯è§ï¼Œ<code>data 2</code> æ˜¯ç”±ä¸»çº¿ç¨‹å¤„ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>parallel_for</code> è™½ç„¶è¢«ç§°ä¸º a blocking parallel construtï¼Œä½†çº¿ç¨‹ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®ŒæˆæœŸé—´æ˜¯éé˜»å¡çš„ï¼Œå®ƒè¿˜å¯ä»¥å……å½“å·¥ä½œçº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ± ä¸­çš„ä»»åŠ¡ã€‚</p><p>ä»£ç æ¨¡æ‹Ÿ <code>parallel_for</code> çš„ <code>wait</code> ï¼š</p><figure class="highlight cpp"><figcaption><span>my_task_scheduler.cpp</span><a href="/blog/downloads/code/TBB/my_task_scheduler.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaskScheduler</span> {</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TaskScheduler</span>(<span class="type">size_t</span> numThreads);</span><br><span class="line">    ~<span class="built_in">TaskScheduler</span>();</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">enqueue</span><span class="params">(std::function&lt;<span class="type">void</span>()&gt; task)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wait</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;std::thread&gt; workers;</span><br><span class="line">    std::queue&lt;std::function&lt;<span class="type">void</span>()&gt;&gt; tasks;</span><br><span class="line">    std::mutex queueMutex;</span><br><span class="line">    std::condition_variable condition;</span><br><span class="line">    std::condition_variable finished;</span><br><span class="line">    <span class="type">bool</span> stop;</span><br><span class="line">    <span class="type">size_t</span> activeTasks;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">workerThread</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">executeTask</span><span class="params">()</span></span>;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">TaskScheduler::<span class="built_in">TaskScheduler</span>(<span class="type">size_t</span> numThreads) : <span class="built_in">stop</span>(<span class="literal">false</span>), <span class="built_in">activeTasks</span>(<span class="number">0</span>) {</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; numThreads; ++i) {</span><br><span class="line">        workers.<span class="built_in">emplace_back</span>(&amp;TaskScheduler::workerThread, <span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">TaskScheduler::~<span class="built_in">TaskScheduler</span>() {</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">        stop = <span class="literal">true</span>;</span><br><span class="line">    }</span><br><span class="line">    condition.<span class="built_in">notify_all</span>();</span><br><span class="line">    <span class="keyword">for</span> (std::thread &amp;worker : workers) {</span><br><span class="line">        worker.<span class="built_in">join</span>();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskScheduler::enqueue</span><span class="params">(std::function&lt;<span class="type">void</span>()&gt; task)</span> </span>{</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">        tasks.<span class="built_in">push</span>(std::<span class="built_in">move</span>(task));</span><br><span class="line">    }</span><br><span class="line">    condition.<span class="built_in">notify_one</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskScheduler::wait</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (!tasks.<span class="built_in">empty</span>() || activeTasks &gt; <span class="number">0</span>) {</span><br><span class="line">        <span class="comment">// å¦‚æœè¿˜æœ‰ä»»åŠ¡ï¼Œæ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œé¿å…å½“å‰çº¿ç¨‹è¢«é˜»å¡</span></span><br><span class="line">        <span class="keyword">if</span> (!tasks.<span class="built_in">empty</span>()) {</span><br><span class="line">            <span class="built_in">executeTask</span>();</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            finished.<span class="built_in">wait</span>(lock);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskScheduler::workerThread</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) {</span><br><span class="line">        std::function&lt;<span class="type">void</span>()&gt; task;</span><br><span class="line">        {</span><br><span class="line">            <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">            condition.<span class="built_in">wait</span>(lock, [<span class="keyword">this</span>] { <span class="keyword">return</span> stop || !tasks.<span class="built_in">empty</span>(); });</span><br><span class="line">            <span class="keyword">if</span> (stop &amp;&amp; tasks.<span class="built_in">empty</span>()) <span class="keyword">return</span>;</span><br><span class="line">            task = std::<span class="built_in">move</span>(tasks.<span class="built_in">front</span>());</span><br><span class="line">            tasks.<span class="built_in">pop</span>();</span><br><span class="line">            ++activeTasks;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">task</span>();</span><br><span class="line">        {</span><br><span class="line">            <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">            --activeTasks;</span><br><span class="line">            <span class="keyword">if</span> (tasks.<span class="built_in">empty</span>() &amp;&amp; activeTasks == <span class="number">0</span>) {</span><br><span class="line">                finished.<span class="built_in">notify_all</span>();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TaskScheduler::executeTask</span><span class="params">()</span> </span>{</span><br><span class="line">    std::function&lt;<span class="type">void</span>()&gt; task;</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">        <span class="keyword">if</span> (tasks.<span class="built_in">empty</span>()) <span class="keyword">return</span>;</span><br><span class="line">        task = std::<span class="built_in">move</span>(tasks.<span class="built_in">front</span>());</span><br><span class="line">        tasks.<span class="built_in">pop</span>();</span><br><span class="line">        ++activeTasks;</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">task</span>();</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(queueMutex)</span></span>;</span><br><span class="line">        --activeTasks;</span><br><span class="line">        <span class="keyword">if</span> (tasks.<span class="built_in">empty</span>() &amp;&amp; activeTasks == <span class="number">0</span>) {</span><br><span class="line">            finished.<span class="built_in">notify_all</span>();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">parallel_for</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, std::function&lt;<span class="type">void</span>(<span class="type">int</span>)&gt; func)</span> </span>{</span><br><span class="line">    <span class="function"><span class="type">static</span> TaskScheduler <span class="title">scheduler</span><span class="params">(std::thread::hardware_concurrency())</span></span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = start; i &lt; end; ++i) {</span><br><span class="line">        scheduler.<span class="built_in">enqueue</span>([i, &amp;func] { <span class="built_in">func</span>(i); });</span><br><span class="line">    }</span><br><span class="line">    scheduler.<span class="built_in">wait</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> N1 = <span class="number">100</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> N2 = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The first parallel loop.</span></span><br><span class="line">    <span class="built_in">parallel_for</span>(<span class="number">0</span>, N1, [&amp;](<span class="type">int</span> i) {</span><br><span class="line">        <span class="comment">// The second parallel loop.</span></span><br><span class="line">        <span class="built_in">parallel_for</span>(<span class="number">0</span>, N2, [&amp;](<span class="type">int</span> j) {</span><br><span class="line">            <span class="comment">// Some work</span></span><br><span class="line">        });</span><br><span class="line">        <span class="comment">// çº¿ç¨‹å‘å‡º parallel_for ä¹‹åï¼Œéœ€è¦ç­‰å¾…å†…éƒ¨æ‰€æœ‰ parallel loop çš„ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">        <span class="comment">// åœ¨æ­¤æœŸé—´å…è®¸ç»§ç»­æ‹¿å–å¤–éƒ¨çš„ parallel loop çš„ä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">    });</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><h2 id="3-TBBçº¿ç¨‹æ± "><a href="#3-TBBçº¿ç¨‹æ± " class="headerlink" title="3. TBBçº¿ç¨‹æ± "></a>3. TBBçº¿ç¨‹æ± </h2><p>TBBä¼¼ä¹æ€»æ˜¯ä½¿ç”¨åŒä¸€ä¸ªå…¨å±€çº¿ç¨‹æ± ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><figcaption><span>tbb_thread_pool.cpp</span><a href="/blog/downloads/code/TBB/tbb_thread_pool.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/tbb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">std::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">task_group_function</span><span class="params">()</span> </span>{</span><br><span class="line">    tbb::task_group tg;</span><br><span class="line">    <span class="type">int</span> max_concurrency = tbb::this_task_arena::<span class="built_in">max_concurrency</span>();</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Task group max concurrency: &quot;</span> &lt;&lt; max_concurrency &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) {</span><br><span class="line">        tg.<span class="built_in">run</span>([i] {</span><br><span class="line">            {</span><br><span class="line">                std::lock_guard&lt;std::mutex&gt; <span class="built_in">lock</span>(mtx);</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;Task group thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; is running.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">    tg.<span class="built_in">wait</span>();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">task_arena_function</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="function">tbb::task_arena <span class="title">arena</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> max_concurrency = arena.<span class="built_in">max_concurrency</span>();</span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Task arena max concurrency: &quot;</span> &lt;&lt; max_concurrency &lt;&lt; endl;</span><br><span class="line">    }</span><br><span class="line">    arena.<span class="built_in">execute</span>([max_concurrency] {</span><br><span class="line">        tbb::<span class="built_in">parallel_for</span>(<span class="number">0</span>, <span class="number">16</span>, [](<span class="type">int</span> i) {</span><br><span class="line">            {</span><br><span class="line">                std::lock_guard&lt;std::mutex&gt; <span class="built_in">lock</span>(mtx);</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;Task arena thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot; is running.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            }</span><br><span class="line">            <span class="built_in">sleep</span>(<span class="number">2</span>);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// è·å–é»˜è®¤task_arenaçš„æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°</span></span><br><span class="line">    <span class="type">int</span> arena_max_concurrency = tbb::this_task_arena::<span class="built_in">max_concurrency</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Default task_arena max concurrency: &quot;</span> &lt;&lt; arena_max_concurrency &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">tg_thread</span><span class="params">(task_group_function)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">ta_thread</span><span class="params">(task_arena_function)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…ä¸¤ä¸ªçº¿ç¨‹å®Œæˆ</span></span><br><span class="line">    tg_thread.<span class="built_in">join</span>();</span><br><span class="line">    ta_thread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build &amp;&amp; cmake .. &amp;&amp; make</span><br><span class="line">$ ./tbb_thread_pool &gt; result.txt</span><br><span class="line">$ <span class="built_in">cat</span> result.txt | grep running | <span class="built_in">sort</span> | <span class="built_in">uniq</span></span><br><span class="line">Task arena thread 140667163379264 is running.</span><br><span class="line">Task arena thread 140667167639104 is running.</span><br><span class="line">Task arena thread 140667184678464 is running.</span><br><span class="line">Task arena thread 140667201848896 is running.</span><br><span class="line">Task group thread 140667167639104 is running.</span><br><span class="line">Task group thread 140667171898944 is running.</span><br><span class="line">Task group thread 140667176158784 is running.</span><br><span class="line">Task group thread 140667180418624 is running.</span><br><span class="line">Task group thread 140667188938304 is running.</span><br><span class="line">Task group thread 140667210303040 is running.</span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸¤è¡Œæ—¥å¿—å¯ä»¥çœ‹å‡ºï¼Œarena å’Œ group é‡ç”¨äº†åŒä¸€ä¸ªçº¿ç¨‹ ID ï¼Œè¯´æ˜å®ƒä»¬åŒå±äºåŒä¸€ä¸ªå…¨å±€çº¿ç¨‹æ± ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Task arena thread 140667167639104 is running.</span><br><span class="line">Task group thread 140667167639104 is running.</span><br></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å‘ç°å…¨å±€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ€»æ•°æ˜¯è‡ªé€‚åº”çš„ï¼Œæ¯”å¦‚æœ¬ä¾‹å°±æ˜¯ <code>10</code> ä¸ªï¼Œæ—¢ä¸æ˜¯ <code>task_group</code> çš„ <code>8</code> ä¸ªï¼Œ<br>ä¹Ÿä¸æ˜¯ <code>task_arena</code> çš„ <code>4</code> ä¸ªï¼š</p><p>TODO</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> result.txt | grep running | <span class="built_in">sort</span> | <span class="built_in">uniq</span> | <span class="built_in">wc</span> -l</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h2 id="4-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰"><a href="#4-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰" class="headerlink" title="4. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰"></a>4. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰</h2><p><a href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/The_Task_Scheduler.html">The Task Scheduler</a></p><h3 id="4-1-åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based-Programmingï¼‰"><a href="#4-1-åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based-Programmingï¼‰" class="headerlink" title="4.1. åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based Programmingï¼‰"></a>4.1. åŸºäºä»»åŠ¡ç¼–ç¨‹ï¼ˆTask-Based Programmingï¼‰</h3><p>å½“è¿½æ±‚æ€§èƒ½æ—¶ï¼Œæ¨èä»¥é€»è¾‘ä»»åŠ¡ï¼ˆlogical tasksï¼‰è€Œä¸æ˜¯çº¿ç¨‹ï¼ˆthreadsï¼‰æ¥ç¼–ç¨‹ï¼Œæœ‰ä»¥ä¸‹åŸå› ï¼š</p><ul><li>å°†å¹¶è¡Œæ€§ä¸å¯ç”¨èµ„æºåŒ¹é…</li><li>æ›´å¿«çš„ä»»åŠ¡å¯åŠ¨å’Œå…³é—­</li><li>æ›´æœ‰æ•ˆçš„è¯„ä¼°é¡ºåº</li><li>æ”¹è¿›è´Ÿè½½å‡è¡¡</li><li>æ›´é«˜å±‚çš„æ€è€ƒ</li></ul><p>TODO</p><h3 id="4-2-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰å¦‚ä½•å·¥ä½œ"><a href="#4-2-ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask-Schedulerï¼‰å¦‚ä½•å·¥ä½œ" class="headerlink" title="4.2. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰å¦‚ä½•å·¥ä½œ"></a>4.2. ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆTask Schedulerï¼‰å¦‚ä½•å·¥ä½œ</h3><p><a href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/How_Task_Scheduler_Works.html">How Task Scheduler Works</a></p><h4 id="4-2-1-æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰"><a href="#4-2-1-æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰" class="headerlink" title="4.2.1. æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰"></a>4.2.1. æ·±åº¦ä¼˜å…ˆï¼ˆdepth-firstï¼‰</h4><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„åŒç«¯é˜Ÿåˆ—ï¼Œå¤´éƒ¨ç§°ä¸º top ï¼ˆä¹Ÿç§°é¡¶éƒ¨ï¼‰ï¼Œå°¾éƒ¨ç§°ä¸º bottom ï¼ˆä¹Ÿç§°åº•éƒ¨ï¼‰ã€‚<br>é˜Ÿåˆ—çš„åº•éƒ¨æ˜¯é˜Ÿåˆ—çš„æœ€æ·±å¤„ï¼ˆæœ€æœ«å¤„ï¼‰ï¼Œåº•éƒ¨ä»»åŠ¡æ˜¯æœ€æ–°çš„ï¼Œé¡¶éƒ¨ä»»åŠ¡æ˜¯æœ€æ—§çš„ã€‚</p><p>æ·±åº¦ä¼˜å…ˆæœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li><code>çƒ­ç‚¹ç¼“å­˜å‘½ä¸­</code>ï¼šæœ€æ–°çš„ä»»åŠ¡çš„ç¼“å­˜æ˜¯æœ€çƒ­çš„ï¼Œæ‰€ä»¥ä¼˜å…ˆæ‰§è¡Œæ–°ä»»åŠ¡ã€‚</li><li><code>æœ€å°åŒ–ç©ºé—´</code>ï¼šå¹¿åº¦ä¼˜å…ˆä¼šåŒæ—¶åˆ›å»ºæŒ‡æ•°çº§æ•°é‡çš„å…±å­˜èŠ‚ç‚¹ï¼Œè€Œæ·±åº¦ä¼˜å…ˆè™½ç„¶ä¹Ÿä¼šåˆ›å»ºç›¸åŒæ•°é‡çš„èŠ‚ç‚¹ï¼Œä½†æ˜¯åªæœ‰çº¿æ€§æ•°ç›®çš„èŠ‚ç‚¹ä¼šåŒæ—¶å…±å­˜ï¼Œå› ä¸ºå®ƒåˆ›å»ºäº†å…¶ä»–å°±ç»ªä»»åŠ¡çš„æ ˆã€‚</li></ul><p>ç”Ÿäº§ï¼šå½“çº¿ç¨‹äº§ç”Ÿä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå°†å…¶æ”¾ç½®åˆ°çº¿ç¨‹è‡ªèº«æ‰€æœ‰çš„ deque çš„å°¾éƒ¨ã€‚</p><p>æ¶ˆè´¹ï¼šå½“çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œæ ¹æ®ä»¥ä¸‹è§„åˆ™é¡ºåºé€‰å–ä¸€ä¸ªä»»åŠ¡ï¼š</p><ul><li>è§„åˆ™1ï¼šè·å–ä¸Šä¸€ä¸ªä»»åŠ¡è¿”å›çš„ä»»åŠ¡ï¼Œå¦‚æœæœ‰ï¼›</li><li>è§„åˆ™2ï¼šä»çº¿ç¨‹è‡ªå·±æ‰€æœ‰çš„ deque å°¾éƒ¨é€‰å–ä¸€ä¸ªä»»åŠ¡ï¼ˆå³æ·±åº¦ä¼˜å…ˆï¼‰ï¼Œå¦‚æœæœ‰ï¼›</li><li>è§„åˆ™3ï¼šéšæœºé€‰æ‹©ä¸€ä¸ªå…¶ä»–çº¿ç¨‹çš„ deque ï¼Œä»å…¶å¤´éƒ¨çªƒå–ä¸€ä¸ªä»»åŠ¡ï¼ˆå³å¹¿åº¦ä¼˜å…ˆï¼‰ã€‚å¦‚æœè¢«é€‰ deque ä¸ºç©ºï¼Œåˆ™é‡å¤æœ¬æ¡è§„åˆ™ç›´è‡³æˆåŠŸã€‚</li></ul><p>è§„åˆ™1 è¢«ç§°ä¸ºâ€œä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰â€ã€‚</p><p>è§„åˆ™2 æ˜¯æ·±åº¦ä¼˜å…ˆï¼Œè¿™ä½¿å¾—å½“å‰çº¿ç¨‹å¾—ä»¥ä¸æ–­æ‰§è¡Œæœ€æ–°çš„ä»»åŠ¡ç›´è‡³å…¶å®Œæˆæ‰€æœ‰å·¥ä½œã€‚</p><p>è§„åˆ™3 æ˜¯ä¸´æ—¶çš„å¹¿åº¦ä¼˜å…ˆï¼Œå®ƒå°†æ½œåœ¨çš„å¹¶è¡Œè½¬åŒ–ä¸ºå®é™…çš„å¹¶è¡Œã€‚</p><h4 id="4-2-2-ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask-Scheduler-Bypassï¼‰æŠ€æœ¯"><a href="#4-2-2-ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask-Scheduler-Bypassï¼‰æŠ€æœ¯" class="headerlink" title="4.2.2. ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰æŠ€æœ¯"></a>4.2.2. ä»»åŠ¡è°ƒåº¦ç»•è¡Œï¼ˆTask Scheduler Bypassï¼‰æŠ€æœ¯</h4><p>ä¸€ä¸ªä»»åŠ¡ä»äº§ç”Ÿåˆ°è¢«æ‰§è¡Œæ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š</p><blockquote><ul><li>å°†æ–°ä»»åŠ¡åŠ å…¥çº¿ç¨‹çš„ deque ã€‚</li><li>æ‰§è¡Œå½“å‰ä»»åŠ¡ç›´è‡³å®Œæˆã€‚</li><li>ä»çº¿ç¨‹ deque è·å–ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œï¼Œé™¤éè¯¥ä»»åŠ¡è¢«å…¶ä»–çº¿ç¨‹çªƒå–èµ°äº†ã€‚</li></ul></blockquote><p>å…¶ä¸­ï¼Œæ­¥éª¤1 å’Œ æ­¥éª¤3 ä¼šå¼•å…¥ä¸å¿…è¦çš„ deque æ“ä½œï¼Œç”šè‡³æ›´ç³Ÿçš„æ˜¯ï¼Œå…è®¸çªƒå–ä¼šæŸå®³å±€éƒ¨æ€§è€Œä¸ä¼šå¢åŠ æ˜¾è‘—çš„å¹¶è¡Œæ€§ã€‚<br>ä»»åŠ¡è°ƒåº¦å™¨ç»•è¡ŒæŠ€æœ¯å¯ä»¥ç›´æ¥æŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯ç”Ÿäº§è¯¥ä»»åŠ¡ï¼Œä»è€Œé¿å…äº†ä¸Šè¿°é—®é¢˜ã€‚<br>å› ä¸ºæ ¹æ®â€œè§„åˆ™1â€ï¼Œä¸Šä¸€ä¸ªä»»åŠ¡äº§ç”Ÿçš„æ–°ä»»åŠ¡ä¼šç§°ä¸ºç¬¬ä¸€ä¸ªå¤‡é€‰ä»»åŠ¡ã€‚<br>æ­¤å¤–ï¼Œè¯¥æŠ€æœ¯å‡ ä¹ä¿è¯äº†è¯¥æ–°ä»»åŠ¡è¢«å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œè€Œä¸æ˜¯å…¶ä»–çº¿ç¨‹ã€‚</p><p>æ³¨æ„ï¼šå½“å‰å”¯ä¸€èƒ½ä½¿ç”¨è¯¥ä¼˜åŒ–æŠ€æœ¯çš„æ˜¯ä½¿ç”¨ <code>tbb::task_group</code> ã€‚</p><h3 id="4-3-æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding-Task-Scheduler-Executionï¼‰"><a href="#4-3-æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding-Task-Scheduler-Executionï¼‰" class="headerlink" title="4.3. æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding Task Scheduler Executionï¼‰"></a>4.3. æŒ‡å¯¼ä»»åŠ¡è°ƒåº¦å™¨çš„æ‰§è¡Œï¼ˆGuiding Task Scheduler Executionï¼‰</h3><p><a href="https://uxlfoundation.github.io/oneTBB/main/tbb_userguide/Guiding_Task_Scheduler_Execution.html">Guiding Task Scheduler Execution</a></p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»åŠ¡è®¡åˆ’ç¨‹åºä¼šå°è¯•ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„è®¡ç®—èµ„æºã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†ä»»åŠ¡è®¡åˆ’ç¨‹åºé…ç½®ä¸ºä»…ä½¿ç”¨å…¶ä¸­çš„ä¸€äº›èµ„æºã€‚</p><p>æ³¨æ„ï¼šæŒ‡å¯¼ä»»åŠ¡è°ƒåº¦ç¨‹åºçš„æ‰§è¡Œå¯èƒ½ä¼šå¯¼è‡´å¯ç»„åˆæ€§é—®é¢˜ã€‚</p><p>TBB æä¾› <code>task_arena</code> æ¥å£ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æŒ‡å¯¼ä»»åŠ¡åœ¨ arena ï¼ˆç«æŠ€åœºï¼‰å†…è¢«æ‰§è¡Œ:</p><ul><li>è®¾ç½®é¦–é€‰è®¡ç®—å•å…ƒï¼›</li><li>é™åˆ¶éƒ¨åˆ†è®¡ç®—å•å…ƒã€‚</li></ul><h3 id="4-4-å·¥ä½œéš”ç¦»ï¼ˆWork-Isolationï¼‰"><a href="#4-4-å·¥ä½œéš”ç¦»ï¼ˆWork-Isolationï¼‰" class="headerlink" title="4.4. å·¥ä½œéš”ç¦»ï¼ˆWork Isolationï¼‰"></a>4.4. å·¥ä½œéš”ç¦»ï¼ˆWork Isolationï¼‰</h3><p><a href="https://www.intel.com/content/www/us/en/docs/onetbb/developer-guide-api-reference/2021-12/work-isolation.html">Work Isolation</a></p><figure class="highlight cpp"><figcaption><span>work_isolation_eg1.cpp</span><a href="/blog/downloads/code/TBB/work_isolation_eg1.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The first parallel loop.</span></span><br><span class="line">oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N1, []( <span class="type">int</span> i ) {</span><br><span class="line">    <span class="comment">// The second parallel loop.</span></span><br><span class="line">    oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N2, []( <span class="type">int</span> j ) { <span class="comment">/* Some work */</span> } );</span><br><span class="line">} );</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰çº¿ç¨‹è¢« <code>parallel_for</code> â€œé˜»å¡â€ï¼ˆä¸æ˜¯çœŸæ­£çš„é˜»å¡ï¼Œåªèƒ½ç§°ä¸º a blocking parallel constructï¼‰ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹è¢«å…è®¸æ‹¿å–ç¬¬ä¸€ä¸ªå¾ªç¯çš„ä»»åŠ¡æ¥æ‰§è¡Œã€‚è¿™ä¼šå¯¼è‡´å³ä½¿æ˜¯åŒä¸€ä¸ªçº¿ç¨‹å†…ï¼Œä¹Ÿå¯å‡ºç°ä¹±åºæ‰§è¡Œçš„æƒ…å†µã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå±å®³ã€‚</p><p>ä½†æ˜¯å°‘æ•°æƒ…å†µå¯èƒ½å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚ä¸€ä¸ª thread-local å˜é‡å¯èƒ½ä¼šåœ¨åµŒå¥—å¹¶è¡Œæ„é€ ä¹‹å¤–æ„å¤–è¢«æ›´æ”¹ï¼š</p><figure class="highlight cpp"><figcaption><span>work_isolation_eg2.cpp</span><a href="/blog/downloads/code/TBB/work_isolation_eg2.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">oneapi::tbb::enumerable_thread_specific&lt;<span class="type">int</span>&gt; ets;</span><br><span class="line">oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N1, [&amp;ets]( <span class="type">int</span> i ) {</span><br><span class="line">    <span class="comment">// Set a thread specific value</span></span><br><span class="line">    ets.<span class="built_in">local</span>() = i;</span><br><span class="line">    oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N2, []( <span class="type">int</span> j ) { <span class="comment">/* Some work */</span> } );</span><br><span class="line">    <span class="comment">// While executing the above parallel_for, the thread might have run iterations</span></span><br><span class="line">    <span class="comment">// of the outer parallel_for, and so might have changed the thread specific value.</span></span><br><span class="line">    <span class="built_in">assert</span>( ets.<span class="built_in">local</span>()==i ); <span class="comment">// The assertion may fail!</span></span><br><span class="line">} );</span><br></pre></td></tr></table></figure><p>åœ¨å…¶å®ƒåœºæ™¯ä¸‹ï¼Œè¿™ç§è¡Œä¸ºå¯èƒ½ä¼šå¯¼è‡´æ­»é”æˆ–å…¶ä»–é—®é¢˜ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦æ›´æœ‰åŠ›åœ°ä¿è¯çº¿ç¨‹å†…çš„æ‰§è¡Œæ¬¡åºã€‚ä¸ºæ­¤ï¼ŒTBB æä¾›äº†ä¸€äº›éš”ç¦»å¹¶è¡Œæ„é€ çš„æ‰§è¡Œçš„æ–¹æ³•ï¼Œä»¥ä½¿å…¶ä»»åŠ¡ä¸ä¼šå¹²æ‰°å…¶ä»–åŒæ—¶è¿è¡Œçš„ä»»åŠ¡ã€‚</p><p>å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯åœ¨å•ç‹¬çš„ <code>task_arena</code> ä¸­æ‰§è¡Œå†…å±‚å¾ªç¯ï¼š</p><figure class="highlight cpp"><figcaption><span>work_isolation_eg3.cpp</span><a href="/blog/downloads/code/TBB/work_isolation_eg3.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">oneapi::tbb::enumerable_thread_specific&lt;<span class="type">int</span>&gt; ets;</span><br><span class="line">oneapi::tbb::task_arena nested;</span><br><span class="line">oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N1, [&amp;]( <span class="type">int</span> i ) {</span><br><span class="line">    <span class="comment">// Set a thread specific value</span></span><br><span class="line">    ets.<span class="built_in">local</span>() = i;</span><br><span class="line">    nested.<span class="built_in">execute</span>( []{</span><br><span class="line">        <span class="comment">// Run the inner parallel_for in a separate arena to prevent the thread</span></span><br><span class="line">        <span class="comment">// from taking tasks of the outer parallel_for.</span></span><br><span class="line">        oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N2, []( <span class="type">int</span> j ) { <span class="comment">/* Some work */</span> } );</span><br><span class="line">    } );</span><br><span class="line">    <span class="built_in">assert</span>( ets.<span class="built_in">local</span>()==i ); <span class="comment">// Valid assertion</span></span><br><span class="line">} );</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œä½¿ç”¨å•ç‹¬çš„ arena è¿›è¡Œå·¥ä½œéš”ç¦»å¹¶ä¸æ€»æ˜¯æ–¹ä¾¿çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šäº§ç”Ÿæ˜æ˜¾çš„å¼€é”€ã€‚ä¸ºäº†è§£å†³è¿™äº›ç¼ºç‚¹ï¼ŒTBB æä¾› <code>this_task_arena::isolate</code> å‡½æ•°ï¼Œé€šè¿‡é™åˆ¶è°ƒç”¨çº¿ç¨‹ä»…å¤„ç†åœ¨å‡½æ•°å¯¹è±¡èŒƒå›´å†…ï¼ˆä¹Ÿç§°ä¸ºéš”ç¦»åŒºåŸŸï¼‰å®‰æ’çš„ä»»åŠ¡ï¼Œæ¥éš”ç¦»åœ°è¿è¡Œä¸€ä¸ªç”¨æˆ·æä¾›çš„å‡½æ•°å¯¹è±¡ã€‚</p><p>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸€ä¸ªä»»åŠ¡ç­‰å¾…è°ƒç”¨æˆ–ï¼ˆç­‰å¾…ï¼‰åœ¨ä¸€ä¸ªéš”ç¦»åŒºåŸŸå†…çš„é˜»å¡å¹¶è¡Œç»“æ„æ—¶ï¼Œè¯¥çº¿ç¨‹åªèƒ½æ‰§è¡Œåœ¨è¯¥éš”ç¦»åŒºåŸŸå†…ç”Ÿæˆçš„ä»»åŠ¡åŠå…¶ç”±å…¶ä»–çº¿ç¨‹ç”Ÿæˆçš„å­ä»»åŠ¡ï¼ˆæ¢å¥è¯è¯´ï¼Œå³ä½¿å­ä»»åŠ¡æ˜¯ç”±å…¶ä»–çº¿ç¨‹ç”Ÿæˆçš„ï¼Œåªè¦å±äºå½“å‰éš”ç¦»åŒºåŸŸï¼Œå½“å‰çº¿ç¨‹ä¹Ÿå¯ä»¥æ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼‰ã€‚çº¿ç¨‹è¢«ç¦æ­¢æ‰§è¡Œä»»ä½•å¤–å±‚ä»»åŠ¡æˆ–å±äºå…¶ä»–éš”ç¦»åŒºåŸŸçš„ä»»åŠ¡ã€‚</p><p>ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº† <code>this_task_arena::isolate</code> çš„ä½¿ç”¨ï¼Œä»¥ä¿è¯åœ¨åµŒå¥—çš„å¹¶è¡Œç»“æ„è°ƒç”¨æ—¶ï¼Œ thread-local å˜é‡ä¸ä¼šè¢«æ„å¤–ä¿®æ”¹ï¼š</p><figure class="highlight cpp"><figcaption><span>work_isolation_eg4.cpp</span><a href="/blog/downloads/code/TBB/work_isolation_eg4.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;oneapi/tbb/task_arena.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;oneapi/tbb/parallel_for.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;oneapi/tbb/enumerable_thread_specific.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> N1 = <span class="number">1000</span>, N2 = <span class="number">1000</span>;</span><br><span class="line">    oneapi::tbb::enumerable_thread_specific&lt;<span class="type">int</span>&gt; ets;</span><br><span class="line">    oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N1, [&amp;ets]( <span class="type">int</span> i ) {</span><br><span class="line">        <span class="comment">// Set a thread specific value</span></span><br><span class="line">        ets.<span class="built_in">local</span>() = i;</span><br><span class="line">        <span class="comment">// Run the second parallel loop in an isolated region to prevent the current thread</span></span><br><span class="line">        <span class="comment">// from taking tasks related to the outer parallel loop.</span></span><br><span class="line">        oneapi::tbb::this_task_arena::<span class="built_in">isolate</span>( []{</span><br><span class="line">            oneapi::tbb::<span class="built_in">parallel_for</span>( <span class="number">0</span>, N2, []( <span class="type">int</span> j ) { <span class="comment">/* Some work */</span> } );</span><br><span class="line">        } );</span><br><span class="line">        <span class="built_in">assert</span>( ets.<span class="built_in">local</span>()==i ); <span class="comment">// Valid assertion</span></span><br><span class="line">    } );</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p><strong>è¡¥å……ï¼š</strong>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜éš”ç¦»åŒºåŸŸå†…å…¶ä»–çº¿ç¨‹å¦‚ä½•ç”Ÿæˆå­ä»»åŠ¡ï¼Œå¹¶ä¸”è¿™äº›å­ä»»åŠ¡å¯ä»¥ç”±å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªéš”ç¦»åŒºåŸŸï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼šçº¿ç¨‹Aå’Œçº¿ç¨‹Bã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªéš”ç¦»åŒºåŸŸå†…ç”Ÿæˆäº†ä¸€äº›ä»»åŠ¡ï¼Œå¹¶ä¸”è¿™äº›ä»»åŠ¡å¯èƒ½ä¼šç”Ÿæˆå­ä»»åŠ¡ã€‚</p><figure class="highlight cpp"><figcaption><span>work_isolation_eg5.cpp</span><a href="/blog/downloads/code/TBB/work_isolation_eg5.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tbb/tbb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">taskA</span><span class="params">()</span> </span>{</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Task A executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">    tbb::<span class="built_in">parallel_invoke</span>(</span><br><span class="line">         {</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Subtask A1 executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">        },</span><br><span class="line">         {</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Subtask A2 executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">        }</span><br><span class="line">    );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">taskB</span><span class="params">()</span> </span>{</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Task B executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">    tbb::<span class="built_in">parallel_invoke</span>(</span><br><span class="line">         {</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Subtask B1 executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">        },</span><br><span class="line">         {</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Subtask B2 executed by thread &quot;</span> &lt;&lt; tbb::this_task_arena::<span class="built_in">current_thread_index</span>() &lt;&lt; std::endl;</span><br><span class="line">        }</span><br><span class="line">    );</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    tbb::task_arena arena;</span><br><span class="line">    arena.<span class="built_in">execute</span>([&amp;] {</span><br><span class="line">        tbb::this_task_arena::<span class="built_in">isolate</span>([&amp;] {</span><br><span class="line">            tbb::<span class="built_in">parallel_invoke</span>(taskA, taskB);</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>taskA å’Œ taskB æ˜¯åœ¨éš”ç¦»åŒºåŸŸå†…ç”Ÿæˆçš„ä»»åŠ¡ã€‚<br>taskA ç”Ÿæˆäº†ä¸¤ä¸ªå­ä»»åŠ¡ Subtask A1 å’Œ Subtask A2ã€‚<br>taskB ç”Ÿæˆäº†ä¸¤ä¸ªå­ä»»åŠ¡ Subtask B1 å’Œ Subtask B2ã€‚<br>å‡è®¾çº¿ç¨‹Aæ‰§è¡Œäº† taskAï¼Œçº¿ç¨‹Bæ‰§è¡Œäº† taskBã€‚åœ¨éš”ç¦»åŒºåŸŸå†…ï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹Bå¯ä»¥æ‰§è¡Œå½¼æ­¤ç”Ÿæˆçš„å­ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹Aå¯ä»¥æ‰§è¡Œ Subtask B1 æˆ– Subtask B2ï¼Œè€Œçº¿ç¨‹Bå¯ä»¥æ‰§è¡Œ Subtask A1 æˆ– Subtask A2ï¼Œåªè¦è¿™äº›å­ä»»åŠ¡å±äºåŒä¸€ä¸ªéš”ç¦»åŒºåŸŸã€‚</p><h2 id="5-æ¨èé˜…è¯»"><a href="#5-æ¨èé˜…è¯»" class="headerlink" title="5. æ¨èé˜…è¯»"></a>5. æ¨èé˜…è¯»</h2><h3 id="5-1-ä¹¦ç±"><a href="#5-1-ä¹¦ç±" class="headerlink" title="5.1. ä¹¦ç±"></a>5.1. ä¹¦ç±</h3><ol><li>Intel Building Blocks ç¼–ç¨‹æŒ‡å—. James Reinders.</li><li>Patterns for Parallel Pragramming. Timothy Mattson ç­‰.</li><li>è®¾è®¡æ¨¡å¼ï¼šDesign Patterns of Reusable Object-Oriented Software (Addison Wesley). Gamma, Helm, Johnson å’Œ Vlissides.</li></ol>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gcc ä¸ glibc</title>
      <link href="/blog/2024/02/02/cpp/gcc%E4%B8%8Eglibc/"/>
      <url>/blog/2024/02/02/cpp/gcc%E4%B8%8Eglibc/</url>
      
        <content type="html"><![CDATA[<h2 id="gcc"><a href="#gcc" class="headerlink" title="gcc"></a>gcc</h2><p>gccæ˜¯ä¸€ä¸ªç¼–è¯‘å¥—ä»¶ï¼ŒåŒ…å«cã€c++ã€Fortranè¯­è¨€çš„ç¼–è¯‘å™¨ã€‚</p><h2 id="glibc"><a href="#glibc" class="headerlink" title="glibc"></a>glibc</h2><p>glibcæ˜¯ä¸€ä¸ªlibraryï¼Œä¸ºCç¨‹åºæä¾›åŸºç¡€å…¬å…±åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€æ•°å­¦å‡½æ•°å’Œå…¶ä»–æ ¸å¿ƒç»„ä»¶ã€‚<br>Linuxå¹³å°å’Œvscodeä¼¼ä¹éƒ½ä¾èµ–glibcï¼Œå¦‚æœæ“…è‡ªå°†<code>LD_LIBRARY_PATH</code>æ›´æ”¹ä¸ºå…¶ä»–ç‰ˆæœ¬çš„glibcè·¯å¾„ï¼Œåˆ™bashä¼šç›´æ¥crashã€‚</p><h3 id="glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š"><a href="#glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š" class="headerlink" title="glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š"></a>glibcåŒ…å«ä»¥ä¸‹binå’Œlibï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> glibc-v2.34/Linux/RHEL7.0-2017-x86_64/bin &amp;&amp; <span class="built_in">ls</span></span><br><span class="line">catchsegv  getconf  iconv  locale     makedb  pcprofiledump  sotruss  tzselect  zdump</span><br><span class="line">gencat     getent   ldd    localedef  mtrace  pldd           sprof    xtrace</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å…¶ä»–ç‰ˆæœ¬çš„glibc/libç›®å½•æ‰§è¡Œlså‘½ä»¤ä¼šæŠ¥é”™ï¼Œå¤§æ¦‚åŸå› å¯èƒ½æ˜¯å› ä¸ºå½“å‰è·¯å¾„çš„glibcçš„libå’Œç³»ç»Ÿçš„libå†²çªã€‚</span></span><br><span class="line">$ <span class="built_in">cd</span> ../lib &amp;&amp; <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span>: relocation error: ./libc.so.6: symbol __tunable_get_val, version GLIBC_PRIVATE not defined <span class="keyword">in</span> file ld-linux-x86-64.so.2 with <span class="built_in">link</span> time reference</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">ls</span> lib</span><br><span class="line">Mcrt1.o               libanl.so.1             libm.so             libnss_hesiod.so.2</span><br><span class="line">Scrt1.o               libc.a                  libm.so.6           libpcprofile.so</span><br><span class="line">audit                 libc.so                 libmcheck.a         libpthread.a</span><br><span class="line">crt1.o                libc.so.6               libmemusage.so      libpthread.so.0</span><br><span class="line">crti.o                libc_malloc_debug.so    libmvec.a           libresolv.a</span><br><span class="line">crtn.o                libc_malloc_debug.so.0  libmvec.so          libresolv.so</span><br><span class="line">gconv                 libc_nonshared.a        libmvec.so.1        libresolv.so.2</span><br><span class="line">gcrt1.o               libcrypt.a              libnsl.so.1         librt.a</span><br><span class="line">ld-linux-x86-64.so.2  libcrypt.so             libnss_compat.so    librt.so.1</span><br><span class="line">libBrokenLocale.a     libcrypt.so.1           libnss_compat.so.2  libthread_db.so</span><br><span class="line">libBrokenLocale.so    libdl.a                 libnss_db.so        libthread_db.so.1</span><br><span class="line">libBrokenLocale.so.1  libdl.so.2              libnss_db.so.2      libutil.a</span><br><span class="line">libSegFault.so        libg.a                  libnss_dns.so.2     libutil.so.1</span><br><span class="line">libanl.a              libm-2.34.a             libnss_files.so.2</span><br><span class="line">libanl.so             libm.a                  libnss_hesiod.so</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š"><a href="#æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š" class="headerlink" title="æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š"></a>æŸ¥çœ‹glibcçš„ç‰ˆæœ¬ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»ä¸Šå¯çŸ¥ï¼Œlddæ˜¯glibcçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€</span></span><br><span class="line">$ ldd --version</span><br></pre></td></tr></table></figure><h3 id="å¯»æ‰¾libc-soçš„è·¯å¾„ï¼š"><a href="#å¯»æ‰¾libc-soçš„è·¯å¾„ï¼š" class="headerlink" title="å¯»æ‰¾libc.soçš„è·¯å¾„ï¼š"></a>å¯»æ‰¾libc.soçš„è·¯å¾„ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ locate libc.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libc.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">$ locate libstdc++.so</span><br><span class="line">/usr/lib/gcc/x86_64-linux-gnu/11/libstdc++.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libstdc++.so.6</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30</span><br><span class="line">/usr/share/gdb/auto-load/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.30-gdb.py</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…glibcï¼š"><a href="#å®‰è£…glibcï¼š" class="headerlink" title="å®‰è£…glibcï¼š"></a>å®‰è£…glibcï¼š</h3><p>Ubuntuå¹³å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install lib6</span><br></pre></td></tr></table></figure><p>RedHatå¹³å°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install glibc</span><br></pre></td></tr></table></figure><h3 id="æ£€æŸ¥GNC-C-Library-libstdc-çš„ç‰ˆæœ¬ï¼š"><a href="#æ£€æŸ¥GNC-C-Library-libstdc-çš„ç‰ˆæœ¬ï¼š" class="headerlink" title="æ£€æŸ¥GNC C++ Library (libstdc++)çš„ç‰ˆæœ¬ï¼š"></a>æ£€æŸ¥GNC C++ Library (libstdc++)çš„ç‰ˆæœ¬ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ strings /usr/lib/libstdc++.so.* | grep LIBCXX</span><br><span class="line">[sjcvl-zhigaoz ] /lan/cva_rel/vxe_main/24.02.650.d000/tools.lnx86/lib/64bit % strings /usr/lib/libstdc++.so.* | grep LIBCXX</span><br><span class="line">GLIBCXX_3.4</span><br><span class="line">GLIBCXX_3.4.1</span><br><span class="line">GLIBCXX_3.4.2</span><br><span class="line">...</span><br><span class="line">GLIBCXX_3.4.19</span><br><span class="line">GLIBCXX_DEBUG_MESSAGE_LENGTH</span><br><span class="line"></span><br><span class="line">$ strings /usr/lib/libc.so.* | grep GLIBC</span><br><span class="line">GLIBC_2.0</span><br><span class="line">GLIBC_2.1</span><br><span class="line">GLIBC_2.1.1</span><br><span class="line">...</span><br><span class="line">GLIBC_2.17</span><br><span class="line">GLIBC_PRIVATE</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æœ‰ä¸€ä¸ªä½¿ç”¨äº†libstdc++çš„ç‰¹å®šçš„binaryæˆ–applicationï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æ£€æŸ¥å…¶ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ldd &lt;your_binary_or_application&gt; | grep libstdc++</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨vscodeçš„â€œRemote SSHâ€å·¥å…·è¯•å›¾è¿æ¥åˆ°Linuxæ—¶ï¼Œå¯èƒ½ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p><blockquote><p>Warning: Missing GLIBCXX &gt;&#x3D; 3.4.25! from &#x2F;usr&#x2F;lib64&#x2F;libstdc++.so.6.0.19<br>Warning: Missing GLIBC &gt;&#x3D; 2.28! from &#x2F;usr&#x2F;lib64&#x2F;libc-2.17.so<br>Error: Missing required dependencies. Please refer to our FAQ <a href="https://aka.ms/vscode-remote/faq/old-linux">https://aka.ms/vscode-remote/faq/old-linux</a> for additional information.</p></blockquote><p>è¿™æ˜¯å› ä¸ºLinuxç³»ç»Ÿä¸Šçš„glibcç‰ˆæœ¬ä¸­ä¸åŒ…å«GLIBCXX_3.4.25åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚æ­¤æ—¶éœ€è¦é™çº§vscodeï¼ˆå»ºè®®åšæ³•ï¼‰æˆ–å‡çº§glibcï¼ˆä¼¼ä¹å¾ˆéš¾ï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gcc </tag>
            
            <tag> glibc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡æ—¶å·¥å…·</title>
      <link href="/blog/2024/01/30/misc/%E8%AE%A1%E6%97%B6%E5%B7%A5%E5%85%B7/"/>
      <url>/blog/2024/01/30/misc/%E8%AE%A1%E6%97%B6%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="times"><a href="#times" class="headerlink" title="times"></a>times</h2><ol><li>bash built-in</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">times</span></span><br></pre></td></tr></table></figure><ol start="2"><li>function</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">clock_t</span> <span class="title">times</span><span class="params">(<span class="keyword">struct</span> tms *buf)</span></span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> timing </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introduction to memory</title>
      <link href="/blog/2024/01/29/linux/Introduction-to-memory/"/>
      <url>/blog/2024/01/29/linux/Introduction-to-memory/</url>
      
        <content type="html"><![CDATA[<h2 id="malloc-free"><a href="#malloc-free" class="headerlink" title="malloc&#x2F;free"></a>malloc&#x2F;free</h2><p>See <a href="https://www.gnu.org/software/libc/manual/html_node/Backtraces.html">this example</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> ** <span class="title">backtrace_symbols</span> <span class="params">(<span class="type">void</span> *<span class="type">const</span> *buffer, <span class="type">int</span> size)</span> </span></span><br></pre></td></tr></table></figure><blockquote><p>The return value of backtrace_symbols is a pointer obtained via the malloc function, and it is the responsibility of the caller to free that pointer. Note that only the return value need be freed, not the individual strings.</p></blockquote><p>Question: Why does it say â€œonly the return value need be freed, not the individual stringsâ€?</p><p>Let us observe the defintion of the <code>malloc</code>&#x2F;<code>free</code> functions first:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> *<span class="title">malloc</span><span class="params">( <span class="type">size_t</span> size )</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">free</span><span class="params">( <span class="type">void</span> *ptr )</span></span>;</span><br></pre></td></tr></table></figure><p><code>free</code> takes a <code>void*</code> pointer to deallocate the memory, it doesnâ€™t care what type it is, even if it is a multi-level pointer. It means that <code>malloc</code> has stored the memory size in some place and <code>free</code> will find it beforing deallocate the memory.</p><p>Let us return the question. The memory pointer returned by <code>backtrace_symbols</code> is the <code>char**</code> type, it must be a whole block contigunous memory using <code>malloc</code> and might be enforced to be transformed as <code>char**</code> pointer when returing. So when we <code>free</code> the memory block, the Linux kernel find its actual memory size and deallocate it.</p><p>Example:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>** strings = (<span class="type">char</span>**)<span class="built_in">malloc</span>(<span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">char</span>*) + <span class="number">3</span> * <span class="number">50</span>); <span class="comment">// assuming a maximum 50 characters per sentence</span></span><br><span class="line">    <span class="type">char</span>* block = (<span class="type">char</span>*)(strings + <span class="number">3</span>);</span><br><span class="line">    <span class="type">char</span>* s1 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The first sentence&quot;</span>); block += <span class="built_in">strlen</span>(s1) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span>* s2 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The second sentence&quot;</span>); block += <span class="built_in">strlen</span>(s2) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span>* s3 = <span class="built_in">strcpy</span>(block, <span class="string">&quot;The third sentence&quot;</span>);</span><br><span class="line">    strings[<span class="number">0</span>] = s1;</span><br><span class="line">    strings[<span class="number">1</span>] = s2;</span><br><span class="line">    strings[<span class="number">2</span>] = s3;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, strings[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(strings); <span class="comment">// deallocate all memory at once</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>More elegant but less economical code:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span>** strings = (<span class="type">char</span>**)<span class="built_in">malloc</span>(<span class="number">3</span> * <span class="built_in">sizeof</span>(<span class="type">char</span>*) + <span class="number">3</span> * <span class="number">50</span>);</span><br><span class="line">    <span class="type">char</span>* block = (<span class="type">char</span>*)(strings + <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        strings[i] = block + i * <span class="number">50</span>; <span class="comment">// Assuming a maximum of 50 characters per sentence</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">0</span>], <span class="string">&quot;The first sentence&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">1</span>], <span class="string">&quot;The second sentence&quot;</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(strings[<span class="number">2</span>], <span class="string">&quot;The third sentence&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, strings[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(strings); <span class="comment">// deallocate all memory at once</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.gnu.org/software/libc/manual/html_node/Memory_002dmapped-I_002fO.html">The GNU C Library (glibc) manual: 13.8 Memory-mapped I&#x2F;O</a></li><li><a href="https://www.gnu.org/software/libc/manual/html_node/Memory-Protection.html">The GNU C Library (glibc) manual: 3.4 Memory Protection</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> memory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UML</title>
      <link href="/blog/2024/01/29/UML/"/>
      <url>/blog/2024/01/29/UML/</url>
      
        <content type="html"><![CDATA[<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://cloud.tencent.com/developer/article/1176331">è®¤è¯†UMLç±»å…³ç³»â€”â€”ä¾èµ–ã€å…³è”ã€èšåˆã€ç»„åˆã€æ³›åŒ–</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell Commands</title>
      <link href="/blog/2024/01/26/linux/Shell-Commands/"/>
      <url>/blog/2024/01/26/linux/Shell-Commands/</url>
      
        <content type="html"><![CDATA[<h2 id="shuf"><a href="#shuf" class="headerlink" title="shuf"></a>shuf</h2><h2 id="cut"><a href="#cut" class="headerlink" title="cut"></a>cut</h2><h2 id="tr"><a href="#tr" class="headerlink" title="tr"></a>tr</h2><h2 id="lp"><a href="#lp" class="headerlink" title="lp"></a>lp</h2><h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><p>Options:</p><pre><code>-t, --field-separator=SEP    use SEP instead of non-blank to blank transition-k, --key=POS1[,POS2]    start a key at POS1 (origin 1), end it at POS2 (default end of line)-h, --human-numeric-sort    compare human readable numbers (e.g., 2K 1G)-n, --numeric-sort    compare according to string numerical value</code></pre><h2 id="nproc"><a href="#nproc" class="headerlink" title="nproc"></a>nproc</h2><p>print the number of processing units avaiable.</p><h2 id="od-xxd-hexdump"><a href="#od-xxd-hexdump" class="headerlink" title="od &#x2F; xxd &#x2F; hexdump"></a>od &#x2F; xxd &#x2F; hexdump</h2><p>read the binary file.</p><p>Notes: byte order</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&quot;ABCD&quot;</span> | xxd</span><br><span class="line">00000000: 4142 4344                                ABCD</span><br><span class="line">$ <span class="built_in">echo</span> -n <span class="string">&quot;ABCD&quot;</span> | hexdump</span><br><span class="line">0000000 4241 4443                              </span><br><span class="line">0000004</span><br></pre></td></tr></table></figure><p><a href="https://unix.stackexchange.com/questions/282215/how-to-view-a-binary-file">Reference</a></p><h2 id="comm-diff-tkdiff-cmp"><a href="#comm-diff-tkdiff-cmp" class="headerlink" title="comm &#x2F; diff &#x2F; tkdiff &#x2F; cmp"></a>comm &#x2F; diff &#x2F; tkdiff &#x2F; cmp</h2><p>Can be used to compare binary or non-binary files.</p><h3 id="comm"><a href="#comm" class="headerlink" title="comm"></a>comm</h3><p>compare two sorted files line by line.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> file1.txt </span><br><span class="line">apple</span><br><span class="line">banana</span><br><span class="line">cherry</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> file2.txt </span><br><span class="line">banana</span><br><span class="line">cherry</span><br><span class="line"><span class="built_in">date</span></span><br><span class="line">erase</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">comm</span> file1.txt file2.txt </span><br><span class="line">apple</span><br><span class="line">                banana</span><br><span class="line">                cherry</span><br><span class="line">        <span class="built_in">date</span></span><br><span class="line">        erase</span><br></pre></td></tr></table></figure><p>The file must be sorted before using the <code>comm</code> command. Otherwise it will complain that:</p><pre><code>comm: file 1 is not in sorted order</code></pre><p>and cannot work correctly. For example,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> file1.txt </span><br><span class="line">apple</span><br><span class="line">cherry</span><br><span class="line">banana</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> file2.txt </span><br><span class="line">banana</span><br><span class="line">cherry</span><br><span class="line"><span class="built_in">date</span></span><br><span class="line">erase</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">comm</span> file1.txt file2.txt </span><br><span class="line">apple</span><br><span class="line">        banana</span><br><span class="line">                cherry</span><br><span class="line"><span class="built_in">comm</span>: file 1 is not <span class="keyword">in</span> sorted order</span><br><span class="line">banana</span><br><span class="line">        <span class="built_in">date</span></span><br><span class="line">        erase</span><br><span class="line"><span class="built_in">comm</span>: input is not <span class="keyword">in</span> sorted order</span><br></pre></td></tr></table></figure><h3 id="diff"><a href="#diff" class="headerlink" title="diff"></a>diff</h3><p>Syntax:</p><pre><code>diff -u file1 file2</code></pre><p>Options:</p><pre><code>-e, --ed    output an ed script-u, -U NUM, --unified[=NUM]    output NUM (default 3) lines of unified context    (that is, print NUM lines before and after the difference line)</code></pre><h3 id="tkdiff"><a href="#tkdiff" class="headerlink" title="tkdiff"></a>tkdiff</h3><p>Use a GUI to display the differences.</p><h3 id="cmp"><a href="#cmp" class="headerlink" title="cmp"></a>cmp</h3><p>Prints less information comparing to <code>diff</code>.</p><p>Syntax:</p><pre><code>cmp file1 file2</code></pre><h2 id="ed-vim-sed-awk"><a href="#ed-vim-sed-awk" class="headerlink" title="ed&#x2F;vim&#x2F;sed&#x2F;awk"></a>ed&#x2F;vim&#x2F;sed&#x2F;awk</h2>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ åˆå§‹åŒ–åˆ—è¡¨</title>
      <link href="/blog/2024/01/26/cpp/C++%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%97%E8%A1%A8/"/>
      <url>/blog/2024/01/26/cpp/C++%E5%88%9D%E5%A7%8B%E5%8C%96%E5%88%97%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ—è¡¨åˆå§‹åŒ–"><a href="#åˆ—è¡¨åˆå§‹åŒ–" class="headerlink" title="åˆ—è¡¨åˆå§‹åŒ–"></a>åˆ—è¡¨åˆå§‹åŒ–</h2><p>struct&#x2F;union&#x2F;arrayé»˜è®¤æ”¯æŒåˆ—è¡¨åˆå§‹åŒ–ã€‚</p><p><a href="https://en.cppreference.com/w/c/language/struct_initialization">Struct and union initialization</a><br><a href="https://en.cppreference.com/w/c/language/array_initialization">Array initialization</a></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;initializer_list&gt;</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x, y, z; <span class="comment">// æ³¨æ„ï¼šæ•°æ®æˆå‘˜å¿…é¡»æ˜¯publicçš„ã€‚</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; z &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec_;</span><br><span class="line">    <span class="type">int</span> x_;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;vec_=&#123; &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : vec_) &#123;</span><br><span class="line">            cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;&#125;, x_=&quot;</span> &lt;&lt; x_ &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec_;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;vec_=&#123; &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : vec_) &#123;</span><br><span class="line">            cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;&#125;&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// C++ä¼šæ„é€ ä¸€ä¸ªåˆ—è¡¨åˆå§‹åŒ–çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œ</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹(1)å’Œ(2)éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªé»˜è®¤æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line">    A a1&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;; <span class="comment">// (1) åˆ—è¡¨åˆå§‹åŒ–</span></span><br><span class="line">    <span class="function">A <span class="title">a2</span><span class="params">(&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;)</span></span>; <span class="comment">// (2) åŒ(1)</span></span><br><span class="line">    a1.<span class="built_in">print</span>();</span><br><span class="line">    a2.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    B b1&#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;, <span class="number">4</span>&#125;; <span class="comment">// å†…éƒ¨çš„&quot;&#123;1,2,3&#125;&quot;ç”¨äºæ„é€ vec_ï¼Œ&quot;4&quot;ç”¨äºåˆå§‹åŒ–x_</span></span><br><span class="line">    b1.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// C C1&#123;1,2,3&#125;; // (1) è¿™é‡Œä¼šæŠ¥é”™&quot;error: too many initializers for â€˜Câ€™&quot;ï¼Œ</span></span><br><span class="line">    <span class="comment">//              //     å› ä¸ºCåªæœ‰ä¸€ä¸ªæ•°æ®æˆå‘˜vec_ï¼Œè¿™é‡Œå´ä¼ å…¥äº†3ä¸ªå‚æ•°</span></span><br><span class="line">    C c2&#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;&#125;; <span class="comment">// (2) å…¶ä¸­ï¼Œå†…éƒ¨çš„&quot;&#123;1,2,3&#125;&quot;ç”¨äºæ„é€ vec_ï¼Œå¤–å±‚çš„&quot;&#123;&#125;&quot;ç”¨äºå¯¹c2æœ¬èº«è¿›è¡Œæ„é€ </span></span><br><span class="line">    c2.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="std-initializer-list"><a href="#std-initializer-list" class="headerlink" title="std::initializer_list"></a>std::initializer_list</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;initializer_list&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, y, z;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">A</span>(initializer_list&lt;<span class="type">int</span>&gt; il) &#123;</span><br><span class="line">        initializer_list&lt;<span class="type">int</span>&gt;::iterator it = il.<span class="built_in">begin</span>();</span><br><span class="line">        x = *it++;</span><br><span class="line">        y = *it++;</span><br><span class="line">        z = *it++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; z &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">B</span>(initializer_list&lt;<span class="type">int</span>&gt; il) &#123;</span><br><span class="line">        vec = il; <span class="comment">// ç”¨initializer_liståˆå§‹åŒ–vector</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;&#123; &quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : vec) &#123;</span><br><span class="line">            cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;&#125;&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    a.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    B b&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    b.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Brackets in Bash</title>
      <link href="/blog/2024/01/25/linux/Brackets-in-Bash/"/>
      <url>/blog/2024/01/25/linux/Brackets-in-Bash/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸­æ‹¬å·"><a href="#ä¸­æ‹¬å·" class="headerlink" title="ä¸­æ‹¬å·"></a>ä¸­æ‹¬å·</h2><ol><li><p><code>[ ]</code>å’Œ<code>test</code>æ˜¯bashçš„å†…éƒ¨å‘½ä»¤ï¼Œ<code>[[ ]]</code>æ˜¯shellçš„æ¡ä»¶åˆ¤æ–­å…³é”®å­—ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">type</span> [</span><br><span class="line">[ is a shell <span class="built_in">builtin</span></span><br><span class="line">$ <span class="built_in">type</span> <span class="built_in">test</span></span><br><span class="line"><span class="built_in">test</span> is a shell <span class="built_in">builtin</span></span><br><span class="line">$ <span class="built_in">type</span> [[</span><br><span class="line">[[ is a shell keyword</span><br></pre></td></tr></table></figure></li><li><p><code>[ ]</code>å’Œ<code>test</code>æ˜¯ç­‰ä»·çš„ï¼Œç”¨äºè¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼ã€‚å¯ä»¥ä½¿ç”¨<code>man [</code>æˆ–<code>help [</code>æŸ¥é˜…å¸®åŠ©æ–‡æ¡£ã€‚</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">help</span> [</span><br><span class="line">[: [ arg... ]</span><br><span class="line">    Evaluate conditional expression.</span><br><span class="line">    </span><br><span class="line">    This is a synonym <span class="keyword">for</span> the <span class="string">&quot;test&quot;</span> <span class="built_in">builtin</span>, but the last argument must</span><br><span class="line">    be a literal `]<span class="string">&#x27;, to match the opening `[&#x27;</span>.</span><br></pre></td></tr></table></figure></li><li><p><code>[[ ]]</code>å…³é”®å­—å¯ä»¥å±è”½shellç‰¹æ®Šç¬¦å·ï¼Œæ¯”å¦‚<code>&amp;&amp;</code>ã€<code>||</code>ã€<code>&gt;</code>å’Œ<code>&lt;</code>å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ¡ä»¶åˆ¤æ–­ç¬¦è€Œä¸æ˜¯é‡å®šå‘ç¬¦ã€‚</p></li><li><p><code>[ ]</code>ä¸­ä½¿ç”¨<code>-a</code>å’Œ<code>-o</code>è¡¨ç¤ºé€»è¾‘ä¸å’Œé€»è¾‘æˆ–ï¼Œ<code>[[ ]]</code>ä¸­åˆ™ä½¿ç”¨<code>&amp;&amp;</code>å’Œ<code>||</code>ã€‚</p></li></ol><h2 id="å°æ‹¬å·"><a href="#å°æ‹¬å·" class="headerlink" title="å°æ‹¬å·"></a>å°æ‹¬å·</h2><ol><li><code>$()</code>ç”¨äºå‘½ä»¤æ›¿æ¢ã€‚</li><li>åŒå°æ‹¬å·<code>(( ))</code>ï¼šåœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­ä½¿ç”¨é«˜çº§æ•°å­¦è¡¨è¾¾å¼ã€‚</li></ol><h2 id="å¤§æ‹¬å·"><a href="#å¤§æ‹¬å·" class="headerlink" title="å¤§æ‹¬å·"></a>å¤§æ‹¬å·</h2><p>è¯·é˜…è¯»ï¼š<a href="https://www.linux.com/topic/desktop/all-about-curly-braces-bash/">All about {Curly Braces} in Bash</a></p><ol><li><p><code>$&#123;&#125;</code>ç”¨äºå¼•ç”¨å˜é‡ã€‚</p><p> ä¸<code>$var</code>ç›¸æ¯”ï¼Œ<code>$&#123;var&#125;</code>æ˜¯ä¸€ç§æ¶ˆé™¤æ­§ä¹‰çš„æªæ–½ï¼Œæ¯”å¦‚ï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ var=abc</span><br><span class="line">$ vartest=ABC</span><br><span class="line"><span class="comment"># $varå¼•ç”¨å˜é‡&#x27;var&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$var</span></span><br><span class="line">abc</span><br><span class="line"><span class="comment"># å¼•ç”¨å˜é‡&#x27;vartest&#x27;</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$vartest</span></span><br><span class="line">ABC</span><br><span class="line"><span class="comment"># å¼•ç”¨å˜é‡&#x27;var&#x27;å¹¶åœ¨å…¶ååŠ ä¸Š&#x27;test&#x27;å­—ç¬¦</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="variable">$&#123;var&#125;</span><span class="built_in">test</span></span><br><span class="line">abctest</span><br></pre></td></tr></table></figure></li><li><p><code>&#123;&#125;</code>è¡¨ç¤ºåˆ†ç»„ã€‚</p></li></ol><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.cnblogs.com/zeweiwu/p/5485711.html">Shellä¸­testã€å•ä¸­æ‹¬å·ã€åŒä¸­æ‹¬å·çš„åŒºåˆ«</a></li><li><a href="https://www.baeldung.com/linux/bash-single-vs-double-brackets">Differences Between Single and Double Brackets in Bash</a></li><li><a href="https://www.jianshu.com/p/3e1eaaa3fee8">Shellä¸­çš„æ‹¬å·ã€åŒæ‹¬å·ã€æ–¹æ‹¬å·å’ŒåŒæ–¹æ‹¬å·</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Regular Expression</title>
      <link href="/blog/2024/01/25/linux/Regular-Expression/"/>
      <url>/blog/2024/01/25/linux/Regular-Expression/</url>
      
        <content type="html"><![CDATA[<h2 id="regexp"><a href="#regexp" class="headerlink" title="regexp"></a>regexp</h2><h2 id="ERegExp"><a href="#ERegExp" class="headerlink" title="ERegExp"></a>ERegExp</h2><h2 id="Wildcard-Glob"><a href="#Wildcard-Glob" class="headerlink" title="Wildcard&#x2F;Glob"></a>Wildcard&#x2F;Glob</h2><p><code>man 7 glob</code></p><blockquote><p>glob - globbing pathnames. glob is a shell built-in.</p><p>ä¸»è¦ç”¨äºåŒ¹é…å¸¦æœ‰é€šé…ç¬¦çš„æ–‡ä»¶è·¯å¾„ã€‚å…¶åŒ¹é…å­—ç¬¦ä¸²çš„èƒ½åŠ›æ¯”æ­£åˆ™è¡¨è¾¾å¼å¼±ã€‚</p><p>å®ƒæœ€åˆæ˜¯è´å°”å®éªŒå®¤ Unix ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªåå« glob çš„å‘½ä»¤ï¼ˆglob æ˜¯ global çš„ç¼©å†™ï¼‰ï¼Œç”¨äºå±•å¼€å‘½ä»¤è¡Œä¸­çš„é€šé…ç¬¦ã€‚åæ¥ç³»ç»Ÿæä¾›äº†è¯¥åŠŸèƒ½çš„ C è¯­è¨€åº“å‡½æ•°glob()ï¼ŒçŸ¥åçš„ shell è§£é‡Šå™¨å°±ä½¿ç”¨äº†è¯¥æ¥å£ï¼Œshell è„šæœ¬å’Œå‘½ä»¤è¡Œä¸­ä½¿ç”¨çš„ glob æ¨¡å¼åŒ¹é…åŠŸèƒ½ä¾¿æºè‡ªäºæ­¤ã€‚â€”â€”è§<a href="https://juejin.cn/post/6844904077801816077">åšå®¢</a>ã€‚</p></blockquote><p><a href="https://tldp.org/LDP/GNU-Linux-Tools-Summary/html/x11655.htm">Wildcards</a></p><p><code>&#123;&#125;</code>ä¸¥æ ¼æ¥è®²ä¸å±äºglobçš„èŒƒç•´ï¼Œå…¶åœ¨shellè¡¨ç¤ºä¸€ä¸ªåˆ†ç»„ï¼Œè§ï¼š<a href="https://www.linux.com/topic/desktop/all-about-curly-braces-bash/">All about {Curly Braces} in Bash</a>ã€‚</p><h2 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h2><h2 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h2><p><a href="https://www.ibm.com/docs/nl/aix/7.2?topic=awk-command">awk Command</a></p><h3 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F<span class="string">&#x27; *|:&#x27;</span> <span class="string">&#x27;/LISTEN/&#123;print $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>-F</code>è¡¨ç¤ºåˆ†éš”ç¬¦ï¼›<br><code> *|:</code>æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºä»¥â€ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼â€æˆ–â€:â€ä½œä¸ºåˆ†éš”ç¬¦ï¼›<br>å†å…¶åçš„<code>//</code>ä¸­æ˜¯å¦ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…æ–‡æœ¬ï¼›<br><code>&#123;&#125;</code>ä¸­æ˜¯actionã€‚</p><h3 id="æ¡ä»¶åˆ¤æ–­"><a href="#æ¡ä»¶åˆ¤æ–­" class="headerlink" title="æ¡ä»¶åˆ¤æ–­"></a>æ¡ä»¶åˆ¤æ–­</h3><p><a href="https://tecadmin.net/awk-conditional-statements/">if-else in awk</a><br><a href="https://unix.stackexchange.com/questions/660178/how-to-use-and-and-or-together-in-an-awk-program">use AND and OR in an awk program</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;if ($1 &gt; 49151 &amp;&amp; $1 &lt; 65536) &#123;print $1&#125; &#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;$1 &gt; 49151 &amp;&amp; $1 &lt; 65536&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="BEGIN-END"><a href="#BEGIN-END" class="headerlink" title="BEGIN&#x2F;END"></a>BEGIN&#x2F;END</h3><p>In AWK, <code>BEGIN</code> and <code>END</code> are special patterns that allow you to execute code before processing the input (<code>BEGIN</code>) or after processing all the input (<code>END</code>).</p><ul><li>The <code>BEGIN</code> block is executed once at the beginning of the AWK program and it is typically used for initializing variables or performing setup tasks.</li><li>The <code>END</code> block is executed once after processing all input, and it is commonly used for final caclucations, summaries, or printing results.</li></ul><h3 id="Special-symbols"><a href="#Special-symbols" class="headerlink" title="Special symbols"></a>Special symbols</h3><ul><li><code>$</code> ç”¨äºå¼•ç”¨fieldï¼Œä¾‹å¦‚<code>$1</code>ä»£è¡¨ç¬¬ä¸€ä¸ªfieldï¼ˆå…¸å‹æ¥è¯´æ˜¯ç¬¬ä¸€åˆ—ï¼‰ã€‚</li><li><code>NF</code> è¡¨ç¤ºnumber of filedï¼Œå‡è®¾ä¸€å…±æœ‰7åˆ—ï¼Œé‚£ä¹ˆ<code>$NF</code>ä¸<code>$7</code>ç­‰ä»·ã€‚</li></ul><h2 id="grep"><a href="#grep" class="headerlink" title="grep"></a>grep</h2><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><ol><li>æ‰¾å‡ºä¸€ä¸ªæœªä½¿ç”¨çš„port</li></ol><div class="tabs" id="code"><ul class="nav-tabs"><li class="tab active"><a href="#code-1">Makefile</a></li><li class="tab"><a href="#code-2">Bash</a></li><li class="tab"><a href="#code-3">Python</a></li></ul><div class="tab-content"><div class="tab-pane active" id="code-1"><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &quot;$$&quot;æ˜¯ä¸ºäº†è½¬ä¹‰&quot;$&quot;</span></span><br><span class="line">max_port=<span class="variable">$(<span class="built_in">shell</span> netstat -antulpen 2&gt; /dev/null \</span></span><br><span class="line"><span class="variable">    | awk -F&#x27; *&#x27; &#x27;/^(tcp|udp)</span>/&#123;print $$4&#125;&#x27; | cut -d: -f 2 \</span><br><span class="line">    | egrep <span class="string">&quot;\w&quot;</span> | sort | tail -1)</span><br><span class="line"><span class="comment">#$(warning $&#123;max_port&#125;)</span></span><br><span class="line">port=<span class="variable">$(<span class="built_in">shell</span> expr <span class="variable">$(max_port)</span> + 1)</span></span><br><span class="line"><span class="comment">#$(warning $&#123;port&#125;)</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="code-2"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»1025å¼€å§‹æ‰¾å‡ºå·²ç»å­˜åœ¨çš„ç«¯å£ï¼Œå¦‚æœç›¸é‚»ç«¯å£çš„gapå¤§äº1ï¼Œåˆ™è¿”å›â€œå½“å‰ç«¯å£å·+1â€</span></span><br><span class="line">netstat -ant | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span> \</span><br><span class="line">    | awk -F: <span class="string">&#x27;&#123;if ($NF ~ /^[0-9]+$/ &amp;&amp; $NF &gt; 1024) &#123;print $NF&#125;&#125;&#x27;</span> \</span><br><span class="line">    | awk <span class="string">&#x27;BEGIN &#123;prev = 1024&#125; </span></span><br><span class="line"><span class="string">        &#123;if ($1 - prev &gt; 1) &#123; port = prev + 1; exit&#125; else &#123; prev = $1&#125;&#125; </span></span><br><span class="line"><span class="string">        END &#123; if (port==&quot;&quot;) &#123;print prev + 1&#125; else &#123;print port&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="code-3"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿™ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">#ä»¥0ç«¯å£ä¸ºå‚æ•°åˆ›å»ºä¸€ä¸ªsocketï¼Œåˆ™ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#one-line mode:</span></span><br><span class="line"><span class="comment">#python -c &#x27;import socket; s=socket.socket(); s.bind((&quot;&quot;, 0)); print(s.getsockname()[1]); s.close()&#x27;</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((<span class="string">&#x27;&#x27;</span>, <span class="number">0</span>))</span><br><span class="line">addr = s.getsockname()</span><br><span class="line"><span class="built_in">print</span>(addr[<span class="number">1</span>])</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure></div></div></div>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Killings at Badger&#39;s Drift</title>
      <link href="/blog/2024/01/24/english/The-Killings-at-Badger-s-Drift/"/>
      <url>/blog/2024/01/24/english/The-Killings-at-Badger-s-Drift/</url>
      
        <content type="html"><![CDATA[<h2 id="Video"><a href="#Video" class="headerlink" title="Video"></a>Video</h2><p>è§†é¢‘ï¼š<a href="https://tubitv.com/tv-shows/521987/s01-e01-the-killings-at-badgers-drift">é“¾æ¥</a>ã€‚</p><p>å½±ç‰‡åï¼šMidsomer Murders, S01:E01, <a href="https://www.google.com/search?q=+Badger%27s+Drift+&rlz=1C1GCEJ_enUS1023US1023&ei=fnuzZJivL96x0PEP4MunkAc&ved=0ahUKEwiY5oz5upKAAxXeGDQIHeDlCXIQ4dUDCBA&uact=5&oq=+Badger%27s+Drift+&gs_lp=Egxnd3Mtd2l6LXNlcnAiECBCYWRnZXIncyBEcmlmdCAyBxAuGBMYgAQyDRAuGBMYgAQYxwEYrwEyBxAAGBMYgAQyBxAAGBMYgAQyCRAAGBMYgAQYCjIHEAAYExiABDIHEAAYExiABDIHEAAYExiABDIHEAAYExiABDIHEAAYExiABDIWEC4YExiABBiXBRjcBBjeBBjgBNgBAUj3MFCYDViYDXAFeAGQAQCYAb0CoAG9AqoBAzMtMbgBA8gBAPgBAvgBAcICChAAGEcY1gQYsAPiAwQYACBBiAYBkAYKugYGCAEQARgU&sclient=gws-wiz-serp">The Killings at Badgerâ€™s Drift</a></p><p>S01:E01 - Season 01 : Episode 01ï¼Œç¬¬1å­£ç¬¬1é›†ã€‚episodeï¼Œæ’æ›²ï¼ˆæŸäº‹ä»¶ï¼›æŸäº‹å‘ç”Ÿçš„çŸ­æš‚æ—¶é—´ï¼‰ï¼›å‰§é›†ï¼ˆ<a href="https://www.ldoceonline.com/dictionary/episode">ä¸€èˆ¬ä¸€å‘¨æ›´æ–°æ”¾æ˜ ä¸€æ¬¡</a>ï¼‰ã€‚</p><p>midsomer - <a href="https://www.wordnik.com/words/midsomer">midsummerçš„è¿‡æ—¶å†™æ³•</a>ã€‚æœ¬ç‰‡ä¸­æ˜¯<a href="https://en.wikipedia.org/wiki/Midsomer_Murders">ä¸€ä¸ªè™šæ„çš„è‹±æ ¼å…°å¿</a>ï¼Œå½±ç‰‡å¼€å¤´æœ‰ä¸€ä¸ªè·¯ç‰Œï¼Œå†™ç€ï¼šâ€œBadgerâ€™s Drift, Midsomerâ€™s best kept villageâ€ï¼Œæ„æ€å¤§æ¦‚æ˜¯ï¼ŒBadgerâ€™s Driftæ˜¯Midsomerä¿å­˜æœ€å¥½çš„æ‘åº„ã€‚</p><h2 id="å¼€å¹•ä»‹ç»"><a href="#å¼€å¹•ä»‹ç»" class="headerlink" title="å¼€å¹•ä»‹ç»"></a>å¼€å¹•ä»‹ç»</h2><p>Screenplay by Anthony Horowitz - Screenplay å‰§æœ¬ã€‚</p><p>From the novel by Caroline Graham</p><p>Starring - ä¸»æ¼”</p><p>Directed by - å¯¼æ¼”æ˜¯</p><p>caption - å­—å¹•ã€‚</p><p>subtitle - å­—å¹•ã€‚</p><h2 id="ç¬¬ä¸€å¹•-Emilyä¹‹æ­»"><a href="#ç¬¬ä¸€å¹•-Emilyä¹‹æ­»" class="headerlink" title="ç¬¬ä¸€å¹• Emilyä¹‹æ­»"></a>ç¬¬ä¸€å¹• Emilyä¹‹æ­»</h2><h3 id="æ‘è½å°è·¯ä¸Š"><a href="#æ‘è½å°è·¯ä¸Š" class="headerlink" title="æ‘è½å°è·¯ä¸Š"></a>æ‘è½å°è·¯ä¸Š</h3><p>-[Doctor] Hello, Missis Simpson. Have a very good afternoon.</p><p>bright playful music - æ˜å¿«ä¿çš®çš„éŸ³ä¹ã€‚</p><p>Daily Mirror, forward with the people. è¿™æ˜¯ä¸€å—æ‹›ç‰Œä¸Šçš„å­—æ ·ã€‚ã€Šæ¯æ—¥é•œæŠ¥ã€‹çš„å£å·æ˜¯â€œä¸äººæ°‘åŒè¡Œâ€ï¼ŒThe Sunâ€™s slogan was â€˜Forward with the Peopleâ€™, which had been adopted by the Mirror in 1945 and only recently dropped. - å‚è§è°·æ­Œå¿«ç…§ã€Š<a href="https://webcache.googleusercontent.com/search?q=cache:32HydJ4eVUYJ:https://www.gale.com/intl/essays/adrian-bingham-introduction-daily-mirror&cd=9&hl=zh-CN&ct=clnk&gl=us">An Introduction to the Daily Mirror</a>ã€‹ã€‚haydayå¥½å¤©æ°”ï¼Œå…¨ç››æ—¶æœŸã€‚hayå¹²è‰ã€‚</p><p>-[Lucy] Ah, sneaking off, arenâ€™t you, Emily? å·å·æºœèµ°ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>-[Emily] I wouldnâ€™t call it sneaking, Lucy. Anyway, whoâ€™s talking? Youâ€™ve been out all day! æˆ‘ä¸ä¼šç§°å®ƒä¸ºæºœã€‚ä¸ç®¡æ€æ ·ï¼Œæ˜¯è°åœ¨è¯´è¯ï¼Ÿä½ è‡ªå·±å·²ç»å‡ºå»ä¸€æ•´å¤©äº†ï¼</p><p>-Iâ€™m not gonna tell you where. æˆ‘ä¸ä¼šå‘Šè¯‰ä½ æˆ‘å»äº†å“ªé‡Œã€‚</p><p>-You didnâ€™t find it? ä½ æ²¡æœ‰æ‰¾åˆ°ï¼Ÿ</p><p>-No. æ²¡æœ‰ã€‚</p><p>-Youâ€™ll be buying me tea this year, my dear. You wait and see! ä»Šå¹´ä½ ä¼šç»™æˆ‘ä¹°èŒ¶ï¼Œä½ ç­‰ç€çœ‹ï¼</p><p>-Chance would be a fine thing! æœ‰æœºä¼šï¼ˆè®©æˆ‘ç»™ä½ ä¹°èŒ¶ï¼‰å°±å¥½äº†ï¼</p><p>pros and cons - <a href="https://www.merriam-webster.com/dictionary/pros%20and%20cons">ä¼˜ç‚¹å’Œç¼ºç‚¹</a>ã€‚</p><h3 id="æ ‘æ—"><a href="#æ ‘æ—" class="headerlink" title="æ ‘æ—"></a>æ ‘æ—</h3><p>birds chirp - é¸Ÿå„¿å½å½å–³å–³ã€‚</p><p>Spurred coral root - åˆºçŠç‘šæ ¹ã€‚spuré©¬åˆºã€‚â€Itâ€™s an orchidï¼ˆå…°èŠ±ï¼‰, not a flower.â€</p><p>padlock clicks - æŒ‚é”å’”å’”å£°ã€‚</p><p>camera clicks - ç›¸æœºå’”å’”å£°ã€‚</p><p>man moans - ç”·äººå‘»åŸã€‚</p><p>man pants - ç”·äººå–˜æ¯ã€‚pantå–˜æ°”ã€‚</p><p>bird flaps - é¸Ÿå„¿æ‹é£ã€‚</p><p>Emily shrieks - Emilyå°–å«ã€‚</p><h3 id="Emilyå›å®¶è·¯ä¸Š"><a href="#Emilyå›å®¶è·¯ä¸Š" class="headerlink" title="Emilyå›å®¶è·¯ä¸Š"></a>Emilyå›å®¶è·¯ä¸Š</h3><p>brakes screech - åˆ¹è½¦å£°ã€‚brakeåˆ¹è½¦ï¼Œscreechå‘å‡ºå°–å«ã€å™ªå£°ã€‚</p><h3 id="Emilyå®¶"><a href="#Emilyå®¶" class="headerlink" title="Emilyå®¶"></a>Emilyå®¶</h3><p>slow sinister music - sinisteré™©æ¶çš„ã€‚</p><p>bees buzz - èœœèœ‚å—¡å—¡ã€‚</p><p>beehive cottage - èœ‚å·¢å°å±‹ã€‚beehive &#x2F;ËˆbiË.haÉªv&#x2F; èœ‚çªï¼›cottage &#x2F;ËˆkÉ‘Ë.tÌ¬ÉªdÊ’&#x2F; &#x2F;ËˆkÉ’t.ÉªdÊ’&#x2F;å°å±‹ã€‚</p><p>cat meows - meow &#x2F;ËŒmiËˆaÊŠ&#x2F; å–µ</p><p>Come on, out you go - æ¥ï¼Œä½ å‡ºå»ã€‚</p><p>door thuds - é—¨ç °çš„ä¸€å£°ã€‚thud &#x2F;Î¸ÊŒd&#x2F; æ’å‡»å£°ï¼Œç °ã€‚</p><p>dial up phone rattles - æ‹¨å·å˜å˜å£°ã€‚rattle æ‹¨æµªé¼“ï¼›å˜å˜å£°ã€‚</p><p>door rattles.</p><p>bangs. - to (cause something to) make a sudden very loud noise or noises.</p><p>birds squawk - é¸Ÿå«ï¼ˆä¸å¥½çš„å£°éŸ³ï¼‰ã€‚squawk - (of a bird) to make an unpleasantly loud, sharp noise.</p><p>door knocks - æ•²é—¨å£°ã€‚</p><p>door knob screeches - é—¨æŠŠæ‰‹å°–å«ï¼ˆå£°ï¼‰ã€‚</p><p>intense sinister music - æ¿€çƒˆé™©æ¶çš„éŸ³ä¹ã€‚</p><p>dark dreamy music - é»‘æš—æ¢¦å¹»çš„éŸ³ä¹ã€‚</p><h2 id="ç¬¬äºŒå¹•-åˆæ­¥è°ƒæŸ¥"><a href="#ç¬¬äºŒå¹•-åˆæ­¥è°ƒæŸ¥" class="headerlink" title="ç¬¬äºŒå¹• åˆæ­¥è°ƒæŸ¥"></a>ç¬¬äºŒå¹• åˆæ­¥è°ƒæŸ¥</h2><p>-This is it, here, Sir.</p><p>-Really, Troy? Iâ€™d never have guessed.</p><p>crowd chatters - äººç¾¤é—²èŠã€‚</p><p>We only ever meet when thereâ€™s a corpse. - æˆ‘ä»¬åªæœ‰åœ¨æœ‰å°¸ä½“çš„æ—¶å€™ä¼šè§é¢ã€‚corpose - å°¸ä½“ã€‚ever - at any time: Nothing ever happened in this evening. Have you ever gone to London?</p><p>broken neck - è„–å­æ–­äº†ã€‚</p><p>scuff marks on the carpet - åœ°æ¯¯ä¸Šæœ‰ç£¨æŸç—•è¿¹ã€‚scuff vt. ç£¨æŸï¼Œæ“¦ä¼¤ã€‚</p><p>a blow to the back of the neck and then dragged over here - é¢ˆåé­åˆ°ä¸€å‡»ï¼Œç„¶åè¢«æ‹–åˆ°è¿™é‡Œã€‚</p><p>spinster - è€å¤„å¥³ã€‚</p><p>The old girl who lives opposite - ä½åœ¨å¯¹é¢çš„è€å§‘å¨˜ã€‚</p><p>She slammed the door for a start - å¥¹çŒ›åœ°å…³ä¸Šé—¨ã€‚slam çŒ›æ’ã€‚</p><p>She didnâ€™t padlock her tricycle - å¥¹æ²¡æœ‰é”ä¸Šä¸‰è½®è½¦ã€‚padlock æŒ‚é”ã€‚tricycle ä¸‰è½®è½¦ã€‚</p><p>Thereâ€™s no reflection on you, Chief Inspector, but to leave her tricycle like that, she must have been very upset. æ€»ç£å¯Ÿï¼Œå¯¹ä½ æ¥è¯´æ²¡æœ‰ä»€ä¹ˆååº”ï¼ˆæ²¡æœ‰ä»€ä¹ˆå¥½å¥‡æ€ªçš„ï¼‰ï¼Œä½†æ˜¯å°±è¿™æ ·æŠŠå¥¹çš„ä¸‰è½®è½¦ä¸¢ä¸‹ï¼Œå¥¹ä¸€å®šå¾ˆæ²®ä¸§ã€‚</p><p>-Iâ€™ll have to go over tomorrow. I still havenâ€™t told the bees. - go over: to make oneâ€™s way å¼€è¾Ÿæ–°çš„è·¯ã€‚ i.g. go over to store for supplies. å»å•†åº—è´­ä¹°æ—¥ç”¨å“ã€‚</p><p>-Iâ€™m sorry?</p><p>-Well you have to tell the bees when someone dies. Otherwise they just clear off. - <a href="https://en.wikipedia.org/wiki/Telling_the_bees">Telling the bees</a> å…»èœ‚äººæœ‰ä¸€ä¸ªä¼ ç»Ÿï¼Œä¼šå°†é‡å¤§äº‹ä»¶ï¼ˆç”Ÿè€ç—…æ­»å©šå§»ç­‰ï¼‰å‘Šè¯‰èœœèœ‚ï¼Œå¦åˆ™ä¸Šå¤©ä¼šä½¿å…»èœ‚å®¶åº­å—åˆ°æƒ©ç½šï¼ˆæ¯”å¦‚æœ¬ç‰‡ä¸­Miss Bellringer è¯´èœœèœ‚ä¼šå…¨éƒ¨èµ°å¼€ï¼‰ã€‚</p><p>clock bell chimes - é’Ÿå£°å“èµ·ã€‚chime &#x2F;tÊƒaÉªm&#x2F; 1.ï¼ˆé’Ÿï¼‰å“èµ·ï¼ˆå°¤å…¶æ˜¯å‘Šè¯‰ä½ åˆ°å‡ ç‚¹äº†ï¼‰ï¼›2. ä¸æŸæŸç›¸åŒæˆ–å…·æœ‰ç›¸åŒçš„æ•ˆæœï¼še.g. Her views on life didnâ€™t chime with mine. å¥¹çš„äººç”Ÿè§‚å’Œæˆ‘ä¸å¤ªä¸€è‡´ã€‚</p><p>tower bell rings.</p><p>-Clear off her rocker, if you ask me. - rock: å²©çŸ³ï¼›å‰åæ‘‡æ™ƒï¼Œrock musicæ‘‡æ»šä¹ã€‚rockerï¼Œæ‘‡æ¤…ï¼Œï¼ˆæ‘‡æ¤…ç­‰ä¸‹é¢çš„ï¼‰ä¸¤æ¡å¼¯æœ¨ï¼ˆç”¨æ¥æ‘‡æ™ƒï¼‰ä¹‹ä¸€ï¼›off oneâ€™s rocker: å¤„äºæåº¦æ··ä¹±æˆ–ç²¾ç¥ä¸å¥å…¨çš„çŠ¶æ€ã€‚in a state marked by extreme confusion or mental unsoundness: â€¦ he felt dizzy, slightly off his rocker at this extraordinary assailment of his senses.</p><p>-You didnâ€™t believed her?</p><p>-Well, what she got to go on? A slammed door and a trike that wasnâ€™t padlocked. Itâ€™s a waste of time.</p><p>undertaker - æ®¡ä»ªå‘˜ã€‚</p><p>-I based in Causton but <strong>it happens</strong> I live here in Badgerâ€™s Drift and I thought I ought to <strong>pop by</strong>. Miss Simpson was a client. æˆ‘åœ¨Caustonä¸Šç­ï¼Œä½†æ˜¯ç¢°å·§æˆ‘ä½è¿™é‡Œã€‚pop by: é¡ºä¾¿è¿‡æ¥ä¸€ä¸‹ï¼›pop, (spoken) to go somewhere for a short time.</p><p>-Iâ€™m sorry?</p><p>-Sheâ€™d pre-paid. Our <strong>Satin</strong> Service. Itâ€™s one of our complete funeral packages. Very <strong>up-market</strong>, although between you and me. I let her have it at a discount (sniffs). She taught my mom, you know. - Satinï¼Œç¼é¢ï¼Œç»¸ç¼ï¼Œè¿™é‡Œåº”è¯¥æŒ‡æœåŠ¡çš„ç­‰çº§ï¼Œç±»ä¼¼é‡‘å¡ä¼šå‘˜ã€é“¶å¡ä¼šå‘˜ã€‚</p><p>-What can I do for you, Mister Rainbird?</p><p>-I was wondering if I could take her, <strong>the deceased</strong>. - decease&#x3D;death. the deceasedå»ä¸–çš„äººã€‚</p><p>-Oh, Iâ€™m afraid that wonâ€™t be possible for a little while.</p><p>-Oh! You do suspect some naughtiness. It was her neck, I undertand. ä½ ç¡®å®æ€€ç–‘æœ‰ä¸€äº›æ£è›‹é¬¼ã€‚è‡´å‘½ä¼¤åœ¨é¢ˆéƒ¨ï¼Œæˆ‘çŸ¥é“çš„ã€‚- naughty é¡½çš®çš„ï¼›naughtiness åè¯ï¼Œé¡½çš®ã€‚</p><p>-[Troy] Who told you that?</p><p>-Come on, everybody knows that by now. Itâ€™s that sort of village.</p><p>-[Troy] Well, you canâ€™t have the body yet. All right? Sir?</p><p>-[to Barnaby] Oh, I see youâ€™ve got a right constable there. You let me know when youâ€™re ready for me.</p><p>-[Troy] See the car?</p><p>-Yes.</p><p>-You wouldnâ€™t have thought they were so well paid, would you, undertakers? ä½ åº”è¯¥æ²¡æœ‰æƒ³åˆ°æ®¡ä»ªå‘˜ä¼šè·å¾—å¦‚æ­¤é«˜çš„æŠ¥é…¬ï¼Œä¸æ˜¯å—ï¼Ÿ</p><p>-Check the camera, and the telephones. Find out what calls did Miss Simpson made after six oâ€™clock.</p><p>-So youâ€™re taking it seriously then, sir?</p><p>-No, Troy, Iâ€™m just filling in time until tea.</p><p>-Right! Oh, camera and telephone, right. What about you?</p><p>-I must find a doctor.</p><p>-Something wrong, sir?</p><p>-Emily Simpsonâ€™s doctor, Troy. Maybe she did suffer from dizzy spells. Maybe she did just fail. Either way, I want to know. - spell æ‹¼å†™ï¼›å’’è¯­ã€‚</p><h3 id="åŒ»ç”Ÿçš„å®¶é‡Œ"><a href="#åŒ»ç”Ÿçš„å®¶é‡Œ" class="headerlink" title="åŒ»ç”Ÿçš„å®¶é‡Œ"></a>åŒ»ç”Ÿçš„å®¶é‡Œ</h3><p>åŒ»ç”Ÿçš„æ‹›ç‰Œï¼š</p><pre><code>DR. TREVOR LESSITERM.B B.S M.R.C.G.PPHSICIAN &amp; SURGEON</code></pre><p>DR. - Doctorã€‚Trevor Lessiteræ˜¯åŒ»ç”Ÿçš„åå­—ã€‚</p><p>M.B B.S - Bachelor of Medicine, Bachelor of Surgery å†…å¤–å…¨ç§‘åŒ»å­¦å£«</p><p>M.R.C.G.P - Membership of the Royal College of General Practitioners è‹±å›½çš‡å®¶å…¨ç§‘åŒ»ç”Ÿå­¦é™¢ä¼šå‘˜èµ„æ ¼ã€‚pratitioner ä»ä¸šè€…ã€‚general pratitioner å…¨ç§‘åŒ»ç”Ÿã€‚</p><p>She is remarkably fit for her age. - åœ¨å¥¹è¿™ä¸ªå¹´é¾„ï¼Œå¥¹æ˜¾å¾—éå¸¸å¥åº·ã€‚fit å¥åº·çš„ã€‚</p><p>I liked to drop in at the end of my rounds. You know, glass of sherry and all that. - go round to sbâ€™s house æ‹œè®¿æŸäººã€‚ drop in - é¡ºä¾¿è¿‡æ¥ã€‚</p><p>cricket æ¿çƒã€‚</p><p>But she never <a href="https://www.collinsdictionary.com/zh/dictionary/english/get-around-to">got round to</a> saying what it was. - å¥¹æ²¡èƒ½è¯´å‡ºæ¥æ˜¯ä»€ä¹ˆäº‹ã€‚get round to åšæˆäº†ä¸€ä»¶ä½ å› å…¶ä»–äº‹æƒ…è¢«è€½æäº†äº‹ã€‚</p><p>Iâ€™ve got to talk to someone. - æˆ‘å¾—è¿™ä¸ªäººè¯´è¯´è¯ã€‚have (got) to ä¸å¾—ä¸ã€‚</p><p>-Did she say what it was?</p><p>-No.</p><p>-Didnâ€™t you press her?</p><p>-Weâ€™re not meant to. - æˆ‘ä»¬ä¸æ˜¯æ•…æ„çš„ã€‚</p><p>-And there was nothing more?</p><p>-Iâ€™m sorry, Inspector. I know there was something else but I canâ€™t think. æˆ‘çŸ¥é“è¿˜æœ‰äº›äº‹æƒ…ï¼Œä½†æ˜¯æˆ‘æƒ³ä¸èµ·æ¥ã€‚</p><p>-Well, if it does come to you, can you give us ring? å½“ä½ æƒ³èµ·æ¥ï¼Œèƒ½ä¸èƒ½ç»™æˆ‘ä»¬ä¸€ä¸ªç”µè¯ã€‚</p><p>-Yes, of course.</p><p>ring off - æŒ‚æ–­ç”µè¯ã€‚</p><p>Inspector - ç£å¯Ÿã€‚</p><p>scrambled eggs - ç‚’é¸¡è›‹ã€‚scramble äº‰å¤ºã€‚</p><p>Stuck with a heavy object as yet unidentified at the base of the neck. è„–å­æ ¹éƒ¨è¢«ä¸€ä¸ªå°šæœªè¾¨è®¤çš„é‡ç‰©å¡ä½ã€‚</p><p>sombre music - é˜´æ²‰çš„éŸ³ä¹ã€‚</p><p>The grass flattened, brambles broken. è‰è¢«å‹æ‰äº†ï¼Œè†æ£˜æ–­äº†ã€‚</p><p>What, you think someoneâ€™s been having it away? ä½ è®¤ä¸ºæœ‰äººæŠŠå®ƒä»¬æ‹¿èµ°äº†ï¼Ÿ</p><p>Two people bonking? ä¸¤ä¸ªäººææ–—&#x2F;æ€§äº¤ï¼Ÿ</p><p>tweezers - é•Šå­ã€‚</p><p>-A piece of black fibre. ä¸€ç‰‡é»‘è‰²çº¤ç»´ã€‚</p><p>-Off their clothes. ä»ä»–ä»¬çš„è¡£æœä¸Šæ‰ä¸‹æ¥çš„ï¼Ÿ</p><p>-No, I donâ€™t think so. Iâ€™d say a blanket or rug, something like that. æˆ‘è®¤ä¸ºæ˜¯æ¯¯å­æˆ–åœ°æ¯¯ã€‚</p><p>I want the whole place gone over. - <a href="https://www.collinsdictionary.com/zh/dictionary/english/go-over">go over</a> ä»”ç»†æ£€æŸ¥ã€‚</p><p>Do you really think thatâ€™s what it came down to, sir? ä½ çœŸçš„è®¤ä¸ºè¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨å—ï¼Ÿ</p><p>Unless it was adultery. é™¤éæ˜¯é€šå¥¸ã€‚</p><p>I suppose they could have been arse-bandits. - æˆ‘çŒœæƒ³å¯èƒ½ä»–ä»¬æ˜¯å±è‚¡å°å·ï¼ˆåŒæ€§æ‹ï¼‰ã€‚arseï¼ˆç²—é²çš„è¯ï¼‰å±è‚¡ã€‚bandit æœ‰æ­¦å™¨çš„å°å·ã€‚</p><p>You mean â€œhomesexualsâ€, Troy?  Troyï¼Œä½ æ˜¯è¯´åŒæ€§æ‹ï¼Ÿ</p><p>You are as politically correct as <a href="https://en.wikipedia.org/wiki/Nuremberg_rallies">Nuremberg rally</a>. ä½ å’Œçº½ä¼¦å ¡é›†ä¼šï¼ˆå¾·å›½çº³ç²¹ä¸€å¹´ä¸€åº¦çš„å…šä»£ä¼šï¼‰ä¸€æ ·æ”¿æ²»æ­£ç¡®ã€‚</p><h3 id="Rainbirdå®¶"><a href="#Rainbirdå®¶" class="headerlink" title="Rainbirdå®¶"></a>Rainbirdå®¶</h3><p>eerie music - æ€ªå¼‚çš„éŸ³ä¹ã€‚</p><p>pot to kettle. æŠŠé”…é‡Œï¼ˆçš„æ°´ï¼‰å€’åˆ°å£¶é‡Œï¼Œåº”è¯¥æ˜¯ä¸ŠèŒ¶çš„æ„æ€ã€‚ï¼ˆå½±ç‰‡ä¸­ï¼ŒèŒ¶æ°´æ˜¯è£…åœ¨ç“·å£¶é‡Œï¼‰</p><p>eyrie - æ˜¯ aerie çš„å¦ä¸€ç§å†™æ³•ï¼Œé¹°å·¢ã€‚an elevated often secluded dwelling, structure, or position è¾ƒé«˜ä¸”é€šå¸¸åƒ»é™çš„ä½å®…ã€ç»“æ„æˆ–ä½ç½®ã€‚<a href="https://www.collinsdictionary.com/zh/dictionary/e%3Cb%3Englis%3C/b%3Eh/eyrie">If you refer to a place such as a house or a castle as an eyrie, you mean it is built high up and is difficult to reach.</a></p><p>My hide. Yes, Iâ€™m a keen observer of wild life, birds. æˆ‘çš„éšè—çˆ±å¥½ï¼Œæˆ‘å–œæ¬¢è§‚å¯Ÿé‡ç”ŸåŠ¨ç‰©â€”â€”é¸Ÿã€‚</p><p>I thought I saw a pair of binoculars. æˆ‘æƒ³æˆ‘çœ‹è§äº†ä¸€å‰¯æœ›è¿œé•œã€‚</p><p>trolley æ‰‹æ¨è½¦ã€‚</p><p>Do help yourself. è¯·è‡ªä¾¿ã€‚</p><p>widower - é³å¤«ã€‚widow å¯¡å¦‡ã€‚</p><p>The clubs are anchovy. Salmon spread in the hearts. Marmite spades and potted meat diamonds.</p><p>æ¢…èŠ±çŠ¶çš„anchovyã€‚Salmon spreadæ˜¯å¿ƒå½¢çš„ã€‚é»‘æ¡ƒçŠ¶çš„Marmiteã€‚æ–¹å—çŠ¶çš„potted meat. - potted: preserved in a pot, jar, or can: potted meat.</p><p>Not that youâ€™ll find her there. å¹¶ä¸æ˜¯è¯´ä½ ä¼šåœ¨é‚£é‡Œæ‰¾åˆ°å¥¹ã€‚</p><p>Done very nicely for herself. ä¸ºè‡ªå·±åšå¾—å¾ˆå¥½ã€‚</p><p>-Iced sombrero, constable. - Iced sombreroå†°é˜”è¾¹å¸½ï¼ˆåº”è¯¥æ˜¯è¿™ç§å½¢çŠ¶çš„é£Ÿç‰©ï¼‰ï¼Œconstable è­¦å‘˜ã€‚constabulary è­¦å¯Ÿå±€ã€‚</p><p>-No, thank you. And Iâ€™m a sergeant.</p><p><a href="https://en.wikipedia.org/wiki/Police_ranks_of_the_United_Kingdom">å¤§ä¸åˆ—é¢ è­¦å¯Ÿç­‰çº§ï¼ˆç”±é«˜åˆ°ä½ï¼‰</a>ï¼š</p><p>Chief constable, Deputy chief constable, Assistant chief constable, Chief superintendentæ€»è­¦å¸, Superintendentè­¦å¸, Chief inspectoræ€»ç£å¯Ÿ, Inspectorç£å¯Ÿ, Sergeantè­¦é•¿, Constableè­¦å‘˜. - å‚è€ƒ<a href="https://zh.wikipedia.org/zh-hans/%E5%80%AB%E6%95%A6%E8%AD%A6%E5%AF%9F%E5%BB%B3">ç»´åŸºç™¾ç§‘</a>ã€‚</p><p>Detectiveæ˜¯è­¦å¯Ÿçš„å‰ç¼€ä¹‹ä¸€ï¼Œæ¯”å¦‚Detective Chief Inspectorã€‚è¿™ç§è­¦å¯Ÿä¸€èˆ¬ç©¿ä¾¿è¡£ï¼ŒèŒä½å’ŒèŒçº§å’Œåˆ¶æœè­¦å¯Ÿä¸€æ ·ã€‚</p><p>-I mean what are you likely to see flying at that time? æˆ‘çš„æ„æ€ä½ é‚£ä¸ªæ—¶å€™æƒ³è¦çœ‹ä»€ä¹ˆé£ç¦½ï¼Ÿ</p><p>-Owls. çŒ«å¤´é¹°ã€‚</p><p>These two give me the creeps. è¿™ä¸¤ä¸ªäººè®©æˆ‘æ¯›éª¨æ‚šç„¶ã€‚<a href="https://dictionary.cambridge.org/us/dictionary/english/creep">give someone the creeps</a> - to cause someone to have uncomfortable feelings of nervousness or fear:</p><p>-You donâ€™t suppose it was him in the woods, do you? ä½ è¯¥ä¸ä¼šè®¤ä¸ºæ˜¯ä»–åœ¨æ ‘æ—é‡Œå§ï¼Ÿ</p><p>-I somehow doubt it, Troy. æˆ‘æœ‰ç‚¹æ€€ç–‘ã€‚</p><p>They certainly had it in for her. ä»–ä»¬å½“ç„¶æ˜¯ä¸ºäº†å¥¹ã€‚</p><h3 id="Barnabyå®¶"><a href="#Barnabyå®¶" class="headerlink" title="Barnabyå®¶"></a>Barnabyå®¶</h3><p><a href="https://en.wikipedia.org/wiki/%27Tis_Pity_She%27s_a_Whore">â€˜Tis Pity Sheâ€™s a Whore</a>. å¯æƒœå¥¹æ˜¯ä¸€ä¸ªå¦“å¥³ï¼ŒJohn Ford å¯¼æ¼”çš„éŸ³ä¹å‰§ã€‚â€™Tis æ˜¯ it is çš„ç¼©å†™ã€‚</p><p>Would you go through my lines with me? ä½ å¯ä»¥å¸®æˆ‘ä¸€èµ·ç»ƒä¹ ä¸€ä¸‹å°è¯å—ï¼Ÿ</p><p>I doubt heâ€™ll have time. æˆ‘æ€€ç–‘ä»–æ˜¯å¦æœ‰æ—¶é—´ã€‚</p><p>quail - é¹Œé¹‘ã€‚</p><p>(Telephone rings) Iâ€™ll get it. æˆ‘å»æ¥ç”µè¯ã€‚</p><p>In the pond behind the quarry. åœ¨é‡‡çŸ³åœºåé¢çš„æ± å¡˜é‡Œã€‚</p><p>-Think what the police would make of it if their forensic people got hold of it. æƒ³æƒ³è­¦å¯Ÿä¼šæ€ä¹ˆæƒ³ï¼Œå¦‚æœä»–ä»¬çš„æ³•åŒ»äººå‘˜æ‹¿åˆ°äº†å®ƒã€‚<a href="https://dictionary.cambridge.org/us/dictionary/english/make-of">make of</a> - to have an impression or understanding about something. å¯¹æŸäº‹æœ‰å°è±¡æˆ–æœ‰äº†è§£ã€‚</p><p>-Theyâ€™d have a field day. ä»–ä»¬ä¼šåº¦è¿‡æ„‰å¿«çš„ä¸€å¤©ã€‚<a href="https://dictionary.cambridge.org/us/dictionary/english/field-day">field day</a> ç‰¹æ®Šçš„ä¸€å¤©ã€‚</p><p>-This is the big one, Denny. This is going to make us very, very rich. è¿™æ˜¯æœ€é‡è¦çš„ï¼Œè¿™ä¼šè®©æˆ‘å˜å¾—éå¸¸å¯Œæœ‰ã€‚</p><p>Two colomns in the local rag and a coronerâ€™s re-port. - coroner éªŒå°¸å®˜ã€‚</p><h3 id="Tye-House"><a href="#Tye-House" class="headerlink" title="Tye House"></a>Tye House</h3><p>tyres screech - è½®èƒå°–å«å£°ã€‚</p><p>bright upbeat music - æ˜äº®æ¬¢å¿«çš„éŸ³ä¹ã€‚upbeat ä¹è§‚çš„ã€‚</p><p>-How the other half live?</p><p>-Rather less then half Iâ€™d say. æˆ‘è¯´ç›®å‰è¿˜ä¸æ˜¯ï¼ˆå¯Œè±ªçš„ï¼‰å¦ä¸€åŠã€‚</p><p>estate manager - ç‰©ä¸šç»ç†ã€‚</p><p>-I donâ€™t suppose you were in the village at any time at between six and eight on Wednesday? æˆ‘æƒ³ä½ å‘¨ä¸‰å…­ç‚¹åˆ°å…«ç‚¹ä¹‹é—´çš„ä»»ä½•æ—¶é—´éƒ½ä¸ä¼šåœ¨æ‘å­é‡Œï¼Ÿ</p><p>-No. Donâ€™t remember where I was. Out in the fields. ä¸åœ¨ã€‚ä¸å¤ªè®°å¾—æˆ‘å»äº†å“ªé‡Œã€‚æˆ‘å‡ºå»åˆ°ç”°é‡é‡Œå»äº†ã€‚</p><p>drawing room - å®¢å…ã€‚</p><p>late wife - å·²æ•…çš„å¦»å­ã€‚</p><p>as a matter of fact - äº‹å®ä¸Šã€‚</p><p>-If itâ€™s not too painful, sir, Iâ€™d be interested to know how your wife died. å¦‚æœä¸æ˜¯å¤ªç—›è‹¦çš„è¯ï¼Œå…ˆç”Ÿï¼Œæˆ‘å¾ˆæƒ³çŸ¥é“ä½ å¦»å­æ˜¯æ€ä¹ˆæ­»çš„ã€‚</p><p>-It is painful. And I donâ€™t see how itâ€™s relevant. å¾ˆç—›è‹¦ã€‚å¹¶ä¸”æˆ‘æ²¡æœ‰çœ‹åˆ°ï¼ˆè¿™ä¸¤ä»¶äº‹çš„ï¼‰ç›¸å…³æ€§ã€‚</p><p>-Miss Simpson could have known your wife as Annabella. As a nick name, pet name or something like that. If there is a connection - - Simpsonå¥³å£«å¯èƒ½çŸ¥é“ä½ çš„å¦»å­æ˜¯Annabellaï¼Œä¸€ä¸ªæ˜µç§°ã€çˆ±ç§°æˆ–å…¶ä»–å•¥çš„ã€‚</p><p>-There is no connection.</p><p>-We need to be sure.</p><p>-(sighs) If you insist. It was two years agoâ€¦ å¦‚æœä½ åšæŒçš„è¯ã€‚</p><p>And Bellaâ€™s sister had come along. Phyllis, Phyllis Cadell. She didnâ€™t shoot that ofen and I always wondered why she closed that day of all days. - Bellaçš„å§å¦¹Phyllis Cadellä¹Ÿæ¥äº†ï¼Œå¥¹ä¸ç»å¸¸å°„å‡»ï¼Œæˆ‘å¸¸å¸¸æƒ³çŸ¥é“ï¼Œä¸ºä»€ä¹ˆé‚£å¤©å¥¹æ•´å¤©å…³é—¨ï¼ˆå¯èƒ½æ˜¯æœ‰ä¸ªç§äººå•†åº—ï¼‰ã€‚</p><p>Heâ€™d come as a beater, to scare the birds. ä»–æ¥çš„ä»»åŠ¡æ•²å‡»å“å”¬é¸Ÿã€‚</p><p>I suppose itâ€™s always easy to talk about these thing with hindsight but Iâ€™m often felt think we were ill-fated that day. æˆ‘æƒ³äº‹åè°ˆè®ºè¿™äº›äº‹æƒ…æ€»æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½†æˆ‘å¸¸å¸¸è§‰å¾—æˆ‘ä»¬é‚£å¤©è¿æ°”ä¸å¥½ã€‚</p><p>Bella tripped on a root and twisted her ankle rather badly. - Bellaè¢«æ ‘æ ¹ç»Šå€’å¹¶ä¸”è„šè¸è¢«æ‰­ä¼¤å¾—éå¸¸ä¸¥é‡ã€‚</p><p>But by the time ambullance arrived it was all over. ä½†å½“æ•‘æŠ¤è½¦åˆ°è¾¾æ—¶ï¼Œä¸€åˆ‡éƒ½ç»“æŸäº†ã€‚</p><p>dog whines - ç‹—å‘œå‘œå£°ã€‚</p><p>generator - å‘ç”µæœºã€‚</p><p>marquee - å¸ç¯·ã€‚</p><p>You finished it, I take it? ï¼ˆè­¦å®˜ï¼‰ä½ çš„é—®è®¯ç»“æŸäº†å§ï¼Ÿæˆ‘å¯ä»¥åšå…¶ä»–çš„äº‹æƒ…å§ï¼Ÿ</p><p>He was a sort of guardian. ä»–æ˜¯æŸç§å®ˆæŠ¤è€…ã€‚</p><p>We wonâ€™t take up any more or your time. æˆ‘ä»¬ä¸å†å ç”¨æ‚¨çš„æ—¶é—´äº†ã€‚</p><p>exhale - å‘¼æ°”ã€‚</p><p>But I do what I can even Iâ€™m quite worn out. - æˆ‘å°½æˆ‘æ‰€èƒ½å¸®å¿™ï¼Œå³ä½¿æˆ‘ç´¯åäº†ã€‚wear ç£¨æŸã€‚</p><p>mistress - å¥³ä¸»äººï¼Œå…·æœ‰æƒå¨æˆ–æ§åˆ¶åœ°ä½çš„å¥³äººï¼›æƒ…å¦‡ã€‚</p><p>Henry has a cottage on the estate and Iâ€™m being pensioned off there. Iâ€™m quite looking forward to it.</p><p>Pathetic. - å¯æ€œçš„ã€‚</p><p>She was scared shitless. - å¥¹è¢«å“å¾—å±æ»šå°¿æµã€‚</p><p>You do have a way with words, donâ€™t you?</p><p>What are we investigating, sir? Emily Simpson or Belly Trace?</p><p>Thereâ€™s no point asking me about it. æ²¡æœ‰å¿…è¦é—®æˆ‘è¿™ä¸ªé—®é¢˜ã€‚</p><p>I donâ€™t have anything to do with the village. And the village doesnâ€™t have much to do with me.æˆ‘å’Œé‚£æ‘å­æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚é‚£æ‘å­å’Œæˆ‘ä¹Ÿæ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚</p><p>-Could you tell me where you were on last Wednesday?</p><p>-No. I donâ€™t know. Maybe Iâ€™m here, Iâ€™m most days. </p><p>-Not much of life. æ²¡ä»€ä¹ˆç”Ÿæ´»ã€‚</p><p>-My work is my life. You wouldnâ€™t understand that. æˆ‘çš„å·¥ä½œå°±æ˜¯æˆ‘çš„ç”Ÿæ´»ã€‚ä½ ä¸ä¼šç†è§£è¿™ä¸€ç‚¹ã€‚I might have gone for a walk or something, I donâ€™t remember.</p><p>Missis - Miss, Misses å°å§ã€‚</p><p>I ran hell for leather back to Tye House. - hellè¡¨ç¤ºç¨‹åº¦ï¼ŒåŠ å¼ºè¯­æ°”ã€‚</p><p>Iâ€™ll say one thing for Katherine. She certainly doesnâ€™t come cheap. æˆ‘è¦ä¸ºKatherineè¯´ä¸€ä»¶äº‹ï¼Œå¥¹çš„ä»·æ ¼å½“ç„¶ä¸ä¾¿å®œã€‚</p><h3 id="Barnabyå®¶-1"><a href="#Barnabyå®¶-1" class="headerlink" title="Barnabyå®¶"></a>Barnabyå®¶</h3><p>intense uneasy music - å¼ºçƒˆä¸å®‰çš„éŸ³ä¹ã€‚</p><p>-This noble creature was in every part. So angel-like, so glorious, that a woman, who was not human, as was I â€“ è¿™ä¸ªé«˜è´µçš„ç”Ÿç‰©æ— å¤„ä¸åœ¨ã€‚</p><p>-Had not been but human. åªä¸è¿‡æ˜¯äººç±»ã€‚</p><p>-Who had not been but human, as was I. Would have kneeled to him and begged for love. è°ä¸æ˜¯äººç±»ï¼Œå°±åƒæˆ‘ä¸€æ ·ã€‚ä¼šå‘ä»–ä¸‹è·ªå¹¶ä¹çˆ±ã€‚You, why you are not worthy once to name. His name without true worship, or indeed. Unless you kneeled, to have another name him. ä½ ï¼Œä¸ºä½•è¿ä¸€æ¬¡çš„åå­—éƒ½ä¸é…ã€‚ ä»–çš„åå­—æ²¡æœ‰çœŸæ­£çš„å´‡æ‹œï¼Œæˆ–è€…è¯´ç¡®å®å¦‚æ­¤ã€‚ é™¤éä½ è·ªä¸‹æ¥ç»™ä»–èµ·å¦ä¸€ä¸ªåå­—</p><p>-What was he called?</p><p>-We not come to that. æˆ‘ä»¬å¹¶æ²¡æœ‰è°ˆåˆ°è¿™ä¸ªã€‚Let it suffice that you shall have the glory. åªè¦ä½ æ‹¥æœ‰è£è€€å°±è¶³å¤Ÿäº†ã€‚To father what so brave a father got. å¯¹äºçˆ¶äº²æ¥è¯´ï¼Œä¸€ä¸ªçˆ¶äº²æœ‰å¤šä¹ˆå‹‡æ•¢ã€‚</p><p>That sounded good. Itâ€™s coming along.</p><p>Sheâ€™s wonderful. Weâ€™re gonna have to go up and see it.</p><p>-If I ever manage to learn it all. å¦‚æœæˆ‘èƒ½å­¦ä¼šè¿™ä¸€åˆ‡å°±å¥½äº†ã€‚manage to do è®¾æ³•åšï¼Œï¼ˆå°½ç®¡æœ‰å›°éš¾ï¼‰æˆåŠŸåšã€‚</p><p>Iâ€™ve got a nice Pot-au-feu in the deep freeze. æˆ‘æœ‰ä¸€ä»½ç¾å‘³çš„å†·å†»ç‚–é”…ã€‚<a href="https://en.wikipedia.org/wiki/Pot-au-feu">Pot-au-feu</a> (&#x2F;ËŒpÉ’toÊŠËˆfÉœËr&#x2F;; French: [pÉ”tâ€¿o fÃ¸] ( listen); â€œpot on the fireâ€) is a French dish of slowly boiled meat and vegetables, usually served as two courses: first the broth (bouillon) and then the meat (bouilli) and vegetables.</p><p>horse nickers - nicker: 1, (of a horse) give a soft, low, breathy whinny. 2, a nickering sound.</p><p>white lilies - ç™½ç™¾åˆã€‚</p><p>This is the Satin Service.</p><p>Whimsical sombre music - å¼‚æƒ³å¤©å¼€çš„å¿§éƒéŸ³ä¹ã€‚</p><p>Youâ€™ve withdrawn 500 pounds from our joint reserve account. æ‚¨å·²ç»ä»æˆ‘ä»¬çš„è”åˆå‚¨è“„è´¦æˆ·ä¸­æå–äº†500è‹±é•‘ã€‚</p><p>overdraw - é€æ”¯ã€‚</p><p>I thought Iâ€™d leave you two to bicker in private. æˆ‘æƒ³æˆ‘åº”è¯¥è®©ä½ ä¿©ç§ä¸‹æ–—å˜´ã€‚</p><p>I know that my redeemer liveth, and that he shall stand upon the last on the earth. Whom I shall see for myself, and mine eyes shall behold, and not another.ï¼ˆç¥·å‘Šï¼‰æˆ‘çŸ¥é“æˆ‘çš„æ•‘ä¸–ä¸»è¿˜æ´»ç€ã€‚- mine ç”¨åœ¨å…ƒéŸ³ä¹‹å‰ï¼Œç›¸å½“äºmy.</p><p>Missis Rainbird no more a bird-wather than I am. - Rainbirdå¥³å£«å’Œæˆ‘ä¸€æ ·éƒ½ä¸æ˜¯é¸Ÿç±»è§‚å¯Ÿè€…ã€‚</p><p>personalised Porsche. ä¸ªæ€§åŒ–çš„ä¿æ—¶æ·ã€‚</p><p>Rain stopped play. é›¨åœæ­¢äº†æ¯”èµ›ã€‚</p><p>His wifeâ€™s just as bad. ä»–çš„å¦»å­åŒæ ·ç³Ÿç³•ã€‚</p><p>Itâ€™s early closing. å…³é—¨è¿˜æ—©å‘€ã€‚</p><p>Thereâ€™s something wrong and something that doesnâ€™t add up. æœ‰äº›åœ°æ–¹å‡ºäº†é—®é¢˜ï¼Œæœ‰äº›åœ°æ–¹ä¸åˆé€»è¾‘ã€‚</p><p>Maybe he was. Maybe he simply mistaken in his account. But he wasnâ€™t telling us the truth. ä»–å¯èƒ½æ˜¯ï¼ˆåœ¨æ’’è°ï¼‰ï¼Œä¹Ÿå¯èƒ½åªæ˜¯è®°é”™äº†ã€‚ä½†æ˜¯ä»–æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬äº‹å®ã€‚</p><p>Why did he run all the way back to Tye House to call the ambullance when the accident happened on the other side of the village? äº‹æ•…å‘ç”Ÿåœ¨æ‘å­çš„å¦ä¸€è¾¹ï¼Œä¸ºä»€ä¹ˆä»–è¿˜è¦åƒé‡Œè¿¢è¿¢è·‘å›The Houseå«æ•‘æŠ¤è½¦å‘¢ï¼Ÿ</p><p>-It seems theyâ€™re all bloody liars. çœ‹èµ·æ¥ä»–ä»¬éƒ½æ˜¯è¯¥æ­»çš„æ’’è°è€…ã€‚bloody - used to express anger or to emphasize what you are saying in a slightly rude way.</p><p>-One of them is something more. å…¶ä¸­ä¸€ä¸ªæœ‰æ›´å¤šä¸œè¥¿ã€‚</p><p>Forasmuch as it hath pleased Almighty God of his great mercy to take unto himself, the soul of our dear sister here departed, we therefore commit her body to the ground; earth to earth, ashes to ashes, dust to dust; Amen.</p><p>Itâ€™s early days yet. ç°åœ¨è¿˜æ—©å‘¢ã€‚</p><p>Not for poor Emily.</p><p>Come and have sherry. æ¥å–æ¯é›ªè‰é…’å§ï¼I feel the need of a drink. Iâ€™m afraid funerals do that for me. æˆ‘è§‰å¾—éœ€è¦å–ä¸€æ¯ï¼Œææ€•è‘¬ç¤¼å¯¹æˆ‘æ¥è¯´å°±æ˜¯è¿™æ ·ã€‚</p><p>polio - è„Šé«“ç°è´¨ç‚ã€‚</p><p>pensive music - pensiveæ²‰æ€çš„ã€‚</p><p>She adored him. Still does for all I know. - å¥¹å´‡æ‹œ&#x2F;å–œæ¬¢ä»–ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼ˆfor all I knowï¼‰ä»ç„¶å¦‚æ­¤ã€‚</p><p>She was Herryâ€™s ward. å¥¹æ˜¯Herryçš„è¢«ç›‘æŠ¤äººã€‚</p><p>Herry sort of adopted them. - Herryæœ‰ç‚¹æ”¶å…»äº†ä»–ä»¬ã€‚</p><p>set them up in a gamekeeperâ€™s cottage on the estate. - æŠŠä»–ä»¬æ”¾åœ¨åº„å›­çš„çŒåœºçœ‹å®ˆäººçš„å°å±‹é‡Œã€‚</p><p>They are very young then, barely in their teens. - ä»–ä»¬é‚£æ—¶å€™è¿˜å¾ˆå°ï¼Œæ‰åå‡ å²ã€‚</p><p>nanny - ä¿å§†ã€‚</p><p>There was a nanny, Mary Sharpe, Nanny Sharpe, which was meant to look after them. - æœ‰ä¸€ä¸ªä¿å§†ï¼Œå«Sharpeï¼Œæ˜¯ä¸ºäº†ç…§é¡¾ä»–ä»¬ã€‚</p><p>-But she had a terrible time. ä½†æ˜¯å¥¹åº¦è¿‡äº†ä¸€æ®µç³Ÿç³•çš„æ—¶å…‰ã€‚</p><p>-In what way? ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼ï¼Ÿ</p><p>-The children were always fighting. Endless rows. - å­©å­ä»¬æ€»æ˜¯æ‰“æ¶ï¼Œæ— ä¼‘æ­¢åœ°äº‰åµã€‚row å¯æ•°åè¯ï¼Œäº‰åµï¼š<a href="https://www.collinsdictionary.com/zh/dictionary/english/row">A row is a serious disagreement between people or organizations</a>.</p><p>In the end, Mary upped and left. - æœ€åï¼ŒMaryèµ·èº«ç¦»å¼€äº†ã€‚up åŠ¨è¯ï¼Œå¢åŠ ï¼›çªç„¶ç¦»å¼€ï¼š<a href="https://www.collinsdictionary.com/zh/dictionary/english/up">If you up and leave a place, you go away from it, often suddenly or unexpectedly</a>.</p><p>Now sheâ€™s retired down on the coast. ç°åœ¨å¥¹åœ¨æµ·è¾¹é€€ä¼‘äº†ã€‚</p><p>-If you ask me, Katherine is the one to look out for. å¦‚æœä½ é—®æˆ‘ï¼Œå‡¯ç‘Ÿç³æ˜¯å€¼å¾—ç•™æ„çš„äººã€‚</p><p>-Meaning? æ„æ€æ˜¯ï¼Ÿ</p><p>-That girl is far too beautiful for other peopleâ€™s good. é‚£ä¸ªå¥³å­©å¤ªæ¼‚äº®äº†ï¼Œä¸åˆ©äºåˆ«äººã€‚That girl is far too beautiful for other peopleâ€™s good. If she was found bonking in the wood, she has the most to lose. å¦‚æœå¥¹è¢«å‘ç°åœ¨æ ‘æ—é‡Œæ‰“æ»šï¼ˆæ€§äº¤ï¼‰ï¼Œå¥¹çš„æŸå¤±å°†æ˜¯æœ€å¤§çš„ã€‚</p><p>Sheâ€™s got a point. å¥¹è¯´å¾—æœ‰é“ç†ã€‚</p><p>it barks its head off. å®ƒæ‹¼å‘½ç‹‚å«ã€‚its headåœ¨è¿™é‡Œè¡¨ç¤ºå¼ºçƒˆç¨‹åº¦ã€‚Youâ€™d have heard it a mile away! ä½ ä¸€è‹±é‡Œå¤–éƒ½èƒ½å¬è§å®ƒã€‚</p><p>Damn! Do you know, for a minute I thought I had the whole thing solved. è¯¥æ­»ï¼ä½ çŸ¥é“å—ï¼Œæœ‰ä¸€ç¬é—´æˆ‘ä»¥ä¸ºæˆ‘å·²ç»è§£å†³äº†æ•´ä¸ªé—®é¢˜ã€‚</p><p>I think I deserve another Marron Lyonnaise. - æˆ‘è®¤ä¸ºæˆ‘å€¼å¾—å†æ¥ä¸€ä»½æˆ‘å€¼å¾—å†æ¥ä¸€ä»½é©¬é¾™Â·é‡Œæ˜‚é…±ã€‚</p><p>I want their clothes bagged and down forensics. - æˆ‘æƒ³æŠŠä»–ä»¬çš„è¡£æœæ‰“åŒ…å¹¶å–è¯ã€‚forensicsæ³•åŒ»ã€‚</p><p>What a mess. - çœŸæ˜¯ä¸€å›¢ç³Ÿã€‚</p><p>Sheâ€™s being treated for shock outside, no surprise. - å¥¹ä¼‘å…‹äº†ï¼Œæ­£åœ¨å¤–é¢æ¥å—æ²»ç–—ï¼Œè¿™å¹¶ä¸å¥‡æ€ªã€‚shockä¼‘å…‹ã€‚</p><p>Donâ€™t expect to get much sense. - ä¸è¦æŒ‡æœ›å¾—åˆ°å¤ªå¤šæ„ä¹‰ã€‚</p><p>Youâ€™d better come up and take a look at this. ä½ æœ€å¥½è¿‡æ¥çœ‹çœ‹è¿™ä¸ªã€‚</p><p>-Youâ€™re not going to believe it. ä½ ä¸ä¼šç›¸ä¿¡çš„ã€‚</p><p>-On the contrary, Troy, I rather think I will. æ°æ°ç›¸åï¼Œæˆ‘è§‰å¾—æˆ‘ä¼šç›¸ä¿¡çš„ã€‚</p><p>What was it she said, sir? å…ˆç”Ÿï¼Œå¥¹è¯´äº†ä»€ä¹ˆï¼Ÿ</p><p>Listen to this: At 10:30 a.m. Mister and Missis W crossed over by post box to avoid Miss G. 10ç‚¹30åˆ†ï¼ŒWå…ˆç”Ÿå’ŒWå°å§ç©¿è¿‡é‚®æ”¿ä¿¡ç®±ä»¥é¿å…Gå°å§ã€‚</p><p>11:00 a.m. A called on Miss S., stayed 15 minutes. ä¸Šåˆ11:00ï¼ŒAæ‹œè®¿äº†Så°å§ï¼Œåœç•™äº†15åˆ†é’Ÿã€‚</p><p>There must be a couple of hundred entries in this file alone. ä»…è¿™ä¸ªæ–‡ä»¶ä¸­å°±å¾—æœ‰ä¸Šç™¾ä¸ªæ¡ç›®ã€‚May thousands of them over the years. å¯èƒ½æœ‰è¿™å‡ å¹´çš„ä¸Šåƒæ¡è®°å½•ã€‚</p><p>I want them all taken down. æˆ‘å¸Œæœ›ä»–ä»¬éƒ½è¢«è®°å½•ä¸‹æ¥äº†ã€‚<a href="https://www.collinsdictionary.com/zh/dictionary/english-chinese/take-down">take down</a> 1, è®°å½•write down; 2, æ‹†é™¤dismantle: wall, fence etc.</p><p>Weâ€™re gonna have to go through the whole lot of them. æˆ‘ä»¬ä¸å¾—ä¸è¦æŠŠå®ƒä»¬å…¨éƒ¨æµè§ˆä¸€éã€‚</p><p>blackmail - n. &amp; vt. å‹’ç´¢ã€‚</p><p>She wasnâ€™t a bad old stick. å¥¹ä¸æ˜¯ä¸€ä¸ªå¾ˆåçš„äººã€‚</p><p>She is a bit perculiar, her and her son. Him being au undertaker and all. - å¥¹å’Œå¥¹çš„å„¿å­æœ‰ç‚¹å¥‡æ€ªã€‚ä»–æ˜¯æ®¡ä»ªé¦†çš„æ‰¿åŠäººç­‰ç­‰ã€‚perculiar - å¥‡ç‰¹çš„ã€‚</p><p>But she was very good for me, in her own way, very good to me.</p><p>One is getting wed. å°†è¦ç»“å©šçš„é‚£ä¸ªã€‚</p><p>-Thatâ€™s a bend just ahead. å‰é¢å°±æ˜¯ä¸€ä¸ªè½¬å¼¯ã€‚</p><p>-Now, Iâ€™ve seen it, sir. æˆ‘çœ‹åˆ°äº†ã€‚</p><p>And do me a favor, Troy, when we get there, if we get there, park at the bottom of the lane. å¸®æˆ‘ä¸€ä¸ªå¿™ï¼Œç‰¹æ´›ä¼Šï¼Œå½“æˆ‘ä»¬åˆ°è¾¾é‚£é‡Œæ—¶ï¼Œå¦‚æœæˆ‘ä»¬åˆ°è¾¾é‚£é‡Œï¼Œè¯·å°†è½¦åœåœ¨è½¦é“çš„åº•éƒ¨ã€‚</p><p>yells - å‘¼å–Šã€‚</p><p>Sometimes you really make me sick. æœ‰æ—¶ä½ çœŸçš„è®©æˆ‘æ„Ÿåˆ°æ¶å¿ƒã€‚</p><p>I donâ€™t care if you marry him for money, but why canâ€™t you come clean and admit it? æˆ‘ä¸åœ¨ä¹ä½ å«ç»™ä»–æ˜¯ä¸æ˜¯ä¸ºäº†é’±ï¼Œä½†ä½ ä¸å¦ç™½æ‰¿è®¤ã€‚come clean å¦ç™½è¯´å‡ºæ¥ã€‚admit æ‰¿è®¤ã€‚</p><p>Itâ€™s not like that. ä¸æ˜¯é‚£æ ·çš„ã€‚</p><p>So what is it like? Tying yourself to a bloody cripple at your age. åœ¨ä½ è¿™ä¸ªå¹´çºªï¼ŒæŠŠè‡ªå·±ç»‘åœ¨ä¸€ä¸ªè¯¥æ­»çš„ç˜¸å­èº«ä¸Šã€‚tying - tieçš„ç°åœ¨åˆ†è¯ã€‚</p><p>That bloody cripple looked after us. If it hadnâ€™t been for him, we wouldnâ€™t have had a home. We wouldnâ€™t have had anything.</p><p>Yes, heâ€™s getting his pound of flesh, isnâ€™t he? - æ˜¯çš„ï¼Œä»–æ­£åœ¨å¾—åˆ°ä¸€ç£…è‚‰ï¼ˆæ„æ€æ˜¯ä¹°åˆ°å›æŠ¥ï¼‰ã€‚</p><p>Heâ€™s not buying me, Michael.</p><p>So what is he doing then? Renting you by the hour? é‚£ä»–ç°åœ¨æ˜¯åšä»€ä¹ˆï¼ŸæŒ‰å°æ—¶ç§Ÿèµä½ å—ï¼Ÿ</p><p>slaps - æ‹å‡»ã€‚</p><p>Alright, then. Donâ€™t come to our wedding. Henry and I are better off without you. é‚£å¥½å§ã€‚ä¸è¦æ¥å‚åŠ æˆ‘ä»¬çš„å©šç¤¼ã€‚æ²¡æœ‰ä½ ï¼Œäº¨åˆ©å’Œæˆ‘ä¼šè¿‡å¾—æ›´å¥½ã€‚be better off - If you say that someone would be better off doing something, you are advising them to do it or expressing the opinion that it would benefit them to do it: If youâ€™ve got bags youâ€™re better off taking a taxi.</p><p>I wonâ€™t bother buying a present, then!</p><p>-Do you want to go follow her, sir?</p><p>-No, Troy, Iâ€™d like to take a closer look in here.</p><p>-What? Go in without a warrant? Isnâ€™t that a bit? - ä»€ä¹ˆï¼Ÿæ²¡æœ‰æœæŸ¥ä»¤å°±è¿›å»ï¼Ÿwarrant - ä¿è¯ï¼›å€¼å¾—ï¼Œæœ‰å¿…è¦ï¼›æœæŸ¥ä»¤ï¼›åšæŸäº‹çš„ä¾æ®ã€‚</p><p>-You have a problem, Troy?</p><p>-No, no. Just glad I didnâ€™t suggest it. åªæ˜¯åº†å¹¸æˆ‘æ²¡å¦‚æ­¤å»ºè®®ã€‚</p><p>-If anybody finds us, you did.</p><p>-Pity. çœŸé—æ†¾ã€‚</p><p>-Locked? é”ä¸Šäº†ï¼Ÿ</p><p>-Yep.</p><p>-I can force it. æˆ‘å¯ä»¥å¼ºè¡Œå¼„å¼€å®ƒã€‚</p><p>Thank you all the same.</p><p>-Mom gone to bed? å¦ˆå¦ˆå·²ç»ç¡äº†å—ï¼Ÿ</p><p>-Hours ago. å‡ å°æ—¶å‰ï¼ˆå°±ç¡äº†ï¼‰ã€‚Whatâ€™s all this? è¿™åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>-Notebooks. Iris Rainbrid took a Neighbourhood Watch to unheard of extremes. - Iris Rainbridå°†é‚»é‡Œå®ˆæœ›è€…ç»„ç»‡å¸¦åˆ°äº†å‰æ‰€æœªé—»çš„æç«¯ã€‚extreme - æç«¯ã€‚</p><p>You wouldnâ€™t think that one small village could have so much trouble bubbling under the surface.</p><p>-Was it very horrid? The bodies.</p><p>-Iâ€™ve seen worse.</p><p>Iâ€™m one more step further down the road. - æˆ‘åœ¨è·¯ä¸Šåˆå‘å‰è¿ˆè¿›äº†ä¸€æ­¥ã€‚</p><p>-I havenâ€™t read lines with you. Howâ€™s it going?</p><p>-Oh well, four acts down, one to go. - å››å¹•å·²ç»“æŸï¼Œè¿˜å‰©ä¸€å¹•ã€‚</p><p>-Yes, I suppost itâ€™s the last act that really matters. æ˜¯çš„ï¼Œæˆ‘è®¤ä¸ºçœŸæ­£é‡è¦çš„æ˜¯æœ€åä¸€å¹•ã€‚</p><p>car rumbles - è½¦éš†éš†åœ°ã€‚</p><p>peacock hoots - å­”é›€å«ã€‚</p><p>Itâ€™s out of the question. - è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚</p><p>Voice of sanity. ç†æ™ºçš„å£°éŸ³ã€‚</p><p>Parish Council - æ•™åŒºè®®ä¼šã€‚</p><p>It was only later I realised. åæ¥æˆ‘æ‰æ„è¯†åˆ°ã€‚</p><p>Everythingâ€™s over, itâ€™s all slipping away. ä¸€åˆ‡éƒ½ç»“æŸäº†ï¼Œä¸€åˆ‡éƒ½è¿‡å»äº†ã€‚</p><p>-I donâ€™t suppose you saw anyone in the woods? æˆ‘æƒ³ä½ åœ¨æ ‘æ—é‡Œæ²¡æœ‰çœ‹åˆ°ä»»ä½•äººå§ï¼Ÿ</p><p>-No. æ²¡æœ‰çœ‹åˆ°ã€‚</p><p>Phillips Codell, Iâ€™m here arresting you on suspicion of the murder of Bella Trace on 26th of June 1995.</p><p>You donâ€™t have to say anything, but it may harm your defence if you do not mention when questioned something that you reply on in court. Anything you do say may be given in evidence.</p><p>He was in that wheelchair and she just couldnâ€™t cope.</p><p>Itâ€™s something one does in the country. è¿™æ˜¯å›½å†…æ¯ä¸ªäººéƒ½ä¼šåšçš„äº‹æƒ…ã€‚</p><p>I took a hip flask, filled with vodka and I kept on drinking. It was the only that I could get the courge.</p><p>All the dead birds. The noise, the blood that made me feel sick and dizzy. åˆ°å¤„éƒ½æ˜¯æ­»é¸Ÿã€‚å™ªéŸ³ã€è¡€æ¶²è®©æˆ‘æ„Ÿåˆ°æ¶å¿ƒå’Œå¤´æ™•ã€‚</p><p>I didnâ€™t think I was gonna be able to do it.</p><p>I doubled back behind the trees and managed to hide. - æˆ‘æŠ˜å›æ ‘åå¹¶è®¾æ³•èº²äº†èµ·æ¥ã€‚double back, to turn and go back in the direction you have come from.</p><p>Then I waited until I had a clear shot. And then. I shot her. ç„¶åæˆ‘å°±ç­‰åˆ°äº†æ¸…æ™°çš„è§†è§’ã€‚ç„¶åï¼Œæˆ‘å°±å¼€æªæ‰“äº†å¥¹ã€‚ç¬¬ä¸€ä¸ªshotæ˜¯â€œé•œå¤´â€çš„æ„æ€ï¼Œç¬¬äºŒä¸ªshotï¼Œæ˜¯shootçš„è¿‡å»å¼åŠè¿‡å»åˆ†è¯ã€‚</p><p>It was terrible. I saw her pitch forward and fall to the ground. - å¤ªå¯æ€•äº†ã€‚æˆ‘çœ‹åˆ°å¥¹å‘å‰å€¾å€’ï¼Œå€’åœ¨äº†åœ°ä¸Šã€‚pitch, to move or be moved suddenly, especially by throwing or being thrown.</p><p>And then, I just panicked. ç„¶åï¼Œæˆ‘å°±æƒŠæ…Œå¤±æªäº†ã€‚panickis a common misspelling of panic.</p><p>I got up and I ran and I ran.</p><p>I thought then that Iâ€™d done it, that I got away with it. é‚£æ—¶æˆ‘æƒ³æˆ‘å·²ç»åšåˆ°äº†ï¼Œæˆ‘é€ƒè„±äº†æƒ©ç½šã€‚</p><p>How could I have known that Iâ€™d been seen? æˆ‘æƒ³çŸ¥é“ï¼Œæˆ‘æ˜¯æ€ä¹ˆè¢«çœ‹è§çš„ï¼Ÿ</p><p>She put it all in those notebooks, didnâ€™t she? I had to go to that revolting house.</p><p>I expect youâ€™ll be needed more than ever at Tye House now. æˆ‘é¢„è®¡Tye Houseç°åœ¨æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´éœ€è¦ä½ ã€‚Quite the chatelaine youâ€™ll be, wonâ€™t you? Now, what will you have?</p><p>dramatic siniter music - æˆå‰§æ€§çš„é™©æ¶éŸ³ä¹</p><p>The diamonds are marmite, the spades are jam, the hearts are tuna and the clubs are sandwich spread. æ–¹å—æ˜¯é©¬éº¦é…±ï¼Œé»‘æ¡ƒæ˜¯æœé…±ï¼Œçº¢å¿ƒæ˜¯é‡‘æªé±¼ï¼Œæ¢…èŠ±æ˜¯ä¸‰æ˜æ²»ã€‚</p><p>spread - æ”¾åœ¨é¢åŒ…æˆ–é¥¼å¹²ä¸Šçš„è½¯è´¨é£Ÿç‰©ï¼ˆé…±ï¼‰ã€‚a soft food for putting on bread and crackers:</p><p>cheese&#x2F;chocolate&#x2F;fish spread</p><p>Thereâ€™s bread and various spreads for tea.</p><p>voiceover - ç”»å¤–éŸ³ã€‚</p><p>How much did they take? ä»–ä»¬æ‹¿äº†å¤šå°‘é’±ï¼Ÿ</p><p>Theyâ€™d even stopped asking me. They knew I was cleaned out. ä»–ä»¬ç”šè‡³ä¸å†æ‰¾æˆ‘è¦äº†ã€‚ä»–ä»¬çŸ¥é“æˆ‘è¢«æç©ºäº†ã€‚</p><p>Sir, thereâ€™s someone here for you in reception. å…ˆç”Ÿï¼Œæœ‰äººåœ¨æ¥å¾…å¤„ç­‰å€™æ‚¨ã€‚</p><p>Thereâ€™s something about that story, the shooting party, that still not right.</p><p>You know you featured in here? ä½ çŸ¥é“ä½ è‡ªå·±è¢«åŒ…æ‹¬åœ¨è¿™ä¸ªç¬”è®°æœ¬ä¸­äº†å—ï¼Ÿ</p><p>He was wearing his denims and that cap he wears. é‚£ä¸ªäººç©¿ç€ä»–çš„ç‰›å­è£¤å’Œå¸½å­ã€‚</p><p>brutal - é‡è›®çš„ã€‚</p><p>-You again. You donâ€™t give up, do you?</p><p>-Mister Lacey, weâ€™re here in connection with the death of Iris Rainbird.</p><p>-In connection with. You policemen have a wonderful way of expressing yourselves.</p><p>-As you may know, Mister Lacey, she was murdered in a particularly brutal fashion. ä½ å¯èƒ½çŸ¥é“ï¼Œè±è¥¿å…ˆç”Ÿï¼Œå¥¹æ˜¯è¢«ä»¥ä¸€ç§ç‰¹åˆ«æ®‹é…·çš„æ–¹å¼è°‹æ€çš„ã€‚</p><p>-I hope youâ€™re not looking for insincere expressions of regret on my part, Chief Inspector. æˆ‘å¸Œæœ›ä½ ä¸æ˜¯åœ¨å¯»æ‰¾æˆ‘ä¸çœŸè¯šçš„é—æ†¾è¡¨ç¤ºï¼Œæ€»ç£å¯Ÿã€‚She was a very nasty woman. å¥¹æ˜¯ä¸ªä»¤äººè®¨åŒçš„å¥³äººã€‚</p><p>-Did you ever go to her house?</p><p>-No.</p><p>-So what would you say if I told you that somebody had been you entering her front door shortly after four oâ€™clock yesterday afternoon?</p><p>-I would say they needed their eyes testing.</p><p>-(Troy) Mister Lacey, we have a warrant here to search these premises. - premises, æŸäººï¼ˆä¸€èˆ¬æ˜¯å…¬å¸æˆ–ç»„ç»‡ï¼‰æ‹¥æœ‰çš„åœŸåœ°å’Œå»ºç­‘the land and buildings owned by someone, especially by a company or organization. premise, å‰æã€‚</p><p>-So how do you explain this, Sir?</p><p>-I canâ€™t! Of course I canâ€™t!</p><p>-Where have you put the clothes?</p><p>-What clothes?</p><p>-The dungarees, the cap and the golves. å·¥ä½œæœã€å¸½å­å’Œæ‰‹å¥—ã€‚</p><p>-What?</p><p>-The clothes you wore to kill Iris Rainbird.</p><p>-Youâ€™re raving mad! ä½ ç–¯äº†å§ï¼rave, to speak in an uncontrolled way, usually because you are upset or angry, or because you are sick.</p><p>Iâ€™ve been framed. æˆ‘è¢«é™·å®³äº†ã€‚</p><p>a custody death.</p><p>-Maybe we should have put her on suicide watch, sir?</p><p>-Is that a reprimant, Troy? â€˜Cause youâ€™re right. This is my fault.</p><p>-Maybe sheâ€™s better off this way. All things considered.</p><p>-That is not the point.</p><p>Lacey has been shouting  his mouth off, sir. è±è¥¿ä¸€ç›´åœ¨å¤§å–Šå¤§å«ã€‚</p><p>door clanks. é—¨å®å½“å“ã€‚</p><p>How nice of you to look in, Chief Inspector.</p><p>-You say what youâ€™ve got to say and get on with it. ä½ è¯´å‡ºä½ å¿…é¡»è¯´çš„è¯ï¼Œç„¶åç»§ç»­è¯´ä¸‹å»ã€‚</p><p>-I want to go home.</p><p>-Arenâ€™t you, Mister Comedy? You want the truth, Mister Lacey. Iâ€™ve had you up to here. æˆ‘å‡ ä¹éƒ½æŸ¥å‡ºä½ çš„ç½ªäº†ã€‚</p><p>You were in such a hurry to drag me off yesterday. ä½ æ˜¨å¤©é‚£ä¹ˆæ€¥ç€æŠŠæˆ‘æ‹–èµ°ã€‚</p><p>mid-morning - ä¸Šåˆä¸­æ—¬ã€‚</p><p>Caped Crusader - æ–—ç¯·åå­—å†›</p><p>He only did the first sketches but they took all day. ä»–åªç”»äº†è‰å›¾ï¼Œä½†æ˜¯è¿™äº›è‰å›¾èŠ±äº†ä¸€å¤©çš„æ—¶é—´ã€‚</p><p>He said I had a wonderful complicated face.</p><p>Heâ€™s a surrealist, is he? ä»–æ˜¯è¶…ç°å®ä¸»ä¹‰è€…ï¼Œæ˜¯å—ï¼Ÿ</p><p>-And since everyoneâ€™s always picking on him, you might as well know he was there the night Emily Simpson died too. æ—¢ç„¶æ¯ä¸ªäººéƒ½åœ¨æ‰¾ä»–çš„èŒ¬ï¼Œä½ ä¸å¦¨çŸ¥é“è‰¾ç±³ä¸½Â·è¾›æ™®æ£®å»ä¸–çš„é‚£å¤©æ™šä¸Šä»–ä¹Ÿåœ¨ä»–çš„å·¥ä½œå®¤é‡Œã€‚</p><p>-Youâ€™ve seen quite a bit of him, is there something that I ought to know? ä½ å·²ç»å’Œä»–è§è¿‡ä¸å°‘æ¬¡é¢äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆäº‹æ˜¯æˆ‘è¯¥çŸ¥é“çš„ï¼Ÿï¼ˆä½ æœ‰æ²¡æœ‰å’Œä»–å‘ç”Ÿè¿‡ä»€ä¹ˆï¼Ÿï¼‰</p><p>-What? Something like you and your Missis Whiplash? Or Barbara and all her boyfriends? No, dad, thereâ€™s nothing you need to know at all. ä»€ä¹ˆäº‹ï¼Ÿå°±åƒä½ å’ŒWhiplashå¤ªå¤ªé‚£æ ·å—ï¼Ÿæˆ–è€…Barbaraå’Œå¥¹çš„é‚£äº›ç”·æœ‹å‹ä¸€æ ·ï¼Ÿæ²¡æœ‰ï¼Œçˆ¸çˆ¸ï¼Œæ²¡æœ‰ä»€ä¹ˆäº‹æ˜¯ä½ åº”è¯¥çŸ¥é“çš„ï¼ˆæˆ‘å’Œä»–æ²¡æœ‰å‘ç”Ÿé‚£æ ·çš„äº‹ï¼‰ã€‚</p><p>In fact I think she may have told us more than she meant to. äº‹å®ä¸Šæˆ‘è®¤ä¸ºå¥¹å‘Šè¯‰äº†æˆ‘ä»¬æ¯”å¥¹æœ¬æ„æ›´å¤šçš„äº‹æƒ…ã€‚</p><p>-Itâ€™s very good.</p><p>-Itâ€™s only Marks and Sparks, Iâ€™m afraid. You should have told me you were coming.</p><p>-Marks and Sparks is fine.</p><p>The Lessiter girl backed up his alibi. è±æ–¯ç‰¹å¥³å­©æ”¯æŒäº†ä»–çš„ä¸åœ¨åœºè¯æ®ã€‚</p><p>It had to be a trick. è¿™ä¸€å®šæ˜¯ä¸€ä¸ªè¯¡è®¡ã€‚</p><p>car honks. æ±½è½¦é¸£ç¬›ã€‚</p><p>I have to be off. æˆ‘è¦èµ°äº†ã€‚</p><p>Burnham Crescent - Burnhamå‘éŸ³ä¸º[BUR] + [NUHM]ã€‚crescenté›•åˆ»æˆçš„ç±»ä¼¼æ–°æœˆçš„å½¢çŠ¶ã€‚</p><p>Up ahead this road on the left. å¾€è¿™æ¡è·¯å‰é¢çš„å·¦è¾¹èµ°ã€‚</p><p>They were not easy children but of course under the circumstances, one had to make allowances. ä»–ä»¬ä¸æ˜¯å¥½å­©å­ï¼Œä½†å½“ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäººä»¬å¿…é¡»ä½“è°…ä»–ä»¬ã€‚</p><p>Every day it was a slanging match. æ¯å¤©éƒ½æ˜¯ä¸€åœºè°©éª‚æ¯”èµ›ã€‚Sheâ€™d scream at him and heâ€™d fling himself out of the house.</p><p>cup shatters. æ¯å­ç²‰ç¢ã€‚</p><p>How could Iâ€™ve betrayed them? æˆ‘æ€ä¹ˆå¯èƒ½èƒŒå›ä»–ä»¬ï¼Ÿ</p><p>All she had to do was to hand the dog over to her brother. å¥¹æ‰€è¦åšçš„å°±æ˜¯æŠŠç‹—äº¤ç»™å¥¹å“¥å“¥ã€‚</p><p>Why wouldnâ€™t he open the door. Because then sheâ€™d have seen the dog and that would have spoiled the whole set-up. é‚£ä¼šç ´åæ•´ä¸ªè®¾è®¡ã€‚</p><p>If it hadnâ€™t been for an observant neighbour and an unlocked tricycle, weâ€™d have never been any the wiser. å¦‚æœæ²¡æœ‰ç»†å¿ƒçš„é‚»å±…å’Œä¸€è¾†æ²¡ä¸Šé”çš„ä¸‰è½®è½¦ï¼Œæˆ‘ä»¬æ°¸è¿œä¸ä¼šå˜å¾—æ›´èªæ˜ã€‚</p><p>Yes, theyâ€™re clever, werenâ€™t they? Always working off one another.</p><p>Whoever went to the house was wearing overalls and a cap and they probably made sure they were seen at least from behind. - overallså·¥ä½œæœã€‚</p><p>Katherine stabbed them and then she put the knife and the blood-soaked overalls into the basket.</p><p>Bella Trace was just a freak change, wrong place, wrong time.</p><p>makesman - åˆ¶é€ è€…ã€‚</p><p>bludgeon, poison, stab</p><p>sheep bleat - ç¾Šå’©å’©å«ã€‚</p><p>â€œIâ€™ve been framed.â€ And he made this sign. It was a coded message. He was warning her to remove the picture. - æˆ‘æŠŠç”»è£…åœ¨æ¡†é‡Œäº†ã€‚frame, æŠŠç”»è£…æ¡†ï¼ŒWhen a picture or photograph is framed, it is put in a frame.</p><p>Itâ€™d have given the game away, wouldnâ€™t it? è¿™å¹…ç”»æ³„éœ²äº†è¿™ä¸ªæ¸¸æˆï¼Œä¸æ˜¯å—ï¼Ÿgive awayæ³„éœ²ï¼ŒIf you give away information that should be kept secret, you reveal it to other people.</p><p>-Itâ€™s powerful. Itâ€™s brilliant even in its own way.</p><p>-He had talent.</p><p>-But so twisted.</p><p>-I almost guessed it when we came here. The three bedrooms and only one bed slept in. They pulled the wool right over my eyes.</p><p>-(Troy) When?</p><p>-That time we came here and they were arguing. They really did seem to hate each other, didnâ€™t they? And they couldnâ€™t have staged it for our benefit. Because they didnâ€™t know we were here. Except they did. They saw us in the mirror. And they did put on a show.</p><p>-Poor Emily.</p><p>-(Troy) And poor Annabella. Who was she?</p><p>-I donâ€™t suppose weâ€™ll ever know. </p><p>I hope youâ€™re not gonna fall asleep in this.</p><p>I wouldnâ€™t dream of it.</p><p>Anyway, after what youâ€™ve just been through, a start of incest should be right up your street.</p><p>Come this in sadness from you.</p><p>Let some mystery befall me soon if I dissemble all.</p>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> movie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode Usage</title>
      <link href="/blog/2024/01/24/misc/VSCode-Usage/"/>
      <url>/blog/2024/01/24/misc/VSCode-Usage/</url>
      
        <content type="html"><![CDATA[<h2 id="Reduce-the-disk-usage-of-VSCode"><a href="#Reduce-the-disk-usage-of-VSCode" class="headerlink" title="Reduce the disk usage of VSCode"></a>Reduce the disk usage of VSCode</h2><p>ä»¥ä¸‹æ–‡ä»¶å¯ä»¥åˆ é™¤ï¼š</p><ul><li><p>.vscode-server&#x2F;data&#x2F;User&#x2F;workspaceStorage&#x2F;*ï¼šå‡ åGB.</p></li><li><p>.vscode-serverï¼š<a href="https://stackoverflow.com/questions/58453967/vscode-remote-ssh-vscode-server-taking-up-a-lot-of-space">å‚è€ƒ</a></p></li><li><p>.config: å¯ä»¥é’ˆå¯¹æ¯ä¸ªç›®å½•æ‰¾åˆ°ç›¸åº”çš„ç¨‹åºï¼Œæ¯”å¦‚ Chromeï¼Œç„¶åæœ‰é’ˆå¯¹æ€§åœ°åˆ é™¤ä¸€äº›æ–‡ä»¶ã€‚å‚è€ƒ<a href="https://stackoverflow.com/questions/58453967/vscode-remote-ssh-vscode-server-taking-up-a-lot-of-space">è¿™é‡Œ</a>ã€‚</p></li><li><p>.cache: å’Œ .config ç±»ä¼¼å¤„ç†ï¼Œå‚è€ƒ<a href="https://superuser.com/questions/366771/what-does-cache-do-it-consumes-a-huge-disk-space">è¿™é‡Œ</a>ã€‚</p><p>  .cache&#x2F;vscode-cpptools: This cache folder stores cached precompiled headers or â€œipchâ€ files that the IntelliSense engine uses to improve performance. You can limit the size of the cache by changing the setting value of C_Cpp.intelliSenseCacheSize. å‚è€ƒ<a href="https://github.com/microsoft/vscode-cpptools/issues/6594">è¿™é‡Œ</a>ï¼š<br>  <img src="/blog/image.png" alt="C_Cpp.intelliSenseCacheSize"></p></li></ul><h2 id="Hot-keys"><a href="#Hot-keys" class="headerlink" title="Hot keys"></a>Hot keys</h2><ol><li>è·³è½¬åˆ°å¯¹åº”å¤§æ‹¬å·ï¼š<code>Ctrl Shift \</code></li></ol><h2 id="Debug-code-in-VSCode"><a href="#Debug-code-in-VSCode" class="headerlink" title="Debug code in VSCode"></a>Debug code in VSCode</h2><ul><li><a href="https://code.visualstudio.com/Docs/editor/debugging#_multitarget-debugging">Debug multiple processes in VSCode</a></li><li><a href="https://stackoverflow.com/questions/60515935/visual-studio-code-does-not-attach-debugger-to-multi-processes-in-python-using-p">Debug Python Subprocess</a></li></ul><h2 id="Useful-plugins"><a href="#Useful-plugins" class="headerlink" title="Useful plugins"></a>Useful plugins</h2><ul><li><code>Remote - SSH</code>: Windows è¿æ¥ Linuxã€‚å‰ç½®æ¡ä»¶ï¼šWindows æœ¬èº«éœ€è¦å®‰è£… ssh å‘½ä»¤è¡Œå·¥å…·ã€‚</li><li><code>Perforce for VS Code</code>: perforce å·¥å…·ã€‚</li><li><code>intent-rainbow</code>: ç”¨å½©è‰²æ˜¾ç¤ºç¼©è¿›ã€‚</li><li><code>C/C++</code></li><li><code>Makefile Tools</code></li><li><code>Verilog Format</code></li><li><code>All in one</code></li><li><code>c/c++ definition generator</code></li><li><code>KoroFileHeader</code>: å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/610490070">è¿™é‡Œ</a>ã€‚</li></ul><h2 id="Useful-configurations"><a href="#Useful-configurations" class="headerlink" title="Useful configurations"></a>Useful configurations</h2><p><a href="https://www.cxyzjd.com/article/weixin_45461426/105936955">è‡ªåŠ¨å¡«å……å¤´æ–‡ä»¶ï¼Œæ¯”å¦‚ifndefå®</a></p><p>é…ç½®æ–‡ä»¶ï¼š</p><ul><li>launch.json</li><li>tasks.json: <a href="https://stackoverflow.com/questions/48273346/vscode-command-for-user-input-in-debug-launch-config">ref</a>, <a href="https://code.visualstudio.com/updates/v1_30#_improved-user-input-variables-for-task-and-debug-configurations">ref</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ‰“å°è¿›ç¨‹å †æ ˆ</title>
      <link href="/blog/2024/01/23/cpp/%E6%89%93%E5%8D%B0%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%A0%86%E6%A0%88/"/>
      <url>/blog/2024/01/23/cpp/%E6%89%93%E5%8D%B0%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%A0%86%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p><a href="https://www.gnu.org/software/libc/manual/html_node/Backtraces.html">glic Functions</a></p><pre><code>backtracebacktrace_symbolsbacktrace_symbols_fd</code></pre><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;execinfo.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print_trace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> <span class="type">int</span> SIZE = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>* buffer[SIZE];</span><br><span class="line">    <span class="type">char</span>** strings;</span><br><span class="line">    <span class="type">int</span> size, i;</span><br><span class="line"></span><br><span class="line">    size = <span class="built_in">backtrace</span>(buffer, SIZE);</span><br><span class="line">    strings = <span class="built_in">backtrace_symbols</span>(buffer, size);</span><br><span class="line">    <span class="keyword">if</span> (strings != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Obtained %d stack frames.\n&quot;</span>, size);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; ++i)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, strings[i]);</span><br><span class="line">        <span class="built_in">free</span>(strings);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹åº“"><a href="#ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="ç¬¬ä¸‰æ–¹åº“"></a>ç¬¬ä¸‰æ–¹åº“</h2><p>breakpad: <a href="https://blog.csdn.net/weixin_45609638/article/details/125090204">https://blog.csdn.net/weixin_45609638/article/details/125090204</a></p><p><a href="https://juejin.cn/post/6899070041074073614">https://juejin.cn/post/6899070041074073614</a></p><p><a href="https://juejin.cn/post/7130820896213712927">https://juejin.cn/post/7130820896213712927</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build Linux Kernel Module</title>
      <link href="/blog/2024/01/23/linux/Build-Linux-Kernel-Module/"/>
      <url>/blog/2024/01/23/linux/Build-Linux-Kernel-Module/</url>
      
        <content type="html"><![CDATA[<h2 id="å†…æ ¸ç¼–è¯‘"><a href="#å†…æ ¸ç¼–è¯‘" class="headerlink" title="å†…æ ¸ç¼–è¯‘"></a>å†…æ ¸ç¼–è¯‘</h2><p>obj-m: <a href="https://stackoverflow.com/questions/57839941/what-is-the-meaning-of-obj-m-in-linux-device-driver-makefile">é“¾æ¥</a></p><p>make modules: <a href="https://askubuntu.com/questions/1363530/what-does-make-and-make-modules-do-when-compiling-building-the-kernel">é“¾æ¥</a></p><h2 id="ç¼–è¯‘å†…æ ¸æ¨¡å—"><a href="#ç¼–è¯‘å†…æ ¸æ¨¡å—" class="headerlink" title="ç¼–è¯‘å†…æ ¸æ¨¡å—"></a>ç¼–è¯‘å†…æ ¸æ¨¡å—</h2><p><a href="https://tldp.org/LDP/lkmpg/2.6/html/x181.html">æ–‡æ¡£</a></p><p>Makefile:</p><pre><code>obj-m += hello-1.oall:    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modulesclean:    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean</code></pre><p><code>make -C</code> changes to a new directory where the new makefiles will be run.</p><p><code>M=$(PWD)</code> defines a variable <code>M</code> which the child makefiles can use.</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul><li><code>insmod</code>: æ’å…¥ä¸€ä¸ªæ¨¡å—ï¼ˆ.koï¼‰åˆ°kernelä¸­ã€‚</li><li><code>rmmod</code>: ä»å†…æ ¸ä¸­åˆ é™¤ä¸€ä¸ªæ¨¡å—ã€‚</li><li><code>modprobe</code>: ä»å†…æ ¸ä¸­å¢åˆ æ¨¡å—ã€‚<code>modprobe</code>ä»<code>/lib/modules/`uname -r`</code>ä¸­æœç´¢æ‰€æœ‰çš„æ¨¡å—å’Œå…¶ä»–æ–‡ä»¶ï¼Œé™¤äº†<code>/etc/modprobe.d</code>ç›®å½•ä¸­çš„å¯é€‰é…ç½®æ–‡ä»¶ï¼ˆå‚è§<code>modprobe.d(5)</code>ï¼‰ã€‚</li><li><code>lsmod</code>: æ˜¾ç¤ºå½“å‰åŠ è½½çš„å†…æ ¸æ¨¡å—çš„çŠ¶æ€ï¼ˆå³å¯¹<code>/proc/modules</code>å†…å®¹çš„æ ¼å¼åŒ–ï¼‰ã€‚</li><li><code>modinfo</code>: ä»å‘½ä»¤è¡ŒæŒ‡å®šçš„å†…æ ¸æ¨¡å—ä¸­æå–ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ç»™å‡ºæ¨¡å—åç§°ï¼Œé‚£ä¹ˆä¼šæœç´¢<code>/lib/modules/version</code>ç›®å½•ï¼Œå°±åƒ<code>modprobe</code>åŠ è½½æ¨¡å—æ—¶ä¸€æ ·ã€‚</li><li><code>depmod</code>: ç”Ÿæˆ<code>modules.dep</code>å’Œæ˜ å°„æ–‡ä»¶ã€‚</li><li><code>dmesg</code>: æ‰“å°æˆ–æ§åˆ¶å†…æ ¸ring bufferï¼ˆå­˜å‚¨kernel messageï¼‰ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introducation to PCIE</title>
      <link href="/blog/2024/01/23/misc/PCIE/"/>
      <url>/blog/2024/01/23/misc/PCIE/</url>
      
        <content type="html"><![CDATA[<h1 id="è¯æ±‡è¡¨ï¼ˆGlossaryï¼‰"><a href="#è¯æ±‡è¡¨ï¼ˆGlossaryï¼‰" class="headerlink" title="è¯æ±‡è¡¨ï¼ˆGlossaryï¼‰"></a>è¯æ±‡è¡¨ï¼ˆGlossaryï¼‰</h1><ul><li>BAR: base address register.</li><li>PCI configuration space.</li><li>sba: system bus address.</li></ul><p><a href="https://wiki.osdev.org/PCI">PCI</a></p><p><a href="https://en.wikipedia.org/wiki/PCI_configuration_space">PCI configurtation space</a></p><pre><code>PCIè®¾å¤‡æœ‰ä¸€ç»„è¢«ç§°ä¸ºconfiguratin spaceçš„å¯„å­˜å™¨ï¼Œå¹¶ä¸”PCI Expresså¼•å…¥äº†Extended configuration spaceã€‚configuration spaceå¯„å­˜å™¨è¢«æ˜ å°„åˆ°memory locationsã€‚é©±åŠ¨è®¾å¤‡å’Œè¯Šæ–­è½¯ä»¶å¿…é¡»è¦æœ‰æƒé™è®¿é—®configuration spaceï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä½¿ç”¨APIsæ¥æˆæƒè®¿é—®è®¾å¤‡configuration spaceã€‚</code></pre><p>PCI configuration spaceæœ‰ä¸¤ç§ç±»å‹çš„Headerï¼ˆ64 bytesï¼‰ï¼š</p><h2 id="Header-Type-0x0"><a href="#Header-Type-0x0" class="headerlink" title="Header Type 0x0"></a>Header Type 0x0</h2><style type="text/css">.tg  {border-collapse:collapse;border-spacing:0;}.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;  overflow:hidden;padding:10px 5px;word-break:normal;}.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}.tg .tg-rcf9{background-color:#F9F9F9;text-align:left;vertical-align:middle}.tg .tg-tbl0{background-color:#F9F9F9;font-weight:bold;text-align:center;vertical-align:middle}</style><table class="tg"><thead>  <tr>    <th class="tg-tbl0">Register</th>    <th class="tg-tbl0">Offset</th>    <th class="tg-tbl0">Bits 31-24</th>    <th class="tg-tbl0">Bits 23-16</th>    <th class="tg-tbl0">Bits 15-8</th>    <th class="tg-tbl0">Bits 7-0</th>  </tr></thead><tbody>  <tr>    <td class="tg-rcf9">0x0</td>    <td class="tg-rcf9">0x0</td>    <td class="tg-rcf9" colspan="2">Device ID</td>    <td class="tg-rcf9" colspan="2">Vendor ID</td>  </tr>  <tr>    <td class="tg-rcf9">0x1</td>    <td class="tg-rcf9">0x4</td>    <td class="tg-rcf9" colspan="2">Status</td>    <td class="tg-rcf9" colspan="2">Command</td>  </tr>  <tr>    <td class="tg-rcf9">0x2</td>    <td class="tg-rcf9">0x8</td>    <td class="tg-rcf9">Class code</td>    <td class="tg-rcf9">Subclass</td>    <td class="tg-rcf9">Prog IF</td>    <td class="tg-rcf9">Revision ID</td>  </tr>  <tr>    <td class="tg-rcf9">0x3</td>    <td class="tg-rcf9">0xC</td>    <td class="tg-rcf9">BIST</td>    <td class="tg-rcf9">Header type</td>    <td class="tg-rcf9">Latency Timer</td>    <td class="tg-rcf9">Cache Line Size</td>  </tr>  <tr>    <td class="tg-rcf9">0x4</td>    <td class="tg-rcf9">0x10</td>    <td class="tg-rcf9" colspan="4">Base address #0 (BAR0)</td>  </tr>  <tr>    <td class="tg-rcf9">0x5</td>    <td class="tg-rcf9">0x14</td>    <td class="tg-rcf9" colspan="4">Base address #1 (BAR1)</td>  </tr>  <tr>    <td class="tg-rcf9">0x6</td>    <td class="tg-rcf9">0x18</td>    <td class="tg-rcf9">Secondary Latency Timer</td>    <td class="tg-rcf9">Subordinate Bus Number</td>    <td class="tg-rcf9">Secondary Bus Number</td>    <td class="tg-rcf9">Primary Bus Number</td>  </tr>  <tr>    <td class="tg-rcf9">0x7</td>    <td class="tg-rcf9">0x1C</td>    <td class="tg-rcf9" colspan="2">Secondary Status</td>    <td class="tg-rcf9">I/O Limit</td>    <td class="tg-rcf9">I/O Base</td>  </tr>  <tr>    <td class="tg-rcf9">0x8</td>    <td class="tg-rcf9">0x20</td>    <td class="tg-rcf9" colspan="2">Memory Limit</td>    <td class="tg-rcf9" colspan="2">Memory Base</td>  </tr>  <tr>    <td class="tg-rcf9">0x9</td>    <td class="tg-rcf9">0x24</td>    <td class="tg-rcf9" colspan="2">Prefetchable Memory Limit</td>    <td class="tg-rcf9" colspan="2">Prefetchable Memory Base</td>  </tr>  <tr>    <td class="tg-rcf9">0xA</td>    <td class="tg-rcf9">0x28</td>    <td class="tg-rcf9" colspan="4">Prefetchable Base Upper 32 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xB</td>    <td class="tg-rcf9">0x2C</td>    <td class="tg-rcf9" colspan="4">Prefetchable Limit Upper 32 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xC</td>    <td class="tg-rcf9">0x30</td>    <td class="tg-rcf9" colspan="2">I/O Limit Upper 16 Bits</td>    <td class="tg-rcf9" colspan="2">I/O Base Upper 16 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xD</td>    <td class="tg-rcf9">0x34</td>    <td class="tg-rcf9" colspan="3">Reserved</td>    <td class="tg-rcf9">Capability Pointer</td>  </tr>  <tr>    <td class="tg-rcf9">0xE</td>    <td class="tg-rcf9">0x38</td>    <td class="tg-rcf9" colspan="4">Expansion ROM base address</td>  </tr>  <tr>    <td class="tg-rcf9">0xF</td>    <td class="tg-rcf9">0x3C</td>    <td class="tg-rcf9" colspan="2">Bridge Control</td>    <td class="tg-rcf9">Interrupt PIN</td>    <td class="tg-rcf9">Interrupt Line</td>  </tr></tbody></table><h2 id="Header-Type-0x1"><a href="#Header-Type-0x1" class="headerlink" title="Header Type 0x1"></a>Header Type 0x1</h2><style type="text/css">.tg  {border-collapse:collapse;border-spacing:0;}.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;  overflow:hidden;padding:10px 5px;word-break:normal;}.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}.tg .tg-rcf9{background-color:#F9F9F9;text-align:left;vertical-align:middle}.tg .tg-tbl0{background-color:#F9F9F9;font-weight:bold;text-align:center;vertical-align:middle}</style><table class="tg"><thead>  <tr>    <th class="tg-tbl0">Register</th>    <th class="tg-tbl0">Offset</th>    <th class="tg-tbl0">Bits 31-24</th>    <th class="tg-tbl0">Bits 23-16</th>    <th class="tg-tbl0">Bits 15-8</th>    <th class="tg-tbl0">Bits 7-0</th>  </tr></thead><tbody>  <tr>    <td class="tg-rcf9">0x0</td>    <td class="tg-rcf9">0x0</td>    <td class="tg-rcf9" colspan="2">Device ID</td>    <td class="tg-rcf9" colspan="2">Vendor ID</td>  </tr>  <tr>    <td class="tg-rcf9">0x1</td>    <td class="tg-rcf9">0x4</td>    <td class="tg-rcf9" colspan="2">Status</td>    <td class="tg-rcf9" colspan="2">Command</td>  </tr>  <tr>    <td class="tg-rcf9">0x2</td>    <td class="tg-rcf9">0x8</td>    <td class="tg-rcf9">Class code</td>    <td class="tg-rcf9">Subclass</td>    <td class="tg-rcf9">Prog IF</td>    <td class="tg-rcf9">Revision ID</td>  </tr>  <tr>    <td class="tg-rcf9">0x3</td>    <td class="tg-rcf9">0xC</td>    <td class="tg-rcf9">BIST</td>    <td class="tg-rcf9">Header type</td>    <td class="tg-rcf9">Latency Timer</td>    <td class="tg-rcf9">Cache Line Size</td>  </tr>  <tr>    <td class="tg-rcf9">0x4</td>    <td class="tg-rcf9">0x10</td>    <td class="tg-rcf9" colspan="4">Base address #0 (BAR0)</td>  </tr>  <tr>    <td class="tg-rcf9">0x5</td>    <td class="tg-rcf9">0x14</td>    <td class="tg-rcf9" colspan="4">Base address #1 (BAR1)</td>  </tr>  <tr>    <td class="tg-rcf9">0x6</td>    <td class="tg-rcf9">0x18</td>    <td class="tg-rcf9">Secondary Latency Timer</td>    <td class="tg-rcf9">Subordinate Bus Number</td>    <td class="tg-rcf9">Secondary Bus Number</td>    <td class="tg-rcf9">Primary Bus Number</td>  </tr>  <tr>    <td class="tg-rcf9">0x7</td>    <td class="tg-rcf9">0x1C</td>    <td class="tg-rcf9" colspan="2">Secondary Status</td>    <td class="tg-rcf9">I/O Limit</td>    <td class="tg-rcf9">I/O Base</td>  </tr>  <tr>    <td class="tg-rcf9">0x8</td>    <td class="tg-rcf9">0x20</td>    <td class="tg-rcf9" colspan="2">Memory Limit</td>    <td class="tg-rcf9" colspan="2">Memory Base</td>  </tr>  <tr>    <td class="tg-rcf9">0x9</td>    <td class="tg-rcf9">0x24</td>    <td class="tg-rcf9" colspan="2">Prefetchable Memory Limit</td>    <td class="tg-rcf9" colspan="2">Prefetchable Memory Base</td>  </tr>  <tr>    <td class="tg-rcf9">0xA</td>    <td class="tg-rcf9">0x28</td>    <td class="tg-rcf9" colspan="4">Prefetchable Base Upper 32 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xB</td>    <td class="tg-rcf9">0x2C</td>    <td class="tg-rcf9" colspan="4">Prefetchable Limit Upper 32 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xC</td>    <td class="tg-rcf9">0x30</td>    <td class="tg-rcf9" colspan="2">I/O Limit Upper 16 Bits</td>    <td class="tg-rcf9" colspan="2">I/O Base Upper 16 Bits</td>  </tr>  <tr>    <td class="tg-rcf9">0xD</td>    <td class="tg-rcf9">0x34</td>    <td class="tg-rcf9" colspan="3">Reserved</td>    <td class="tg-rcf9">Capability Pointer</td>  </tr>  <tr>    <td class="tg-rcf9">0xE</td>    <td class="tg-rcf9">0x38</td>    <td class="tg-rcf9" colspan="4">Expansion ROM base address</td>  </tr>  <tr>    <td class="tg-rcf9">0xF</td>    <td class="tg-rcf9">0x3C</td>    <td class="tg-rcf9" colspan="2">Bridge Control</td>    <td class="tg-rcf9">Interrupt PIN</td>    <td class="tg-rcf9">Interrupt Line</td>  </tr></tbody></table><pre><code>BAR0Memory-mapped I/O (MMIO) registersBAR1Device memory windows.BAR2/3Complementary space of BAR1.BAR5I/O port.BAR6PCI ROM.</code></pre><h1 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h1><p>lspci</p><p><a href="https://diego.assencio.com/?index=649b7a71b35fc7ad41e03b6d0e825f07">Interpreting the output of lspci</a></p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://insujang.github.io/2017-04-03/pci-express-i/o-system/">PCI Express I&#x2F;O System</a></li><li><a href="https://www.pcmag.com/encyclopedia/term/pci-express">PCI Express</a></li><li><a href="https://www.trentonsystems.com/blog/what-is-pcie">What is PCIe</a></li><li><a href="https://stackoverflow.com/questions/30190050/what-is-the-base-address-register-bar-in-pcie">What is the Base Address Register (BAR) in PCIe?</a></li><li><a href="https://utcc.utoronto.ca/~cks/space/blog/linux/PCIeLspciBusAddresses">PCIe bus addresses, lspci, and working out your PCIe bus topology</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PCIE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LDAP</title>
      <link href="/blog/2024/01/23/misc/LDAP/"/>
      <url>/blog/2024/01/23/misc/LDAP/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>LDAP, Lightweight Directory Access Protocol.</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://support.bull.com/documentation/byproduct/infra/sw-extremcomp/sw-extremcomp-com/g">Bull Support</a></p>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LDAP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Drive</title>
      <link href="/blog/2024/01/23/linux/Drive/"/>
      <url>/blog/2024/01/23/linux/Drive/</url>
      
        <content type="html"><![CDATA[<h1 id="é©±åŠ¨"><a href="#é©±åŠ¨" class="headerlink" title="é©±åŠ¨"></a>é©±åŠ¨</h1><p>æœ¬æ–‡ä»‹ç»é©±åŠ¨ã€‚</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><ul><li><p><code>lsmod</code> - Show status of modules in the Linux kernel.</p><p><code>lsmod</code> is a trivial program which nicely formats the contents of the <code>/proc/odules</code>,<br>showing what kernel modules are currently loaded.</p></li><li><p><code>dmesg</code> - examine or control the kernel ring buffer.</p><p>  The kernel buffer is a data structure used for keeping the log messages of the kernel and the kernel modules.<br>  Itâ€™s a ring buffer with a fixed size. Once itâ€™s full, new messages overwrite the oldest messages.<br>  During boot, the kernel saves the messages into the kernel buffer.</p></li><li><p><code>lsscsi</code> - Uses information in sysfs (Linux kernel series 2.6 and later) to list SCSI devices (or hosts) currently attached to the system.</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git Usage</title>
      <link href="/blog/2024/01/23/personal_site/git-Usage/"/>
      <url>/blog/2024/01/23/personal_site/git-Usage/</url>
      
        <content type="html"><![CDATA[<h2 id="gitignoreä¸ç”Ÿæ•ˆ"><a href="#gitignoreä¸ç”Ÿæ•ˆ" class="headerlink" title="gitignoreä¸ç”Ÿæ•ˆ"></a>gitignoreä¸ç”Ÿæ•ˆ</h2><p>å‚è€ƒï¼š<a href="https://www.python100.com/html/32VIQ026UL7U.html">é“¾æ¥</a>ã€‚</p><h2 id="file-mode-10064çš„å«ä¹‰"><a href="#file-mode-10064çš„å«ä¹‰" class="headerlink" title="file mode 10064çš„å«ä¹‰"></a>file mode 10064çš„å«ä¹‰</h2><p>å‚è€ƒ<a href="https://blog.csdn.net/flyd1005/article/details/43824473">åšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Environment Variables</title>
      <link href="/blog/2024/01/23/linux/Environment-Variables/"/>
      <url>/blog/2024/01/23/linux/Environment-Variables/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><ul><li><p><code>environ</code> - ç”¨æˆ·ç¯å¢ƒï¼Œä¸€ä¸ªå…¨å±€å˜é‡ã€‚å¤´æ–‡ä»¶ <code>&lt;unistd.h&gt;</code>ã€‚å¯ä»¥é€šè¿‡ <code>man environ</code> æŸ¥çœ‹æ‰‹å†Œã€‚</p>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;program environment: &quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>** entry = environ; *entry; ++entry) &#123;</span><br><span class="line">        cout &lt;&lt; *entry &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>getenv</code> - è·å–ç¯å¢ƒå˜é‡ã€‚å¤´æ–‡ä»¶ <code>&lt;stdlib.h&gt;</code>ã€‚</p></li><li><p><code>setenv</code> - è®¾ç½®ç¯å¢ƒå˜é‡ã€‚å¤´æ–‡ä»¶ <code>stdlib.h</code>ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thread</title>
      <link href="/blog/2024/01/23/thread/Thread/"/>
      <url>/blog/2024/01/23/thread/Thread/</url>
      
        <content type="html"><![CDATA[<h2 id="sched-setaffinity"><a href="#sched-setaffinity" class="headerlink" title="sched_setaffinity"></a><code>sched_setaffinity</code></h2><p>å‚è€ƒ<a href="https://man7.org/linux/man-pages/man2/sched_setaffinity.2.html">manpage</a>.</p><p>affinity è¡¨ç¤º CPU äº²ç¼˜æ€§ï¼šå³ä¸å“ªä¸ªæ›´äº²ï¼Œæ›´æ„¿æ„å±äºå“ªä¸€ä¸ªã€‚</p><p><a href="https://blog.csdn.net/itjinks/article/details/40477779">https://blog.csdn.net/itjinks/article/details/40477779</a></p><p><a href="https://blog.csdn.net/itjinks/article/details/40477779">CPU affinity æ˜¯ä¸€ç§è°ƒåº¦å±æ€§(scheduler property), å®ƒå¯ä»¥å°†ä¸€ä¸ªè¿›ç¨‹â€ç»‘å®šâ€ åˆ°ä¸€ä¸ªæˆ–ä¸€ç»„CPUä¸Š.</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GNU Introducation</title>
      <link href="/blog/2024/01/23/misc/GNU-Introducation/"/>
      <url>/blog/2024/01/23/misc/GNU-Introducation/</url>
      
        <content type="html"><![CDATA[<ul><li><a href="https://www.gnu.org/">GNU</a></li><li><a href="https://www.gnu.org/software/">GNU Software</a></li><li><a href="https://www.gnu.org/software/gnulib/">Gnulib</a></li><li><a href="https://www.gnu.org/software/make/">Gnumake</a></li></ul><h2 id="libc"><a href="#libc" class="headerlink" title="libc"></a>libc</h2><h3 id="Memory-Protection"><a href="#Memory-Protection" class="headerlink" title="Memory Protection"></a>Memory Protection</h3><p>å‚è§ï¼š<a href="https://www.gnu.org/software/libc/manual/html_node/Memory-Protection.html">æ–‡æ¡£</a>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gnu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gdb å…¥é—¨</title>
      <link href="/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/"/>
      <url>/blog/2024/01/23/cpp/gdb%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="gdbå®ç°åŸç†"><a href="#gdbå®ç°åŸç†" class="headerlink" title="gdbå®ç°åŸç†"></a>gdbå®ç°åŸç†</h2><p>å‚è€ƒ<a href="https://www.zhihu.com/people/bi-an-60-46">é“¾æ¥</a>ã€‚</p><h2 id="gdbå‘½ä»¤"><a href="#gdbå‘½ä»¤" class="headerlink" title="gdbå‘½ä»¤"></a>gdbå‘½ä»¤</h2><ul><li><p><code>thread apply [threadno] [all] args</code> - å°†å‘½ä»¤ä¼ é€’ç»™ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œå‚è§<a href="https://developer.apple.com/library/archive/documentation/DeveloperTools/gdb/gdb/gdb_5.html">é“¾æ¥</a>ã€‚<br>æ¯”å¦‚ï¼Œ<code>thread apply all continue</code>è¡¨ç¤ºå°†<code>continue</code>å‘½ä»¤ä¼ é€’ç»™æ‰€æœ‰çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è®©æ‰€æœ‰çº¿ç¨‹éƒ½ç»§ç»­è¿è¡Œã€‚</p></li><li><p><code>rbreak</code> - Set a breakpoint for all functions matching REGEXP. å‚è€ƒ<a href="https://blog.csdn.net/zdl1016/article/details/8708077">é“¾æ¥</a>ã€‚</p><p>  e.g. <code>rbreak file.C:.*</code> - ç»™file.Cçš„æ‰€æœ‰å‡½æ•°åŠ ä¸Šæ–­ç‚¹ã€‚</p></li><li><p><code>info</code></p><ul><li><code>info inferior</code> - å¯ä»¥æŸ¥çœ‹å½“å‰è°ƒè¯•çš„è¿›ç¨‹çš„PIDã€‚å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯åœ¨gdbå‘½ä»¤è¡Œä¸­ç›´æ¥è°ƒç”¨Cå‡½æ•°ï¼š<code>print (int)getpid()</code>ã€‚å‚è€ƒï¼š<a href="https://www.qiniu.com/qfans/qnso-36704270">é“¾æ¥</a>ã€‚</li><li><code>info source</code> - å½“å‰è°ƒè¯•çš„æºæ–‡ä»¶è·¯å¾„ã€‚</li><li><code>info sources &lt;pattern&gt;</code> - æŸ¥è¯¢æºæ–‡ä»¶è·¯å¾„</li><li><code>info proc</code> - <a href="https://sourceware.org/gdb/onlinedocs/gdb/Process-Information.html">å½“å‰è¿›ç¨‹ä¿¡æ¯</a>ã€‚<ul><li><code>info proc files</code> - å½“å‰è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶ï¼ˆå’Œæ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚</li><li><code>info args</code> - æŸ¥çœ‹å‡½æ•°å‚æ•°</li><li><code>info locals</code> - æŸ¥çœ‹å±€éƒ¨å˜é‡ã€‚</li></ul></li></ul></li><li><p><code>show</code> </p><ul><li><code>show environment</code> æŸ¥çœ‹å…¨å±€å˜é‡</li><li><code>set environment &lt;var&gt;=&lt;value&gt;</code> è®¾ç½®ç¯å¢ƒå˜é‡</li></ul></li><li><p><code>attach</code> - è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚ä¸<code>gdb -p</code>æ•ˆæœç›¸åŒã€‚</p></li><li><p><code>detach</code> - å–æ¶ˆè¿æ¥çš„è¿›ç¨‹ã€‚</p></li><li><p><code>handle &lt;signal&gt; print pass nostop</code> - æ•è·ä¿¡å·ï¼ˆæ¯”å¦‚<code>SIGSEGV</code>ï¼‰å¹¶ä¸”å¿½ç•¥å®ƒã€‚<code>handle &lt;signal nostop</code>ã€‚</p><ul><li><code>pass</code> è¡¨ç¤º gdb ä¼šå°†æ•è·åˆ°çš„ä¿¡å·å‘å›ç»™è¢«è°ƒè¯•çš„è¿›ç¨‹ã€‚</li></ul></li><li><p><code>set</code> - ä¿®æ”¹å˜é‡çš„å€¼ï¼Œæ¯”å¦‚<code>set x=10</code>ï¼ˆæˆ–<code>set var x=10</code>ï¼‰å°†å˜é‡<code>x</code>çš„å€¼æ”¹ä¸º<code>10</code>ã€‚å‚è€ƒ<a href="https://blog.csdn.net/yasi_xi/article/details/12784507">åšå®¢</a>ã€‚</p></li><li><p><code>show directories</code></p></li><li><p><code>print</code> - gdbé»˜è®¤è®¾ç½®æ‰“å°å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º200ï¼›æ›´æ”¹æ‰“å°æœ€å¤§é•¿åº¦ï¼š<code>set print elements &lt;number-of-elements&gt;</code>ï¼Œ<code>0</code>è¡¨ç¤ºunlimited.<br>    - æ‰“å°æ•°ç»„: <code>print arr[0]@3</code> ï¼Œå…¶ä¸­ <code>@3</code> è¡¨ç¤ºæ‰“å° 3 ä¸ªå…ƒç´ ã€‚<br>    - ä»¥åå…­è¿›åˆ¶æ‰“å°ï¼š<code>p/x &lt;var&gt;</code></p></li><li><p><code>ptype &lt;variable name&gt;</code> - æ‰“å°å˜é‡ç±»å‹ã€‚</p></li><li><p><code>finish</code> - ä»å‡½æ•°ä¸­è¿”å›ï¼Œå¹¶æ‰“å°å‡½æ•°è¿”å›å€¼ï¼ˆå³ä½¿å‡½æ•°çš„returnè¯­å¥å¾ˆå¤æ‚ï¼Œä¹Ÿå¯ä»¥è·å–è¿”å›å€¼ï¼‰ã€‚</p></li><li><p><code>frame &lt;n&gt;</code> - è·³è½¬åˆ°æŸä¸ªæ ˆfå¸§ã€‚</p></li></ul><h2 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h2><p>è§<a href="https://www.irya.unam.mx/computo/sites/manuales/fce12/debugger/cl/commandref/gdb_mode/cmd_set_environm.htm">é“¾æ¥</a></p><h2 id="æ–­ç‚¹"><a href="#æ–­ç‚¹" class="headerlink" title="æ–­ç‚¹"></a>æ–­ç‚¹</h2><p>æ·»åŠ æ–­ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">break file:line_no</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ–­ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info break</span><br></pre></td></tr></table></figure><p>åˆ é™¤ç¬¬2ä¸ªæ–­ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete 2</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶æ–­ç‚¹"><a href="#æ¡ä»¶æ–­ç‚¹" class="headerlink" title="æ¡ä»¶æ–­ç‚¹"></a>æ¡ä»¶æ–­ç‚¹</h3><p>å‚è€ƒï¼š<a href="http://c.biancheng.net/view/8255.html">åšå®¢</a>ã€<a href="https://ftp.gnu.org/old-gnu/Manuals/gdb/html_node/gdb_28.html">æ–‡æ¡£</a>ã€‚</p><p><code>break ... if cond</code></p><h3 id="è§‚å¯Ÿæ–­ç‚¹"><a href="#è§‚å¯Ÿæ–­ç‚¹" class="headerlink" title="è§‚å¯Ÿæ–­ç‚¹"></a>è§‚å¯Ÿæ–­ç‚¹</h3><h3 id="æ•æ‰æ–­ç‚¹"><a href="#æ•æ‰æ–­ç‚¹" class="headerlink" title="æ•æ‰æ–­ç‚¹"></a>æ•æ‰æ–­ç‚¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">try...catch</span><br></pre></td></tr></table></figure><h3 id="æ‰“å°é•¿åº¦çš„é™åˆ¶"><a href="#æ‰“å°é•¿åº¦çš„é™åˆ¶" class="headerlink" title="æ‰“å°é•¿åº¦çš„é™åˆ¶"></a>æ‰“å°é•¿åº¦çš„é™åˆ¶</h3><ul><li>Value sizes - å‚è€ƒï¼š<a href="https://sourceware.org/gdb/onlinedocs/gdb/Value-Sizes.html">æ–‡æ¡£</a></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> max-value-size bytes</span><br><span class="line"><span class="built_in">set</span> max-value-size unlimited</span><br></pre></td></tr></table></figure><ul><li><p>æ‰“å°å­—ç¬¦é•¿åº¦é™åˆ¶</p><p>gdbé»˜è®¤è®¾ç½®æ‰“å°å­—ç¬¦ä¸²çš„é•¿åº¦ä¸º200ï¼›æ›´æ”¹æ‰“å°æœ€å¤§é•¿åº¦ï¼š<code>set print elements</code></p></li></ul><h2 id="coredump"><a href="#coredump" class="headerlink" title="coredump"></a>coredump</h2><p>gdbå‘½ä»¤ï¼š<code>gcore</code>ã€‚</p><p><a href="https://man7.org/linux/man-pages/man5/core.5.html">Reference</a></p><h2 id="WSLæ— æ³•ä½¿ç”¨gdb"><a href="#WSLæ— æ³•ä½¿ç”¨gdb" class="headerlink" title="WSLæ— æ³•ä½¿ç”¨gdb"></a>WSLæ— æ³•ä½¿ç”¨gdb</h2><p>WSLæŒ‡Windowsè™šæ‹Ÿæœºã€‚</p><p><a href="https://github.com/microsoft/WSL/issues/8516">è§£å†³æ–¹æ³•</a>ï¼š</p><p>å®‰è£…<a href="https://launchpad.net/~ubuntu-support-team/+archive/ubuntu/gdb">PPAçš„daily buildç‰ˆæœ¬</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:ubuntu-support-team/gdb</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install gdb</span><br></pre></td></tr></table></figure><h2 id="gdb-attach-æƒé™æŠ¥é”™"><a href="#gdb-attach-æƒé™æŠ¥é”™" class="headerlink" title="gdb attach æƒé™æŠ¥é”™"></a>gdb attach æƒé™æŠ¥é”™</h2><p>This is due to kernel hardening in Linux; you can disable this behavior by <code>echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</code> or by modifying it in <code>/etc/sysctl.d/10-ptrace.conf</code>.</p><p><a href="https://stackoverflow.com/questions/19215177/how-to-solve-ptrace-operation-not-permitted-when-trying-to-attach-gdb-to-a-pro">How to solve â€œptrace operation not permittedâ€ when trying to attach GDB to a process?</a></p><h2 id="gdb-debug-forks"><a href="#gdb-debug-forks" class="headerlink" title="gdb debug forks"></a>gdb debug forks</h2><p><a href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Forks.html">Reference</a></p><p>By default, when a program forks, gdb will continue to debug the parent process and the child process will run unimpeded.</p><p>If you want to follow the child process instead of the parent process, use the command set <code>follow-fork-mode</code>.</p><p><code>set follow-fork-mode mode</code><br>Set the debugger response to a program call of <code>fork</code> or <code>vfork</code>. A call to fork or vfork creates a new process. The mode argument can be:<br><code>parent</code><br>The original process is debugged after a fork. The child process runs unimpeded. This is the default.<br><code>child</code><br>The new process is debugged after a fork. The parent process runs unimpeded.<br><code>ask</code><br>gdb ä¼šæç¤ºè®©ä½ é€‰æ‹© <code>parent</code> è¿˜æ˜¯ <code>child</code> ã€‚</p><p><code>show follow-fork-mode</code><br>Display the current debugger response to a fork or vfork call.<br>On Linux, if you want to debug both the parent and child processes, use the command set detach-on-fork.</p><p><code>set detach-on-fork mode</code><br>Tells gdb whether to detach one of the processes after a fork, or retain debugger control over them both.<br><code>on</code><br>The child process (or parent process, depending on the value of follow-fork-mode) will be detached and allowed to run independently. This is the default.<br><code>off</code><br>Both processes will be held under the control of gdb. One process (child or parent, depending on the value of follow-fork-mode) is debugged as usual, while the other is held suspended.</p><p><code>show detach-on-fork</code><br>Show whether detach-on-fork mode is on&#x2F;off.</p><p>If you issue a run command to gdb after an exec call executes, the new target restarts. To restart the parent process, use the file command with the parent executable name as its argument. By default, after an exec call executes, gdb discards the symbols of the previous executable image. You can change this behaviour with the set follow-exec-mode command.</p><p>set follow-exec-mode mode<br>Set debugger response to a program call of exec. An exec call replaces the program image of a process.<br>follow-exec-mode can be:</p><p><code>new</code><br>gdb creates a new inferior and rebinds the process to this new inferior. The program the process was running before the exec call can be restarted afterwards by restarting the original inferior.<br>For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">(gdb) info inferior</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 2    &lt;null&gt;        prog2</span><br><span class="line">  1    &lt;null&gt;        prog1</span><br></pre></td></tr></table></figure><p><code>same</code><br>gdb keeps the process bound to the same inferior. The new executable image replaces the previous executable loaded in the inferior. Restarting the inferior after the exec call, with e.g., the run command, restarts the executable the process was running after the exec call. This is the default mode.<br>For example:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog1</span><br><span class="line">(gdb) run</span><br><span class="line">process 12020 is executing new program: prog2</span><br><span class="line">Program exited normally.</span><br><span class="line">(gdb) info inferiors</span><br><span class="line">  Id   Description   Executable</span><br><span class="line">* 1    &lt;null&gt;        prog2</span><br></pre></td></tr></table></figure><h2 id="Setting-Catchpoints"><a href="#Setting-Catchpoints" class="headerlink" title="Setting Catchpoints"></a>Setting Catchpoints</h2><p><a href="https://www-zeuthen.desy.de/unix/unixguide/infohtml/gdb/Set-Catchpoints.html#Set-Catchpoints">Reference</a></p><h2 id="gdb-redirect-to-a-log-file"><a href="#gdb-redirect-to-a-log-file" class="headerlink" title="gdb redirect to a log file"></a>gdb redirect to a log file</h2><p>You need to enable logging:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set logging on</span><br><span class="line">Now GDB will log to ./gdb.txt. You can tell it which file to use:</span><br><span class="line"></span><br><span class="line">(gdb) set logging file my_god_object.log</span><br><span class="line">And you can examine the current logging configuration:</span><br><span class="line"></span><br><span class="line">(gdb) show logging</span><br></pre></td></tr></table></figure><p>æ›´æ–°ï¼šæ–°ç‰ˆæœ¬ gdb é‡‡ç”¨ <code>set logging enabled on</code> ã€‚</p><p>è®°å½•è¾“å…¥çš„å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) set trace-commands on</span><br></pre></td></tr></table></figure><p><a href="https://stackoverflow.com/questions/5941158/gdb-print-to-file-instead-of-stdout">Refercence</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gdb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gcc å…¥é—¨</title>
      <link href="/blog/2024/01/23/cpp/gcc%E5%85%A5%E9%97%A8/"/>
      <url>/blog/2024/01/23/cpp/gcc%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="é€’å½’å¤„ç†é¡ºåº"><a href="#é€’å½’å¤„ç†é¡ºåº" class="headerlink" title="é€’å½’å¤„ç†é¡ºåº"></a>é€’å½’å¤„ç†é¡ºåº</h2><p>gcc çš„è¾“å…¥æ–‡ä»¶å’Œåº“æ˜¯ä»å·¦å¾€å³å¤„ç†çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¸‹å‘½ä»¤æ˜¯é”™è¯¯çš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -L. -la main.cc</span><br></pre></td></tr></table></figure><p>é“¾æ¥å™¨å¤„ç†åˆ°æŸä¸ªç›®æ ‡æ–‡ä»¶ï¼ˆå¦‚ main.cc ç¼–è¯‘åçš„ç›®æ ‡ä»£ç ï¼‰æ—¶ï¼Œå¦‚æœé‡åˆ°æœªè§£æçš„ç¬¦å·ï¼ˆæ¯”å¦‚ f() ï¼‰ï¼Œ<br>å®ƒä¼šä»æ¥ä¸‹æ¥çš„åº“ä¸­æŸ¥æ‰¾è¿™äº›ç¬¦å·ã€‚å› æ­¤é¡ºåºéå¸¸é‡è¦ã€‚</p><p>è¿™é‡Œï¼Œ-L. -la é€‰é¡¹åœ¨ main.cc ä¹‹å‰ï¼Œé“¾æ¥å™¨ä¼šé¦–å…ˆå°è¯•ä» liba.so ä¸­æŸ¥æ‰¾å¼•ç”¨çš„ç¬¦å·ï¼Œ<br>ä½†æ˜¯ï¼Œå› ä¸ºæ­¤æ—¶ main.cc è¿˜æœªè¢«å¤„ç†ï¼Œæ‰€ä»¥é“¾æ¥å™¨è¿˜ä¸çŸ¥é“æœ‰å¯¹ liba.so ä¸­çš„å‡½æ•° f() çš„å¼•ç”¨ã€‚<br>åˆ°äº† main.cc ï¼Œé“¾æ¥å™¨è§£æå‡ºå¼•ç”¨ï¼Œä½†å®ƒä¸ä¼šå›å¤´å†å» liba.so ä¸­æŸ¥æ‰¾ï¼Œå¯¼è‡´æŠ¥é”™ï¼šâ€undefined reference to f()â€ã€‚</p><p>æ­£ç¡®çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.cc -L. -la</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šliba.so çš„æŒ‡å®šå¿…é¡»å»æ‰ lib å’Œ .so ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å…è®¸ç›´æ¥æŒ‡å®šâ€œåº“æ–‡ä»¶åâ€ï¼Œè€Œæ˜¯åªèƒ½æŒ‡å®šâ€œåº“åâ€ã€‚<br>å¦‚æœæƒ³ç›´æ¥æŒ‡å®šåº“æ–‡ä»¶åï¼Œé‚£ä¹ˆåº”è¯¥æŠŠ liba.so å½“æˆè¾“å…¥æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.cc ./liba.so</span><br></pre></td></tr></table></figure><h2 id="å±æ€§è¯­æ³•ï¼ˆAttribute-Syntaxï¼‰"><a href="#å±æ€§è¯­æ³•ï¼ˆAttribute-Syntaxï¼‰" class="headerlink" title="å±æ€§è¯­æ³•ï¼ˆAttribute Syntaxï¼‰"></a>å±æ€§è¯­æ³•ï¼ˆAttribute Syntaxï¼‰</h2><p>å‚è€ƒï¼š<a href="https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Attribute-Syntax.html#Attribute%20Syntax">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h3 id="å‡½æ•°å±æ€§ï¼ˆFunction-Attributesï¼‰"><a href="#å‡½æ•°å±æ€§ï¼ˆFunction-Attributesï¼‰" class="headerlink" title="å‡½æ•°å±æ€§ï¼ˆFunction Attributesï¼‰"></a>å‡½æ•°å±æ€§ï¼ˆFunction Attributesï¼‰</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://stackoverflow.com/questions/11621043/how-should-i-properly-use-attribute-format-printf-x-y-inside-a-class">stackoverflow</a></li><li><a href="https://gcc.gnu.org/onlinedocs/gcc-3.2/gcc/Function-Attributes.html">gccå®˜æ–¹æ–‡æ¡£ï¼šFunction Attributes</a></li></ul><p>å±æ€§åˆ—ä¸¾ï¼š</p><ul><li><p><code>format (archetype, string-index, first-to-check)</code></p><p>  format å±æ€§ï¼ŒæŒ‡å®šå‡½æ•°é‡‡ç”¨ printfã€scanfã€strftime æˆ– strfmon é£æ ¼çš„å‚æ•°ï¼Œ<br>  è¿™äº›å‚æ•°åº”æ ¹æ®æ ¼å¼å­—ç¬¦ä¸²ï¼ˆformat stringï¼‰è¿›è¡Œç±»å‹æ£€æŸ¥ï¼ˆtype-checkedï¼‰ã€‚<br>  ç±»å‹æ£€æŸ¥å‘ç”Ÿåœ¨ç¼–è¯‘æœŸã€‚</p><p>  ä¸¾ä¾‹ï¼š</p>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">int</span></span></span><br><span class="line"><span class="function"><span class="title">my_printf</span> <span class="params">(<span class="type">void</span> *my_object, <span class="type">const</span> <span class="type">char</span> *my_format, ...)</span></span></span><br><span class="line"><span class="function">    __<span class="title">attribute__</span> <span class="params">((format (printf, <span class="number">2</span>, <span class="number">3</span>)))</span></span>;</span><br></pre></td></tr></table></figure><ul><li><code>archetype</code>å†³å®šformat stringåº”è¯¥å¦‚ä½•è§£é‡Šã€‚<br>å¯é€‰ä¸º<code>printf</code>ã€<code>scanf</code>ã€<code>strftime</code>æˆ–<code>strfmon</code>ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨<code>__printf__</code>ã€<code>__scanf__</code>ã€<code>__strftime__</code>æˆ–<code>__strfmon__</code>ï¼‰ã€‚</li><li><code>string-index</code>æŒ‡å®šå“ªä¸ªå‚æ•°æ˜¯format stringï¼ˆä»1å¼€å§‹ï¼‰ã€‚</li><li><code>first-to-check</code>æŒ‡å®šformat stringå¯¹åº”çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åºå·ã€‚<br>å¯¹äºé‚£äº›æ— æ³•æ£€æŸ¥å‚æ•°çš„å‡½æ•°ï¼ˆæ¯”å¦‚<code>vprintf</code>ï¼‰ï¼Œè¯¥å‚æ•°æŒ‡å®šä¸º<code>0</code>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä»…æ£€æŸ¥format stringçš„ä¸€è‡´æ€§ã€‚å¯¹äº<code>strftime</code>æ ¼å¼ï¼Œè¯¥å‚æ•°å¿…é¡»ä¸º<code>0</code>ã€‚</li></ul></li></ul><h2 id="é€‰é¡¹"><a href="#é€‰é¡¹" class="headerlink" title="é€‰é¡¹"></a>é€‰é¡¹</h2><ul><li><code>-save-temps</code>: å¯ä»¥ä¿ç•™æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼Œä¾‹å¦‚é¢„ç¼–è¯‘æ–‡ä»¶ã€æ±‡ç¼–æ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶ç­‰ã€‚</li></ul><h2 id="ç¬¦å·å¯è§æ€§"><a href="#ç¬¦å·å¯è§æ€§" class="headerlink" title="ç¬¦å·å¯è§æ€§"></a>ç¬¦å·å¯è§æ€§</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> GCC visibility push(hidden)</span></span><br><span class="line"></span><br><span class="line">__attribute__((__visibility__(<span class="string">&quot;default&quot;</span>)))</span><br></pre></td></tr></table></figure><p>gcc ç¼–è¯‘é€‰é¡¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -fvisibility=hidden ...</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gcc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>core dump</title>
      <link href="/blog/2024/01/23/cpp/core-dump/"/>
      <url>/blog/2024/01/23/cpp/core-dump/</url>
      
        <content type="html"><![CDATA[<h2 id="ulimit"><a href="#ulimit" class="headerlink" title="ulimit"></a><code>ulimit</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹é…ç½®</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br><span class="line"><span class="comment">#è®¾ç½®core file size</span></span><br><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p><code>ulimit</code>åªå¯¹å½“å‰ç»ˆç«¯æœ‰æ•ˆã€‚</p><p>ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯¹æ‰€æœ‰ç”¨æˆ·å’Œç»ˆç«¯æœ‰æ•ˆï¼š</p><ol><li>åœ¨<code>/etc/security/limits.conf</code>ä¸­è®¾ç½®ï¼ˆredhatè¡ç”Ÿç³»linuxï¼‰ã€‚</li><li>æˆ–æ³¨é‡Šæ‰<code>/etc/profile</code>ä¸­çš„è¿™ä¸€è¡Œï¼š <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># No core files by default</span></span><br><span class="line"><span class="built_in">ulimit</span> -S -c 0 &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure></li></ol><h2 id="core-pattern"><a href="#core-pattern" class="headerlink" title="core_pattern"></a>core_pattern</h2><h3 id="core-patternè§£é‡Š"><a href="#core-patternè§£é‡Š" class="headerlink" title="core_patternè§£é‡Š"></a>core_patternè§£é‡Š</h3><p>è§<a href="https://stackoverflow.com/questions/2065912/core-dumped-but-core-file-is-not-in-the-current-directory">é“¾æ¥</a>ã€‚</p><p>Read <a href="http://www.kernel.org/doc/Documentation/sysctl/kernel.txt">&#x2F;usr&#x2F;src&#x2F;linux&#x2F;Documentation&#x2F;sysctl&#x2F;kernel.txt</a>.</p><pre><code>core_pattern is used to specify a core dumpfile pattern name.</code></pre><p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œ<a href="https://wiki.ubuntu.com/Apport">Apport</a>ï¼ˆcrash reporting serviceï¼‰ä¼šç”Ÿæˆé…ç½®æ–‡ä»¶<code>/proc/sys/kernel/core_pattern</code>ã€‚å‚è€ƒ<a href="https://askubuntu.com/questions/420410/how-to-permanently-edit-the-core-pattern-file">è¿™é‡Œ</a>ã€‚</p><p>Apport uses <code>/proc/sys/kernel/core_pattern</code> to directly pipe the core dump into <code>apport</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">|/usr/share/apport/apport %p %s %c</span><br><span class="line">$ </span><br></pre></td></tr></table></figure><p>Note that even if <code>ulimit</code> is set to disabled core files (by specyfing a core file size of zero using <code>ulimit -c 0</code>), <code>apport</code> will still capture the crash.</p><p>For intercepting Python crashes it installs a <code>/etc/python*/sitecustomize.py</code> to call apport on unhandled exceptions.</p><p>å…¶ä¸­ï¼Œ<code>/usr/share/apport/apport</code>æ˜¯ä¸€ä¸ªpythonè„šæœ¬ã€‚</p><p>ä»¥ä¸‹æ˜¯core_patternæ–‡ä»¶çš„å‚æ•°è¯´æ˜ï¼ˆå‚è€ƒLinux Manual Pageï¼š<code>man core</code>ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%c - Core file size soft resource limit of crashing process (since Linux 2.6.24).</span><br><span class="line">%p - insert pid into filename æ·»åŠ pid</span><br><span class="line">%u - insert current uid into filename æ·»åŠ å½“å‰uid</span><br><span class="line">%g - insert current gid into filename æ·»åŠ å½“å‰gid</span><br><span class="line">%s - insert signal that caused the coredump into the filename æ·»åŠ å¯¼è‡´äº§ç”Ÿcoreçš„ä¿¡å·</span><br><span class="line">%t - insert UNIX time that the coredump occurred into filename æ·»åŠ coreæ–‡ä»¶ç”Ÿæˆæ—¶çš„unixæ—¶é—´</span><br><span class="line">%h - insert hostname where the coredump happened into filename æ·»åŠ ä¸»æœºå</span><br><span class="line">%e - insert coredumping executable name into filename æ·»åŠ å‘½ä»¤å</span><br><span class="line"></span><br><span class="line">If the first character of the pattern is a &#x27;|&#x27;, the kernel will treat the rest of the pattern as a command to run. The core dump will be written to the standard input of that program instead of to a file.</span><br></pre></td></tr></table></figure><p>Apportçš„æ‹¦æˆªç»„ä»¶é»˜è®¤æ˜¯å…³é—­çš„ï¼š</p><p>Apport itself is running at all times because it collects crash data for whoopsie (see <a href="https://wiki.ubuntu.com/ErrorTracker">ErrorTracker</a>). However, the crash interception component is still disabled. To enable it permanently, do:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/apport/crashdb.conf</span><br></pre></td></tr></table></figure><p>â€¦ and add a hash symbol # in the beginning of the following line:</p><pre><code>&#39;problem_types&#39;: [&#39;Bug&#39;, &#39;Package&#39;],</code></pre><p>To disable crash reporting just remove the hash symbol.</p><h3 id="è®¾ç½®core-pattern"><a href="#è®¾ç½®core-pattern" class="headerlink" title="è®¾ç½®core_pattern"></a>è®¾ç½®core_pattern</h3><p>è§<a href="https://www.cnblogs.com/xiaodoujiaohome/p/6222895.html">é“¾æ¥</a>ã€‚</p><ol><li><p>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_uses_pidå¯ä»¥æ§åˆ¶äº§ç”Ÿçš„coreæ–‡ä»¶çš„æ–‡ä»¶åä¸­æ˜¯å¦æ·»åŠ pidä½œä¸ºæ‰©å±•ï¼Œå¦‚æœæ·»åŠ åˆ™æ–‡ä»¶å†…å®¹ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼›</p></li><li><p>&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;core_patternå¯ä»¥è®¾ç½®æ ¼å¼åŒ–çš„coreæ–‡ä»¶ä¿å­˜ä½ç½®æˆ–æ–‡ä»¶åï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> /proc/sys/kernel/core_pattern</span><br><span class="line">|/usr/share/apport/apport %p %s %c</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;/corefile/core-%e-%p-%t&quot;</span> &gt; /proc/sys/kernel/core_pattern</span><br></pre></td></tr></table></figure><p> ä½ å¯ä»¥ç”¨ä¸‹åˆ—æ–¹å¼æ¥å®Œæˆï¼š</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹æ‰€æœ‰sysctlæ‰€æœ‰å˜é‡çš„å€¼ã€‚</span></span><br><span class="line">sysctl -a</span><br><span class="line"><span class="comment">#è®¾ç½®å˜é‡kernel.core_patternä¸ºå¦‚ä¸‹å€¼ã€‚</span></span><br><span class="line">sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t</span><br></pre></td></tr></table></figure><p> è¿™äº›æ“ä½œä¸€æ—¦è®¡ç®—æœºé‡å¯ï¼Œåˆ™ä¼šä¸¢å¤±ï¼Œå¦‚æœä½ æƒ³æŒä¹…åŒ–è¿™äº›æ“ä½œï¼Œå¯ä»¥åœ¨ &#x2F;etc&#x2F;sysctl.confæ–‡ä»¶ä¸­å¢åŠ ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kernel.core_pattern=/tmp/core%p</span><br></pre></td></tr></table></figure><p> åŠ å¥½åï¼Œå¦‚æœä½ æƒ³ä¸é‡å¯çœ‹çœ‹æ•ˆæœçš„è¯ï¼Œåˆ™ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -p /etc/sysctl.conf</span><br></pre></td></tr></table></figure></li></ol><h2 id="ç›¸å…³å‘½ä»¤è¡Œå·¥å…·"><a href="#ç›¸å…³å‘½ä»¤è¡Œå·¥å…·" class="headerlink" title="ç›¸å…³å‘½ä»¤è¡Œå·¥å…·"></a>ç›¸å…³å‘½ä»¤è¡Œå·¥å…·</h2><p>å‚è€ƒèµ„æ–™ï¼š</p><p>Linux Manual Page: <a href="https://man7.org/linux/man-pages/man5/core.5.html"><code>man core</code></a></p><pre><code>SEE ALSO    bash(1),  coredumpctl(1),  gdb(1),  getrlimit(2), mmap(2), prctl(2), sigaction(2), elf(5), proc(5), pthreads(7), signal(7), systemd-coredump(8)</code></pre><h2 id="Segment-Faultæ’æŸ¥"><a href="#Segment-Faultæ’æŸ¥" class="headerlink" title="Segment Faultæ’æŸ¥"></a>Segment Faultæ’æŸ¥</h2><p>å‚è€ƒ<a href="https://www.wtango.com/%E6%AE%B5%E9%94%99%E8%AF%AFsegmentation-fault%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0%E4%BB%A5%E5%8F%8A%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95/">é“¾æ¥</a>ã€‚</p><ol><li><p>dmesg + nm + addr2line</p><p>addr2lineåªèƒ½æ‰¾å‡ºexecutableçš„è¡Œå·ï¼›å¦‚æœæ˜¯shared librariesï¼Œè¯·ä½¿ç”¨gdbã€‚å‚è€ƒ<a href="https://stackoverflow.com/questions/2549214/interpreting-segfault-messages">è¿™é‡Œ</a>ã€‚</p><p>dmesgè¾“å‡ºçš„å«ä¹‰ï¼š</p><p>ip: è¡¨ç¤ºinstruction pointer.</p></li><li><p>fprintf</p></li><li><p>gdb</p></li><li><p>signal(SIGSEGV,handler)</p></li><li><p>valgrind<br>å‚è€ƒï¼š<br> <a href="https://jvns.ca/blog/2018/04/28/debugging-a-segfault-on-linux/">åšå®¢</a><br> <a href="https://valgrind.org/docs/manual/ms-manual.html">æ–‡æ¡£</a><br> <a href="https://courses.cs.washington.edu/courses/cse326/05wi/valgrind-doc/ms_main.html">å¯ä»¥ä½¿ç”¨PostScriptæŸ¥çœ‹å›¾å½¢åŒ–ç»“æœ</a></p></li><li><p>heaptrack</p><p> è§<a href="https://github.com/KDE/heaptrack">githubä»“åº“</a></p></li><li><p>Jemalloc</p><p> è§<a href="https://jemalloc.net/">å®˜ç½‘</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–è¯‘å’Œé“¾æ¥</title>
      <link href="/blog/2024/01/23/cpp/%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5/"/>
      <url>/blog/2024/01/23/cpp/%E7%BC%96%E8%AF%91%E5%92%8C%E9%93%BE%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¼–è¯‘ä¸»è¦æ­¥éª¤"><a href="#ç¼–è¯‘ä¸»è¦æ­¥éª¤" class="headerlink" title="ç¼–è¯‘ä¸»è¦æ­¥éª¤"></a>ç¼–è¯‘ä¸»è¦æ­¥éª¤</h2><p>å‚è€ƒ<a href="https://blog.csdn.net/chen1415886044/article/details/104537547">åšå®¢</a></p><ol><li>é¢„å¤„ç†</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -E test.c -o test.i</span><br></pre></td></tr></table></figure><ol start="2"><li><p>ç¼–è¯‘</p><p> ç¼–è¯‘æ˜¯å°†é«˜çº§è¯­è¨€ï¼ˆä¾‹å¦‚Cã€C++ã€Javeç­‰ï¼‰ä»£ç è½¬æ¢æˆæœºå™¨ç çš„è¿‡ç¨‹ã€‚<br> ç¼–è¯‘å¯ä»¥åˆ†æˆå¤šä¸ªé˜¶æ®µï¼ŒåŒ…æ‹¬è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æã€ä¼˜åŒ–å’Œä»£ç ç”Ÿæˆã€‚<br> ç¼–è¯‘å™¨é¦–å…ˆå°†æºä»£ç è½¬æ¢ä¸€ç§ä¸­é—´è¡¨ç¤ºï¼ˆé€šå¸¸æ˜¯æ±‡ç¼–ä»£ç æˆ–å­—èŠ‚ç ï¼‰ï¼Œç„¶åå†å°†å…¶è½¬æ¢ä¸ºç›®æ ‡æœºå™¨çš„æœºå™¨ä»£ç ã€‚<br> ç»è¿‡ç¼–è¯‘çš„ä»£ç é€šå¸¸æ˜¯äºŒè¿›åˆ¶çš„ï¼Œå¯ä»¥ç›´æ¥åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œã€‚</p></li></ol><p>å…ˆç”Ÿæˆæ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S test.i -o test.s</span><br></pre></td></tr></table></figure><ol start="3"><li><p>æ±‡ç¼–</p><p> å°†æ±‡ç¼–ä»£ç è½¬æˆæœºå™¨ç ã€‚</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c test.s -o test.o</span><br></pre></td></tr></table></figure><ol start="4"><li><p>é“¾æ¥</p><p> è¯¥ç›®æ ‡æ–‡ä»¶ä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶ã€åº“æ–‡ä»¶ã€å¯åŠ¨æ–‡ä»¶ç­‰é“¾æ¥èµ·æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc test.o -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p>Note: å¯ä»¥ä½¿ç”¨ <code>-save-temps</code> é€‰é¡¹ä»¥ä¿ç•™ç¼–è¯‘è¿‡ç¨‹ä¸­çš„æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -save-temps test.c</span><br></pre></td></tr></table></figure><h2 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h2><h2 id="C-åç§°ä¿®é¥°"><a href="#C-åç§°ä¿®é¥°" class="headerlink" title="C++åç§°ä¿®é¥°"></a>C++åç§°ä¿®é¥°</h2><p><code>Name mangling (C++ only)</code>: åç§°ä¿®é¥°ï¼Œä¹Ÿç§°ä¸ºåç§°é‡æ•´ã€åç§°æ”¹ç¼–ã€‚å‚è§é“¾æ¥<a href="https://www.ibm.com/docs/en/i/7.2?topic=linkage-name-mangling-c-only">1</a>ã€<a href="https://zh.wikipedia.org/wiki/%E5%90%8D%E5%AD%97%E4%BF%AE%E9%A5%B0">2</a>ã€‚</p><h3 id="ç¯å¢ƒå˜é‡"><a href="#ç¯å¢ƒå˜é‡" class="headerlink" title="ç¯å¢ƒå˜é‡"></a>ç¯å¢ƒå˜é‡</h3><p>å‚è€ƒï¼š<code>man ld.so</code></p><pre><code>PATHLD_LIBRARY_PATHLD_PRELOAD  åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¼ºåˆ¶ä¼˜å…ˆåŠ è½½æŒ‡å®šçš„å…±äº«åº“ï¼Œå³ä½¿ç³»ç»Ÿä¸­å·²æœ‰å…¶ä»–ç‰ˆæœ¬ã€‚å¸¸ç”¨äºè°ƒè¯•ã€æ€§èƒ½åˆ†æã€å‡½æ•°æ‹¦æˆªï¼ˆhookï¼‰ç­‰ã€‚            åªåœ¨è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚            ä¼˜å…ˆçº§é«˜äº rpathã€LD_LIBRARY_PATH ç­‰ã€‚            å¯ä»¥ç”¨æ¥â€œæ³¨å…¥â€åº“ï¼Œä¿®æ”¹ç¨‹åºè¡Œä¸ºã€‚</code></pre><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><p>å‚è€ƒï¼š<code>man ld.so</code>, <code>man vdso</code>, <code>man elf</code>, <a href="https://linux.die.net/man/1/scanelf">scanelf</a></p><pre><code>ld(1), ldd(1), pldd(1), sprof(1), dlopen(3),getauxval(3), elf(5), capabilities(7),rtld-audit(7), ldconfig(8), sln(8), vdso(7), as(1), elfedit(1), gdb(1), nm(1),objcopy(1), objdump(1), patchelf(1), readelf(1), size(1), strings(1), strip(1),execve(2), dl_iterate_phdr(3), core(5), ld.so(8)</code></pre><p>ldconfig</p><pre><code>é…ç½®åŠ¨æ€è¿æ¥å™¨ï¼ˆdynamic linkerï¼‰çš„è¿è¡Œæ—¶ç»‘å®šï¼ˆdynamic bindingsï¼‰ã€‚å¦‚æœä½ åˆšåˆšå®‰è£…å¥½å…±äº«åº“ï¼Œå¯èƒ½éœ€è¦è¿è¡Œldconfigï¼š    sudo ldconfigé€šå¸¸éœ€è¦è¶…çº§ç”¨æˆ·æ¥è¿è¡Œldconfigï¼Œå› ä¸ºå¯èƒ½å¯¹éœ€è¦æŸäº›rootç”¨æˆ·æ‰€æœ‰çš„ç›®å½•å’Œæ–‡ä»¶æœ‰å†™å…¥æƒé™ã€‚lddconfig ä¸ºä»ä»¥ä¸‹ç›®å½•æ‰¾åˆ°çš„å…±äº«åº“åˆ›å»ºå¿…è¦çš„ links å’Œ cache ï¼š    command lineæŒ‡å®šçš„ç›®å½•ï¼›    /etc/ld.so.confæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›®å½•ï¼›    å—ä¿¡ä»»çš„ç›®å½•: /lib, /lib64, /usr/lib, /usr/lib64 ã€‚è¯¥ cache è¢«è¿è¡Œæ—¶è¿æ¥å™¨ï¼ˆrun-time linkerï¼‰ ld.so æˆ– ld-linux.so ä½¿ç”¨ã€‚ldconfig å°è¯•åŸºäºè¯¥åº“è¿æ¥çš„ C åº“æ¥æ¨æ–­ ELF åº“ï¼ˆæ¯”å¦‚ libc5 æˆ– libc6/glibcï¼‰çš„ç±»å‹ã€‚ä¸€äº›ç°æœ‰çš„åº“æ²¡æœ‰åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥æ¨æ–­å…¶ç±»å‹ã€‚å› æ­¤ï¼Œ /etc/ld.so.conf æ–‡ä»¶æ ¼å¼å…è®¸æŒ‡å®šæœŸæœ›çš„ç±»å‹ã€‚è¿™åªåœ¨è¿™äº› ELF åº“ä¸èƒ½è¢«è§£å†³çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ldconfig æœŸæœ›çš„ç¬¦å·é“¾æ¥æœ‰æŸç§ç‰¹å®šçš„å½¢å¼ï¼Œæ¯”å¦‚ï¼š    libfoo.so -&gt; libfoo.so.1 -&gt; libfoo.so.1.12å…¶ä¸­ï¼Œä¸­é—´çš„æ–‡ä»¶ libfoo.so.1 æ˜¯åº“çš„ SONAME ã€‚å¦‚æœä¸éµå¾ªè¿™ç§æ ¼å¼å¯èƒ½ä¼šå¯¼è‡´å‡çº§åçš„å…¼å®¹æ€§é—®é¢˜ã€‚</code></pre><p>ldd</p><pre><code>æè¿°ï¼š    lddè°ƒç”¨æ ‡å‡†åŠ¨æ€è¿æ¥å™¨ï¼ˆè§ ld.so(8)ï¼‰ï¼Œå¹¶ä¸”å°†ç¯å¢ƒå˜é‡ LD_TRACE_LODADED_OBJECTS ä¸º 1 ã€‚    è¿™ä¼šè®©åŠ¨æ€è¿æ¥å™¨æ£€æŸ¥ç¨‹åºçš„åŠ¨æ€ä¾èµ–ï¼Œå¹¶ä¸”å¯»æ‰¾ï¼ˆæ ¹æ® ld.so(8) æè¿°çš„è§„åˆ™ï¼‰    å’ŒåŠ è½½æ»¡è¶³è¿™äº›ä¾èµ–çš„ç›®æ ‡ã€‚å¯¹äºæ¯ä¸€æ¡ä¾èµ–ï¼Œ    ldd æ˜¾ç¤ºåŒ¹é…çš„ç›®æ ‡çš„ä½ç½®å’Œå…¶è½½å…¥å¤„çš„16è¿›åˆ¶åœ°å€ã€‚    ï¼ˆlinux-vdsoå’Œld-linuxå…±äº«ä¾èµ–æ˜¯ç‰¹æ®Šçš„ï¼›è§vdso(7)å’Œld.so(8)ï¼‰å®‰å…¨æ€§ï¼š    æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€äº›ç‰ˆæœ¬çš„lddå¯èƒ½ä¼šå°è¯•é€šè¿‡ç›´æ¥è¿è¡Œç¨‹åºï¼ˆå¯èƒ½å¯¼è‡´ç¨‹åºä¸­çš„ELFè§£é‡Šå™¨    æˆ–ç¨‹åºæœ¬èº«çš„è¿è¡Œï¼‰æ¥è·å–ä¾èµ–ä¿¡æ¯ã€‚    å› æ­¤ï¼Œæ°¸è¿œä¸è¦åœ¨ä¸å—ä¿¡ä»»çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä½¿ç”¨lddï¼Œå› ä¸ºä¼šå¯¼è‡´éšæ„ä»£ç çš„è¿è¡Œã€‚æ›´å®‰å…¨æ›¿ä»£æ–¹æ³•ä¸ºï¼š        $ objdump -p /path/to/program | grep NEEDED    æ³¨æ„ï¼Œè¿™ç§æ›¿ä»£æ–¹æ³•åªä¼šæ˜¾ç¤ºè¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„ç›´æ¥ä¾èµ–ï¼Œè€Œlddæ˜¾ç¤ºè¯¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ•´ä¸ªä¾èµ–æ ‘ã€‚è§£é‡Šlddçš„è¾“å‡º:$ ldd -v libibsupport_real.so ./libibsupport_real.so: /usr/lib64/libibverbs.so.1: version `IBVERBS_1.8&#39; not found (required by ./libibsupport_real.so)    linux-vdso.so.1 =&gt;  (0x00002ad3e49e3000)    libibverbs.so.1 =&gt; /usr/lib64/libibverbs.so.1 (0x00002ad3e589b000)    ...    Version information:    ./libibsupport_real.so:            libgcc_s.so.1 (GCC_3.0) =&gt; /usr/lib64/libgcc_s.so.1            libibverbs.so.1 (IBVERBS_1.8) =&gt; not found            libibverbs.so.1 (IBVERBS_1.1) =&gt; /usr/lib64/libibverbs.so.1            ...    /usr/lib64/libnl-3.so.200:                libm.so.6 (GLIBC_2.2.5) =&gt; /usr/lib64/libm.so.6                ...åœ¨&quot;Version information&quot;ä¸­ï¼Œ&quot;libgcc_s.so.1 (GCC_3.0) =&gt; /usr/lib64/libgcc_s.so.1&quot;è¡¨ç¤ºï¼š    &quot;libgcc_s.so.1&quot;æŒ‡å®šä¸€ä¸ªshared libraryçš„åå­—ï¼ˆlibgcc_s.so.1æ˜¯GCC runtime libraryçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè¯¥shared libraryä¸º&quot;./libibsupport_real.so&quot;æ‰€ä¾èµ–ï¼›    &quot;(GCC_3.0)&quot;è¡¨æ˜&quot;libgcc_s.so.1&quot;éœ€è¦3.0ç‰ˆæœ¬åŠä»¥ä¸Šçš„GNU Compiler Collection (GCC)ï¼›    &quot;=&gt;&quot;æŒ‡å‡ºæ»¡è¶³ä¾èµ–çš„shared libraryï¼›    &quot;/usr/lib64/libgcc_s.so.1&quot;æ˜¯æ»¡è¶³è¦æ±‚çš„shared libraryçš„è·¯å¾„ã€‚</code></pre><p>  <a href="https://stackoverflow.com/questions/34428037/how-to-interpret-the-output-of-the-ldd-program">ldd outputè¯´æ˜</a></p><p>sprof</p><p>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/881074/how-to-use-sprof">stackoverflows</a></p><p>objdump</p><pre><code>[-p|--private-headers][-x|--all-headers]</code></pre><p>readelf</p><pre><code>[-d|--dynamic]</code></pre><h3 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h3><pre><code>/lib/ld.so    Run-time linker/loader./etc/ld.so.conf    File containing a list of directories, one per line, in which to search for libraries./etc/ld.so.cache    File containing an ordered list of libraries found in the directories specified in /etc/ld.so.conf, as well as those found in the trusted directories.The trusted directories:    /lib    /lib64    /usr/lib    /usr/lib64</code></pre><p>ld.so</p><pre><code>åå­—    ld.so, ld-linux.so - åŠ¨æ€è¿æ¥/åŠ è½½å™¨ã€‚ç®€ä»‹    åŠ¨æ€è¿æ¥å™¨å¯ä»¥è¢«é—´æ¥è¿è¡Œæˆ–ç›´æ¥è¿è¡Œã€‚    é—´æ¥è¿è¡Œï¼š        è¿è¡ŒæŸäº›åŠ¨æ€è¿æ¥ç¨‹åºæˆ–å…±äº«åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½å‘åŠ¨æ€è¿æ¥å™¨ä¼ é€’å‘½ä»¤è¡Œé€‰é¡¹ï¼›å¹¶ä¸”åœ¨ELFæƒ…å†µä¸‹ï¼Œå­˜å‚¨åœ¨ç¨‹åºçš„.interp sectionä¸­çš„åŠ¨æ€è¿æ¥å™¨è¢«æ‰§è¡Œã€‚    ç›´æ¥è¿è¡Œï¼š        /lib/ld-linux.so.* [OPTIONS] [PRAGRAM [ARGUMENTS]]æè¿°    ld.so å’Œ ld-linux.so* å¯»æ‰¾å’ŒåŠ è½½ç¨‹åºæ‰€éœ€çš„å…±äº«å¯¹è±¡ï¼ˆå…±äº«åº“ï¼‰ï¼Œå‡†å¤‡ç¨‹åºçš„è¿è¡Œï¼Œç„¶åè¿è¡Œå®ƒã€‚    å¦‚æœåœ¨ç¼–è¯‘æœŸæ²¡æœ‰å‘ ld(1) æŒ‡å®š -static é€‰é¡¹ï¼Œåˆ™LinuxäºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦åŠ¨æ€è¿æ¥ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ï¼‰ã€‚</code></pre><h3 id="SONAME"><a href="#SONAME" class="headerlink" title="SONAME"></a>SONAME</h3><p>å‚è€ƒï¼š<code>man ldconfig</code><br>å‚è€ƒï¼š<a href="https://en.wikipedia.org/wiki/Soname">SONAME Wiki</a></p><blockquote><p>GNU linkerä½¿ç”¨ -hname æˆ– -soname&#x3D;name æ¥æŒ‡å®šè¯¥åº“çš„library name fieldã€‚<br>åœ¨å†…éƒ¨ï¼Œlinkerä¼šåˆ›å»ºä¸€ä¸ª DT_SONAME fieldå¹¶ä¸”ç”¨ name æ¥å¡«å……å®ƒã€‚</p></blockquote><ol><li>æŒ‡å®šSONAMEï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Use ld:</span></span><br><span class="line">$ ld -shared -soname libexample.so.1 -o libexample.so.1.2.3 file1.o file2.o</span><br><span class="line"><span class="comment">#Use gcc or g++:</span></span><br><span class="line">$ gcc -shared -Wl,-soname,libexample.so.1 -o libexample.so.1.2.3 file1.o file2.o</span><br></pre></td></tr></table></figure><ol start="2"><li>å®‰è£…æ—¶åˆ›å»ºè½¯é“¾æ¥ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ln</span> -s libexample.so.1.2.3 libexample.so.1</span><br><span class="line"><span class="built_in">ln</span> -s libexample.so.1 libexample.so</span><br></pre></td></tr></table></figure><ol start="3"><li>æŸ¥çœ‹SONAMEï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Use objdump</span></span><br><span class="line">$ objdump -p libexample.so.1.3 | grep SONAME</span><br><span class="line">  SONAME               libexample.so.1</span><br><span class="line"><span class="comment">#Use readelf</span></span><br><span class="line">$ readelf -d libexample.so | grep SONAME</span><br><span class="line"> 0x000000000000000e (SONAME)             Library soname: [libexample.so.1]</span><br></pre></td></tr></table></figure><h3 id="ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol-versioningï¼‰"><a href="#ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol-versioningï¼‰" class="headerlink" title="ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol versioningï¼‰"></a>ç¬¦å·ç‰ˆæœ¬æ§åˆ¶ï¼ˆsymbol versioningï¼‰</h3><h4 id="å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š"><a href="#å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š" class="headerlink" title="å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š"></a>å®šåˆ¶å‡½æ•°ç‰ˆæœ¬ï¼š</h4><ol><li>example.cä¸­å®šä¹‰å‡½æ•°<code>my_printf</code>ï¼š</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">my_printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, format);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>version_script.txtä¸­å®šä¹‰å‡½æ•°çš„ç‰ˆæœ¬ä¸º<code>VERSION_1</code>ï¼š</li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VERSION_1 &#123;</span><br><span class="line"> global:</span><br><span class="line">   my_printf;</span><br><span class="line"> local:</span><br><span class="line">   *;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li>ç¼–è¯‘æ—¶æŒ‡å®š<code>version_script.txt</code>ä¸ºversion-scriptï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -Wl,--version-script=version_script.txt -o libexample.so example.o</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>-Wl,</code>å¼•å‡ºè¿æ¥å™¨é€‰é¡¹ã€‚</p><ol start="4"><li>æŸ¥çœ‹ï¼š<ol><li>ä½¿ç”¨<code>readelf -sW libexample.so</code>æŸ¥çœ‹å‡½æ•°<code>my_printf</code>çš„ç‰ˆæœ¬å·ï¼ˆâ€VERSION_1â€ï¼‰ï¼š</li></ol></li></ol><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Symbol table &#x27;.dynsym&#x27; contains 8 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND </span><br><span class="line">     1: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_deregisterTMCloneTable</span><br><span class="line">     2: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5 (3)</span><br><span class="line">     3: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND __gmon_start__</span><br><span class="line">     4: 0000000000000000     0 NOTYPE  WEAK   DEFAULT  UND _ITM_registerTMCloneTable</span><br><span class="line">     5: 0000000000000000     0 FUNC    WEAK   DEFAULT  UND __cxa_finalize@GLIBC_2.2.5 (3)</span><br><span class="line">     6: 0000000000001105    39 FUNC    GLOBAL DEFAULT   13 my_printf@@VERSION_1</span><br><span class="line">     7: 0000000000000000     0 OBJECT  GLOBAL DEFAULT  ABS VERSION_1</span><br></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨<code>objdump -T libexample.so</code></li><li>ä½¿ç”¨<code>nm -D libexample.so</code></li></ol><h4 id="å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬"><a href="#å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬" class="headerlink" title="å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬"></a>å®ç°åŒä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªç‰ˆæœ¬</h4><ol><li>ç¼–å†™æºä»£ç </li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;foo version 1.0\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo_v2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;foo_v2 version 2.0\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>ç¼–å†™ç‰ˆæœ¬è„šæœ¬</li></ol><p>ä¾‹å¦‚ï¼Œversion_script.mapæ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">VERS_1.0 &#123;</span><br><span class="line">    global: <span class="comment"># globalè¡¨ç¤ºç¬¦å·å…¨å±€å¯è§ï¼›é»˜è®¤ä¸ºå±€éƒ¨ï¼ˆä¹Ÿå¯èƒ½é€šè¿‡localæ˜¾å¼å£°æ˜ä¸ºå±€éƒ¨ï¼‰ï¼Œä¸ä¼šè¢«å¯¼å‡º</span></span><br><span class="line">        foo;</span><br><span class="line">&#125; VERS_1.1;</span><br><span class="line"></span><br><span class="line">VERS_1.1 &#123;</span><br><span class="line">    global:</span><br><span class="line">        foo_v2;</span><br><span class="line">    foo; <span class="comment"># VER_1.1ç»§æ‰¿è‡ªVER_1.0</span></span><br><span class="line">         <span class="comment"># 1. fooåœ¨VER_1.0ä¸­å·²ç»å£°æ˜ä¸ºäº†globalï¼Œä¸éœ€è¦å†æ¬¡å£°æ˜global</span></span><br><span class="line">         <span class="comment"># 2. å½“ç„¶å¯ä»¥å†æ¬¡æ˜¾å¼å£°æ˜ä¸ºglobalï¼Œä½†æ˜¯è¿™ä¸æ˜¯æ¨èçš„åšæ³•</span></span><br><span class="line">         <span class="comment"># 3. å‡è®¾fooåœ¨VER_1.0ä¸­ä¸æ˜¯globalï¼Œæ­¤å¤„å£°æ˜ä¸ºglobalï¼Œ</span></span><br><span class="line">         <span class="comment"># ä¼šå°†åŸæœ¬ä¸æ˜¯globalçš„fooå˜å¾—å…¨å±€å¯è§</span></span><br><span class="line">         <span class="comment"># 4. æˆ‘ä»¬å…¶å®æ— éœ€å†æ¬¡å¯¼å‡ºfooï¼Œå› ä¸ºé™¤éæˆ‘ä»¬æ˜¾å¼éšè—ï¼ˆä½¿ç”¨localå…³é”®å­—ï¼‰ï¼Œfooå°±åœ¨</span></span><br><span class="line">         <span class="comment"># VER_1.1æ˜¯å’ŒVER_1.0ä¸­çš„å¯è§æ€§ä¿æŒä¸€è‡´</span></span><br><span class="line">         <span class="comment"># 5. å¦‚æœå¸Œæœ›åœ¨VER_1.1ä¸­çš„fooä¸VER_1.0æœ‰ä¸åŒçš„è¡Œä¸ºï¼Œé‚£ä¹ˆéœ€è¦å†æ¬¡å°†å…¶å¯¼å‡º</span></span><br><span class="line">&#125; VERS_2.0;</span><br><span class="line"></span><br><span class="line">VERS_2.0 &#123;</span><br><span class="line">    global:</span><br><span class="line">        foo_v2</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>VER_1.1ç»§æ‰¿äº†VER_1.0çš„å…¨éƒ¨ç¬¦å·ï¼ŒåŒæ—¶VER_1.1å¯ä»¥å¢åŠ æˆ–ä¿®æ”¹ç¬¦å·ã€‚</p><p>VER_1.0ï¼šç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¯¼å‡ºfooç¬¦å·ï¼›<br>VER_1.1ï¼šç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œå¼•å…¥foo_v2ï¼Œå¹¶é‡æ–°å¯¼å‡ºfooï¼›</p><h4 id="ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬"><a href="#ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬" class="headerlink" title="ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬"></a>ç¨‹åºä¾èµ–çš„åº“ç‰ˆæœ¬</h4><p>æœ‰å¦‚ä¸‹ç®€å•ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// file: main.cc</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸ç¼–è¯‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ main.cc -o a.out</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç¬¦å·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings a.out</span><br></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°å…¶ä¸­æœ‰ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">GLIBC_2.34</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ç”Ÿæˆåº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œä¼šæ ¹æ®ç³»ç»Ÿä¸Šå®‰è£…çš„glibcç‰ˆæœ¬ï¼ˆå› ä¸ºåº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–glibcï¼‰ï¼Œ<br>ä¸ºåº“æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„å‡½æ•°ç¬¦å·é™„åŠ ä¸Šç‰¹å®šçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚<br>ä¸ºäº†ä¿è¯å‘ä¸‹å…¼å®¹ï¼Œglibcé€šè¿‡ç¬¦å·æ§åˆ¶ä¿ç•™äº†å¤šä¸ªç‰ˆæœ¬çš„ç¬¦å·ï¼Œæ”¯æŒè€ç‰ˆæœ¬çš„è½¯ä»¶èƒ½åœ¨è¾ƒæ–°çš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚<br>ä¾‹å¦‚ï¼Œå¦‚æœæŸä¸ªå‡½æ•°åœ¨glibc2.2.5ä¸­å¼•å…¥ï¼Œå®ƒå¯ä»¥ç»§ç»­ä¿ç•™åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œä½†ç¬¦å·æ ‡è®°ä¸ºGLIBC_2.2.5ã€‚</p><h3 id="ELF"><a href="#ELF" class="headerlink" title="ELF"></a>ELF</h3><pre><code>ELF - Executable and Linking Format.ELFæè¿°äº†normal executable filesã€relocatable object filesã€core fileså’Œshared objectsçš„æ ¼å¼ã€‚</code></pre><p>å‚è€ƒï¼š<code>man elf</code>, <a href="http://chuquan.me/2018/05/21/elf-introduce/">åšå®¢:elfä»‹ç»</a>ã€‚</p><h3 id="é“¾æ¥å"><a href="#é“¾æ¥å" class="headerlink" title="é“¾æ¥å"></a>é“¾æ¥å</h3><p>å‚è€ƒï¼š<a href="https://littlebee1024.github.io/learning_book/booknotes/cxydzwxy/link/dynamic/#_16">ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</a>, <code>man ld</code></p><p>GCCçš„æä¾›äº†ä¸åŒçš„æ–¹æ³•æŒ‡å®šé“¾æ¥çš„å…±äº«åº“ï¼š</p><ul><li><p><code>l&lt;link_name&gt;</code>å‚æ•°</p><p>  æŒ‡å®šéœ€è¦é“¾æ¥çš„å…±äº«åº“lib<link_name>.so</p></li><li><p><code>l:&lt;filename&gt;</code>å‚æ•°</p><p>  é€šè¿‡æ–‡ä»¶åæŒ‡å®šå…±äº«åº“ï¼Œå‚è€ƒLDæ‰‹å†Œ</p></li><li><p>å…¨è·¯å¾„æŒ‡å®š</p></li><li><p><code>Wl,-static</code>å‚æ•°</p><p>  æŒ‡å®šæŸ¥æ‰¾é™æ€åº“ï¼Œé€šè¿‡-Wl,-Bdynamicæ¢å¤æˆåŠ¨æ€åº“æŸ¥æ‰¾</p></li></ul><h3 id="é“¾æ¥å™¨é€‰é¡¹"><a href="#é“¾æ¥å™¨é€‰é¡¹" class="headerlink" title="é“¾æ¥å™¨é€‰é¡¹"></a>é“¾æ¥å™¨é€‰é¡¹</h3><p>å‚è€ƒï¼š<code>man ld</code></p><pre><code>ld - The GNU linker</code></pre><p>é€‰é¡¹ï¼š</p><pre><code>-rpath=dir    æ·»åŠ ä¸€ä¸ªç›®å½•åˆ°è¿è¡Œæ—¶åº“æœå¯»è·¯å¾„ä¸­ã€‚</code></pre><p>gccé€šè¿‡ <code>-Wl</code> å‰ç¼€æŒ‡å®šé“¾æ¥å™¨é€‰é¡¹ï¼Œä¾‹å¦‚ï¼š</p><pre><code> gcc -Wl,--start-group foo.o bar.o -Wl,--end-group gcc -Wl,-rpath,&#39;$ORIGIN/../lib&#39;-rpath-link    ç”¨äºåœ¨é“¾æ¥æ—¶æŒ‡å®šé¢å¤–çš„å…±äº«åº“æœç´¢è·¯å¾„ã€‚åœ¨ç¼–è¯‘/é“¾æ¥é˜¶æ®µï¼Œå‘Šè¯‰é“¾æ¥å™¨å»å“ªé‡Œæ‰¾é—´æ¥ä¾èµ–çš„å…±äº«åº“ã€‚åªå½±å“æ„å»ºè¿‡ç¨‹ï¼Œä¸å½±å“è¿è¡Œæ—¶è¡Œä¸ºã€‚    å½“ä½ é“¾æ¥ä¸€ä¸ªå…±äº«åº“ï¼ˆæ¯”å¦‚ libfoo.soï¼‰ï¼Œè€Œè¿™ä¸ªåº“åˆä¾èµ–å…¶ä»–å…±äº«åº“ï¼ˆæ¯”å¦‚ libbar.soï¼‰ï¼Œå¦‚æœè¿™äº›ä¾èµ–åº“ä¸åœ¨æ ‡å‡†è·¯å¾„ä¸­ï¼Œé“¾æ¥å™¨å¯èƒ½æ‰¾ä¸åˆ°å®ƒä»¬ã€‚è¿™æ—¶å°±å¯ä»¥ç”¨ -rpath-link æ¥å‘Šè¯‰é“¾æ¥å™¨å»å“ªé‡Œæ‰¾è¿™äº›â€œé—´æ¥ä¾èµ–â€çš„åº“ã€‚</code></pre><table><thead><tr><th>é€‰é¡¹</th><th>ç”¨é€”</th><th>ç”Ÿæ•ˆæ—¶é—´</th></tr></thead><tbody><tr><td>-L</td><td>æ·»åŠ åº“æœç´¢è·¯å¾„</td><td>é“¾æ¥æ—¶</td></tr><tr><td>-rpath-link</td><td>æ·»åŠ é—´æ¥ä¾èµ–åº“çš„æœç´¢è·¯å¾„</td><td>é“¾æ¥æ—¶</td></tr><tr><td>-Wl,-rpath</td><td>å°†è·¯å¾„å†™å…¥å¯æ‰§è¡Œæ–‡ä»¶ä¾›è¿è¡Œæ—¶ä½¿ç”¨</td><td>è¿è¡Œæ—¶</td></tr><tr><td>LD_LIBRARY_PATH</td><td>ç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šè¿è¡Œæ—¶åº“è·¯å¾„</td><td>è¿è¡Œæ—¶</td></tr></tbody></table><h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><ol><li><a href="https://unix.stackexchange.com/questions/120015/how-to-find-out-the-dynamic-libraries-executables-loads-when-run">How to find out the dynamic libraries are loaded when running an executable?</a></li></ol><p>Answer:</p><ul><li><code>ldd /path/to/program</code></li><li><code>objdump -p /path/to/program | grep NEEDED</code></li><li><code>lddtree</code> (from <code>pax-utils</code>) or <code>readelf -d /bin/ls | grep &#39;NEEDED&#39;</code></li><li><code>lsof -p PID | grep mem</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ pidof nginx</span><br><span class="line">6920 6919</span><br><span class="line"></span><br><span class="line">$ lsof -p 6919 | grep mem</span><br></pre></td></tr></table></figure><ul><li><code>strace -e trace=open myprogram</code></li></ul><p><code>ldd</code> and <code>lsof</code> show the libraries loaded either directly or at a given moment. They do not account for libraries loaded via <code>dlopen</code> (or discarded by <code>dlclose</code>). You can get a better picture of this using <code>strace</code>.</p><ul><li><code>pmap &lt;pid&gt; -p</code></li></ul><h3 id="Notice"><a href="#Notice" class="headerlink" title="Notice"></a>Notice</h3><ol><li><p>ç”Ÿæˆsoæ—¶ï¼Œé“¾æ¥å™¨ä¸ä¼šå¯»æ‰¾å…¶soä¾èµ–ï¼›executableä¼šå¯»æ‰¾soçš„ä¾èµ–å…³ç³»ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿soç”Ÿæˆè¿‡ç¨‹ä¸æŠ¥é”™ï¼Œä½†æ˜¯executableç”Ÿæˆæ—¶å¯èƒ½ä¼šæŠ¥é”™ã€‚</p></li><li><p>ç”Ÿæˆsoæ—¶ï¼Œå¦‚æœå¼•ç”¨äº†å…¶ä»– so ï¼Œåªè¦ include å…¶ä»– so çš„å¤´æ–‡ä»¶ï¼Œå¼•ç”¨å¤´æ–‡ä»¶ä¸­çš„ç¬¦å·æ—¶ï¼Œå°±èƒ½ç¼–è¯‘é€šè¿‡ã€‚ä½†æ˜¯è¿™æ ·ç”Ÿæˆçš„ so æ²¡æœ‰åŠ ä¸Šå¯¹åº”ç¬¦å·çš„ä¾èµ–ã€‚<br>æ­¤æ—¶ç”¨ readelf -s æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·ï¼Œå…¶ type ä¸º NOTYPE ã€‚</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ readelf -sW libb.so</span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.dynsym&#x27; contains 14 entries:</span><br><span class="line">Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line"> 6: 0000000000000000     0 NOTYPE  GLOBAL DEFAULT  UND _Z1fv</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœåŠ ä¸Šå¯¹åº” -la é€‰é¡¹ï¼Œå°±ä¼šä» liba.so ä¸­å¯»æ‰¾ä¾èµ–çš„ç¬¦å·ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™æ·»åŠ è¿›å…¥ so çš„ä¾èµ–é¡¹ä¸­ã€‚å½“è¿è¡Œæ—¶åˆ™ä¼šåŠ è½½ liba.so ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¸ä¼šåŠ è½½ã€‚<br>ç”¨ readelf -s æŸ¥çœ‹å¯¹åº”çš„ç¬¦å·ï¼Œå…¶ type ä¸å†æ—¶ NOTYPE ï¼Œè€Œæ˜¯ FUNC ï¼ˆå¦‚æœè¯¥ç¬¦å·æ˜¯ä¸€ä¸ªå‡½æ•°çš„è¯ï¼‰ã€‚</p> <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6: 0000000000000000     0 FUNC    GLOBAL DEFAULT  UND _Z1fv</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç¬¦å·ï¼Œæˆ–è€…è¯´ liba.so ä¸­æ ¹æœ¬æ²¡æœ‰å®ç°è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå…¶ type ä¾ç„¶æ˜¯ NOTYPE ï¼Œæ­¤æ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ã€‚<br>æ³¨æ„ï¼šå¦‚æœåªæ˜¯ include å¤´æ–‡ä»¶ï¼Œä¹Ÿå°±è¯´åªæœ‰æŸä¸ªç¬¦å·çš„å£°æ˜ï¼Œå¹¶æ²¡æœ‰å…¶å®šä¹‰æˆ–å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆ so ä¸­ä¸ä¼šç”Ÿæˆå…¶ä¿¡æ¯ã€‚</p></li></ol><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><h3 id="è¿è¡Œæ—¶é”™è¯¯ï¼šâ€-path-to-a-out-usr-lib-x86-64-linux-gnu-libstdc-so-6-version-GLIBCXX-3-4-30â€™-not-found-required-by-path-to-libxxx-so-â€"><a href="#è¿è¡Œæ—¶é”™è¯¯ï¼šâ€-path-to-a-out-usr-lib-x86-64-linux-gnu-libstdc-so-6-version-GLIBCXX-3-4-30â€™-not-found-required-by-path-to-libxxx-so-â€" class="headerlink" title="è¿è¡Œæ—¶é”™è¯¯ï¼šâ€&#x2F;path&#x2F;to&#x2F;a.out: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6: version &#96;GLIBCXX_3.4.30â€™ not found (required by &#x2F;path&#x2F;to&#x2F;libxxx.so)â€"></a>è¿è¡Œæ—¶é”™è¯¯ï¼šâ€&#x2F;path&#x2F;to&#x2F;a.out: &#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libstdc++.so.6: version &#96;GLIBCXX_3.4.30â€™ not found (required by &#x2F;path&#x2F;to&#x2F;libxxx.so)â€</h3><p>è§£é‡Šï¼š<code>libxxx.so</code> å¼•ç”¨äº†ä¸€ä¸ª <code>GLIBCXX_3.4.30</code> çš„ç¬¦å·ï¼ˆå¯èƒ½æ˜¯å…¨å±€å˜é‡æˆ–å‡½æ•°ï¼‰ï¼Œä½†æ˜¯åœ¨ç³»ç»Ÿçš„ <code>/usr/lib/x86_64-linux-gnu/libstdc++.so.6</code> ä¸­æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬çš„ç¬¦å·ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep <span class="string">&#x27;GLIBCXX_3.4.&#x27;</span></span><br><span class="line">GLIBCXX_3.4.1</span><br><span class="line">...</span><br><span class="line">GLIBCXX_3.4.27</span><br><span class="line">GLIBCXX_3.4.28</span><br><span class="line"><span class="comment"># æ²¡æœ‰ GLIBCXX_3.4.30</span></span><br><span class="line"></span><br><span class="line">$ strings /path/to/libxxx.so | grep <span class="string">&#x27;GLIBCXX_3.4.30&#x27;</span> | c++filt</span><br><span class="line">GLIBCXX_3.4.30</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)@@GLIBCXX_3.4.30</span><br></pre></td></tr></table></figure><p>è¿™å¾€å¾€æ˜¯å› ä¸ºåŸå§‹çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>libxxx.so</code> æ˜¯åœ¨ä¸€å°æœºå™¨ä¸­ç¼–è¯‘çš„ï¼Œæ­¤æ—¶å°†è¯¥æœºå™¨çš„ <code>GLIBCXX_3.4.30</code> ç¬¦å·ç¼–è¯‘åˆ°å…¶ä¸­äº†ã€‚ä½†æ˜¯è¿è¡Œæ—¶çš„æœºå™¨æ˜¯å¦ä¸€å°ï¼Œè¯¥æœºå™¨ä¸Š<br>ä¸å­˜åœ¨ <code>GLIBCXX_3.4.30</code> ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿è¡Œæ—¶æŠ¥é”™ã€‚</p><p>æˆ–è€…ï¼Œå› ä¸ºç¯å¢ƒå˜é‡çš„é…ç½®é”™è¯¯ï¼Œç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶å¼•ç”¨çš„ <code>libstdc++.so.6</code> ä¸æ˜¯åŒä¸€ä¸ªï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´è¿è¡Œæ—¶å¯èƒ½æ‰¾ä¸åˆ°ç¼–è¯‘æ—¶çš„ <code>GLIBCXX_3.4.30</code> ç‰ˆæœ¬ã€‚</p><p>å¯ä»¥åœ¨æºæ–‡ä»¶ä¸­ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬ï¼ˆä½¿ç”¨è¿è¡Œæ—¶çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚ <code>GLIBCXX_3.4.11</code> ï¼‰ï¼š</p><ol><li>æŸ¥æ‰¾ç‰ˆæœ¬ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ objdump -T /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep condition_variable | c++filt</span><br><span class="line">00000000000d52d0 g    DF .text  000000000000000c  GLIBCXX_3.4.30 std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line">00000000000ac730 g    DF .text  000000000000001c (GLIBCXX_3.4.11) std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line"></span><br><span class="line">$ objdump -T /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep condition_variable</span><br><span class="line">00000000000d52d0 g    DF .text  000000000000000c  GLIBCXX_3.4.30 _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</span><br><span class="line">00000000000ac730 g    DF .text  000000000000001c (GLIBCXX_3.4.11) _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç¡®å®šç¬¦å·ä¸º <code>_ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE</code> ï¼Œç‰ˆæœ¬ä¸º <code>GLIBCXX_3.4.11</code> ã€‚</p><p>åœ¨æºæ–‡ä»¶ä¸­æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight cpp"><figcaption><span>symver</span><a href="/blog/downloads/code/symver.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** æŒ‡å®šç‰¹å®šç‰ˆæœ¬çš„ç¬¦å· START */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> {</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/** __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line">__asm__ (<span class="string">&quot;.symver _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE, _ZNSt18condition_variable4waitERSt11unique_lockISt5mutexE@GLIBCXX_3.4.11&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">}</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/** __cplusplus */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** æŒ‡å®šç‰¹å®šç‰ˆæœ¬çš„ç¬¦å· END */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹åå°±å¯ä»¥ä½¿ç”¨ std::condition_variable::wait(std::unique_lock&lt;std::mutex&gt;&amp;) å°±æ˜¯ GLIBCXX_3.4.11 çš„</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"> </span><br><span class="line">std::mutex m;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line">std::string data;</span><br><span class="line"><span class="type">bool</span> ready = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span> processed = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">worker_thread</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="comment">// wait until main() sends data</span></span><br><span class="line">    <span class="function">std::unique_lock <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">    cv.<span class="built_in">wait</span>(lk, []{ <span class="keyword">return</span> ready; });</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// after the wait, we own the lock</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Worker thread is processing data\n&quot;</span>;</span><br><span class="line">    data += <span class="string">&quot; after processing&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// send data back to main()</span></span><br><span class="line">    processed = <span class="literal">true</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Worker thread signals data processing completed\n&quot;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// manual unlocking is done before notifying, to avoid waking up</span></span><br><span class="line">    <span class="comment">// the waiting thread only to block again (see notify_one for details)</span></span><br><span class="line">    lk.<span class="built_in">unlock</span>();</span><br><span class="line">    cv.<span class="built_in">notify_one</span>();</span><br><span class="line">}</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">(worker_thread)</span></span>;</span><br><span class="line"> </span><br><span class="line">    data = <span class="string">&quot;Example data&quot;</span>;</span><br><span class="line">    <span class="comment">// send data to the worker thread</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::lock_guard <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">        ready = <span class="literal">true</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;main() signals data ready for processing\n&quot;</span>;</span><br><span class="line">    }</span><br><span class="line">    cv.<span class="built_in">notify_one</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// wait for the worker</span></span><br><span class="line">    {</span><br><span class="line">        <span class="function">std::unique_lock <span class="title">lk</span><span class="params">(m)</span></span>;</span><br><span class="line">        cv.<span class="built_in">wait</span>(lk, []{ <span class="keyword">return</span> processed; });</span><br><span class="line">    }</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Back in main(), data = &quot;</span> &lt;&lt; data &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    worker.<span class="built_in">join</span>();</span><br><span class="line">}</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ symver.cpp</span><br></pre></td></tr></table></figure><p>éªŒè¯ç¬¦å·ç‰ˆæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ strings a.out | grep condition_variable | c++filt</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)</span><br><span class="line">std::condition_variable::<span class="built_in">wait</span>(std::unique_lock&lt;std::mutex&gt;&amp;)@GLIBCXX_3.4.11</span><br></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨åŠ è½½so"><a href="#æ‰‹åŠ¨åŠ è½½so" class="headerlink" title="æ‰‹åŠ¨åŠ è½½so"></a>æ‰‹åŠ¨åŠ è½½so</h2><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight cpp"><figcaption><span>dlopen.cpp</span><a href="/blog/downloads/code/compile/dlopen.cpp">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;dlfcn.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*<span class="type">func_t</span>)</span><span class="params">()</span></span>;  <span class="comment">// å®šä¹‰å‡½æ•°æŒ‡é’ˆç±»å‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="comment">// æ‰“å¼€ .so æ–‡ä»¶</span></span><br><span class="line">    <span class="type">void</span> *handle = <span class="built_in">dlopen</span>(<span class="string">&quot;your_library.so&quot;</span>, RTLD_LAZY);</span><br><span class="line">    <span class="keyword">if</span> (!handle) {</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;%s\n&quot;</span>, <span class="built_in">dlerror</span>());</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¸…é™¤ä»»ä½•ç°æœ‰çš„é”™è¯¯</span></span><br><span class="line">    <span class="built_in">dlerror</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–ç¬¦å·</span></span><br><span class="line">    <span class="comment">// void (*func)(); // æ–¹æ³•ä¸€ï¼šå£°æ˜å¹¶å®šä¹‰å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="type">func_t</span> func;  <span class="comment">// æ–¹æ³•äºŒï¼šå®šä¹‰å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// ä»¥ä¸‹å››ç§æ–¹æ³•/å†™æ³•éƒ½å¯ä»¥ç”¨äºå°† dlsym è¿”å›çš„ void* èµ‹å€¼ç»™å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// (1) *(void **) (&amp;func) = dlsym(handle, &quot;your_function&quot;);</span></span><br><span class="line">    <span class="comment">//    è§£é‡Šï¼šå–å‡½æ•°æŒ‡é’ˆ func çš„åœ°å€ï¼Œå°†å…¶è½¬ä¸º void**ï¼Œç„¶åå°† dlsym è¿”å›çš„ void* èµ‹å€¼ç»™å®ƒè§£å¼•ç”¨åçš„å˜é‡ï¼ˆå³ funcï¼‰</span></span><br><span class="line">    <span class="comment">// (2) func = (void (*)())dlsym(handle, &quot;your_function&quot;);</span></span><br><span class="line">    <span class="comment">// (3) func = reinterpret_cast&lt;func_t&gt;(dlsym(handle, &quot;your_function&quot;));</span></span><br><span class="line">    <span class="comment">// (4) å¦‚ä¸‹</span></span><br><span class="line">    func = (<span class="type">func_t</span>)<span class="built_in">dlsym</span>(handle, <span class="string">&quot;your_function&quot;</span>);</span><br><span class="line">    <span class="type">char</span> *error = <span class="built_in">dlerror</span>();</span><br><span class="line">    <span class="keyword">if</span> (error != <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;%s\n&quot;</span>, error);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨ç¬¦å·</span></span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­ .so æ–‡ä»¶</span></span><br><span class="line">    <span class="built_in">dlclose</span>(handle);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> compile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ ç¼ºé™·</title>
      <link href="/blog/2024/01/23/cpp/C++%E7%BC%BA%E9%99%B7/"/>
      <url>/blog/2024/01/23/cpp/C++%E7%BC%BA%E9%99%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="basic-string-M-construct-null-not-valid"><a href="#basic-string-M-construct-null-not-valid" class="headerlink" title="basic_string::_M_construct null not valid"></a>basic_string::_M_construct null not valid</h2><p>C++æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cpp defeat: basic_string::_M_construct null not valid</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;fun&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fun</span>(<span class="number">0</span>); <span class="comment">// Run-time error: basic_string::_M_construct null not valid</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>fun(0)</code>çš„<code>0</code>ä¼šè¢«è§†ä¸º<code>const char*</code>ç±»å‹ï¼Œä¹Ÿå°±æ˜¯<code>nullptr</code>ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æœŸå¯ä»¥é€šè¿‡ã€‚<br>ä½†æ˜¯è¿è¡ŒæœŸä¼šè§¦å‘<code>string</code>å¯¹è±¡çš„æ„é€ é”™è¯¯â€œbasic_string::_M_construct null not validâ€ã€‚</p><p>éšè”½ä¸€ç‚¹çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> * <span class="title">get_a_string</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Attention: Alaways take care that a parameter to a string should not be NULL!</span></span><br><span class="line">    <span class="built_in">fun</span>(<span class="built_in">get_a_string</span>()); <span class="comment">// Run-time error: basic_string::_M_construct null not valid</span></span><br><span class="line">    <span class="comment">// Better code</span></span><br><span class="line">    <span class="type">char</span> * str = <span class="built_in">get_a_string</span>();</span><br><span class="line">    <span class="built_in">fun</span>(str != <span class="literal">NULL</span>? str : <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ è°ƒè¯•å·¥å…·</title>
      <link href="/blog/2024/01/23/cpp/C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
      <url>/blog/2024/01/23/cpp/C++%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="å•å…ƒæµ‹è¯•æ¡†æ¶"><a href="#å•å…ƒæµ‹è¯•æ¡†æ¶" class="headerlink" title="å•å…ƒæµ‹è¯•æ¡†æ¶"></a>å•å…ƒæµ‹è¯•æ¡†æ¶</h2><p><a href="https://cpptest.sourceforge.io/tutorial.html">CppTest</a></p><h2 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) breakpoint exit</span><br><span class="line">(gdb) breakpoint _exit</span><br><span class="line">(gdb) breakpoint atexit</span><br><span class="line">(gdb) breakpoint abort</span><br></pre></td></tr></table></figure><p>Enable coredump: <a href="https://medium.com/@sourabhedake/core-dumps-how-to-enable-them-73856a437711">how to do</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br></pre></td></tr></table></figure><p>Where is the core dumped file:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;kernel.core_pattern&#x27;</span> /etc/sysctl.conf</span><br></pre></td></tr></table></figure><h2 id="strace"><a href="#strace" class="headerlink" title="strace"></a>strace</h2><p>Example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -f -o strace.log -tt -y -yy -e trace=desc,process,network</span><br></pre></td></tr></table></figure><p>Refer to <a href="https://gist.github.com/graste/929bb122c353bdd90c20">here</a></p><blockquote><p>-e trace&#x3D;ipc â€“ communication between processes (IPC)<br>-e trace&#x3D;memory â€“ memory syscalls<br>-e trace&#x3D;network â€“ network syscalls<br>-e trace&#x3D;process â€“ process calls (like fork, exec)<br>-e trace&#x3D;signal â€“ process signal handling (like HUP, exit)<br>-e trace&#x3D;file â€“ file related syscalls<br>-e trace&#x3D;desc â€“ all file descriptor related system calls</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mkdocs Configuration</title>
      <link href="/blog/2024/01/23/personal_site/Mkdocs-Configuration/"/>
      <url>/blog/2024/01/23/personal_site/Mkdocs-Configuration/</url>
      
        <content type="html"><![CDATA[<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p><code>mkdocs.yml</code> æ–‡ä»¶æ˜¯ MkDocs æ–‡æ¡£ç”Ÿæˆå™¨çš„é…ç½®æ–‡ä»¶ã€‚</p><p>ç¤ºä¾‹ï¼š<a href="https://github.com/squidfunk/mkdocs-material/blob/master/mkdocs.yml"><code>mkdocs.yml</code></a></p><h3 id="theme"><a href="#theme" class="headerlink" title="theme"></a>theme</h3><p>è¯¥æ–‡ä»¶ä¸­çš„ <code>theme</code> éƒ¨åˆ†ç”¨äºæŒ‡å®šç”¨äºç”Ÿæˆæ–‡æ¡£çš„ä¸»é¢˜ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨çš„ä¸»é¢˜æ˜¯ Materialã€‚ <code>name</code> å­—æ®µæŒ‡å®šä¸»é¢˜çš„åç§°ï¼Œè€Œ <code>custom_dir</code> å­—æ®µæŒ‡å®šåŒ…å«ä¸»é¢˜è‡ªå®šä¹‰å†…å®¹çš„ç›®å½•ã€‚ <code>features</code> å­—æ®µæŒ‡å®šå¯ä»¥ä¸ºä¸»é¢˜å¯ç”¨çš„å¯é€‰åŠŸèƒ½åˆ—è¡¨ã€‚</p><p>ä»¥ä¸‹æ˜¯åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºçš„å¯é€‰åŠŸèƒ½ï¼š</p><ul><li><code>announce.dismiss</code>: å¯ç”¨å¯å…³é—­çš„å…¬å‘Šæ¨ªå¹…ï¼Œæ˜¾ç¤ºåœ¨æ–‡æ¡£çš„æ¯ä¸ªé¡µé¢é¡¶éƒ¨ã€‚</li><li><code>content.action.edit</code>: åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¯ç”¨â€œç¼–è¾‘â€æŒ‰é’®ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥è½»æ¾ç¼–è¾‘é¡µé¢å†…å®¹ã€‚</li><li><code>content.action.view</code>: åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¯ç”¨â€œæŸ¥çœ‹æºä»£ç â€æŒ‰é’®ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥æŸ¥çœ‹é¡µé¢çš„æºä»£ç ã€‚</li><li><code>content.code.annotate</code>: å¯ç”¨ä»£ç æ³¨é‡ŠåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ·»åŠ æ³¨é‡Šä»¥è§£é‡Šä»£ç ã€‚</li><li><code>content.code.copy</code>: å¯ç”¨ä»£ç å¤åˆ¶åŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾å¤åˆ¶ä»£ç ã€‚</li><li><code>content.tooltips</code>: å¯ç”¨å·¥å…·æç¤ºåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨é¼ æ ‡æ‚¬åœæ—¶æŸ¥çœ‹æœ‰å…³é¡µé¢å…ƒç´ çš„ä¿¡æ¯ã€‚</li><li><code>navigation.footer</code>: åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¯ç”¨é¡µè„šå¯¼èˆªæ ã€‚</li><li><code>navigation.indexes</code>: å¯ç”¨ç´¢å¼•å¯¼èˆªæ ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾æµè§ˆæ–‡æ¡£ä¸­çš„ç´¢å¼•ã€‚</li><li><code>navigation.sections</code>: å¯ç”¨éƒ¨åˆ†å¯¼èˆªæ ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾æµè§ˆæ–‡æ¡£ä¸­çš„å„ä¸ªéƒ¨åˆ†ã€‚</li><li><code>navigation.tabs</code>: å¯ç”¨é€‰é¡¹å¡å¯¼èˆªæ ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾æµè§ˆæ–‡æ¡£ä¸­çš„å„ä¸ªé€‰é¡¹å¡ã€‚</li><li><code>navigation.top</code>: åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¯ç”¨é¡¶éƒ¨å¯¼èˆªæ ã€‚</li><li><code>navigation.tracking</code>: å¯ç”¨å¯¼èˆªè·Ÿè¸ªåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥è·Ÿè¸ªä»–ä»¬åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®ã€‚</li><li><code>search.highlight</code>: å¯ç”¨æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºåŠŸèƒ½ã€‚</li><li><code>search.share</code>: å¯ç”¨å…±äº«æœç´¢ç»“æœåŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾å…±äº«æœç´¢ç»“æœã€‚</li><li><code>search.suggest</code>: å¯ç”¨æœç´¢å»ºè®®åŠŸèƒ½ï¼Œä½¿ç”¨æˆ·å¯ä»¥åœ¨è¾“å…¥æœç´¢æŸ¥è¯¢æ—¶è·å¾—å»ºè®®ã€‚</li><li><code>toc.follow</code>: å¯ç”¨ç›®å½•è·ŸéšåŠŸèƒ½ï¼Œä½¿ç›®å½•å§‹ç»ˆä¿æŒå¯è§ã€‚</li></ul><p><code>palette</code> å­—æ®µæŒ‡å®šäº†ä¸€ä¸ªé¢œè‰²æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><code>scheme</code>: æŒ‡å®šé¢œè‰²æ–¹æ¡ˆçš„åç§°ã€‚</li><li><code>primary</code>: æŒ‡å®šä¸»è¦é¢œè‰²ã€‚</li><li><code>accent</code>: æŒ‡å®šå¼ºè°ƒé¢œè‰²ã€‚</li><li><code>toggle</code>: æŒ‡å®šåˆ‡æ¢åˆ°æš—æ¨¡å¼æ—¶ä½¿ç”¨çš„å›¾æ ‡å’Œåç§°ã€‚</li></ul><p>ç¬¬ä¸€ä¸ªæ–¹æ¡ˆåä¸º defaultï¼Œå…¶ä¸­ä¸»è¦é¢œè‰²å’Œå¼ºè°ƒé¢œè‰²å‡ä¸º indigoã€‚åˆ‡æ¢åˆ°æš—æ¨¡å¼æ—¶ï¼Œä½¿ç”¨çš„å›¾æ ‡ä¸º material&#x2F;brightness-7ï¼Œåç§°ä¸ºâ€œåˆ‡æ¢åˆ°æš—æ¨¡å¼â€ã€‚</p><p>ç¬¬äºŒä¸ªæ–¹æ¡ˆåä¸º slateï¼Œå…¶ä¸­ä¸»è¦é¢œè‰²å’Œå¼ºè°ƒé¢œè‰²å‡ä¸º indigoã€‚åˆ‡æ¢åˆ°äº®æ¨¡å¼æ—¶ï¼Œä½¿ç”¨çš„å›¾æ ‡ä¸º material&#x2F;brightness-4ï¼Œåç§°ä¸ºâ€œåˆ‡æ¢åˆ°äº®æ¨¡å¼â€ã€‚</p><p>font å­—æ®µæŒ‡å®šäº†ç”¨äºæ–‡æœ¬å’Œä»£ç çš„å­—ä½“ã€‚åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­ï¼Œæ–‡æœ¬å­—ä½“ä¸º Robotoï¼Œä»£ç å­—ä½“ä¸º Roboto Monoã€‚ favicon å­—æ®µæŒ‡å®šäº†ç½‘ç«™å›¾æ ‡çš„è·¯å¾„ã€‚ icon å­—æ®µæŒ‡å®šäº†ç½‘ç«™æ ‡å¿—çš„è·¯å¾„ã€‚</p><p>favicon å’Œ icon æ˜¯ç½‘ç«™çš„ä¸¤ä¸ªä¸åŒå…ƒç´ ã€‚</p><p>favicon æ˜¯ç½‘ç«™çš„å›¾æ ‡ï¼Œé€šå¸¸æ˜¾ç¤ºåœ¨æµè§ˆå™¨æ ‡ç­¾é¡µä¸Šã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå°çš„å›¾åƒæ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ .ico æ ¼å¼ã€‚åœ¨ mkdocs.yml æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ favicon å­—æ®µæ¥æŒ‡å®šç½‘ç«™å›¾æ ‡çš„è·¯å¾„ã€‚</p><p>icon æ˜¯ç½‘ç«™çš„æ ‡å¿—ï¼Œé€šå¸¸æ˜¾ç¤ºåœ¨ç½‘ç«™çš„æ ‡é¢˜æ æˆ–é¡µçœ‰ä¸­ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå›¾åƒæ–‡ä»¶ï¼Œä¾‹å¦‚ .png æˆ– .jpg æ–‡ä»¶ã€‚åœ¨ mkdocs.yml æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ icon å­—æ®µæ¥æŒ‡å®šç½‘ç«™æ ‡å¿—çš„è·¯å¾„ã€‚</p><h3 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h3><p>è¿™é‡Œåˆ—å‡ºäº†ä¸‰ä¸ªæ’ä»¶ï¼šblogã€searchå’Œminifyã€‚å…¶ä¸­ï¼Œblogæ’ä»¶ç”¨äºæ”¯æŒåšå®¢åŠŸèƒ½ï¼Œsearchæ’ä»¶ç”¨äºæ”¯æŒæœç´¢åŠŸèƒ½ï¼Œè€Œminifyæ’ä»¶ç”¨äºå‹ç¼©HTMLæ–‡ä»¶ã€‚åœ¨searchæ’ä»¶ä¸­ï¼Œseparatorå‚æ•°æŒ‡å®šäº†æœç´¢æ—¶çš„åˆ†éš”ç¬¦ï¼Œè¿™é‡Œçš„åˆ†éš”ç¬¦åŒ…æ‹¬ç©ºæ ¼ã€è¿å­—ç¬¦ã€é€—å·ã€å†’å·ã€ç­‰å·ã€æ„Ÿå¹å·ã€æ–¹æ‹¬å·ã€æ‹¬å·ã€å¼•å·ã€åå¼•å·å’Œæ–œæ ç­‰ã€‚</p><h3 id="extra"><a href="#extra" class="headerlink" title="extra"></a>extra</h3><h4 id="analytics"><a href="#analytics" class="headerlink" title="analytics"></a>analytics</h4><p>analyticså‚æ•°ç”¨äºæŒ‡å®šç½‘ç«™åˆ†ææœåŠ¡æä¾›å•†å’Œå±æ€§IDï¼Œä¾‹å¦‚è¡¡é‡ç½‘ç«™æµé‡ã€‚</p><ul><li><a href="https://squidfunk.github.io/mkdocs-material/setup/setting-up-site-analytics/">Setting up site analytics</a></li><li><a href="https://analytics.google.com/analytics/academy/course/6">googleå…è´¹è¯¾ç¨‹</a></li></ul><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p>See <a href="https://mkdocs.readthedocs.io/en/0.10/user-guide/configuration/">the doc</a>.</p><ol><li>Keep underscore in file name</li></ol><p>refer to: </p><ul><li><a href="https://pypi.org/project/mkdocs-gen-nav-plugin/">https://pypi.org/project/mkdocs-gen-nav-plugin/</a></li><li><a href="https://github.com/mkdocs/mkdocs/issues/2017">https://github.com/mkdocs/mkdocs/issues/2017</a></li><li><a href="https://github.com/squidfunk/mkdocs-material/discussions/5977">https://github.com/squidfunk/mkdocs-material/discussions/5977</a></li><li><a href="https://www.mkdocs.org/user-guide/writing-your-docs/#meta-data">https://www.mkdocs.org/user-guide/writing-your-docs/#meta-data</a></li><li>No help: <a href="https://www.mkdocs.org/user-guide/custom-themes/#pagetitle">https://www.mkdocs.org/user-guide/custom-themes/#pagetitle</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mkdocs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>File System</title>
      <link href="/blog/2024/01/23/linux/File-System/"/>
      <url>/blog/2024/01/23/linux/File-System/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–‡ä»¶ç¤ºä¾‹"><a href="#æ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="æ–‡ä»¶ç¤ºä¾‹"></a>æ–‡ä»¶ç¤ºä¾‹</h2><ul><li><p><code>/proc</code>: æŸ¥çœ‹æ‰‹å†Œ <code>man proc</code>ã€‚</p></li><li><p><code>/proc/self/exe</code>: æ˜¯æŒ‡å‘å½“å‰è¿›ç¨‹çš„ç¨‹åºæ–‡ä»¶çš„è½¯é“¾æ¥ã€‚</p></li><li><p><code>/proc/&lt;pid&gt;/exe</code>: æ˜¯æŒ‡å‘è¿›ç¨‹<code>&lt;pid&gt;</code>çš„ç¨‹åºæ–‡ä»¶çš„è½¯é“¾æ¥ã€‚</p><p>  <a href="https://docs.oracle.com/cd/E19455-01/805-7228/bkuptasks2-78540/index.html">How to Find File System Names</a></p></li><li><p><code>/proc/[pid]/status</code>ï¼šå¯æŸ¥çœ‹è¿›ç¨‹çš„å†…å­˜ä½¿ç”¨å³°å€¼ç­‰ä¿¡æ¯ï¼Œå…³é”®å­—ä¸ºâ€VmHWMâ€ã€â€VmPeakâ€ã€â€VmRSSâ€ã€‚</p></li><li><p><code>/proc/[pid]/stat</code>ï¼šget current memory</p></li><li><p><code>/dev/shm</code>:</p><p>  <a href="https://www.cyberciti.biz/tips/what-is-devshm-and-its-practical-usage.html">What Is &#x2F;dev&#x2F;shm And Its Practical Usage</a></p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure><p>  Sample outputs:</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/wks01-root</span><br><span class="line">                    444G   70G  351G  17% /</span><br><span class="line">tmpfs                 3.9G     0  3.9G   0% /lib/init/rw</span><br><span class="line">udev                  3.9G  332K  3.9G   1% /dev</span><br><span class="line">tmpfs                 3.9G  168K  3.9G   1% /dev/shm</span><br><span class="line">/dev/sda1             228M   32M  184M  15% /boot</span><br></pre></td></tr></table></figure></li></ul><h2 id="åˆ†åŒº-Partition-å’Œæ–‡ä»¶ç³»ç»Ÿ-Filesystem"><a href="#åˆ†åŒº-Partition-å’Œæ–‡ä»¶ç³»ç»Ÿ-Filesystem" class="headerlink" title="åˆ†åŒº(Partition)å’Œæ–‡ä»¶ç³»ç»Ÿ(Filesystem)"></a>åˆ†åŒº(Partition)å’Œæ–‡ä»¶ç³»ç»Ÿ(Filesystem)</h2><p>æœ¬å°èŠ‚å†…å®¹æ¥è‡ª <a href="https://www.linuxfordevices.com/tutorials/linux/partitions-and-filesystems">å‚è€ƒé“¾æ¥</a> ã€‚</p><h3 id="åˆ†åŒºï¼š"><a href="#åˆ†åŒºï¼š" class="headerlink" title="åˆ†åŒºï¼š"></a>åˆ†åŒºï¼š</h3><p>Linuxä¸Šçš„åˆ†åŒºæŒ‡ï¼šå­˜å‚¨è®¾å¤‡ä¸­åˆ’åˆ†å‡ºæ¥çš„ä¸€ä¸ªç‰‡æ®µï¼Œè¯¥ç‰‡æ®µä¸å…¶ä»–ç‰‡æ®µé€»è¾‘ä¸Šåˆ†ç¦»ï¼Œå¥½æ¯”ä¸€ä¸ªä¸ªç‹¬ç«‹çš„æˆ¿é—´ã€‚</p><h3 id="åˆ†åŒºè¡¨-partition-table-ï¼š"><a href="#åˆ†åŒºè¡¨-partition-table-ï¼š" class="headerlink" title="åˆ†åŒºè¡¨(partition table)ï¼š"></a>åˆ†åŒºè¡¨(partition table)ï¼š</h3><p>åˆ†åŒºè¡¨å­˜å‚¨å„ä¸ªåˆ†åŒºçš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚èµ·å§‹ä½ç½®ã€ç»ˆæ­¢ä½ç½®ã€å¤§å°ç­‰ã€‚<br>æœ‰ä¸¤ç§ä¸»è¦çš„åˆ†åŒºè¡¨ç±»å‹ï¼ŒMBR(older)å’ŒGPT(newer)ï¼š</p><table><thead><tr><th>Partition tables</th><th>Maximum primary partitions</th><th>Maximum size for each partition</th><th>Security</th><th>Operating system Support</th></tr></thead><tbody><tr><td>Master Boot Record (MBR)</td><td>4</td><td>2TB</td><td>No such security features</td><td>Supports most modern OS</td></tr><tr><td>Guid Partition Table (GPT)</td><td>No such limit</td><td>18 Exabytes</td><td>CRC32 checksum mechanism to verify the integrity of files</td><td>Supports most modern OS</td></tr></tbody></table><p>ä»ä¸Šè¡¨å¯ä»¥å¾ˆæ˜æ˜¾åœ°çœ‹å‡ºï¼Œä¸ºä»€ä¹ˆGPTæ›´æ¨èã€‚</p><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><p>æ–‡ä»¶ç³»ç»Ÿæ˜¯æˆ‘ä»¬åœ¨æ¯ä¸ªåˆ†åŒºä¸­ç®¡ç†æ•°æ®çš„æ–¹å¼ã€‚å®ƒè´Ÿè´£ç´¢å¼•ã€å­˜å‚¨ã€æ£€ç´¢ã€å‘½åæ–‡ä»¶å’Œç»´æŠ¤æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆæ–‡ä»¶æ‰€æœ‰è€…ã€å¤§å°ã€æƒé™ç­‰ï¼‰ã€‚å­˜å‚¨åœ¨åˆ†åŒºä¸­ã€‚</p><p>ä¸€ä¸ªæ–‡ä»¶ä¿å­˜åœ¨å¤šä¸ªè¿ç»­çš„ <strong>æ‰‡åŒºï¼ˆsectorï¼‰</strong> ä¸­ï¼Œç°ä»£æ¯ä¸ªæ‰‡åŒºå¤§çº¦ä¸º4096å­—èŠ‚ã€‚<br>æ–‡ä»¶ç³»ç»Ÿè´Ÿè´£ç»„ç»‡å“ªäº›æ‰‡åŒºå‡†å¤‡å¥½ä½¿ç”¨äº†ã€ä¸€ä¸ªæ–‡ä»¶å¿…é¡»å­˜å‚¨åœ¨å“ªä¸ªæ‰‡åŒºã€å“ªä¸ªæ‰‡åŒºå­˜å‚¨äº†ä»€ä¹ˆæ–‡ä»¶ã€‚<br>å¦‚æœæ²¡æœ‰è¿™ç§ç»„ç»‡ï¼Œå°±æ— æ³•æ— æ³•æ£€ç´¢ä»»ä½•æ–‡ä»¶ï¼Œå› ä¸ºç³»ç»Ÿæ— æ³•å¾—çŸ¥æ–‡ä»¶çš„ä½ç½®ï¼ˆblockï¼Œå—ï¼‰ã€‚</p><p>ä¸»è¦çš„æ–‡ä»¶ç³»ç»Ÿåˆ†ç±»ï¼š</p><ul><li>FAT</li></ul><p>æ–‡ä»¶åˆ†é…è¡¨ï¼ˆFATï¼ŒFile Allocation Tableï¼‰æ˜¯Microsoftå¼€å‘çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚<br>ä»1997å‘å¸ƒä¹‹åï¼Œæœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œç§°ä¸ºFAT12ã€FAT16ã€FAT32ï¼Œè¿ç»­åœ°å¢åŠ äº†æœ€å¤§æ”¯æŒæ–‡ä»¶å¤§å°ï¼ˆfile sizeï¼‰å’Œé©±åŠ¨å™¨å¤§å°ï¼ˆdrive sizeï¼‰ã€‚</p><p>FAT32å…è®¸çš„æœ€å¤§æ–‡ä»¶å¤§å°ä¸º4Gbã€‚ç›´è‡³WindowsXPï¼ŒFAT32æ˜¯é»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹‹åè¢«NTFSå–ä»£ã€‚<br>è™½ç„¶FATéå¸¸åŸºç¡€ï¼Œä½†æ˜¯å®ƒæ”¯æŒå‡ ä¹æ‰€æœ‰çš„è®¾å¤‡å’Œæ“ä½œç³»ç»Ÿã€‚</p><p><strong>æ³¨ï¼š</strong> é©±åŠ¨å™¨ï¼ˆ<a href="https://www.computerhope.com/jargon/d/drive.htm">drive</a>ï¼‰ï¼Œæ˜¯ä¸€ä¸ªèƒ½å­˜å‚¨å’Œè¯»å–éæ˜“å¤±ä¿¡æ¯çš„ä½ç½®ï¼Œæ¯”å¦‚ç£ç›˜ï¼ˆdiskï¼‰æˆ–å…‰ç›˜ï¼ˆdiscï¼‰ã€‚</p><p>å¦‚ä¸‹å›¾ï¼Œé©±åŠ¨å™¨A:æ˜¯ä¸€ä¸ªè½¯ç›˜ï¼ˆ<a href="https://www.computerhope.com/jargon/f/fdd.htm">floppy drive</a>ï¼‰ï¼Œ<br>é©±åŠ¨å™¨C:æ˜¯ä¸»ç¡¬ç›˜ï¼ˆprimary hard drivceï¼‰ï¼Œ<br>é©±åŠ¨å™¨D:å’ŒE:æ˜¯åˆ†åŒºï¼ŒF:æ˜¯<a href="https://www.computerhope.com/jargon/c/cdrom.htm">CD-ROM</a>ã€‚<br>CD-ROMå¸¸å¸¸æ˜¯æœ€åä¸€ä¸ªç›˜ç¬¦ï¼ˆdrive letterï¼‰ã€‚<br>åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œç¡¬ç›˜æ˜¯C:é©±åŠ¨å™¨ï¼ŒCD-ROMæˆ–å…¶ä»–å…‰ç›˜æ˜¯D:é©±åŠ¨å™¨ã€‚</p><p><img src="/blog/my-compu-drive.webp" alt="é©±åŠ¨å™¨ç¤ºä¾‹" title="é©±åŠ¨å™¨ç¤ºä¾‹å›¾"></p><ul><li>NTFS</li></ul><p>æ–°æŠ€æœ¯æ–‡ä»¶ç³»ç»Ÿï¼ˆNew Technology File Systemï¼ŒNTFSï¼‰æ˜¯FATçš„ç°ä»£æ›¿ä»£è€…ã€‚<br>é™¤äº†æ”¯æŒé«˜è¾¾16EBï¼ˆå¤§äº170äº¿GBï¼‰çš„é©±åŠ¨å™¨å¤§å°å’Œ256TBçš„å•æ–‡ä»¶å¤§å°å¤–ï¼Œè¿˜æ”¯æŒæ—¥å¿—ç³»ç»Ÿï¼ˆ<a href="https://en.wikipedia.org/wiki/Journaling_file_system">journaling system</a>ï¼‰ã€‚</p><ul><li>ext&#x2F;ext2&#x2F;ext3&#x2F;ext4</li></ul><p>Linuxçš„æ‰©å±•æ–‡ä»¶ç³»ç»Ÿï¼ˆextended file systemï¼‰æˆ–extäº1992å¹´å‘å¸ƒã€‚ä¹‹åæœ‰äº†3æ¬¡æ›´æ–°ï¼š</p><p>ext2å¼•å…¥äº†æ–‡ä»¶å±æ€§ï¼ˆæ–‡ä»¶æƒé™ï¼‰ï¼Œext3å¼•å…¥äº†æ—¥å¿—åŠŸèƒ½ï¼ˆ<a href="https://en.wikipedia.org/wiki/Journaling_file_system">journaling</a>ï¼‰ã€‚</p><p>ext4å¯¹ext2å’Œext3å‘åå…¼å®¹ï¼Œå¢åŠ äº†å­˜å‚¨é™åˆ¶å’Œä¸€äº›æ€§èƒ½è°ƒæ•´ã€‚<br>å¯ä»¥æ”¯æŒé«˜è¾¾1EBçš„å·ï¼ˆvolumnï¼‰ï¼Œå•ä¸ªæ–‡ä»¶å¯ä»¥è¾¾16TBã€‚</p><p>ext4ä¹Ÿå¼•å…¥äº†å»¶è¿Ÿå†…å­˜åˆ†é…çš„æ¦‚å¿µï¼Œå³åœ¨æ–‡ä»¶è¢«å¼ºåˆ¶åˆ·æ–°åˆ°å­˜å‚¨è®¾å¤‡æ—¶æ‰ä¸ºå…¶åˆ†é…æ‰‡åŒºã€‚<br>è¿™æé«˜äº†CPUçš„æ€§èƒ½å¹¶å‡å°‘äº†åçš„æ‰‡åŒºã€‚<br>ä»Šå¤©å‡ ä¹æ‰€æœ‰çš„ç°ä»£Linuxå‘è¡Œç‰ˆéƒ½ä½¿ç”¨ext4ä½œä¸ºé»˜è®¤çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p><ul><li><p>ZFS</p></li><li><p>Btrfs</p></li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªåˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ç¤ºä¾‹ï¼š</p><p><img src="/blog/Example-of-partition-and-filesystem1-768x340.png.webp" alt="åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ç¤ºä¾‹å›¾" title="åˆ†åŒºå’Œæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„ç¤ºä¾‹å›¾"></p><p>æˆ‘æœ‰ä¸€ä¸ª500GBçš„SSDï¼Œåˆ†æˆ3ä¸ªåˆ†åŒºï¼ˆbootã€homeã€rootï¼‰ï¼Œä½¿ç”¨GPTä½œä¸ºåˆ†åŒºè¡¨ã€‚</p><p>æˆ‘æ²¡æœ‰åˆ†å‡ºswapåˆ†åŒºã€‚æ‰€æœ‰çš„åˆ†åŒºéƒ½è·‘åœ¨ext4æ–‡ä»¶ç³»ç»Ÿä¸Šã€‚</p><p>åœ¨ä¸€ä¸ªåŒå¯åŠ¨ï¼ˆdual-bootedï¼‰å­˜å‚¨è®¾å¤‡ï¼ˆWindowså’ŒLinuxï¼‰ä¸Šï¼Œè¿˜æœ‰å‡ ä¸ªé€‚ç”¨äºWindwowsçš„NTFSåˆ†åŒºã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ä»»æ„å­˜å‚¨è®¾å¤‡ä¸ŠæŸ¥çœ‹åˆ†åŒºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure><p>æ›´å¤šèµ„æºè¯·è®¿é—®ï¼š</p><ul><li><a href="https://www.linuxfordevices.com/tutorials/ubuntu/install-zfs-on-ubuntu">How to install ZFS on Ubuntu â€“ A Setup and Usage Guide</a></li><li><a href="https://www.linuxfordevices.com/tutorials/linux/ext4-vs-btrfs-filesystem">Ext4 vs Btrfs Filesystems â€“ Which one should you choose?</a></li><li><a href="https://www.linuxfordevices.com/tutorials/linux/btrfs-on-ubuntu">How to install and format a partition with the Btrfs on Ubuntu?</a></li><li><a href="https://ext4.wiki.kernel.org/index.php/Frequently_Asked_Questions">Frequently Asked Questions regarding ext4</a></li></ul><h2 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h2><p>æŒ‚è½½ï¼šä½¿è®¾å¤‡ä¸Šçš„æ–‡ä»¶å’Œç›®å½•å¯ä»¥é€šè¿‡æ–‡ä»¶ç³»ç»Ÿè®¿é—®çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è§<a href="https://zh.wikipedia.org/zh-cn/%E6%8C%82%E8%BD%BD">ç»´åŸºç™¾ç§‘</a>ã€‚</p><p>æŒ‚è½½ç‚¹ï¼šA mount point is a location in the partition used as a root filesystem.</p><h2 id="é©±åŠ¨"><a href="#é©±åŠ¨" class="headerlink" title="é©±åŠ¨"></a>é©±åŠ¨</h2><h2 id="ç›¸å…³å‘½ä»¤ä¸€è§ˆè¡¨"><a href="#ç›¸å…³å‘½ä»¤ä¸€è§ˆè¡¨" class="headerlink" title="ç›¸å…³å‘½ä»¤ä¸€è§ˆè¡¨"></a>ç›¸å…³å‘½ä»¤ä¸€è§ˆè¡¨</h2><p>lsblk</p><pre><code>lsblk [options] [device...]list all avaivable or specified block devices.Reads the sysfs filesystem to gather information.</code></pre><p>df</p><pre><code>df [OPTION]... [FILE]...report file system disk space usage on which each FILE resides.df -T æ‰“å°æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ã€‚</code></pre><p>du</p><pre><code>du [OPTION]... [FILE]...estimate file space usage.</code></pre><p>quota</p><pre><code>quota -s -u user...display users&#39; disk usage and limits.quota reports the quotas of all the filesystems listed in /etc/mtab.For filesystems that are NFS-mounted a call to the rpc.rquotad on the server machine is performed to get the information.-s, --human-readable</code></pre><p>repquota</p><pre><code>prints a summary of disc usage and quotas for the specified file system.</code></pre><p>mount</p><p>lsof - list open files</p><pre><code>https://unix.stackexchange.com/questions/11238/how-to-get-over-device-or-resource-busy</code></pre>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> filesystem </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Introducation to RPC</title>
      <link href="/blog/2024/01/21/net/RPC/"/>
      <url>/blog/2024/01/21/net/RPC/</url>
      
        <content type="html"><![CDATA[<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><ul><li><a href="https://www.ibm.com/docs/ssw_ibm_i_72/rzahp/rzahppdf.pdf">libtirpc(Transport Independent RPC)</a></li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RPC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dead Lock</title>
      <link href="/blog/2024/01/15/thread/Dead-Lock/"/>
      <url>/blog/2024/01/15/thread/Dead-Lock/</url>
      
        <content type="html"><![CDATA[<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://cloud.tencent.com/developer/article/1161103">å…³äºçº¿ç¨‹æ­»é”ï¼Œæ´»é”å’Œé¥¥é¥¿é—®é¢˜</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯é‡å…¥</title>
      <link href="/blog/2024/01/14/misc/%E5%8F%AF%E9%87%8D%E5%85%A5/"/>
      <url>/blog/2024/01/14/misc/%E5%8F%AF%E9%87%8D%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p><strong>å¯é‡å…¥å‡½æ•°</strong>ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«ä¸­æ–­æœåŠ¡ç¨‹åºæ‰“æ–­ï¼Œæ‰§è¡Œä¸­æ–­æœåŠ¡ç¨‹åºä¹‹åæ¢å¤æ‰§è¡Œï¼Œè¿˜èƒ½ä¸å¦¨ç¢ä¹‹å‰çš„æ‰§è¡Œï¼Œå°±ç§°è¯¥å‡½æ•°æ˜¯<strong>å¯é‡å…¥çš„</strong>ã€‚</p><p>å¯é‡å…¥å‡½æ•°ä¸€èˆ¬ç”¨äº<strong>ç¡¬ä»¶ä¸­æ–­å¤„ç†</strong>æˆ–<strong>é€’å½’</strong>ç­‰åº”ç”¨ç¨‹åºä¸­ã€‚</p><p><strong>å¯é‡å…¥ç¨‹åº&#x2F;å¯é‡å…¥å­ä¾‹ç¨‹</strong>ï¼šåœ¨å¤šä¸ªå¤„ç†å™¨ä¸Šèƒ½è¢«å®‰å…¨åœ°å¤šæ¬¡å¹¶å‘è°ƒç”¨ã€‚</p><p><strong>ä¸çº¿ç¨‹å®‰å…¨çš„åŒºåˆ«</strong>ï¼šå¯é‡å…¥å‡½æ•°çš„æ¦‚å¿µåœ¨å¤šä»»åŠ¡æ“ä½œç³»ç»Ÿå‡ºç°ä¹‹å‰å°±å­˜åœ¨äº†ï¼Œæ‰€ä»¥è¯¥æ¦‚å¿µä»…ä»…é’ˆå¯¹çš„æ˜¯å•çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ã€‚<br>ä¸€ä¸ªå‡½æ•°å¯ä»¥æ˜¯çº¿ç¨‹å®‰å…¨ä½†éå¯é‡å…¥çš„ï¼Œä¾‹å¦‚ï¼Œè¯¥å‡½æ•°æ¯æ¬¡éƒ½ä½¿ç”¨äº’æ–¥é‡æ¥åŒ…è£¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¯¥å‡½æ•°ç”¨äºä¸­æ–­æœåŠ¡ç¨‹åºï¼Œé‚£ä¹ˆï¼Œå®ƒå¯èƒ½åœ¨ç­‰å¾…ç¬¬ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹é‡Šæ”¾äº’æ–¥é‡æ—¶é™·å…¥é¥¥é¥¿ã€‚<strong>TODOï¼šé™·å…¥é¥¥é¥¿ä¸ºä»€ä¹ˆå°±ä¸æ˜¯å¯é‡å…¥äº†ï¼Ÿ</strong></p><p>è¦å®ç°å¯é‡å…¥æ€§ï¼Œå‡½æ•°é€šå¸¸éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>ä¸ä½¿ç”¨é™æ€æˆ–å…¨å±€å˜é‡ï¼šè¿™äº›å˜é‡åœ¨å¤šæ¬¡è°ƒç”¨ä¹‹é—´å…±äº«ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰ã€‚</li><li>ä¸ä¾èµ–äºä¸å¯é‡å…¥çš„å‡½æ•°ï¼šä¾‹å¦‚ï¼Œæ ‡å‡†åº“ä¸­çš„æŸäº›å‡½æ•°å¯èƒ½ä¸æ˜¯å¯é‡å…¥çš„ã€‚</li><li>ä¸ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼šåŠ¨æ€å†…å­˜åˆ†é…å¯èƒ½ä¼šå¯¼è‡´ç«äº‰æ¡ä»¶ã€‚</li><li>ä¸ä½¿ç”¨ä¿¡å·å¤„ç†ï¼šä¿¡å·å¤„ç†å¯èƒ½ä¼šä¸­æ–­å‡½æ•°çš„æ‰§è¡Œã€‚</li></ul><p>å¯é‡å…¥æ€§åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹å’Œä¸­æ–­å¤„ç†ç¨‹åºä¸­å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†å‡½æ•°åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„å®‰å…¨æ€§ã€‚</p><h3 id="å¯é‡å…¥-VS-çº¿ç¨‹å®‰å…¨"><a href="#å¯é‡å…¥-VS-çº¿ç¨‹å®‰å…¨" class="headerlink" title="å¯é‡å…¥ VS çº¿ç¨‹å®‰å…¨"></a>å¯é‡å…¥ VS çº¿ç¨‹å®‰å…¨</h3><p>å¯é‡å…¥æ€§å’Œçº¿ç¨‹å®‰å…¨è™½ç„¶éƒ½æ¶‰åŠåˆ°å¹¶å‘ç¼–ç¨‹ï¼Œä½†å®ƒä»¬æœ‰ä¸åŒçš„ä¾§é‡ç‚¹ï¼š</p><p>å¯é‡å…¥æ€§ï¼š</p><p>å®šä¹‰ï¼šä¸€ä¸ªå‡½æ•°å¯ä»¥åœ¨è¢«ä¸­æ–­åå®‰å…¨åœ°å†æ¬¡è°ƒç”¨ï¼Œè€Œä¸ä¼šå½±å“å…¶æ‰§è¡Œç»“æœã€‚<br>æ¡ä»¶ï¼šä¸ä½¿ç”¨é™æ€æˆ–å…¨å±€å˜é‡ã€ä¸ä¾èµ–ä¸å¯é‡å…¥çš„å‡½æ•°ã€ä¸ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ã€ä¸ä½¿ç”¨ä¿¡å·å¤„ç†ã€‚<br>åº”ç”¨åœºæ™¯ï¼šä¸»è¦ç”¨äºä¸­æ–­å¤„ç†ç¨‹åºå’ŒåµŒå…¥å¼ç³»ç»Ÿã€‚<br>çº¿ç¨‹å®‰å…¨ï¼š</p><p>å®šä¹‰ï¼šä¸€ä¸ªå‡½æ•°æˆ–ä»£ç å—åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯ä»¥å®‰å…¨åœ°å¹¶å‘æ‰§è¡Œï¼Œè€Œä¸ä¼šå¯¼è‡´ç«äº‰æ¡ä»¶æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚<br>æ¡ä»¶ï¼šé€šå¸¸éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚äº’æ–¥é”ã€ä¿¡å·é‡ï¼‰æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚<br>åº”ç”¨åœºæ™¯ï¼šä¸»è¦ç”¨äºå¤šçº¿ç¨‹ç¼–ç¨‹ã€‚<br>æ€»ç»“æ¥è¯´ï¼Œå¯é‡å…¥æ€§å…³æ³¨çš„æ˜¯å‡½æ•°åœ¨è¢«ä¸­æ–­åèƒ½å¦å®‰å…¨åœ°å†æ¬¡è°ƒç”¨ï¼Œè€Œçº¿ç¨‹å®‰å…¨å…³æ³¨çš„æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹èƒ½å¦å®‰å…¨åœ°å¹¶å‘æ‰§è¡Œã€‚å¯é‡å…¥å‡½æ•°ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œçº¿ç¨‹å®‰å…¨çš„å‡½æ•°ä¹Ÿä¸ä¸€å®šæ˜¯å¯é‡å…¥çš„ã€‚</p><ol><li>å¯é‡å…¥å‡½æ•°ä¸ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reentrantFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> localCounter = counter;</span><br><span class="line">    localCounter++;</span><br><span class="line">    counter = localCounter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">reentrantFunction</span>();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Counter: %d\n&quot;</span>, counter);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>reentrantFunction æ˜¯å¯é‡å…¥çš„ï¼Œå› ä¸ºå®ƒæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><p>ä¸ä½¿ç”¨é™æ€æˆ–å…¨å±€å˜é‡ï¼šè™½ç„¶ counter æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œä½† reentrantFunction ä¸­çš„æ“ä½œéƒ½æ˜¯åŸºäºå±€éƒ¨å˜é‡ localCounterï¼Œå¹¶ä¸”æ²¡æœ‰ä¾èµ–äºå‡½æ•°å¤–éƒ¨çš„çŠ¶æ€ã€‚<br>ä¸ä¾èµ–ä¸å¯é‡å…¥çš„å‡½æ•°ï¼šreentrantFunction ä¸­æ²¡æœ‰è°ƒç”¨ä»»ä½•ä¸å¯é‡å…¥çš„å‡½æ•°ã€‚<br>ä¸ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…ï¼šå‡½æ•°ä¸­æ²¡æœ‰ä½¿ç”¨ malloc æˆ–å…¶ä»–åŠ¨æ€å†…å­˜åˆ†é…å‡½æ•°ã€‚<br>ä¸ä½¿ç”¨ä¿¡å·å¤„ç†ï¼šå‡½æ•°ä¸­æ²¡æœ‰æ¶‰åŠä¿¡å·å¤„ç†ã€‚<br>å› æ­¤ï¼ŒreentrantFunction å¯ä»¥åœ¨è¢«ä¸­æ–­åå®‰å…¨åœ°å†æ¬¡è°ƒç”¨ï¼Œè€Œä¸ä¼šå½±å“å…¶æ‰§è¡Œç»“æœã€‚</p><p>ç„¶è€Œï¼Œæ­£å› ä¸ºå®ƒä½¿ç”¨äº†å…¨å±€å˜é‡ counterï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šå¯¼è‡´ç«äº‰æ¡ä»¶ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p><ol start="2"><li>çº¿ç¨‹å®‰å…¨çš„å‡½æ•°ä¸ä¸€å®šæ˜¯å¯é‡å…¥çš„</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">pthread_mutex_t</span> lock = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"><span class="type">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">threadSafeFunction</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pthread_mutex_lock</span>(&amp;lock);</span><br><span class="line">    counter++;</span><br><span class="line">    <span class="built_in">pthread_mutex_unlock</span>(&amp;lock);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">pthread_t</span> thread1, thread2;</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;thread1, <span class="literal">NULL</span>, threadSafeFunction, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">pthread_create</span>(&amp;thread2, <span class="literal">NULL</span>, threadSafeFunction, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">pthread_join</span>(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">pthread_join</span>(thread2, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Counter: %d\n&quot;</span>, counter);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>è¿™ä¸ªå‡½æ•° threadSafeFunction æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†äº’æ–¥é”æ¥ä¿æŠ¤å¯¹ counter çš„è®¿é—®ã€‚<br>ç„¶è€Œï¼Œå®ƒä¸æ˜¯å¯é‡å…¥çš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†äº’æ–¥é”ï¼Œäº’æ–¥é”åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­å¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼š</p><p>äº’æ–¥é”çš„ä½¿ç”¨ï¼šäº’æ–¥é”ç”¨äºç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œä½†å®ƒä»¬åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸­å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”æ—¶è¢«ä¸­æ–­ï¼Œç„¶åä¸­æ–­å¤„ç†ç¨‹åºå°è¯•å†æ¬¡è°ƒç”¨è¯¥å‡½æ•°å¹¶è¯•å›¾è·å–åŒä¸€ä¸ªé”ï¼Œå°±ä¼šå‘ç”Ÿæ­»é”ã€‚</p><p>ä¾èµ–äºé”çš„çŠ¶æ€ï¼šå‡½æ•°çš„æ‰§è¡Œä¾èµ–äºé”çš„çŠ¶æ€ã€‚å¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œå‡½æ•°å°±æ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå¿…é¡»ç­‰å¾…é”é‡Šæ”¾ã€‚è¿™ç§ä¾èµ–æ€§ä½¿å¾—å‡½æ•°åœ¨ä¸­æ–­åæ— æ³•å®‰å…¨åœ°å†æ¬¡è°ƒç”¨ã€‚</p><p>ä¸å¯é‡å…¥çš„è¡Œä¸ºï¼šç”±äºé”çš„å­˜åœ¨ï¼Œå‡½æ•°åœ¨ä¸­æ–­åé‡æ–°è¿›å…¥æ—¶å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†é”çš„çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´ä¸å¯é¢„æœŸçš„è¡Œä¸ºã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://www.geeksforgeeks.org/reentrant-function/">Reentrant Function</a></li><li><a href="https://en.wikipedia.org/wiki/Reentrancy_(computing)">Reentrancy</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> concepts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Network discovery</title>
      <link href="/blog/2024/01/09/net/%E7%BD%91%E7%BB%9C%E5%8F%91%E7%8E%B0/"/>
      <url>/blog/2024/01/09/net/%E7%BD%91%E7%BB%9C%E5%8F%91%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Get-IP-from-the-host-name"><a href="#Get-IP-from-the-host-name" class="headerlink" title="Get IP from the host name"></a>Get IP from the host name</h2><p>Key function: <code>getaddrinfo</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _POSIX_C_SOURCE 200112L</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;netdb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;strings.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">addrinfo</span> hints;</span><br><span class="line">    <span class="built_in">bzero</span>(&amp;hints, <span class="keyword">sizeof</span> hints);</span><br><span class="line">    <span class="comment">// hints.ai_family = AF_INET;</span></span><br><span class="line">    hints.ai_socktype = SOCK_STREAM;</span><br><span class="line">    hints.ai_protocol = IPPROTO_TCP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">addrinfo</span> *res = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// The following 3 hostnames are legal.</span></span><br><span class="line">    <span class="type">int</span> rc = <span class="built_in">getaddrinfo</span>(<span class="string">&quot;www.baidu.com&quot;</span>, <span class="literal">NULL</span>, &amp;hints, &amp;res);</span><br><span class="line">    <span class="comment">// int rc = getaddrinfo(&quot;localhost&quot;, NULL, &amp;hints, &amp;res);</span></span><br><span class="line">    <span class="comment">// int rc = getaddrinfo(&quot;PC-XXX&quot;, NULL, &amp;hints, &amp;res); // PC-XXX is a hostname</span></span><br><span class="line">    <span class="keyword">if</span> (rc != <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">perror</span>(<span class="string">&quot;getaddrinfo failed&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">struct</span> addrinfo* res_i = res; res_i != <span class="literal">NULL</span>; res_i = res_i-&gt;ai_next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res_i-&gt;ai_addr) &#123;</span><br><span class="line">            <span class="keyword">if</span> (res_i-&gt;ai_addr-&gt;sa_family == AF_INET) &#123;</span><br><span class="line">                <span class="type">char</span> ip4[INET_ADDRSTRLEN];</span><br><span class="line">                <span class="built_in">inet_ntop</span>(AF_INET, &amp;(((<span class="keyword">struct</span> sockaddr_in*)(res_i-&gt;ai_addr))-&gt;sin_addr), ip4, INET_ADDRSTRLEN);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;IP: %s\n&quot;</span>, ip4);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">char</span> ip6[INET6_ADDRSTRLEN];</span><br><span class="line">                <span class="built_in">inet_ntop</span>(AF_INET6, &amp;(((<span class="keyword">struct</span> sockaddr_in6*)(res_i-&gt;ai_addr))-&gt;sin6_addr), ip6, INET_ADDRSTRLEN);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;IP: %s\n&quot;</span>, ip6);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tcp/ip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ é¢„å¤„ç†</title>
      <link href="/blog/2024/01/07/cpp/C++%E9%A2%84%E5%A4%84%E7%90%86/"/>
      <url>/blog/2024/01/07/cpp/C++%E9%A2%84%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢„å®šä¹‰å®"><a href="#é¢„å®šä¹‰å®" class="headerlink" title="é¢„å®šä¹‰å®"></a>é¢„å®šä¹‰å®</h2><p><code>#if defined(__linux)</code><br><code>#ifdef LINUX2</code></p><h2 id="Cæ ‡å‡†é¢„å®šä¹‰å®"><a href="#Cæ ‡å‡†é¢„å®šä¹‰å®" class="headerlink" title="Cæ ‡å‡†é¢„å®šä¹‰å®"></a>Cæ ‡å‡†é¢„å®šä¹‰å®</h2><ul><li><code>__LINE__</code></li><li><code>__func__</code></li><li><code>__FILE__</code></li><li><code>NDEBUG</code>ï¼šå‚è€ƒ<a href="https://stackoverflow.com/questions/2290509/debug-vs-ndebug">_DEBUGå’ŒNDEBUGçš„åŒºåˆ«</a>ï¼Œå…¶ä¸­ï¼Œ<code>_DEBUG</code>æ˜¯Visual Studioå®šä¹‰çš„ï¼Œ<code>NDEBUG</code>æ˜¯C&#x2F;C++æ ‡å‡†ã€‚</li></ul><h2 id="GNU-Cé¢„å®šä¹‰å®"><a href="#GNU-Cé¢„å®šä¹‰å®" class="headerlink" title="GNU Cé¢„å®šä¹‰å®"></a>GNU Cé¢„å®šä¹‰å®</h2><p><a href="https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html">å®˜æ–¹æ–‡æ¡£</a></p><ul><li><p><code>__COUNTER__</code>: æ‰©å±•ä¸ºä»<code>0</code>å¼€å§‹çš„è¿ç»­æ•´æ•°å€¼ï¼Œæ¯æ¬¡åœ¨æºç ä¸­å‡ºç°ï¼Œåˆ™åŠ <code>1</code>ã€‚ä¸åŒæºæ–‡ä»¶çš„<code>__COUNTER__</code>äº’ä¸å½±å“ã€‚</p><p>å¯ä»¥ç”¨æ¥ç”Ÿæˆå”¯ä¸€çš„å‘½åã€‚<br>å‚è€ƒ<a href="https://stackoverflow.com/questions/652815/has-anyone-ever-had-a-use-for-the-counter-pre-processor-macro">é“¾æ¥</a>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CONCAT_IMPL(x,y) x##y</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CONCAT(x,y) CONCAT_IMPL(x,y)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> VAR(name) CONCAT(name,__COUNTER__)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">VAR</span><span class="params">(myvar)</span></span>; <span class="comment">// å±•å¼€ä¸º int myvar0;</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">VAR</span><span class="params">(myvar)</span></span>; <span class="comment">// å±•å¼€ä¸º int myvar1;</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">VAR</span><span class="params">(myvar)</span></span>; <span class="comment">// å±•å¼€ä¸º int myvar2;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>program_invocation_name</code>ï¼šå‚è€ƒ<a href="https://man7.org/linux/man-pages/man3/program_invocation_name.3.html">man page</a></p></li><li></li></ul><h2 id="pragma"><a href="#pragma" class="headerlink" title="#pragma"></a>#pragma</h2><h3 id="pragma-weak"><a href="#pragma-weak" class="headerlink" title="#pragma weak"></a>#pragma weak</h3><h4 id="Synopsis"><a href="#Synopsis" class="headerlink" title="Synopsis"></a>Synopsis</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> weak function-name1 [= function-name2]</span></span><br></pre></td></tr></table></figure><p><code>#pragma weak</code> means that even if the definition of the symbol is not found, no error will be reported.</p><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// It is not an error for symbol to never be defined at all.</span></span><br><span class="line"><span class="comment">// Without this line, the address of &quot;foo&quot; will always evaluate to &quot;true&quot;,</span></span><br><span class="line"><span class="comment">// so the linker will report an &quot;undefined reference to &#x27;foo&#x27;&quot; error.</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> weak foo</span></span><br><span class="line"><span class="comment">// The declaration is needed.</span></span><br><span class="line"><span class="comment">/* extern */</span> <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (foo)</span><br><span class="line">        <span class="built_in">foo</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Reference: <a href="https://alberand.com/weak-directive.html">1</a>ã€<a href="https://gcc.gnu.org/onlinedocs/gcc-4.5.4/gcc/Weak-Pragmas.html">2</a>ã€<a href="https://docs.oracle.com/cd/E19059-01/wrkshp50/805-4955/auto6/index.html">3</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»ºä¸ªäººç½‘ç«™</title>
      <link href="/blog/2024/01/03/personal_site/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/"/>
      <url>/blog/2024/01/03/personal_site/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E7%BD%91%E7%AB%99/</url>
      
        <content type="html"><![CDATA[<h2 id="Host-site"><a href="#Host-site" class="headerlink" title="Host site"></a>Host site</h2><p>æœ‰ä¸¤ä¸ªæ‰˜ç®¡ä¸ªäººç«™ç‚¹çš„ç½‘ç«™ï¼š<code>Github pages</code>å’Œ<code>reathedocs</code>.</p><h3 id="Github-Pages"><a href="#Github-Pages" class="headerlink" title="Github Pages"></a>Github Pages</h3><p>ä½¿ç”¨<a href="https://docs.github.com/en/pages">github pages</a>å¯ä»¥æ­å»ºä¸ªäººä¸»é¡µã€‚</p><p>github pagesç®€ä»‹ï¼š<a href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages">å®˜æ–¹é“¾æ¥</a>ã€‚</p><p>github pagesä½¿ç”¨äº†<a href="https://en.wikipedia.org/wiki/CNAME_record">CNAME record</a>æŠ€æœ¯ï¼Œå‚è€ƒï¼š<a href="https://www.zhihu.com/question/39301250">é“¾æ¥1</a>ã€<a href="https://www.zhihu.com/question/26609475">é“¾æ¥2</a>ã€<a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages#using-a-subdomain-for-your-github-pages-site">Custom domains in Github Pages</a>ã€‚</p><p>æ³¨ï¼š<a href="https://readthedocs.org/">Read the Docs</a>ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ­å»ºä¸ªäººä¸»é¡µçš„ç½‘ç«™ã€‚</p><h4 id="Github-Pages-ç«™ç‚¹ç±»å‹"><a href="#Github-Pages-ç«™ç‚¹ç±»å‹" class="headerlink" title="Github Pages ç«™ç‚¹ç±»å‹"></a>Github Pages ç«™ç‚¹ç±»å‹</h4><p>æœ‰3ç§ç±»å‹çš„ Github Pages ç«™ç‚¹ï¼ˆsitesï¼‰ï¼šproject, user å’Œ organization ã€‚</p><p>Project sites è¿æ¥åˆ° github ä¸Šç‰¹å®š project ï¼Œæ¯”å¦‚ Javascript library æˆ– recipe collectionã€‚user æˆ– organization sites è¿æ¥åˆ° github.com çš„ç‰¹å®šè´¦æˆ·ã€‚</p><p>å‘å¸ƒ user site ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªä½ çš„ä¸ªäººè´¦æˆ·ä¸‹çš„ä¸€ä¸ªåä¸º <code>&lt;username&gt;.github.io</code> çš„ repository ã€‚å‘å¸ƒ organization site ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªç»„ç»‡æ‰€æœ‰çš„åä¸º <code>&lt;organization&gt;.github.io</code> çš„ repository ã€‚é™¤éä½ ä½¿ç”¨ custom domain ï¼Œå¦åˆ™ user å’Œ organization sites å°†ä½äº <code>http(s)://&lt;username&gt;.github.io</code> æˆ– <code>http(s)://&lt;organization&gt;.github.io</code> ã€‚</p><p>project site çš„æºæ–‡ä»¶å­˜å‚¨åœ¨ä½œä¸º project çš„ç›¸åŒçš„ repository ä¸­ã€‚é™¤éä½¿ç”¨ custom domain ï¼Œ å¦åˆ™ project sites å°†ä½äº <code>http(s)://&lt;username&gt;.github.io/&lt;repository&gt;</code> æˆ– <code>http(s)://&lt;organization&gt;.github.io/&lt;repository&gt;</code> ã€‚</p><p>æœ‰å…³å¦‚ä½•è‡ªå®šä¹‰å½±å“æ‚¨ç½‘ç«™çš„åŸŸåçš„æ›´å¤šä¿¡æ¯ï¼Œå‚è§â€<a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site/about-custom-domains-and-github-pages">About custom domains and GitHub Pages</a>â€œã€‚</p><p>æ¯ä¸ª github è´¦æˆ·å…è®¸åˆ›å»º 1 ä¸ª user æˆ– organization ç«™ç‚¹ã€‚æ— è®ºæ˜¯è¢«ç»„ç»‡è¿˜æ˜¯ä¸ªäººæ‰€æœ‰ï¼Œproject ç«™ç‚¹çš„ä¸ªæ•°ä¸é™åˆ¶ã€‚</p><h4 id="GitHub-Pages-è®¿é—®æ–¹æ³•"><a href="#GitHub-Pages-è®¿é—®æ–¹æ³•" class="headerlink" title="GitHub Pages è®¿é—®æ–¹æ³•"></a>GitHub Pages è®¿é—®æ–¹æ³•</h4><p>å‚è€ƒ<a href="https://docs.github.com/en/pages/getting-started-with-github-pages/creating-a-github-pages-site#next-steps">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>ä¾‹å¦‚ï¼Œä½ çš„projectç«™ç‚¹é…ç½®çš„å‘å¸ƒæºæ˜¯<code>gh-pages</code>åˆ†æ”¯ï¼Œç„¶ååœ¨<code>gh-pages</code>åˆ†æ”¯ä¸Šåˆ›å»ºäº†ä¸€ä¸ª<code>about/contact-us.md</code>æ–‡ä»¶ï¼Œä½ å°†å¯ä»¥åœ¨<code>https://&lt;user&gt;.github.io/&lt;repository&gt;/about/contact-us.html</code>è®¿é—®å®ƒã€‚</p><p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<code>Jekyll</code>ç­‰é™æ€ç«™ç‚¹ç”Ÿæˆå™¨æ¥ç»™ä½ çš„github pageé…ç½®ä¸€ä¸ªä¸»é¢˜ã€‚</p><h4 id="ç«™ç‚¹å‘å¸ƒå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•"><a href="#ç«™ç‚¹å‘å¸ƒå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•" class="headerlink" title="ç«™ç‚¹å‘å¸ƒå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•"></a>ç«™ç‚¹å‘å¸ƒå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•</h4><ul><li><a href="https://stackoverflow.com/questions/72851548/permission-denied-to-github-actionsbot">Permission denied to github-actions[bot]</a></li></ul><h4 id="Github-workflows"><a href="#Github-workflows" class="headerlink" title="Github workflows"></a>Github workflows</h4><p>å‚è€ƒ<a href="https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><h4 id="Githubä¸ªäººè®¿é—®ä»¤ç‰Œ"><a href="#Githubä¸ªäººè®¿é—®ä»¤ç‰Œ" class="headerlink" title="Githubä¸ªäººè®¿é—®ä»¤ç‰Œ"></a>Githubä¸ªäººè®¿é—®ä»¤ç‰Œ</h4><p><a href="https://docs.github.com/zh/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens">Githubä¸ªäººè®¿é—®ä»¤ç‰Œ</a></p><h3 id="readthedocs"><a href="#readthedocs" class="headerlink" title="readthedocs"></a>readthedocs</h3><p>Similar to the github pages.</p><p><a href="https://docs.readthedocs.io/en/stable/tutorial/">Tutorial</a></p><h2 id="é…ç½®å‰å‡†å¤‡"><a href="#é…ç½®å‰å‡†å¤‡" class="headerlink" title="é…ç½®å‰å‡†å¤‡"></a>é…ç½®å‰å‡†å¤‡</h2><h3 id="Markdownç¼–è¾‘å™¨"><a href="#Markdownç¼–è¾‘å™¨" class="headerlink" title="Markdownç¼–è¾‘å™¨"></a>Markdownç¼–è¾‘å™¨</h3><p>æ¨èçš„<a href="https://www.zhihu.com/tardis/zm/art/103348449?source_id=1003">markdownç¼–è¾‘å™¨</a>ï¼š</p><ul><li>VSCodeï¼šå…è´¹ã€‚VSCodeåŸç”Ÿæ”¯æŒMarkdownï¼Œå®‰è£…ä¸€äº›æ’ä»¶å¯ä»¥å¸®åŠ©æ›´å¿«åœ°ç¼–å†™markdownæ–‡ä»¶ã€‚</li><li>Typoraï¼šç°åœ¨å·²ç»å¼€å§‹æ”¶è´¹ã€‚</li></ul><p>VSCode markdownæ’ä»¶ï¼š</p><ul><li>Mardown All in One: æä¾›å¿«æ·é”®ï¼Œå¸®åŠ©æ›´å¿«çš„ç¼–å†™markdownæ–‡ä»¶ã€‚</li><li>Markdown+Mathï¼šæä¾›æ•°å­¦å…¬å¼æ”¯æŒã€‚</li><li>Markdown Preview Enhanced: å°†åŸç”Ÿmarkdowné¢„è§ˆçš„é»‘è‰²èƒŒæ™¯æ”¹æˆç™½è‰²ã€‚</li><li>Markdown Preview Github Stylingï¼šæä¾›Githubé£æ ¼çš„é¢„è§ˆã€‚</li></ul><p><a href="https://www.tablesgenerator.com/markdown_tables">åœ¨çº¿è¡¨æ ¼ç”Ÿæˆå™¨</a>ï¼šå¯ä»¥ç”ŸæˆMarkdownã€Textã€HTMLã€LaTexã€MediaWikiæ ¼å¼çš„è¡¨æ ¼ã€‚</p><h3 id="è½»é‡çº§è™šæ‹ŸæœºWSL"><a href="#è½»é‡çº§è™šæ‹ŸæœºWSL" class="headerlink" title="è½»é‡çº§è™šæ‹ŸæœºWSL"></a>è½»é‡çº§è™šæ‹ŸæœºWSL</h3><p>WSLï¼Œ<a href="https://learn.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a>ï¼Œæ˜¯Windowsæä¾›çš„è½»é‡çº§Linuxè™šæ‹Ÿæœºã€‚</p><p>å®‰è£…æ•™ç¨‹ï¼šè§<a href="https://zhuanlan.zhihu.com/p/170210673">é“¾æ¥</a>ã€‚</p><h4 id="WSLé»˜è®¤æ²¡æœ‰å¯ç”¨systemctlï¼š"><a href="#WSLé»˜è®¤æ²¡æœ‰å¯ç”¨systemctlï¼š" class="headerlink" title="WSLé»˜è®¤æ²¡æœ‰å¯ç”¨systemctlï¼š"></a>WSLé»˜è®¤æ²¡æœ‰å¯ç”¨systemctlï¼š</h4><p>å¯ç”¨systemctlçš„æ–¹æ³•ï¼š<a href="https://askubuntu.com/questions/1379425/system-has-not-been-booted-with-systemd-as-init-system-pid-1-cant-operate">é“¾æ¥</a>ã€‚</p><p>æ›¿ä»£æ–¹æ³•ï¼šä¸éœ€è¦å¯åŠ¨systemctlï¼Œå› ä¸ºä¼šæ¯”è¾ƒå ç”¨èµ„æºï¼Œå¯åŠ¨ä¹Ÿä¼šå˜æ…¢ã€‚å¯ä»¥ä½¿ç”¨serviceå‘½ä»¤æ›¿ä»£ã€‚</p><h4 id="WSLé»˜è®¤æ²¡æœ‰å®‰è£…openssl-serverï¼š"><a href="#WSLé»˜è®¤æ²¡æœ‰å®‰è£…openssl-serverï¼š" class="headerlink" title="WSLé»˜è®¤æ²¡æœ‰å®‰è£…openssl-serverï¼š"></a>WSLé»˜è®¤æ²¡æœ‰å®‰è£…openssl-serverï¼š</h4><p>ä½¿ç”¨sshè¿æ¥åˆ°æœåŠ¡å™¨æ—¶ï¼Œéœ€è¦æœåŠ¡å™¨è¿è¡Œç€sshdç¨‹åºï¼Œå¦åˆ™è¿æ¥ä¸ä¸Šï¼Œä¼šå‡ºç°â€<a href="https://www.makeuseof.com/fix-ssh-connection-refused-error-linux/">Connection refused</a>â€œé”™è¯¯ã€‚</p><p>å‚è€ƒ<a href="https://askubuntu.com/questions/1339980/enable-ssh-in-wsl-system">é“¾æ¥</a>ã€‚</p><p>æŸ¥çœ‹openssh-serveræœ‰æ²¡æœ‰å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list | grep ssh</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šå¦‚æœå®‰è£…äº†openssh-serverï¼Œæ‰§è¡Œwhich sshdå¯ä»¥çœ‹åˆ°è·¯å¾„ã€‚</p><p>WSLé»˜è®¤æ²¡æœ‰å®‰è£…openssh-serverï¼Œå®‰è£…æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure><p>å¯åŠ¨sshï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh start</span><br></pre></td></tr></table></figure><h4 id="ssh-keygen"><a href="#ssh-keygen" class="headerlink" title="ssh-keygen"></a>ssh-keygen</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤é”™è¯¯çš„ know_hosts é¡¹</span></span><br><span class="line">ssh-keygen -f <span class="string">&quot;/home/&lt;user&gt;/.ssh/known_hosts&quot;</span> -R <span class="string">&quot;ubuntu&quot;</span></span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡httpsç™»å½•åˆ°github"><a href="#é€šè¿‡httpsç™»å½•åˆ°github" class="headerlink" title="é€šè¿‡httpsç™»å½•åˆ°github"></a>é€šè¿‡httpsç™»å½•åˆ°github</h4><p><code>git push</code>ä¸å†æ”¯æŒè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå½“æç¤ºè¾“å…¥å¯†ç æ—¶ï¼Œéœ€è¦è¾“å…¥personal access token.</p><p>æ­¥éª¤1ï¼šåœ¨githubä¸Š<a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic">åˆ›å»ºpersonal access token</a>ï¼›</p><p>æ­¥éª¤2ï¼š<a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#using-a-personal-access-token-on-the-command-line">åœ¨å‘½ä»¤è¡Œä¸Šä½¿ç”¨personal access token</a>ï¼›</p><p>æ­¥éª¤3ï¼šä¸ºäº†é¿å…æ¯æ¬¡éƒ½éœ€è¦è¾“å…¥personal access tokenï¼Œå¯ä»¥å°†å…¶<a href="https://docs.github.com/en/get-started/getting-started-with-git/caching-your-github-credentials-in-git">ç¼“å­˜åœ¨git clientä¸Š</a>ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gh auth login</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šä½¿ç”¨<code>gh</code>å‘½ä»¤éœ€è¦å…ˆå®‰è£…GitHub CLIï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gh</span><br></pre></td></tr></table></figure><h3 id="WSLå¸¸è§é—®é¢˜"><a href="#WSLå¸¸è§é—®é¢˜" class="headerlink" title="WSLå¸¸è§é—®é¢˜"></a>WSLå¸¸è§é—®é¢˜</h3><ul><li><a href="https://stackoverflow.com/questions/73673804/npm-show-npm-elf-not-found-error-in-wsl">npm show â€œNPM ELF : not found errorâ€ in WSL</a></li><li><a href="https://www.reddit.com/r/bashonubuntuonwindows/comments/8teo9i/is_there_a_way_to_open_a_file_in_a_browser_from/">WSLæ‰“å¼€htmlçš„æ–¹æ³•</a></li></ul><p>åœ¨WSLçš„Linuxä¸‹ï¼Œåœ¨.bashrcä¸­åŠ å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">browser</span></span>() &#123;</span><br><span class="line">    explorer.exe $(wslpath -w $(<span class="built_in">realpath</span> <span class="variable">$1</span>))</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">export</span> -f browser</span><br></pre></td></tr></table></figure><p>æ‰“å¼€htmlï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">browser index.html</span><br></pre></td></tr></table></figure><h2 id="é™æ€ç«™ç‚¹ç”Ÿæˆå™¨"><a href="#é™æ€ç«™ç‚¹ç”Ÿæˆå™¨" class="headerlink" title="é™æ€ç«™ç‚¹ç”Ÿæˆå™¨"></a>é™æ€ç«™ç‚¹ç”Ÿæˆå™¨</h2><p>ä»¥ä¸‹å‡ ç§<a href="https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages">é™æ€ç«™ç‚¹ç”Ÿæˆå™¨</a>éƒ½å¯ä»¥ç”¨æ¥æ­å»ºä¸ªäººä¸»é¡µã€‚å¦‚æœä½¿ç”¨é™¤JekyIIå¤–çš„å·¥å…·ï¼Œåˆ™éœ€è¦é…ç½®<a href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions">Github Actions</a>ä»¥æ„å»ºå’Œå‘å¸ƒä½ çš„ç«™ç‚¹ã€‚</p><h3 id="mkdocs"><a href="#mkdocs" class="headerlink" title="mkdocs"></a>mkdocs</h3><p><a href="https://www.mkdocs.org/">mkdocs</a>æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„é™æ€ç½‘é¡µç”Ÿæˆå™¨ã€‚</p><p><code>mkdocs.yml</code> æ–‡ä»¶æ˜¯ MkDocs æ–‡æ¡£ç”Ÿæˆå™¨çš„é…ç½®æ–‡ä»¶ï¼Œå…¶æ ¼å¼è¯´æ˜å‚è§<a href="mkdocs.yml.md">è¿™é‡Œ</a>ã€‚</p><h3 id="JekyII"><a href="#JekyII" class="headerlink" title="JekyII"></a>JekyII</h3><p>Jekyll æ˜¯ä¸€ä¸ªé™æ€ç«™ç‚¹ç”Ÿæˆå™¨ï¼Œå†…ç½®å¯¹ GitHub Pages çš„æ”¯æŒå’Œç®€åŒ–çš„æ„å»ºè¿›ç¨‹ã€‚</p><p>å‚è§ <a href="https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/about-github-pages-and-jekyll">About GitHub Pages and Jekyll</a> ã€‚</p><h3 id="Hexo"><a href="#Hexo" class="headerlink" title="Hexo"></a>Hexo</h3><ul><li><a href="https://hexo.io/docs/">Hexoåšå®¢æ¡†æ¶</a></li><li><a href="https://hexo.io/zh-cn/docs/">Hexoä¸­æ–‡æ–‡æ¡£</a></li><li><a href="https://malekbenz.com/blog/2016/09/10/Create-Host-Blog-for-free-with-Hexo-Github">Create and host your blog for free with hexo &amp; Github</a></li></ul><h3 id="Sphinx"><a href="#Sphinx" class="headerlink" title="Sphinx"></a>Sphinx</h3><p><a href="https://www.sphinx-doc.org/en/master/usage/installation.html">Install Sphinx</a><br><a href="https://sphinx-intro-tutorial.readthedocs.io/en/latest/docs_hosting.html">Hosting the documentation</a></p><h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>pythonå»ºç«‹ä¸ªäººç«™ç‚¹</p><pre><code>python -m http.server</code></pre><h2 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h2><h3 id="Markdown"><a href="#Markdown" class="headerlink" title="Markdown"></a>Markdown</h3><ul><li><a href="https://daringfireball.net/projects/markdown">Markdown Documentation</a></li><li><a href="https://squidfunk.github.io/mkdocs-material/reference/diagrams/">Diagrams Reference</a></li></ul><h3 id="reStructuredText"><a href="#reStructuredText" class="headerlink" title="reStructuredText"></a>reStructuredText</h3><p><code>.rst</code></p><h2 id="å¤§å‹æ–‡ä»¶å­˜å‚¨"><a href="#å¤§å‹æ–‡ä»¶å­˜å‚¨" class="headerlink" title="å¤§å‹æ–‡ä»¶å­˜å‚¨"></a>å¤§å‹æ–‡ä»¶å­˜å‚¨</h2><h3 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h3><p>Postimages</p><ul><li>ç½‘ç«™: <a href="https://postimages.org/">https://postimages.org/</a></li><li>ç‰¹ç‚¹:</li><li>é€‚åˆå¿«é€Ÿä¸Šä¼ å’Œç”Ÿæˆå›¾ç‰‡é“¾æ¥ã€‚</li><li>ä¸éœ€è¦æ³¨å†Œï¼Œå¯ä»¥ç›´æ¥ä¸Šä¼ å›¾ç‰‡å¹¶è·å¾—é“¾æ¥ã€‚</li><li>æä¾›å›¾ç‰‡ç¼©ç•¥å›¾å’Œç›´æ¥é“¾æ¥ã€‚</li><li>ä¸Šä¼ åå›¾ç‰‡ä¼šé•¿æœŸå­˜å‚¨ï¼Œé€‚ç”¨äºç½‘ç«™å’Œåšå®¢å›¾ç‰‡æ‰˜ç®¡ã€‚</li></ul><h3 id="è§†é¢‘"><a href="#è§†é¢‘" class="headerlink" title="è§†é¢‘"></a>è§†é¢‘</h3><p>TinyPic (ç”± Photobucket æä¾›)</p><ul><li>ç½‘ç«™: <a href="https://tinypic.com/">https://tinypic.com/</a></li><li>ç‰¹ç‚¹:</li><li>æ”¯æŒä¸Šä¼ å¹¶ç”Ÿæˆå¿«é€Ÿå…±äº«é“¾æ¥ã€‚</li><li>ä¸Šä¼ åï¼Œé“¾æ¥å¯ä»¥åµŒå…¥åˆ°ç¤¾äº¤åª’ä½“ã€è®ºå›ã€åšå®¢ä¸­ã€‚</li><li>å›¾ç‰‡å’Œè§†é¢‘éƒ½æ”¯æŒæ‰˜ç®¡ï¼Œä½†TinyPicå·²å…³é—­ï¼Œç°ç”±PhotobucketæœåŠ¡æ¥ç®¡ã€‚</li></ul><h3 id="Git-LFS"><a href="#Git-LFS" class="headerlink" title="Git LFS"></a>Git LFS</h3><p>GitHub æä¾›çš„ç”¨äºå­˜å‚¨å¤§å‹æ–‡ä»¶çš„æœåŠ¡å« Git LFSï¼ˆGit Large File Storageï¼‰ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯-Git-LFSï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Git-LFSï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Git LFSï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Git LFSï¼Ÿ</h4><p>Git LFS æ˜¯ä¸€ä¸ª Git æ‰©å±•ï¼Œç”¨äºå¤„ç† Git ä»“åº“ä¸­çš„å¤§å‹æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ç­‰ï¼‰ï¼Œå®ƒé€šè¿‡å°†å¤§å‹æ–‡ä»¶å­˜å‚¨åœ¨ GitHub çš„ç‹¬ç«‹å­˜å‚¨åŒºæ¥è§£å†³ Git çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h4 id="Git-LFS-çš„å…è´¹é¢åº¦ï¼š"><a href="#Git-LFS-çš„å…è´¹é¢åº¦ï¼š" class="headerlink" title="Git LFS çš„å…è´¹é¢åº¦ï¼š"></a>Git LFS çš„å…è´¹é¢åº¦ï¼š</h4><p>GitHub ä¸ºå…è´¹è´¦æˆ·æä¾›ä¸€å®šçš„ LFS å­˜å‚¨å’Œå¸¦å®½é¢åº¦ï¼š</p><p>å…è´¹å­˜å‚¨ï¼šæ¯ä¸ª GitHub è´¦æˆ·æä¾› 1GB çš„ LFS å­˜å‚¨ã€‚</p><p>å…è´¹å¸¦å®½ï¼šæ¯ä¸ªæœˆ 1GB çš„ä¸‹è½½å¸¦å®½ã€‚</p><p>å¦‚æœè¶…å‡ºå…è´¹é¢åº¦ï¼Œä½ å¯ä»¥é€‰æ‹©è´­ä¹°æ›´å¤šçš„å­˜å‚¨å’Œå¸¦å®½ã€‚</p><h4 id="Git-LFS-çš„å·¥ä½œåŸç†ï¼š"><a href="#Git-LFS-çš„å·¥ä½œåŸç†ï¼š" class="headerlink" title="Git LFS çš„å·¥ä½œåŸç†ï¼š"></a>Git LFS çš„å·¥ä½œåŸç†ï¼š</h4><p>æ–‡ä»¶æ›¿ä»£ï¼šGit LFS ç”¨ä¸€ä¸ªæŒ‡å‘å¤§æ–‡ä»¶çš„æŒ‡é’ˆæ¥æ›¿ä»£æ–‡ä»¶å†…å®¹ï¼Œå°†æ–‡ä»¶æœ¬èº«å­˜å‚¨åœ¨ GitHub æä¾›çš„ LFS å­˜å‚¨ç©ºé—´ä¸­ã€‚</p><p>æ–‡ä»¶å­˜å‚¨ï¼šå®é™…çš„æ–‡ä»¶å†…å®¹å­˜å‚¨åœ¨ GitHub çš„ LFS å­˜å‚¨ä¸­ï¼ŒGit åªä¼šç®¡ç†è¿™äº›æ–‡ä»¶çš„æŒ‡é’ˆã€‚</p><p>ä¸‹è½½&#x2F;ä¸Šä¼ ï¼šå½“ä½ ä»ä»“åº“å…‹éš†æˆ–æ‹‰å–ä»£ç æ—¶ï¼ŒGit LFS ä¼šè‡ªåŠ¨ä¸‹è½½å¤§æ–‡ä»¶ï¼Œåä¹‹ï¼Œå½“ä½ æäº¤å¤§æ–‡ä»¶æ—¶ï¼ŒGit LFS ä¼šå°†å…¶ä¸Šä¼ åˆ° GitHubã€‚</p><h4 id="å¦‚ä½•ä½¿ç”¨-Git-LFSï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨-Git-LFSï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨ Git LFSï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨ Git LFSï¼Ÿ</h4><ol><li>å®‰è£… Git LFSï¼š<br>é¦–å…ˆéœ€è¦å®‰è£… Git LFSï¼Œå¯ä»¥é€šè¿‡ Git LFS å®˜æ–¹ç½‘ç«™ ä¸‹è½½å’Œå®‰è£…ã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git lfs install</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆå§‹åŒ– Git LFSï¼š<br>åœ¨ä½ çš„ Git ä»“åº“ä¸­åˆå§‹åŒ– Git LFSã€‚</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git lfs track <span class="string">&quot;*.jpg&quot;</span>   <span class="comment"># ä¾‹å¦‚è·Ÿè¸ªæ‰€æœ‰ jpg æ ¼å¼çš„å›¾ç‰‡</span></span><br><span class="line">git add .gitattributes   <span class="comment"># æ·»åŠ  .gitattributes æ–‡ä»¶</span></span><br><span class="line">git add &lt;large-file&gt;     <span class="comment"># æ·»åŠ å¤§å‹æ–‡ä»¶</span></span><br><span class="line">git commit -m <span class="string">&quot;Add large file&quot;</span></span><br><span class="line">git push origin main     <span class="comment"># æ¨é€åˆ° GitHub</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ Git LFS è¿›è¡Œæäº¤ï¼š<br>æ¯æ¬¡æäº¤æ—¶ï¼ŒGit LFS ä¼šè‡ªåŠ¨å¤„ç†å¤§æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä¸Šä¼ åˆ° GitHub LFS å­˜å‚¨åŒºã€‚</li></ol><h5 id="ä¼˜åŠ¿ï¼š"><a href="#ä¼˜åŠ¿ï¼š" class="headerlink" title="ä¼˜åŠ¿ï¼š"></a>ä¼˜åŠ¿ï¼š</h5><p>å‡å°‘ä»“åº“ä½“ç§¯ï¼šé€šè¿‡å°†å¤§æ–‡ä»¶å­˜å‚¨åœ¨ Git LFS ä¸­ï¼Œå¯ä»¥é¿å…å°†å¤§æ–‡ä»¶ç›´æ¥å­˜å‚¨åœ¨ Git ä»“åº“ä¸­ï¼Œä»è€Œæé«˜ Git çš„æ€§èƒ½ã€‚</p><p>é€‚ç”¨äºå¤§æ–‡ä»¶ï¼šé€‚åˆç®¡ç†å›¾åƒã€è§†é¢‘ã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰å¤§å‹æ–‡ä»¶ï¼Œé¿å… Git å…‹éš†å’Œæ‹‰å–è¿‡ç¨‹å˜å¾—è¿‡äºç¼“æ…¢ã€‚</p><h4 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h4><p>Git LFS æ˜¯ GitHub æä¾›çš„ç”¨äºç®¡ç†å’Œå­˜å‚¨å¤§å‹æ–‡ä»¶çš„æ‰©å±•æœåŠ¡ï¼Œé€‚åˆå­˜å‚¨éœ€è¦é¢‘ç¹æ›´æ”¹æˆ–ç®¡ç†çš„å¤§æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰ï¼‰ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> site </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown Syntax</title>
      <link href="/blog/2024/01/03/personal_site/Markdown-Syntax/"/>
      <url>/blog/2024/01/03/personal_site/Markdown-Syntax/</url>
      
        <content type="html"><![CDATA[<h2 id="Mermaid"><a href="#Mermaid" class="headerlink" title="Mermaid"></a>Mermaid</h2><p><a href="https://mermaid.js.org/syntax/flowchart.html">Flowchart</a></p><h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><h3 id="è½¬ä¹‰åå¼•å·"><a href="#è½¬ä¹‰åå¼•å·" class="headerlink" title="è½¬ä¹‰åå¼•å·"></a>è½¬ä¹‰åå¼•å·</h3><p>å‚è€ƒ<a href="https://www.growingwiththeweb.com/2015/06/escaping-backtick-in-markdown.html">é“¾æ¥</a>ã€‚</p><ol><li>åœ¨code blockä¹‹å¤–ï¼Œä½¿ç”¨â€&quot;è½¬ä¹‰å³å¯ï¼š</li></ol><pre>\`</pre><ol start="2"><li>ç”¨å°†åå¼•å·æ”¾å…¥åŒåå¼•å·ä¸­ï¼Œå³</li></ol><pre>`` ` ``</pre><ol start="3"><li>åœ¨ä»£ç å—å¼€å§‹å‰ç¼©è¿›4ä¸ªç©ºæ ¼ï¼Œå³</li></ol><pre>    `</pre><ol start="4"><li>ä½¿ç”¨fencedä»£ç å—ï¼š</li></ol><pre>```<br>`<br>```</pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://www.jetbrains.com/help/hub/markdown-syntax.html">JetBrains: Markdown Syntax</a></li><li><a href="https://www.markdownguide.org/extended-syntax/">Markdown Guide: Extended Syntax</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Book List</title>
      <link href="/blog/2024/01/01/misc/Book-List/"/>
      <url>/blog/2024/01/01/misc/Book-List/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¨èä¹¦ç±"><a href="#æ¨èä¹¦ç±" class="headerlink" title="æ¨èä¹¦ç±"></a>æ¨èä¹¦ç±</h2><ol><li>å¤šäººåœ¨çº¿æ¸¸æˆæ¶æ„å®æˆ˜ï¼šåŸºäºC++çš„åˆ†å¸ƒå¼æ¸¸æˆç¼–ç¨‹&#x2F;å½­æ”¾ç¼–è‘—. â€“åŒ—äº¬ï¼šæœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2020.11 ï¼ˆISBN 978-7-111-66792-6ï¼‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> book </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm</title>
      <link href="/blog/2023/12/29/personal_site/npm/"/>
      <url>/blog/2023/12/29/personal_site/npm/</url>
      
        <content type="html"><![CDATA[<h2 id="Options"><a href="#Options" class="headerlink" title="Options"></a>Options</h2><p><code>npm root</code> - Current installation root path.<br><code>npm root -g</code> - The global installation root path.<br><code>npm uninstall</code> - After executing this command, you should also remove the items in the <code>package.json</code> file and delete the <code>package-lock.json</code> file and the <code>node_modules</code> directory.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/5926672/where-does-npm-install-packages">Where does npm install packages?</a><br><a href="https://stackoverflow.com/questions/66978786/cannot-uninstall-two-npm-packages">Cannot Uninstall two npm Packages</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œæ£€æµ‹å·¥å…·</title>
      <link href="/blog/2023/12/29/net/%E7%BD%91%E7%BB%9C%E6%8E%A2%E6%B5%8B%E5%B7%A5%E5%85%B7/"/>
      <url>/blog/2023/12/29/net/%E7%BD%91%E7%BB%9C%E6%8E%A2%E6%B5%8B%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre><code>sudo apt install net-tools</code></pre><h2 id="æ‰‹å†Œ"><a href="#æ‰‹å†Œ" class="headerlink" title="æ‰‹å†Œ"></a>æ‰‹å†Œ</h2><pre><code>man 7 socket - socket optionsman 7 tcp - tcp options</code></pre><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><pre><code>/proc/sys/net/ipv4/ip_local_port_range</code></pre><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="ç½‘å…³ï¼ˆGatewayï¼‰"><a href="#ç½‘å…³ï¼ˆGatewayï¼‰" class="headerlink" title="ç½‘å…³ï¼ˆGatewayï¼‰"></a>ç½‘å…³ï¼ˆGatewayï¼‰</h3><p>ç½‘å…³ï¼ˆGatewayï¼‰æ˜¯ä¸€ä¸ªç½‘ç»œèŠ‚ç‚¹ï¼Œå®ƒå……å½“å…¶ä»–ç½‘ç»œä¹‹é—´çš„è®¿é—®ç‚¹æˆ–ç½‘å…³ã€‚ç½‘å…³é€šå¸¸ç”¨äºè¿æ¥ä¸åŒçš„ç½‘ç»œï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸åŒçš„åè®®ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ç½‘å…³è®¾å¤‡å¯ä»¥æ˜¯è·¯ç”±å™¨ã€æœåŠ¡å™¨æˆ–å…¶ä»–ç½‘ç»œè®¾å¤‡ã€‚å½“æœ¬åœ°ç½‘ç»œä¸­çš„è®¾å¤‡éœ€è¦ä¸å¤–éƒ¨ç½‘ç»œé€šä¿¡æ—¶ï¼Œå®ƒä»¬ä¼šå°†æ•°æ®åŒ…å‘é€åˆ°ç½‘å…³ï¼Œç½‘å…³å†å°†æ•°æ®åŒ…è½¬å‘åˆ°ç›®æ ‡ç½‘ç»œã€‚</p><p>ä¸¾ä¾‹ï¼š å‡è®¾ä½ çš„æœ¬åœ°ç½‘ç»œä½¿ç”¨çš„IPåœ°å€èŒƒå›´æ˜¯192.168.1.0&#x2F;24ï¼Œè€Œä½ çš„ç½‘å…³IPåœ°å€æ˜¯192.168.1.1ã€‚å½“ä½ çš„è®¡ç®—æœºéœ€è¦è®¿é—®å¤–éƒ¨ç½‘ç»œï¼ˆä¾‹å¦‚äº’è”ç½‘ï¼‰æ—¶ï¼Œå®ƒä¼šå°†æ•°æ®åŒ…å‘é€åˆ°ç½‘å…³ï¼ˆ192.168.1.1ï¼‰ï¼Œç„¶åç”±ç½‘å…³å°†æ•°æ®åŒ…è½¬å‘åˆ°ç›®æ ‡ç½‘ç»œã€‚</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>ip route</code>å‘½ä»¤æŸ¥çœ‹é»˜è®¤ç½‘å…³ã€‚ä¾‹å¦‚ï¼š</p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>default via 192.168.1.1 dev eth0</code>è¡¨ç¤ºé»˜è®¤ç½‘å…³æ˜¯<code>192.168.1.1</code>ï¼Œä½ çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œæ¥å£<code>eth0</code>ä¸ç½‘å…³è¿æ¥ã€‚</p><h3 id="å­ç½‘ï¼ˆCIDRè¡¨ç¤ºæ³•ï¼‰"><a href="#å­ç½‘ï¼ˆCIDRè¡¨ç¤ºæ³•ï¼‰" class="headerlink" title="å­ç½‘ï¼ˆCIDRè¡¨ç¤ºæ³•ï¼‰"></a>å­ç½‘ï¼ˆCIDRè¡¨ç¤ºæ³•ï¼‰</h3><p>CIDRï¼ˆClassless Inter-Domain Routingï¼Œæ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼‰æ˜¯ä¸€ç§ç”¨äºåˆ†é…IPåœ°å€å’Œè·¯ç”±çš„æ ‡å‡†ï¼Œä½¿ç”¨æ–œæ ï¼ˆ&#x2F;ï¼‰åè·Ÿä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºå­ç½‘æ©ç çš„ä½æ•°ã€‚</p><p>åœ¨CIDRè¡¨ç¤ºæ³•ä¸­ï¼Œ<code>192.168.1.0/24</code>è¡¨ç¤ºä¸€ä¸ªå­ç½‘ï¼Œå…¶ä¸­<code>/24</code>è¡¨ç¤ºå­ç½‘æ©ç ä¸º255.255.255.0ã€‚è¿™æ„å‘³ç€å­ç½‘ä¸­æœ‰256ä¸ªIPåœ°å€ï¼ˆä»0åˆ°255ï¼‰ï¼Œä½†å…¶ä¸­ä¸¤ä¸ªåœ°å€æ˜¯ä¿ç•™çš„ï¼š</p><ol><li><strong>ç½‘ç»œåœ°å€</strong>ï¼š<code>192.168.1.0</code>ï¼Œç”¨äºæ ‡è¯†å­ç½‘æœ¬èº«ã€‚</li><li><strong>å¹¿æ’­åœ°å€</strong>ï¼š<code>192.168.1.255</code>ï¼Œç”¨äºå‘å­ç½‘ä¸­çš„æ‰€æœ‰è®¾å¤‡å‘é€å¹¿æ’­æ¶ˆæ¯ã€‚</li></ol><p>å› æ­¤ï¼Œæœ‰æ•ˆçš„ä¸»æœºIPåœ°å€èŒƒå›´æ˜¯ä»<code>192.168.1.1</code>åˆ°<code>192.168.1.254</code>ï¼Œå…±254ä¸ªå¯ç”¨çš„IPåœ°å€ã€‚</p><h3 id="Link-local-Adress"><a href="#Link-local-Adress" class="headerlink" title="Link-local Adress"></a>Link-local Adress</h3><p>The link-local address range refers to IP addresses that are used for communication within a single network segment or link. These addresses are not routable, meaning they are not intended to be used for communication beyond the local network segment.</p><p>For IPv4, the link-local address range is 169.254.0.0&#x2F;16. This range is automatically assigned to network interfaces when no other IP address is available (e.g., when DHCP fails). Devices on the same local network can communicate with each other using these addresses without requiring a router.</p><p>For IPv6, the link-local address range is fe80::&#x2F;10. These addresses are automatically configured on all IPv6-enabled interfaces and are used for local network communication.</p><p>The IP address range 169.254.0.0&#x2F;16 is regarded as link-local because it is reserved for link-local addresses by the Internet Assigned Numbers Authority (IANA). These addresses are used for communication within a single network segment or link and are not routable beyond that segment.</p><p>Characteristics of Link-Local Addresses:</p><ul><li>Automatic Assignment: Devices automatically assign themselves an IP address from the 169.254.0.0&#x2F;16 range if they cannot obtain an IP address through DHCP.</li><li>Non-Routable: These addresses are not meant to be routed across different network segments. They are only valid within the local network.</li><li>Zero Configuration: Link-local addresses allow devices to communicate without manual configuration or a DHCP server.</li></ul><p>Example:<br>When a device fails to get an IP address from a DHCP server, it might assign itself an address like 169.254.1.2. Other devices on the same local network segment will also have addresses in the 169.254.0.0&#x2F;16 range, allowing them to communicate directly.</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><h3 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h3><p>NAME</p><pre><code>ip - show / manipulate routing, devices, policy routing and tunnels.</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ip route get 8.8.8.8</span><br><span class="line">8.8.8.8 via 192.168.1.1 dev eth0 src 192.168.1.100 uid 1000</span><br><span class="line">    cache</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li><code>8.8.8.8</code>: The destination IP address for which the route is being queried.</li><li><code>via 192.168.1.1</code>: The gateway IP address through which the destination can be reached.</li><li><code>dev eth0</code>: The network interface (e.g., <code>eth0</code>) used to reach the destination.</li><li><code>src 192.168.1.100</code>: The source IP address used for sending packets to the destination.</li><li><code>uid 1000</code>: The user ID of the process that issued the command.</li><li><code>cache</code>: Indicates that the route information is cached.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ip route show</span><br><span class="line">default via 192.168.1.1 dev eth0 </span><br><span class="line">192.168.1.0/24 dev eth0 proto kernel scope <span class="built_in">link</span> src 192.168.1.100</span><br><span class="line">169.254.0.0/16 dev idrac proto kernel scope <span class="built_in">link</span> src 169.254.1.2</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼šè¯¥å‘½ä»¤ç”¨äºæ˜¾ç¤ºè·¯ç”±è¡¨ï¼š</p><ul><li><code>default via 192.168.1.1 dev eth0</code>: The default route, packets to any destination not in the routing table will be sent to <code>192.168.1.1</code> via the <code>eth0</code> interface.</li><li><code>192.168.1.0/24 dev eth0 proto kernel scope link src 192.168.1.100</code>: A route for the <code>192.168.1.0/24</code> network (destination network), directly reachable via the <code>eth0</code> interface, with the source IP <code>192.168.1.100</code>.</li><li><code>192.168.1.0/24</code>: Destination network.</li><li><code>dev eth0</code>: Interface <code>eth0</code>.</li><li><code>proto kernel</code>: Added by the kernel.</li><li><code>scope link</code>: Directly reachable.</li><li><code>src 192.168.1.100</code>: Source IP address.</li><li><code>169.254.0.0/16</code>: Link-local address range.</li></ul><h3 id="netstat-ss"><a href="#netstat-ss" class="headerlink" title="netstat &#x2F; ss"></a>netstat &#x2F; ss</h3><p>NAME</p><pre><code>ss - another to investigate sockets.</code></pre><p>Reference</p><p><a href="https://zhuanlan.zhihu.com/p/45920111">æŸ¥çœ‹è¿›ç¨‹å ç”¨çš„ç«¯å£</a></p><p>COMMANDS</p><pre><code>ss -lnpt</code></pre><p>OPTIONS</p><pre><code>-n, --numberic-l, --listening-t, --tcp    Note: Only established (non-listening) connections.-a, --all    Display both listening and non-linstening (for TCP this means established connections) sockets.-u, --udp-p, --process</code></pre><h3 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h3><p>Options:</p><pre><code>-n inhibits the conversion of network numbers to host names for network files.-P inhibits the conversion of port numbers to port names for network files.-i specifies the Internet addresses    multiple addresses (up to a limit of 100) may be specified with multiple options.    An Internet address is specified in the form (Items in square brackets are optional.):    [46][protocol][@hostname|hostaddr][:service|port]    where:    46 specifies the IP version, IPv4 or IPv6        that applies to the following address.        &#39;6&#39; may be be specified only if the UNIX        dialect supports IPv6.  If neither &#39;4&#39; nor        &#39;6&#39; is specified, the following address        applies to all IP versions.    protocol is a protocol name - TCP, UDP    hostname is an Internet host name.  Unless a        specific IP version is specified, open        network files associated with host names        of all versions will be selected.    hostaddr is a numeric Internet IPv4 address in        dot form; or an IPv6 numeric address in        colon form, enclosed in brackets, if the        UNIX dialect supports IPv6.  When an IP        version is selected, only its numeric        addresses may be specified.    service is an /etc/services name - e.g., smtp -        or a list of them.    port is a port number, or a list of them.-s list file size-s p:s  exclude(^)|select protocol (p = TCP|UDP) states by name(s).</code></pre><p>Examples:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:&lt;port&gt;</span><br><span class="line">lsof -i -P -n | grep LISTEN</span><br><span class="line">lsof -nP -iTCP -sTCP:LISTEN</span><br></pre></td></tr></table></figure><h3 id="nc-netcat-nmap"><a href="#nc-netcat-nmap" class="headerlink" title="nc&#x2F;netcat&#x2F;nmap"></a>nc&#x2F;netcat&#x2F;nmap</h3><h3 id="socket"><a href="#socket" class="headerlink" title="socket"></a>socket</h3><p>Create a TCP or a UNIX domain socket and connect to stdin&#x2F;out.</p><p>Installation:</p><pre><code>sudo apt-get install socket</code></pre>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tcp/ip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Written in Blood</title>
      <link href="/blog/2023/12/23/english/Written-in-Blood/"/>
      <url>/blog/2023/12/23/english/Written-in-Blood/</url>
      
        <content type="html"><![CDATA[<h2 id="ç”µå½±é“¾æ¥"><a href="#ç”µå½±é“¾æ¥" class="headerlink" title="ç”µå½±é“¾æ¥"></a>ç”µå½±é“¾æ¥</h2><p><a href="https://tubitv.com/tv-shows/520415/s01-e02-written-in-blood">Midsomer Murdersï¼š Season 1 Episode 2 - Written in Blood</a></p><h2 id="å°è¯"><a href="#å°è¯" class="headerlink" title="å°è¯"></a>å°è¯</h2><p>Phoenix turned and fired twice, the 34 millimetre bullets spitting through the air and splintering the brickwork two inches to the left of the Russia thugâ€™s shoulder. A moment later came the reply of the Uzi semiautomatic and Phoenix twisted round. è²å°¼å…‹æ–¯è½¬èº«å¼€äº†ä¸¤æªï¼Œ34æ¯«ç±³çš„å­å¼¹åœ¨ç©ºä¸­å–·å°„ï¼Œå°†ä¿„ç½—æ–¯æš´å¾’è‚©è†€å·¦ä¾§ä¸¤è‹±å¯¸ç –å¢™å‡»ç¢ã€‚è¿‡ä¸€ä¼šå„¿ï¼Œä¹Œå…¹åŠè‡ªåŠ¨å†²é”‹æªå›åº”äº†ï¼Œè²å°¼å…‹æ–¯æ‰­è¿‡èº«æ¥ã€‚</p><p>Her lips, searching in the sapphire, honeyscented darkness, found his; cool, forceful, unresisting, and as the frozen waves crashed down. å½“å†°å†·ã€æœ‰åŠ›ã€ä¸å¯æŠ—æ‹’çš„æµªæ±¹æ¶Œè€Œä¸‹çš„æ—¶å€™ï¼Œå¥¹çš„å˜´å”‡åœ¨è“å®çŸ³èˆ¬æ•£å‘ç€èœœé¦™çš„å¤œè‰²ä¸­å¯»æ‰¾ï¼Œæ‰¾åˆ°äº†ä»–çš„å˜´å”‡ã€‚</p><p>-Got your meeting, have you? ä½ è¦å»å¼€ä¼šï¼Œå¯¹å—ï¼Ÿ<br>-Yes, Iâ€™m on my way. æ˜¯çš„ï¼Œæˆ‘æ­£åœ¨å»ã€‚</p><p>He pulled her towards him, his powerful, masculine hands tearing at the silk faric of her Gaultier nightshirt.</p><p>The repetitive beat of the innercity drum.</p><p>1887, Sebastian Lyddiard, greatgrandson of Herbert Lyddiard, who served under Sir John Jervis against Napoleon. å¯¹æŠ—æ‹¿ç ´ä»‘ã€‚</p><p>The Right Honourable William Lyddiard. å¨å»‰Â·åˆ©è¿ªäºšå¾·é˜ä¸‹ã€‚</p><p>-Do you ever regret marrying hime, Amy? I wonder if you ever think that but for you he might still be alive? ä½ åæ‚”å«ç»™ä»–å—ï¼ŒåŸƒç±³ï¼Ÿæˆ‘ä¸çŸ¥é“ä½ æ˜¯å¦æƒ³è¿‡ï¼Œå¦‚æœä¸æ˜¯å› ä¸ºä½ ï¼Œä»–å¯èƒ½ç°åœ¨è¿˜æ´»ç€ï¼Ÿ<br>-(Amy) No. æ²¡æœ‰æƒ³è¿‡ã€‚<br>-Well I do. æˆ‘æƒ³è¿‡ã€‚</p><p>-So we come to the question of which writer we invite to address us? æ‰€ä»¥æˆ‘ä»¬æ‰“ç®—è¯·å“ªä½ä½œå®¶æ¥ç»™æˆ‘ä»¬åšæ¼”è®²å‘¢ï¼Ÿ<br>-How about Jilly Cooper?<br>-I think he said a writer.<br>-Do you think we could interest Frederick Forsythe?<br>-I rather doubt it.<br>-Oh, itâ€™s a wonderful idea, Gerald. Especially since youâ€™re writing a thriller. I think Frederick Forsythe would be first rate! æˆ‘è®¤ä¸ºFrederick Forsytheæ˜¯ç¬¬ä¸€æµçš„ã€‚<br>-Heâ€™d never come. Heâ€™d just pretend he didnâ€™t have time. They always do.<br>-Iâ€™d like Seamus Heaney.<br>-The poet?<br>-Not another poet. That last one was such a ghastly little man.</p><h2 id="è¯æ±‡"><a href="#è¯æ±‡" class="headerlink" title="è¯æ±‡"></a>è¯æ±‡</h2><p>screenplay by å‰§æœ¬ç”±â€¦â€¦å†™æˆ<br>millimetre æ¯«ç±³<br>phoenix å‡¤å‡°ï¼Œè¿™é‡Œæ˜¯äººåï¼Œè²å°¼å…‹æ–¯<br>spit åï¼Œå”¾<br>thug æ¶æ£ï¼Œæš´å¾’<br>twist æ‰­ï¼Œæ‹§ï¼Œæ»<br>brickwork ç –ç Œä½“ï¼Œç –å¢™<br>splinter n. ç¢ç‰‡ï¼Œå¼¹ç‰‡ï¼› v. ç¢è£‚ã€‚<br>Uzi semiautomatic ä¹Œå…¹åŠè‡ªåŠ¨å†²é”‹æªï¼ˆ<a href="https://en.wikipedia.org/wiki/Uzi">Uzi</a> submachine gunï¼‰ã€‚Uzi å†²é”‹æªæ˜¯ç”±ä»¥è‰²åˆ—å›½é˜²å†› (IDF) ä¸Šå°‰ï¼ˆåæ¥çš„å°‘æ ¡ï¼‰Uziel Gal åœ¨ 1948 å¹´é˜¿ä»¥æˆ˜äº‰åè®¾è®¡çš„ã€‚<br>sapphire è“å®çŸ³<br>honey èœ‚èœœï¼Œèœœ<br>scent é¦™å‘³ï¼ˆa pleasant natural smellï¼‰ï¼›scented æ•£å‘é¦™å‘³çš„<br>resist æŠ—æ‹’çš„ï¼›unresisted ä¸å¯æŠ—æ‹’çš„ã€‚<br>masculine ç”·æ€§çš„ã€‚<br>tear æ’•ï¼Œæ’•ç ´ï¼Œæ’•æ¯ï¼›æ‹†ï¼›æ³ªæ°´ã€‚<br>nightshirt ç¡è¡£<br>scum æµ®æ¸£<br>scum-bag æ¸£å­è¢‹ï¼Œè¿™é‡Œåº”è¯¥æ˜¯â€œæ¸£ç”·â€ã€â€œäººæ¸£â€çš„æ„æ€ï¼Œéª‚äººçš„è¯ã€‚<br>hum å“¼å£°<br>greatgrandson æ›¾å­™<br>Sir çˆµå£«<br>Napoleon æ‹¿ç ´ä»‘<br>The Right Honourable <a href="https://en.wikipedia.org/wiki/The_Right_Honourable">é˜ä¸‹</a>ã€‚å…¶ä¸­ï¼ŒRightæ˜¯å‰¯è¯ï¼Œæ„æ€æ˜¯â€™veryâ€™ or â€˜fullyâ€™ã€‚ä»è¯­æ³•ä¸Šè¯´ï¼ŒThe Right Honourable æ˜¯å½¢å®¹çŸ­è¯­ï¼Œç›´æ¥ç”¨æ¥ç§°å‘¼äººåæˆ–è€…æŸäººç”¨æ¥è‡ªç§°éƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œåº”è¯¥ä¸å…¶å¼•ç”¨çš„åç§°æˆ–åç§°ä¸€èµ·ä½¿ç”¨ç¬¬ä¸‰äººç§°ã€‚<br>address æ¼”è®²<br>first rate ç¬¬ä¸€æµ<br>pretend å‡è£…<br>ghastly US:&#x2F;ËˆÉ¡Ã¦st.li&#x2F; UK:&#x2F;ËˆÉ¡É‘Ëst.li&#x2F; é˜´æ£®çš„ï¼Œå¯æ€•çš„ï¼Œéå¸¸åçš„<br>bestseller ç•…é”€ä¹¦</p>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> movie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cmake å…¥é—¨</title>
      <link href="/blog/2023/12/07/cpp/cmake%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
      <url>/blog/2023/12/07/cpp/cmake%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>Specify the search path for <code>pkg_check_modules</code>: <a href="https://stackoverflow.com/questions/44487053/set-pkg-config-path-in-cmake">Solution</a></p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;PKG_CONFIG_PATH&#125; <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/libs/opencv-install/lib/pkgconfig&quot;</span>)</span><br></pre></td></tr></table></figure><p><a href="https://zhuanlan.zhihu.com/p/97369704">find_package</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo Documentation</title>
      <link href="/blog/2023/12/07/personal_site/Hexo-Documentation/"/>
      <url>/blog/2023/12/07/personal_site/Hexo-Documentation/</url>
      
        <content type="html"><![CDATA[<h2 id="hexoä¿®æ”¹é»˜è®¤ç«¯å£å·"><a href="#hexoä¿®æ”¹é»˜è®¤ç«¯å£å·" class="headerlink" title="hexoä¿®æ”¹é»˜è®¤ç«¯å£å·"></a>hexoä¿®æ”¹é»˜è®¤ç«¯å£å·</h2><p>å‚è€ƒ<a href="https://www.jianshu.com/p/8398621502fd">åšå®¢</a></p><h2 id="æ·»åŠ ç›®å½•"><a href="#æ·»åŠ ç›®å½•" class="headerlink" title="æ·»åŠ ç›®å½•"></a>æ·»åŠ ç›®å½•</h2><p><a href="https://blog.ligos.net/2016-07-25/Writing-Content-On-Hexo.html">https://blog.ligos.net/2016-07-25/Writing-Content-On-Hexo.html</a><br><a href="https://medium.com/employbl/create-a-custom-blog-theme-with-hexo-js-b24c82eb9271#.viurzqeac">https://medium.com/employbl/create-a-custom-blog-theme-with-hexo-js-b24c82eb9271#.viurzqeac</a><br><a href="https://hexo.io/docs/themes">https://hexo.io/docs/themes</a><br><a href="https://hexo.io/docs/templates">https://hexo.io/docs/templates</a><br><a href="https://hexo.io/docs/helpers">https://hexo.io/docs/helpers</a></p><h2 id="Add-pages"><a href="#Add-pages" class="headerlink" title="Add pages"></a>Add pages</h2><p>Commands</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The following command generate a &#x27;categories/index.md&#x27; file</span></span><br><span class="line">hexo new page categories</span><br><span class="line"></span><br><span class="line">hexo new page tags</span><br><span class="line">hexo new page about</span><br></pre></td></tr></table></figure><p>Refers to <a href="https://stackoverflow.com/questions/60759559/hexo-next-theme-categories-and-tags-page">Hexo NeXT Theme categories and tags page</a></p><h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p><a href="https://blog.csdn.net/wugenqiang/article/details/88377669">Display PDF</a></p>]]></content>
      
      
      <categories>
          
          <category> Tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Getting Started with IB</title>
      <link href="/blog/2023/12/06/net/IB/"/>
      <url>/blog/2023/12/06/net/IB/</url>
      
        <content type="html"><![CDATA[<h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><h3 id="ibv-fork-init"><a href="#ibv-fork-init" class="headerlink" title="ibv_fork_init"></a><code>ibv_fork_init</code></h3><p>æ–‡æ¡£ <a href="https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17/ibv_fork_init">ibv_fork_init</a></p><p><strong>æ¨¡æ¿</strong>: <code>int ibv_fork_init(void)</code></p><p><strong>è¾“å…¥å‚æ•°</strong>: æ— </p><p><strong>è¾“å‡ºå‚æ•°</strong>: æ— </p><p><strong>è¿”å›å€¼</strong>: <code>0</code> on success, <code>-1</code> on error. If the call fails, errno will be set to indicate the reason for the failure.</p><p><strong>æè¿°</strong>: <code>ibv_fork_init</code> åˆå§‹åŒ– libverbs çš„æ•°æ®ç»“æ„æ¥å®‰å…¨åœ°å¤„ç† <code>fork()</code> å¹¶é¿å…æ•°æ®æŸåï¼Œä¸è®º <code>fork()</code> æ˜¯è¢«æ˜¾å¼è°ƒç”¨è¿˜æ˜¯éšå¼è°ƒç”¨ï¼ˆæ¯”å¦‚åœ¨ <code>system()</code> ä¸­è¢«è°ƒç”¨ï¼‰ã€‚<br>å¦‚æœæ‰€æœ‰çš„çˆ¶è¿›ç¨‹æ€»æ˜¯é˜»å¡ç›´è‡³æ‰€æœ‰çš„å­è¿›ç¨‹ç»“æŸæˆ–ä½¿ç”¨ <code>exec()</code> æ”¹å˜åœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆ <code>ibv_fork_init</code> å¯ä»¥ä¸è¢«è°ƒç”¨ã€‚</p><p>è¯¥å‡½æ•°åœ¨æ”¯æŒ <code>madvise</code> çš„ <code>MADV_DONTFORK</code> æ ‡è®°çš„ Linux å†…æ ¸ï¼ˆ2.6.17æˆ–æ›´é«˜ï¼‰ä¸Šå¯ä»¥å·¥ä½œã€‚</p><p>è®¾ç½®ç¯å¢ƒå˜é‡ <code>RDMAV_FORK_SAFE</code> æˆ– <code>IBV_FORK_SAFE</code> ç¯å¢ƒå˜é‡ä¸ºä»»æ„å€¼ï¼Œæœ‰ç€ä¸ <code>ibv_fork_init</code> ç›¸åŒçš„æ•ˆæœã€‚</p><p>è®¾ç½® <code>RDMAV_HUGEPAGES_SAFE</code> ä¸ºä»»æ„å€¼ï¼Œä»¥å‘Šè¯‰åº“éœ€è¦æ£€æŸ¥å†…æ ¸ä¸ºå†…å­˜åŸŸï¼ˆmemory regionsï¼‰ä½¿ç”¨çš„åº•å±‚å†…å­˜é¡µçš„å¤§å°ã€‚å¦‚æœåº”ç”¨ç¨‹åºç›´æ¥æˆ–é€šè¿‡åº“ï¼ˆå¦‚ libhugtlbfs ï¼‰é—´æ¥ä½¿ç”¨å¤§å†…å­˜é¡µï¼ˆåšä¸»æ³¨ï¼šå³å¤§äº4KBï¼‰æ—¶ï¼Œè¯¥ç¯å¢ƒå˜é‡æ˜¯å¿…é¡»çš„ã€‚ï¼ˆåšä¸»æ³¨ï¼š<code>ibv_fork_init</code> å°†æ£€æŸ¥ <code>RDMAV_HUGEPAGES_SAFE</code> ï¼‰</p><p>è°ƒç”¨ <code>ibv_fork_init</code> å°†é™ä½æ€§èƒ½ï¼Œå› ä¸ºæ¯ä¸ªå†…å­˜æ³¨å†Œéƒ½å°†æœ‰ä¸€ä¸ªé¢å¤–çš„ç³»ç»Ÿè°ƒç”¨å’Œåˆ†é…é™„åŠ çš„å†…å­˜ä»¥è¿½è¸ªå†…å­˜åŸŸï¼ˆmemory regionsï¼‰ã€‚<br>ç¡®åˆ‡çš„æ€§èƒ½æŸå¤±å–å†³äºå·¥ä½œè´Ÿè½½ï¼Œé€šå¸¸ä¸ä¼šå¾ˆå¤§ã€‚</p><p>è®¾ç½® <code>RDMAV_HUGEPAGES_SAFE</code> ä¼šä¸ºæ‰€æœ‰çš„å†…å­˜æ³¨å†Œå¢åŠ æ›´å¤šçš„å¼€é”€ã€‚</p><h2 id="æ–‡æ¡£"><a href="#æ–‡æ¡£" class="headerlink" title="æ–‡æ¡£"></a>æ–‡æ¡£</h2><p><a href="https://citeseerx.ist.psu.edu/viewdoc/download;jsessionid=346D319BA2A9F06B8C49B2C0AAFD28D9?doi=10.1.1.668.4459&rep=rep1&type=pdf">Documentation: RDMA Aware Networks Programming User Manual v1.6</a></p><p><a href="/blog/documents/RDMA-Aware-Networks-Programming.pdf">Local Documentation</a></p><p><a href="https://docs.oracle.com/cd/E19671-01/835-0793-03/z40000419112.html#scrolltoc">Sun Network QDR InfiniBand Gateway Switch Topic Set</a></p><p><a href="https://www.zhihu.com/column/c_1231181516811390976">RDMAçŸ¥ä¹ä¸“æ </a></p><p>ç”¨æˆ·æ€çš„Verbs APIæ‰‹å†Œè·Ÿä»£ç åœ¨ä¸€ä¸ªä»“åº“ç»´æŠ¤ï¼Œæ‰‹å†Œåœ°å€ï¼š<a href="https://github.com/linux-rdma/rdma-core/tree/master/libibverbs/man">https://github.com/linux-rdma/rdma-core/tree/master/libibverbs/man</a></p><p>æœ‰å¾ˆå¤šåœ¨çº¿çš„man pageç½‘ç«™å¯ä»¥æŸ¥é˜…è¿™äº›æ¥å£çš„è¯´æ˜ï¼Œæ¯”å¦‚å®˜æ–¹çš„è¿æ¥ï¼š<a href="https://man7.org/linux/man-pages/man3/ibv_post_send.3.html">https://man7.org/linux/man-pages/man3/ibv_post_send.3.html</a></p><p>ä¹Ÿæœ‰ä¸€äº›å…¶ä»–éå®˜æ–¹ç½‘é¡µï¼Œæ”¯æŒåœ¨çº¿æœç´¢ï¼š<a href="https://linux.die.net/man/3/ibv">https://linux.die.net/man/3/ibv</a></p><p>æŸ¥é˜…ç³»ç»Ÿman page<br>å¦‚æœä½ ä½¿ç”¨çš„å•†ç”¨OSå®‰è£…äº†rdma-coreæˆ–è€…libibverbsåº“ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ç”¨manå‘½ä»¤æŸ¥è¯¢æ¥å£ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">man ibv_post_send</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢Mellanoxçš„ç¼–ç¨‹æ‰‹å†Œ<br>ã€Š<a href="https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17">RDMA Aware Networks Programming User Manual Rev 1.7</a>ã€‹ï¼Œæœ€æ–°ç‰ˆæ˜¯2015å¹´æ›´æ–°çš„ã€‚è¯¥æ‰‹å†Œå†™çš„æ¯”è¾ƒè¯¦å°½ï¼Œå¹¶ä¸”é™„æœ‰ç¤ºä¾‹ç¨‹åºï¼Œä½†æ˜¯å¯èƒ½ä¸æœ€æ–°çš„æ¥å£æœ‰ä¸€äº›å·®å¼‚ã€‚Mellanox VPIÂ®ï¼ˆVirtual Procotol Interconnectï¼‰æ¶æ„ä¸ºåŒæ—¶æ”¯æŒInfiniBandå’Œä»¥å¤ªç½‘è¯­ä¹‰çš„ç½‘ç»œé€‚é…å™¨å’Œäº¤æ¢æœºæä¾›é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿå’Œå¯é çš„æ–¹æ³•ã€‚</p><p>Book: <a href="https://github.com/faquir-1990/itBooks/blob/master/Linux%20Kernel%20Networking%20-%20Implementation%20and%20Theory.pdf">Linux Kernel Networking - Implementation and Theory</a></p><p><a href="http://www.rdmamojo.com/">Dotanâ€™s blog</a>: Dotan Barak, an InfiniBand Expert. Dotan is a Senior Software Manager at Mellanox Technologies working on RDMA Technologies.</p><h2 id="æ€§èƒ½åˆ†æå·¥å…·ï¼ˆprofilingï¼‰"><a href="#æ€§èƒ½åˆ†æå·¥å…·ï¼ˆprofilingï¼‰" class="headerlink" title="æ€§èƒ½åˆ†æå·¥å…·ï¼ˆprofilingï¼‰"></a>æ€§èƒ½åˆ†æå·¥å…·ï¼ˆprofilingï¼‰</h2><p>Blog: <a href="https://www.rdmamojo.com/2013/06/08/tips-and-tricks-to-optimize-your-rdma-code/">Tips and tricks to optimize your RDMA code</a></p><p><a href="https://github.com/mellanox-hpc/libibprof">libibprof</a></p><h2 id="IBç®€ä»‹"><a href="#IBç®€ä»‹" class="headerlink" title="IBç®€ä»‹"></a>IBç®€ä»‹</h2><p>RDMA - Remote Direct Memory Access è¿œç¨‹ç›´æ¥å†…å­˜å­˜å–ã€‚</p><p>InfiniBandæ˜¯ä¸€ç§é«˜æ€§èƒ½è®¡ç®—æœºç½‘ç»œé€šä¿¡æ ‡å‡†ï¼Œå®ƒå…·æœ‰æé«˜çš„ååé‡å’Œæä½çš„å»¶è¿Ÿã€‚å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨InfiniBandè¿›è¡Œç¼–ç¨‹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ”¯æŒInfiniBandçš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚C++ï¼‰æ¥ç¼–å†™ä»£ç ã€‚</p><p>æœºæ„å’Œç»„ç»‡ï¼š</p><p>OFA: <a href="https://www.openfabrics.org/">Open Fabrics Alliance</a>.</p><p>IBTA: <a href="https://www.infinibandta.org/">InfiniBand Trade Association</a>.</p><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul><li><code>CQ</code> - Complete Queue å®Œæˆé˜Ÿåˆ—</li><li><code>WQ</code> - Work Queue å·¥ä½œé˜Ÿåˆ—</li><li><code>WR</code> - Work Request å·¥ä½œè¯·æ±‚</li><li><code>QP</code> - Queue Pairs é˜Ÿåˆ—å¯¹ï¼ˆSend-Receiveï¼‰</li><li><code>SQ</code> - Send Queue å‘é€é˜Ÿåˆ—</li><li><code>RQ</code> - Receive Queue æ¥æ”¶é˜Ÿåˆ—</li><li><code>PD</code> - Protection Domain ä¿æŠ¤åŸŸï¼Œå°†QPå’ŒMRç»“åˆåœ¨ä¸€èµ·</li><li><code>MR</code> - Memory Region å†…å­˜åŒºåŸŸã€‚ä¸€å—ç»æ³¨å†Œè¿‡çš„ä¸”æœ¬åœ°ç½‘å¡å¯ä»¥è¯»å†™çš„å†…å­˜åŒºåŸŸã€‚åŒ…å«R_Keyå’ŒL_Keyã€‚</li><li><code>SGE</code> - Scatter&#x2F;Gather Elements åˆ†æ•£&#x2F;èšé›†å…ƒç´ ã€‚</li><li><code>R_Key</code> - Remote Key</li><li><code>L_Key</code> - Local Key</li><li><code>CA</code> - (Host) Channel Adapter, an inifiniband network interface card.</li><li><code>NIC</code> - Network Interface Card ç½‘å¡ã€‚</li><li><code>LID</code> - Local Identifier.</li><li><code>CM</code> - Connection Manager.</li></ul><p>å…¶ä»–å¸¸è§ç¼©å†™ï¼š</p><ul><li><code>RC</code> - reliable connected.</li><li><code>SCSI</code> - Small Computer System Interface å°å‹è®¡ç®—æœºç³»ç»Ÿæ¥å£ã€‚</li><li><code>SRP</code> - SCSI RDMA Protocol. &#x2F; Secure Remote Password.</li></ul><p>åšå®¢ï¼š<a href="https://blog.51cto.com/liangchaoxi/4044818">https://blog.51cto.com/liangchaoxi/4044818</a></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/sec-infiniband_and_rdma_related_software_packages">InfiniBand å’Œ RDMA ç›¸å…³è½¯ä»¶åŒ…</a></p><pre><code>sudo apt-get install infiniband-diagssudo apt install ibverbs-utils</code></pre><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><ul><li><a href="https://insujang.github.io/2020-02-09/introduction-to-programming-infiniband/">introduction to programming infiniband</a></li><li><a href="https://indico.cern.ch/event/218156/attachments/351725/490089/RDMA_Aware_Programming_user_manual.pdf">RDMA Aware Programming user manual (PDF)</a></li></ul><p>ä»¥ä¸‹æ˜¯ä¸€äº›æ”¯æŒInfiniBandçš„C++åº“ï¼š</p><p>Infinityï¼šè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„C++ RDMAåº“ï¼Œç”¨äºInfiniBandç½‘ç»œã€‚å®ƒæä¾›äº†å¯¹ä¸¤ä¾§ï¼ˆå‘é€&#x2F;æ¥æ”¶ï¼‰å’Œå•ä¾§ï¼ˆè¯»&#x2F;å†™&#x2F;åŸå­ï¼‰æ“ä½œçš„æ”¯æŒï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„é¢å‘å¯¹è±¡çš„ibVerbsæŠ½è±¡ã€‚è¯¥åº“ä½¿ç”¨æˆ·èƒ½å¤Ÿæ„å»ºä½¿ç”¨RDMAçš„å¤æ‚åº”ç”¨ç¨‹åºï¼Œè€Œä¸ä¼šå½±å“æ€§èƒ½<a href="https://github.com/claudebarthels/infinity">1</a>ã€‚</p><p>OFEDï¼šè¿™æ˜¯ä¸€ä¸ªå¼€æ”¾å¼Fabrics Enterprise Distributionï¼Œå®ƒæä¾›äº†å¯¹InfiniBandå’ŒRoCEï¼ˆRDMA over Converged Ethernetï¼‰æŠ€æœ¯çš„æ”¯æŒã€‚OFEDæä¾›äº†ä¸€ç»„ç”¨æˆ·ç©ºé—´åº“å’Œé©±åŠ¨ç¨‹åºï¼Œå¯ç”¨äºæ„å»ºæ”¯æŒRDMAçš„åº”ç”¨ç¨‹åº<a href="https://zhuanlan.zhihu.com/p/337461037">2</a>ã€‚</p><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨Infinityåº“ç¼–å†™æ”¯æŒInfiniBandçš„C++ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ–°ä¸Šä¸‹æ–‡</span></span><br><span class="line">infinity::core::Context *context = <span class="keyword">new</span> infinity::core::<span class="built_in">Context</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºé˜Ÿåˆ—å¯¹</span></span><br><span class="line">infinity::queues::QueuePairFactory *qpFactory = <span class="keyword">new</span> infinity::queues::<span class="built_in">QueuePairFactory</span>(context);</span><br><span class="line">infinity::queues::QueuePair *qp = qpFactory-&gt;<span class="built_in">connectToRemoteHost</span>(SERVER_IP, PORT_NUMBER);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå¹¶å‘ç½‘ç»œæ³¨å†Œç¼“å†²åŒº</span></span><br><span class="line">infinity::memory::Buffer *localBuffer = <span class="keyword">new</span> infinity::memory::<span class="built_in">Buffer</span>(context, BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»è¿œç¨‹ç¼“å†²åŒºè¯»å–ï¼ˆå•å‘ï¼‰å¹¶ç­‰å¾…å®Œæˆ</span></span><br><span class="line">infinity::memory::RegionToken *remoteBufferToken = <span class="keyword">new</span> infinity::memory::<span class="built_in">RegionToken</span>(REMOTE_BUFFER_INFO);</span><br><span class="line">infinity::<span class="function">requests::RequestToken <span class="title">requestToken</span><span class="params">(context)</span></span>;</span><br><span class="line">qp-&gt;<span class="built_in">read</span>(localBuffer, remoteBufferToken, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æœ¬åœ°ç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¿œç¨‹ç¼“å†²åŒºï¼ˆå•å‘ï¼‰å¹¶ç­‰å¾…å®Œæˆ</span></span><br><span class="line">qp-&gt;<span class="built_in">write</span>(localBuffer, remoteBufferToken, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æœ¬åœ°ç¼“å†²åŒºçš„å†…å®¹é€šè¿‡é˜Ÿåˆ—å¯¹å‘é€ï¼ˆåŒå‘ï¼‰å¹¶ç­‰å¾…å®Œæˆ</span></span><br><span class="line">qp-&gt;<span class="built_in">send</span>(localBuffer, &amp;requestToken);</span><br><span class="line">requestToken.<span class="built_in">waitUntilCompleted</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line"><span class="keyword">delete</span> remoteBufferToken;</span><br><span class="line"><span class="keyword">delete</span> localBuffer;</span><br><span class="line"><span class="keyword">delete</span> qp;</span><br><span class="line"><span class="keyword">delete</span> qpFactory;</span><br><span class="line"><span class="keyword">delete</span> context;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹æ˜¯ä½¿ç”¨OFEDåº“ç¼–å†™æ”¯æŒInfiniBandçš„C++ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ–°ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_context</span> *context = <span class="built_in">ibv_open_device</span>(*device);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå®Œæˆç«¯å£</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_pd</span> *pd = <span class="built_in">ibv_alloc_pd</span>(context);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºé˜Ÿåˆ—å¯¹</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_qp_init_attr</span> qp_init_attr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;qp_init_attr, <span class="number">0</span>, <span class="built_in">sizeof</span>(qp_init_attr));</span><br><span class="line">qp_init_attr.send_cq = cq;</span><br><span class="line">qp_init_attr.recv_cq = cq;</span><br><span class="line">qp_init_attr.qp_type = IBV_QPT_RC;</span><br><span class="line">qp_init_attr.cap.max_send_wr = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_recv_wr = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_send_sge = <span class="number">1</span>;</span><br><span class="line">qp_init_attr.cap.max_recv_sge = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_qp</span> *qp = <span class="built_in">ibv_create_qp</span>(pd, &amp;qp_init_attr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå¹¶å‘ç½‘ç»œæ³¨å†Œç¼“å†²åŒº</span></span><br><span class="line"><span class="type">char</span> *localBuffer = (<span class="type">char</span> *)<span class="built_in">malloc</span>(BUFFER_SIZE);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_mr</span> *mr = <span class="built_in">ibv_reg_mr</span>(pd, localBuffer, BUFFER_SIZE, IBV_ACCESS_LOCAL_WRITE | IBV_ACCESS_REMOTE_READ | IBV_ACCESS_REMOTE_WRITE);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥åˆ°è¿œç¨‹ä¸»æœº</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> remoteAddress;</span><br><span class="line"><span class="built_in">memset</span>(&amp;remoteAddress, <span class="number">0</span>, <span class="built_in">sizeof</span>(remoteAddress));</span><br><span class="line">remoteAddress.sin_family = AF_INET;</span><br><span class="line">remoteAddress.sin_port = <span class="built_in">htons</span>(PORT_NUMBER);</span><br><span class="line"><span class="built_in">inet_pton</span>(AF_INET, SERVER_IP, &amp;remoteAddress.sin_addr);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">rdma_cm_id</span> *cmId;</span><br><span class="line"><span class="built_in">rdma_create_id</span>(*eventChannel, &amp;cmId, <span class="literal">NULL</span>, RDMA_PS_TCP);</span><br><span class="line"><span class="built_in">rdma_resolve_addr</span>(cmId, <span class="literal">NULL</span>, (<span class="keyword">struct</span> sockaddr *)&amp;remoteAddress, RESOLVE_TIMEOUT_MS);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰å¾…è¿æ¥å®Œæˆ</span></span><br><span class="line"><span class="built_in">rdma_wait_event</span>(*eventChannel, RDMA_CM_EVENT_ESTABLISHED);</span><br><span class="line"><span class="built_in">rdma_ack_cm_event</span>(cmEvent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–è¿œç¨‹ç¼“å†²åŒºä¿¡æ¯</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_wc</span> wc;</span><br><span class="line"><span class="built_in">ibv_post_recv</span>(qp, &amp;recvWr, &amp;badRecvWr);</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="built_in">ibv_poll_cq</span>(cq, <span class="number">1</span>, &amp;wc);</span><br><span class="line">&#125; <span class="keyword">while</span> (wc.status != IBV_WC_SUCCESS || wc.opcode != IBV_WC_RECV_RDMA_WITH_IMM || wc.imm_data != <span class="built_in">htonl</span>(IMM_DATA));</span><br><span class="line">remoteBufferInfo.rkey = <span class="built_in">ntohl</span>(wc.imm_data &gt;&gt; <span class="number">8</span>);</span><br><span class="line">remoteBufferInfo.vaddr = wc.wr_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æœ¬åœ°ç¼“å†²åŒºçš„å†…å®¹å†™å…¥è¿œç¨‹ç¼“å†²åŒºï¼ˆå•å‘ï¼‰</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ibv_send_wr</span> sendWr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;sendWr, <span class="number">0</span>, <span class="built_in">sizeof</span>(sendWr));</span><br><span class="line">sendWr.wr_id = <span class="number">0</span>;</span><br><span class="line">sendWr.opcode = IBV_WR_RDMA_WRITE_WITH_IMM;</span><br><span class="line">sendWr.sg_list = &amp;localSge;</span><br><span class="line">sendWr.num_sge = <span class="number">1</span>;</span><br><span class="line">sendWr.send_flags = IBV_SEND_SIGNALED;</span><br><span class="line">sendWr.wr.rdma.remote_addr = remoteBufferInfo.vaddr;</span><br><span class="line">sendWr.wr.rdma.rkey = remoteBufferInfo.rkey;</span><br><span class="line">localSge.addr = (<span class="type">uintptr_t</span>)localBuffer;</span><br><span class="line">localSge.length = BUFFER_SIZE;</span><br><span class="line">localSge.lkey = mr-&gt;lkey;</span><br><span class="line"><span class="built_in">ibv_post_send</span>(qp, &amp;sendWr, &amp;badSendWr);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³é—­è¿æ¥</span></span><br><span class="line"><span class="built_in">ibv_dereg_mr</span>(mr);</span><br><span class="line"><span class="built_in">free</span>(localBuffer);</span><br><span class="line"><span class="built_in">ibv_destroy_qp</span>(qp);</span><br><span class="line"><span class="built_in">ibv_dealloc_pd</span>(pd);</span><br><span class="line"><span class="built_in">ibv_close_device</span>(context);</span><br></pre></td></tr></table></figure><ul><li>å…¥é—¨çº§æ–‡æ¡£ï¼š<a href="https://zhuanlan.zhihu.com/p/337461037">https://zhuanlan.zhihu.com/p/337461037</a></li><li>æ–‡æ¡£ï¼š<a href="https://docs.kernel.org/infiniband/index.html">https://docs.kernel.org/infiniband/index.html</a></li><li>æ–‡æ¡£ï¼š<a href="http://blog.foool.net/wp-content/uploads/linuxdocs/infiniband.pdf">http://blog.foool.net/wp-content/uploads/linuxdocs/infiniband.pdf</a></li><li>æ–‡æ¡£ï¼š<a href="https://support.bull.com/documentation/byproduct/infra/sw-extremcomp/sw-extremcomp-com/g">https://support.bull.com/documentation/byproduct/infra/sw-extremcomp/sw-extremcomp-com/g</a></li><li>æ–‡æ¡£ï¼š<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_infiniband_and_rdma_networks/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/configuring_infiniband_and_rdma_networks/index</a></li><li>åšå®¢ï¼š<a href="https://zhuanlan.zhihu.com/p/337461037">https://zhuanlan.zhihu.com/p/337461037</a></li><li>æ–‡æ¡£ï¼š<a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_infiniband_and_rdma_networks">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_infiniband_and_rdma_networks</a></li><li>çŸ¥ä¹ä¸“æ ï¼š<a href="https://www.zhihu.com/column/c_1231181516811390976">https://www.zhihu.com/column/c_1231181516811390976</a></li><li>çŸ¥ä¹ä¸“æ ï¼š<a href="https://www.zhihu.com/column/rdmatechnology">https://www.zhihu.com/column/rdmatechnology</a></li></ul><p><a href="https://man7.org/linux/man-pages/man3/ibv_reg_mr.3.html">Linux manual page</a></p><h2 id="Command-Line"><a href="#Command-Line" class="headerlink" title="Command-Line"></a>Command-Line</h2><p>æ–‡æ¡£ï¼š<a href="https://docs.nvidia.com/networking/pages/viewpage.action?pageId=43719572">https://docs.nvidia.com/networking/pages/viewpage.action?pageId=43719572</a></p><ul><li><p><code>ibstat</code></p></li><li><p><code>ibhosts</code> - æŸ¥çœ‹æ‰€æœ‰çš„IB hostsã€‚</p></li><li><p><code>ibnetdiscover</code> - discover InfiniBand topology.</p></li><li><p><code>ibv_devices</code> - list RDMA devices.</p></li><li><p><code>ibv_devinof</code> - Print information about RDMA devices available for use from userspace.</p></li><li><p><code>ibv_rc_pingpong</code> - Run a simple ping-pong test over InfiniBand via the reliable connected (RC) transport.</p></li><li><p><code>targetcli</code> - administration shell for storage targets</p><p>  <code>targetcli</code> is  a  shell for viewing, editing, and saving the configuration of the kernelâ€™s target subsystem,<br>  also known as LIO. It enables the administrator to assign local storage resources backed by either files,<br>  volumes, local SCSI devices, or ramdisk, and export them to remote systems via network fabrics, such as iSCSI or FCoE.</p></li><li><p><code>srp_daemon</code> - Discovers and connects to InfiniBand SCSI RDMA Protocol (SRP) targets in an IB fabric.</p></li><li><p><code>ibsrpdm</code> - List InfiniBand SCSI RDMA Protocol (SRP) targets on an IB fabric.</p></li></ul><h2 id="liraries"><a href="#liraries" class="headerlink" title="liraries"></a>liraries</h2><p>devid: device ID library. Refer to <a href="https://docs.oracle.com/cd/E86824_01/html/E54772/libdevid-3lib.html">here</a>.</p><p>ibverbs: ä½¿å¾—ç”¨æˆ·ç©ºé—´è¿›ç¨‹èƒ½å¤Ÿä½¿ç”¨RDMA verbsï¼ˆå³è¿›è¡ŒRDMAæ“ä½œï¼‰ã€‚Refer to <a href="https://www.ibm.com/docs/en/aix/7.2?topic=ofed-libibverbs-library">here</a>.</p><p>dl: Dynamic Loader.</p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bsubç”¨æ³•</title>
      <link href="/blog/2023/12/06/net/bsub/"/>
      <url>/blog/2023/12/06/net/bsub/</url>
      
        <content type="html"><![CDATA[<h2 id="find-host-queue-sh"><a href="#find-host-queue-sh" class="headerlink" title="find_host_queue.sh"></a>find_host_queue.sh</h2><p>å¯»æ‰¾ hostname æ‰€åœ¨çš„ queue ï¼š</p><figure class="highlight bash"><figcaption><span>find_host_queue.sh</span><a href="/blog/downloads/code/bsub/find_host_queue.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ£€æŸ¥æ˜¯å¦æä¾›äº†ä¸»æœºåå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$1</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: <span class="variable">$0</span> &lt;hostname&gt;&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">HOSTNAME=<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;æ­£åœ¨æŸ¥æ‰¾åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>] æˆ–å…¶ä¸»æœºç»„çš„é˜Ÿåˆ—...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰é˜Ÿåˆ—å</span></span><br><span class="line">queues=$(bqueues | awk <span class="string">&#x27;NR&gt;1 {print $1}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># è·å–é˜Ÿåˆ—çš„ HOSTS å­—æ®µ</span></span><br><span class="line">    hosts_line=$(bqueues -l <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;/HOSTS:/,/^$/&#x27;</span>)</span><br><span class="line">    <span class="comment"># å°†å­—ç¬¦ä¸²æŒ‰ç©ºæ ¼æ‹†åˆ†ä¸ºæ•°ç»„</span></span><br><span class="line">    host_array=(<span class="variable">$hosts_line</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æå–æ‰€æœ‰ä¸»æœºæˆ–ä¸»æœºç»„</span></span><br><span class="line">    <span class="keyword">for</span> entry <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${host_array[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯ä¸»æœºç»„ï¼ˆä»¥@å¼€å¤´æˆ–ä»¥/ç»“å°¾ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$entry</span> == @* || <span class="variable">$entry</span> == */ ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># if [[ $entry == @* ]]; then</span></span><br><span class="line">            <span class="comment">#     # å»æ‰å‰é¢çš„@ç¬¦å·</span></span><br><span class="line">            <span class="comment">#     entry=${entry:1}</span></span><br><span class="line">            <span class="comment"># fi</span></span><br><span class="line">            <span class="comment"># å»æ‰å‰é¢çš„@ç¬¦å·å’Œåé¢çš„æ–œæ </span></span><br><span class="line">            group=<span class="variable">${entry#@}</span></span><br><span class="line">            group=<span class="variable">${entry%/}</span></span><br><span class="line">            <span class="comment"># è·å–ä¸»æœºç»„ä¸­çš„ä¸»æœºåˆ—è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> bmgroup <span class="variable">$group</span> 2&gt;/dev/null | grep -qw <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;âœ… é˜Ÿåˆ— [<span class="variable">$q</span>] åŒ…å«ä¸»æœºç»„ [<span class="variable">$group</span>]ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸»æœº [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment"># ç›´æ¥åŒ¹é…ä¸»æœºå</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> == <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;âœ… é˜Ÿåˆ— [<span class="variable">$q</span>] ç›´æ¥åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="auto-submit-to-host-queue-sh"><a href="#auto-submit-to-host-queue-sh" class="headerlink" title="auto_submit_to_host_queue.sh"></a>auto_submit_to_host_queue.sh</h2><p>æ ¹æ®æä¾›çš„ hostname ï¼Œè‡ªåŠ¨å¯»æ‰¾æœ€ç©ºé—²çš„é˜Ÿåˆ—æäº¤ bsub ä½œä¸šï¼š</p><figure class="highlight bash"><figcaption><span>auto_submit_to_host_queue.sh</span><a href="/blog/downloads/code/bsub/auto_submit_to_host_queue.sh">view raw</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯¥è„šæœ¬ä¼šè‡ªåŠ¨å°† hostname æäº¤åˆ°å»¶è¿Ÿæœ€å°ã€æœ€ç©ºé—²çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="comment"># å¤„ç†åçš„å‘½ä»¤ä¸º bsub -q &lt;queue&gt; -m &lt;host&gt; &lt;args&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨æ³•æç¤º</span></span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼š$0 myhostname -Is bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 2 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ç”¨æ³•: <span class="variable">$0</span> &lt;hostname&gt; &lt;args&gt;&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">HOSTNAME=<span class="variable">$1</span></span><br><span class="line"><span class="comment"># JOB_SCRIPT=$2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># # æ£€æŸ¥ä½œä¸šè„šæœ¬æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment"># if [ ! -f &quot;$JOB_SCRIPT&quot; ]; then</span></span><br><span class="line"><span class="comment">#     echo &quot;é”™è¯¯ï¼šæ‰¾ä¸åˆ°ä½œä¸šè„šæœ¬ $JOB_SCRIPT&quot;</span></span><br><span class="line"><span class="comment">#     exit 1</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ” æ­£åœ¨æŸ¥æ‰¾åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>] çš„é˜Ÿåˆ—...&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> -A matching_queues</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰é˜Ÿåˆ—å</span></span><br><span class="line">queues=$(bqueues | awk <span class="string">&#x27;NR&gt;1 {print $1}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># è·å–é˜Ÿåˆ—çš„ HOSTS å­—æ®µ</span></span><br><span class="line">    hosts_line=$(bqueues -l <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;/HOSTS:/,/^$/&#x27;</span>)</span><br><span class="line">    host_array=(<span class="variable">$hosts_line</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> entry <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${host_array[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">        <span class="comment"># å¦‚æœæ˜¯ä¸»æœºç»„ï¼ˆä»¥@å¼€å¤´æˆ–ä»¥/ç»“å°¾ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> [[ <span class="variable">$entry</span> == @* || <span class="variable">$entry</span> == */ ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="comment"># å»æ‰å‰é¢çš„@ç¬¦å·å’Œåé¢çš„æ–œæ </span></span><br><span class="line">            group=<span class="variable">${entry#@}</span></span><br><span class="line">            group=<span class="variable">${entry%/}</span></span><br><span class="line">            <span class="keyword">if</span> bmgroup <span class="string">&quot;<span class="variable">$group</span>&quot;</span> 2&gt;/dev/null | grep -qw <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span>; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">echo</span> <span class="string">&quot;âœ… é˜Ÿåˆ— [<span class="variable">$q</span>] åŒ…å«ä¸»æœºç»„ [<span class="variable">$group</span>]ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸»æœº [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">                matching_queues[<span class="string">&quot;<span class="variable">$q</span>&quot;</span>]=1</span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">elif</span> [[ <span class="string">&quot;<span class="variable">$entry</span>&quot;</span> == <span class="string">&quot;<span class="variable">$HOSTNAME</span>&quot;</span> ]]; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;âœ… é˜Ÿåˆ— [<span class="variable">$q</span>] ç›´æ¥åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>]&quot;</span></span><br><span class="line">            matching_queues[<span class="string">&quot;<span class="variable">$q</span>&quot;</span>]=1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">${#matching_queues[@]}</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;âŒ æ²¡æœ‰æ‰¾åˆ°åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>] çš„é˜Ÿåˆ—ã€‚&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âœ… æ‰¾åˆ°ä»¥ä¸‹é˜Ÿåˆ—åŒ…å«ä¸»æœº [<span class="variable">$HOSTNAME</span>]ï¼š&quot;</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${!matching_queues[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot; - <span class="variable">$q</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–è¿™äº›é˜Ÿåˆ—çš„ç­‰å¾…ä»»åŠ¡æ•°ï¼Œé€‰æ‹©æœ€ç©ºé—²çš„ä¸€ä¸ª</span></span><br><span class="line">best_queue=<span class="string">&quot;&quot;</span></span><br><span class="line">min_pend=999999</span><br><span class="line"></span><br><span class="line">sorted_queues=$(<span class="keyword">for</span> q <span class="keyword">in</span> <span class="string">&quot;<span class="variable">${!matching_queues[@]}</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    pend=$(bqueues <span class="string">&quot;<span class="variable">$q</span>&quot;</span> | awk <span class="string">&#x27;NR==2 {print $9}&#x27;</span>)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$pend</span> <span class="variable">$q</span>&quot;</span></span><br><span class="line">    <span class="comment"># if [[ &quot;$pend&quot; =~ ^[0-9]+$ ]] &amp;&amp; [ &quot;$pend&quot; -lt &quot;$min_pend&quot; ]; then</span></span><br><span class="line">    <span class="comment">#     min_pend=$pend</span></span><br><span class="line">    <span class="comment">#     best_queue=$q</span></span><br><span class="line">    <span class="comment"># fi</span></span><br><span class="line"><span class="keyword">done</span> | <span class="built_in">sort</span> -n | awk <span class="string">&#x27;{print $2}&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># if [ -z &quot;$best_queue&quot; ]; then</span></span><br><span class="line"><span class="comment">#     echo &quot;âš ï¸ æ— æ³•ç¡®å®šæœ€ç©ºé—²é˜Ÿåˆ—ï¼Œé»˜è®¤ä½¿ç”¨ç¬¬ä¸€ä¸ªï¼š${!matching_queues[@]}&quot;</span></span><br><span class="line"><span class="comment">#     best_queue=${!matching_queues[@]}</span></span><br><span class="line"><span class="comment"># fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾æ¬¡å°è¯•æäº¤ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">for</span> q <span class="keyword">in</span> <span class="variable">$sorted_queues</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸ” å°è¯•é˜Ÿåˆ— [<span class="variable">$q</span>]...&quot;</span></span><br><span class="line">    test_output=$(<span class="built_in">timeout</span> 10 bsub -q <span class="string">&quot;<span class="variable">$q</span>&quot;</span> -n 1 -Is /bin/true 2&gt;&amp;1)</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 124 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;â³ é˜Ÿåˆ— [<span class="variable">$q</span>] æµ‹è¯•è¶…æ—¶ï¼Œè·³è¿‡ã€‚&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$test_output</span>&quot;</span> | grep -q <span class="string">&quot;User cannot use the queue&quot;</span>; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;â›” æ— æƒé™ä½¿ç”¨é˜Ÿåˆ— [<span class="variable">$q</span>]ï¼Œè·³è¿‡ã€‚&quot;</span></span><br><span class="line">        <span class="built_in">continue</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;ğŸš€ æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ— [<span class="variable">$q</span>]...&quot;</span></span><br><span class="line">    CMD=<span class="string">&quot;bsub -q <span class="variable">$q</span> -m <span class="variable">$HOSTNAME</span> <span class="variable">${@:2}</span>&quot;</span></span><br><span class="line">    <span class="comment"># execå°†å½“å‰ç»ˆç«¯ä¼ é€’ç»™bsub</span></span><br><span class="line">    <span class="comment"># exec $CMD</span></span><br><span class="line">    <span class="variable">$CMD</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;âŒ æ‰€æœ‰é˜Ÿåˆ—éƒ½æ— æ³•ä½¿ç”¨æˆ–æäº¤å¤±è´¥ã€‚&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo &quot;ğŸš€ æ­£åœ¨å°†ä»»åŠ¡æäº¤åˆ°æœ€ç©ºé—²çš„é˜Ÿåˆ— [$best_queue]...&quot;</span></span><br><span class="line"><span class="comment"># # bsub -q &quot;$best_queue&quot; &quot;$JOB_SCRIPT&quot;</span></span><br><span class="line"><span class="comment"># bsub -q &quot;$best_queue&quot; -m &quot;$HOSTNAME&quot; &quot;$argv[2-]&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bsub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ä¾‹æ¨¡å¼</title>
      <link href="/blog/2023/11/30/cpp/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/blog/2023/11/30/cpp/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p><a href="https://stackoverflow.com/questions/8623657/multiple-instances-of-singleton-across-shared-libraries-on-linux">Multiple instances of singleton across shared libraries on Linux</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>printf</title>
      <link href="/blog/2023/11/27/cpp/printf/"/>
      <url>/blog/2023/11/27/cpp/printf/</url>
      
        <content type="html"><![CDATA[<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p><a href="https://cpp.hotexamples.com/zh/examples/-/-/lprintf/cpp-lprintf-function-examples.html">https://cpp.hotexamples.com/zh/examples/-/-/lprintf/cpp-lprintf-function-examples.html</a></p><ul><li>printf</li><li>lprintf</li><li>fprintf</li><li>sprintf</li><li>vsprintf</li></ul><p>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°<br>bcopy</p><h2 id="éæ‰“å°å­—ç¬¦"><a href="#éæ‰“å°å­—ç¬¦" class="headerlink" title="éæ‰“å°å­—ç¬¦"></a>éæ‰“å°å­—ç¬¦</h2><p>å‚è§ <a href="https://en.cppreference.com/w/cpp/language/escape">Escape sequeneces</a>.</p><pre><code><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> str[] = <span class="string">&quot;\x1E&quot;</span>; <span class="comment">// &quot;0x1E&quot; æ˜¯ä¸€ä¸ªéæ‰“å°å­—ç¬¦</span></span><br></pre></td></tr></table></figure></code></pre>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Socket Programming</title>
      <link href="/blog/2023/11/27/net/%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B/"/>
      <url>/blog/2023/11/27/net/%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h2><p><code>/etc/services</code>: ç«¯å£åˆ—è¡¨<br><code>/etc/protocols</code>: åè®®åˆ—è¡¨</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://zhuanlan.zhihu.com/p/392820963">ç«¯å£0çš„ä½œç”¨</a></p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tcp/ip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Makefileå…¥é—¨</title>
      <link href="/blog/2023/11/17/cpp/Makefile%E5%85%A5%E9%97%A8/"/>
      <url>/blog/2023/11/17/cpp/Makefile%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Makefileé»˜è®¤shell"><a href="#Makefileé»˜è®¤shell" class="headerlink" title="Makefileé»˜è®¤shell"></a>Makefileé»˜è®¤shell</h2><p>Makefile é»˜è®¤çš„ shell æ˜¯ &#x2F;bin&#x2F;sh:<br>æŸ¥çœ‹ Makefile é»˜è®¤çš„ shell:<br>$(warning ${SHELL}) # æŸ¥çœ‹é»˜è®¤ shell</p><p>å¦‚æœåœ¨ Makefile å¼€å¤´åŠ ä¸Šä»¥ä¸‹è¯­å¥ï¼Œå¯ä»¥æŒ‡å®š shell:<br>SHELL :&#x3D; &#x2F;bin&#x2F;bash</p><p>Makefile çš„ shell å‘½ä»¤ä¼¼ä¹æ¯ä¸€æ¡éƒ½ä¼šæ–°å¼€è¾Ÿä¸€ä¸ª shell ç¯å¢ƒæ¥æ‰§è¡Œï¼Œå› ä¸ºæ¯æ¡ shell å‘½ä»¤ä¼¼ä¹éƒ½æ‰§è¡Œäº†ä¸€æ¬¡ .cshrc è„šæœ¬ã€‚<br>è¦æƒ³åœ¨åŒä¸€ä¸ª shell ç¯å¢ƒä¸­æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œåˆ™éœ€è¦ä½¿ç”¨åˆ†å·åˆ†å‰²å¹¶è½¬ä¹‰æ¢è¡Œç¬¦ã€‚</p><h2 id="Makefileç¯å¢ƒå˜é‡"><a href="#Makefileç¯å¢ƒå˜é‡" class="headerlink" title="Makefileç¯å¢ƒå˜é‡"></a>Makefileç¯å¢ƒå˜é‡</h2><p>ä½ å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ MAKEFLAGS æ¥è®©æ‰€æœ‰çš„å­shelléƒ½å°† make è®¤ä½œ make -nï¼š<br>export MAKEFLAGS&#x3D;â€-nâ€<br>æ³¨ï¼š-n, â€“dry-run è¡¨ç¤ºåªæ‰“å°å°†è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½†æ˜¯ä¸çœŸæ­£æ‰§è¡Œå®ƒä»¬ã€‚</p><p>Makefile è®¾ç½® PATH ç¯å¢ƒå˜é‡ï¼š<br>PATH :&#x3D; mypath:$(PATH)<br>å¿…é¡»ä½¿ç”¨ â€œ:&#x3D;â€ ï¼Œå› ä¸º â€œ:&#x3D;â€ æ˜¯ç®€å•èµ‹å€¼ï¼Œä½†æ˜¯ â€œ&#x3D;â€ ä¼šé€’å½’å±•å¼€ï¼Œä¼šå¯¼è‡´æŠ¥é”™ â€œRecursive variable &#96;PATHâ€™ references itself (eventually)â€ã€‚</p><p>Makefile å®šä¹‰å¤šè¡Œå˜é‡ï¼šä½¿ç”¨ define è¯­å¥ã€‚<br>Makefile æ¥æ”¶å‘½ä»¤è¡Œå‚æ•°</p><p>éå¸¸å¥‡ç‰¹çš„ç°è±¡ï¼š<br>$ make clean<br>cat clean.sh &gt;clean<br>chmod a+x clean<br>å› ä¸º Makefile æ–‡ä»¶ä¸­æ²¡æœ‰ clean çš„ recipeï¼Œä½†æ˜¯å½“å‰ç›®å½•ä¸‹æœ‰ä¸ª clean.sh æ–‡ä»¶ã€‚<br>ä½†æ˜¯ï¼Œå½“å†æ¬¡æ‰§è¡Œ make cleanï¼Œclean è„šæœ¬è¿˜æ˜¯ä¸ä¼šè¢«æ‰§è¡Œï¼š<br>$ make clean<br>make: &#96;cleanâ€™ is up to date.</p><h2 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a>ç‰¹æ®Šç¬¦å·</h2><h3 id="ç©ºæ ¼"><a href="#ç©ºæ ¼" class="headerlink" title="ç©ºæ ¼"></a>ç©ºæ ¼</h3><p>Makefileå¯¹ç©ºæ ¼çš„å¤„ç†ï¼Œä¼¼ä¹æ˜¯ï¼šä»ç¬¬ä¸€ä¸ªéç©ºæ ¼å¼€å§‹ï¼Œåˆ°æ˜ç¡®çš„æˆªæ­¢ç¬¦ï¼ˆæ¢è¡Œã€é€—å·ã€æ‹¬å·ã€æ³¨é‡Šæ ‡è®°â€™#â€™ç­‰ï¼‰ä¸ºæ­¢ã€‚<br>a &#x3D;   b   #æ³¨æ„æœ«å°¾æœ‰3ä¸ªç©ºæ ¼<br>$(warning a&#x3D;$(a)c)</p><p>ç»“æœï¼š<br>a&#x3D;    b   c</p><p>Makefileè½¬ä¹‰ç¬¦ï¼š<br>å­—ç¬¦è½¬ä¹‰æ–¹æ³•<br>$$$<br>##<br>\\</p><p>æ³¨æ„ï¼šè¿™é‡Œè¯´çš„æ˜¯Makefileä¸­çš„è½¬ä¹‰ç¬¦ï¼Œä¸æ˜¯bashä¸­çš„è½¬ä¹‰ç¬¦ã€‚</p><h3 id="æ‹¬å·"><a href="#æ‹¬å·" class="headerlink" title="æ‹¬å·"></a>æ‹¬å·</h3><p>å¼•ç”¨å˜é‡æ—¶ï¼ŒShellä½¿ç”¨å¤§æ‹¬å·ï¼ŒMakefileåˆ™å¤§æ‹¬å·å’Œå°æ‹¬å·éƒ½è¡Œã€‚ä½†æ˜¯åœ¨å‘½ä»¤ä¸­ä½¿ç”¨Shellå˜é‡å°±éœ€è¦ä½¿ç”¨å¤§æ‹¬å·ã€‚</p><p><a href="https://blog.csdn.net/bigmarco/article/details/6687337">å‚è€ƒ</a></p><h2 id="Makefileè°ƒè¯•æ–¹æ³•"><a href="#Makefileè°ƒè¯•æ–¹æ³•" class="headerlink" title="Makefileè°ƒè¯•æ–¹æ³•"></a>Makefileè°ƒè¯•æ–¹æ³•</h2><p>è¦è°ƒè¯• Makefile å¹¶æŸ¥çœ‹å…¶æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š<br>    1. ä½¿ç”¨ make çš„ -n æˆ– â€“dry-run é€‰é¡¹ï¼šè¿™å°†æ˜¾ç¤º Makefile ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼Œè€Œä¸ä¼šçœŸæ­£æ‰§è¡Œå®ƒä»¬ã€‚<br>make -n<br>    1. ä½¿ç”¨ make çš„ -d æˆ– â€“debug é€‰é¡¹ï¼šè¿™å°†æ˜¾ç¤ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å˜é‡çš„å±•å¼€å’Œè§„åˆ™çš„åŒ¹é…è¿‡ç¨‹ã€‚<br>make -d<br>    1. ä½¿ç”¨ make çš„ -p æˆ– â€“print-data-base é€‰é¡¹ï¼šè¿™å°†æ‰“å°æ‰€æœ‰çš„å˜é‡ã€è§„åˆ™å’Œéšå«è§„åˆ™ã€‚<br>make -p<br>    1. åœ¨ Makefile ä¸­æ·»åŠ è°ƒè¯•ä¿¡æ¯ï¼šä½ å¯ä»¥åœ¨ Makefile ä¸­æ·»åŠ ä¸€äº›è°ƒè¯•ä¿¡æ¯ï¼Œä¾‹å¦‚ä½¿ç”¨ $(info â€¦) æ¥æ‰“å°å˜é‡çš„å€¼ã€‚<br>print:<br>    @$(foreach V, $(.VARIABLES), $(info $(V) &#x3D; $($(V))))<br>    1. ä½¿ç”¨ make çš„ -j é€‰é¡¹ï¼šå¦‚æœä½ ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨ -j é€‰é¡¹æ¥é™åˆ¶å¹¶è¡Œä»»åŠ¡çš„æ•°é‡ï¼Œå¹¶æ›´å®¹æ˜“åœ°è·Ÿè¸ªè¾“å‡ºã€‚<br>make -j1</p><p>makefileæ‰“å°æ‰€æœ‰å˜é‡çš„å€¼ï¼š<br>debug:<br>    @$(foreach V, $(.VARIABLES), $(info $(V) &#x3D; $($(V))))<br>ç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š<br>make debug<br>è¿™å°†æ‰“å°æ‰€æœ‰å˜é‡åŠå…¶å€¼ã€‚</p><p>print-%:<br>    @echo $* &#x3D; $($*)</p><p>print-% æ˜¯ä¸€ä¸ª Makefile ç›®æ ‡ï¼Œç”¨äºæ‰“å°å˜é‡çš„å€¼ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br>    1. å®šä¹‰ä¸€ä¸ªç›®æ ‡ print-%ï¼Œå…¶ä¸­ % æ˜¯ä¸€ä¸ªé€šé…ç¬¦ï¼Œè¡¨ç¤ºä»»æ„å˜é‡åã€‚<br>    2. ä½¿ç”¨ @echo $* &#x3D; $($*) æ‰“å°å˜é‡åå’Œå˜é‡å€¼ã€‚</p><p>ç¤ºä¾‹ä»£ç ï¼š<br>print-%:<br>    @echo $* &#x3D; $($*)<br>ä½¿ç”¨æ–¹æ³•ï¼š<br>åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼š<br>make print-VARIABLE_NAME<br>ä¾‹å¦‚ï¼š<br>make print-XTENSA_SW_RELEASE<br>è¿™å°†æ‰“å° XTENSA_SW_RELEASE å˜é‡çš„å€¼ã€‚</p><h2 id="å‘½ä»¤è¡Œå‚æ•°"><a href="#å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°"></a>å‘½ä»¤è¡Œå‚æ•°</h2><p>See <a href="https://stackoverflow.com/questions/2214575/passing-arguments-to-make-run">here</a>.</p><p><code>@:</code> See <a href="https://unix.stackexchange.com/questions/92978/what-does-this-2-mean-in-shell-scripting">here</a>.</p><p>This works fine for me:</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># If the first argument is &quot;run&quot;...</span></span><br><span class="line"><span class="keyword">ifeq</span> (run,<span class="variable">$(<span class="built_in">firstword</span> <span class="variable">$(MAKECMDGOALS)</span>)</span>)</span><br><span class="line">  <span class="comment"># use the rest as arguments for &quot;run&quot;</span></span><br><span class="line">  RUN_ARGS := <span class="variable">$(<span class="built_in">wordlist</span> 2,$(words <span class="variable">$(MAKECMDGOALS)</span>)</span>,<span class="variable">$(MAKECMDGOALS)</span>)</span><br><span class="line">  <span class="comment"># ...and turn them into do-nothing targets</span></span><br><span class="line">  <span class="comment"># <span class="doctag">TODO:</span> What does the following line mean?</span></span><br><span class="line">  <span class="comment"># $(eval $(RUN_ARGS):;@:)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;cmd&quot; refers to any command</span></span><br><span class="line"><span class="section">run:</span></span><br><span class="line">cmd <span class="variable">$(RUN_ARGS)</span></span><br></pre></td></tr></table></figure><h2 id="makefileåŒåç›®æ ‡å¤„ç†æ–¹å¼"><a href="#makefileåŒåç›®æ ‡å¤„ç†æ–¹å¼" class="headerlink" title="makefileåŒåç›®æ ‡å¤„ç†æ–¹å¼"></a>makefileåŒåç›®æ ‡å¤„ç†æ–¹å¼</h2><p>å‚è€ƒï¼š</p><ul><li><a href="https://blog.csdn.net/lixiangminghate/article/details/50448664">é“¾æ¥</a></li><li><a href="https://stackoverflow.com/questions/43718595/two-targets-with-the-same-name-in-a-makefile">é“¾æ¥</a></li></ul><p><a href="https://stackoverflow.com/questions/2019989/how-to-assign-the-output-of-a-command-to-a-makefile-variable">makefileå°†å‘½ä»¤ç»“æœèµ‹å€¼ç»™å˜é‡</a></p><h2 id="Makefileä¸­çŸ­åˆ’çº¿"><a href="#Makefileä¸­çŸ­åˆ’çº¿" class="headerlink" title="Makefileä¸­çŸ­åˆ’çº¿"></a>Makefileä¸­çŸ­åˆ’çº¿</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">all:</span></span><br><span class="line">-/bin/rm -rf *.log</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œâ€<code>-/bin/rm</code>â€œçš„çŸ­åˆ’çº¿â€<code>-</code>â€œæ˜¯ä¸€ä¸ªç‰¹æ®Šå‰ç¼€ï¼Œè¡¨ç¤ºå¿½ç•¥å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹çš„é”™è¯¯ã€‚</p><h2 id="ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº"><a href="#ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº" class="headerlink" title="ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº"></a>ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SRCS = <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all: $(SRCS:.c=)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Unnecessary, as the default rules are adequate.</span></span><br><span class="line"><span class="section">.c:</span></span><br><span class="line">gcc <span class="variable">$(CPFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure><p>æœ€åä¸¤è¡Œå…¶å®ä¸éœ€è¦ï¼Œé»˜è®¤è§„åˆ™å·²ç»è¶³å¤Ÿäº†ã€‚</p><p>å…¶ä¸­ï¼Œ<code>$(SRCS:.c=.o)</code>è¡¨ç¤ºå°†å˜é‡<code>SRCS</code>ä¸­çš„æ¯ä¸ªå•è¯ï¼ˆä»¥ç©ºæ ¼åˆ†å‰²ï¼‰ä¸­çš„<code>.c</code>æ›¿æ¢ä¸º<code>.o</code>ã€‚ä»¥ä¸Šä»£ç åˆ™æ˜¯å°†æ‰€æœ‰<code>.c</code>éƒ½å»æ‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell Configuration</title>
      <link href="/blog/2023/11/13/linux/Shell-Configuration/"/>
      <url>/blog/2023/11/13/linux/Shell-Configuration/</url>
      
        <content type="html"><![CDATA[<h2 id="Color-Scheme"><a href="#Color-Scheme" class="headerlink" title="Color Scheme"></a>Color Scheme</h2><p>Refer to <a href="https://askubuntu.com/questions/466198/how-do-i-change-the-color-for-directories-with-ls-in-the-console">the link</a>.</p><p>Add these three lines to ~&#x2F;.bashrc</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vi ~/.bashrc</span><br><span class="line"><span class="built_in">export</span> LS_OPTIONS=<span class="string">&#x27;--color=auto&#x27;</span></span><br><span class="line"><span class="comment"># dircolors - color set for ls</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(dircolors -b)</span>&quot;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">ls</span>=<span class="string">&#x27;ls $LS_OPTIONS&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è™šæ‹Ÿå†…å­˜</title>
      <link href="/blog/2023/11/07/linux/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/"/>
      <url>/blog/2023/11/07/linux/%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h2 id="1-æœ¯è¯­"><a href="#1-æœ¯è¯­" class="headerlink" title="1. æœ¯è¯­"></a>1. æœ¯è¯­</h2><p>resident set size (RSS)</p><h2 id="2-æ–‡ä»¶ç³»ç»Ÿ"><a href="#2-æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="2. æ–‡ä»¶ç³»ç»Ÿ"></a>2. æ–‡ä»¶ç³»ç»Ÿ</h2><p>&#x2F;proc&#x2F;self&#x2F;statm</p><h2 id="3-ç›¸å…³å‘½ä»¤"><a href="#3-ç›¸å…³å‘½ä»¤" class="headerlink" title="3. ç›¸å…³å‘½ä»¤"></a>3. ç›¸å…³å‘½ä»¤</h2><h3 id="3-1-top"><a href="#3-1-top" class="headerlink" title="3.1. top"></a>3.1. top</h3><h4 id="3-1-1-Fields"><a href="#3-1-1-Fields" class="headerlink" title="3.1.1. Fields"></a>3.1.1. Fields</h4><table><thead><tr><th>TIME+<sup><a href="%5Bwhat-does-time-cpu-time-hundredth-in-top-mean%5D(https://superuser.com/questions/1148884/what-does-time-cpu-time-hundredth-in-top-mean/)">1</a></sup></th><th>TIME</th></tr></thead><tbody><tr><td><code>5432:01</code> means â€œ5432 minutes and 1 secondâ€</td><td><code>90,32</code> means â€œ90 hours and 32 minutesâ€</td></tr><tr><td><code>25:15.20</code> means â€œ25 minutes, 15 seconds and 20% of 1 secondâ€</td><td><code>25:15</code> means â€œ25 minutes and 15 secondsâ€</td></tr></tbody></table><h3 id="3-2-ps"><a href="#3-2-ps" class="headerlink" title="3.2. ps"></a>3.2. ps</h3><h4 id="3-2-1-è¾“å‡ºè¯´æ˜"><a href="#3-2-1-è¾“å‡ºè¯´æ˜" class="headerlink" title="3.2.1. è¾“å‡ºè¯´æ˜"></a>3.2.1. è¾“å‡ºè¯´æ˜</h4><p><code>TIME</code>: the cumulated CPU time in [DD-]hh:mm:ss format (time&#x3D;TIME)</p><table><thead><tr><th>Field</th><th>value &amp; means</th></tr></thead><tbody><tr><td><code>TIME</code></td><td><code>1-18:09:38</code> means â€œ1 day, 18 hours, 9 minutes and 38 secondsâ€</td></tr></tbody></table><h2 id="4-ç›¸å…³ç³»ç»Ÿè°ƒç”¨"><a href="#4-ç›¸å…³ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="4. ç›¸å…³ç³»ç»Ÿè°ƒç”¨"></a>4. ç›¸å…³ç³»ç»Ÿè°ƒç”¨</h2><h3 id="4-1-fork"><a href="#4-1-fork" class="headerlink" title="4.1. fork"></a>4.1. fork</h3><p>å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å‰¯æœ¬ï¼Œè·å–äº†çˆ¶è¿›ç¨‹çš„æ•°æ®ç©ºé—´ã€å †å’Œæ ˆçš„å‰¯æœ¬ï¼Œä½†æ˜¯ä»–ä»¬å…±äº«æ­£æ–‡æ®µã€‚</p><p>å†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼ŒCOWï¼‰ï¼šä¸å¤åˆ¶çˆ¶è¿›ç¨‹çš„å®Œå…¨å‰¯æœ¬ï¼Œåªæœ‰åœ¨çˆ¶æˆ–å­è¿›ç¨‹å°è¯•ä¿®æ”¹è¿™äº›åŒºåŸŸæ—¶ï¼Œåˆ™ä¸ºä¿®æ”¹åŒºåŸŸçš„é‚£å—å†…å­˜åˆ¶ä½œä¸€ä¸ªå‰¯æœ¬ï¼Œé€šå¸¸æ˜¯è™šæ‹Ÿå†…å­˜çš„ä¸€é¡µã€‚</p><p><strong>åšä¸»æ³¨ï¼š</strong> å¦‚æœçˆ¶è¿›ç¨‹å°è¯•ä¿®æ”¹å…±äº«çš„å†…å­˜é¡µï¼Œå†…æ ¸ä¼šä¸ºçˆ¶è¿›ç¨‹åŒæ ·åˆ¶ä½œå‰¯æœ¬ï¼Œè€ŒæŠŠåŸæœ¬çš„å†…å­˜é¡µç•™ç»™å­è¿›ç¨‹ä½¿ç”¨ï¼Œè¿™ä¼šå¯¼è‡´å³ä½¿åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼ŒåŸæœ¬çš„å†…å­˜é¡µçš„ç‰©ç†åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œä»è€Œä½¿å¾— RDMA ç­‰æœºåˆ¶å‘ç”Ÿé”™è¯¯ï¼ˆè¦æ±‚ç‰©ç†åœ°å€ä¿æŒä¸å˜ï¼‰ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦ä½¿ç”¨ <code>madise</code> è®¾ç½® <code>MADV_DONTFORK</code> æ ‡å¿—ã€‚</p><p>åœ¨ Linux ä¸­ï¼Œå†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Write, COWï¼‰æœºåˆ¶ä¸»è¦é€šè¿‡é¡µè¡¨å’Œå†…å­˜ç®¡ç†å•å…ƒï¼ˆMMUï¼‰æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ COW åœ¨ Linux ä¸­çš„å…·ä½“å®ç°æ­¥éª¤ï¼š</p><p>é¡µè¡¨æ ‡è®°ï¼šå½“è¿›ç¨‹è°ƒç”¨ fork() åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„é¡µè¡¨ä¼šæ ‡è®°å…±äº«çš„å†…å­˜é¡µä¸ºåªè¯»ã€‚è¿™æ„å‘³ç€è¿™äº›é¡µåœ¨åˆå§‹çŠ¶æ€ä¸‹æ˜¯å…±äº«çš„ï¼Œä¸”æ— æ³•è¢«å†™å…¥ã€‚</p><p>é¡µé”™è¯¯å¤„ç†ï¼šå¦‚æœçˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹å°è¯•å†™å…¥è¿™äº›åªè¯»é¡µï¼Œä¼šè§¦å‘é¡µé”™è¯¯ï¼ˆpage faultï¼‰ã€‚æ“ä½œç³»ç»Ÿå†…æ ¸ä¼šæ•è·è¿™ä¸ªé¡µé”™è¯¯ï¼Œå¹¶æ‰§è¡Œ COW æœºåˆ¶ã€‚</p><p>å†…å­˜é¡µå¤åˆ¶ï¼šåœ¨é¡µé”™è¯¯å‘ç”Ÿæ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªæ–°çš„ç‰©ç†å†…å­˜é¡µï¼Œå¹¶å°†åŸå§‹é¡µçš„å†…å®¹å¤åˆ¶åˆ°è¿™ä¸ªæ–°é¡µä¸­ã€‚ç„¶åï¼Œé¡µè¡¨ä¼šæ›´æ–°ï¼Œä»¥æŒ‡å‘æ–°çš„å¯å†™å†…å­˜é¡µã€‚</p><p>é¡µè¡¨æ›´æ–°ï¼šæ“ä½œç³»ç»Ÿæ›´æ–°è¿›ç¨‹çš„é¡µè¡¨ï¼Œä½¿å¾—å†™å…¥æ“ä½œå¯ä»¥åœ¨æ–°çš„å†…å­˜é¡µä¸Šè¿›è¡Œï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹å…±äº«çš„åŸå§‹é¡µã€‚</p><p>å¼•ç”¨è®¡æ•°ï¼šæ“ä½œç³»ç»Ÿç»´æŠ¤æ¯ä¸ªå†…å­˜é¡µçš„å¼•ç”¨è®¡æ•°ï¼Œä»¥è·Ÿè¸ªæœ‰å¤šå°‘è¿›ç¨‹å…±äº«è¯¥é¡µã€‚å½“å¼•ç”¨è®¡æ•°å‡å°‘åˆ°é›¶æ—¶ï¼Œå†…å­˜é¡µå¯ä»¥è¢«é‡Šæ”¾ã€‚</p><h3 id="4-2-mmap"><a href="#4-2-mmap" class="headerlink" title="4.2. mmap"></a>4.2. mmap</h3><p>TODO</p><h3 id="4-3-madvise"><a href="#4-3-madvise" class="headerlink" title="4.3. madvise"></a>4.3. madvise</h3><p><code>madvise</code> æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºå‘å†…æ ¸æä¾›å…³äºå†…å­˜ä½¿ç”¨çš„å»ºè®®ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">madvise</span><span class="params">(<span class="type">void</span> *addr, <span class="type">size_t</span> length, <span class="type">int</span> advice)</span>;</span><br></pre></td></tr></table></figure><h4 id="4-3-1-é€‰é¡¹-adviceï¼š"><a href="#4-3-1-é€‰é¡¹-adviceï¼š" class="headerlink" title="4.3.1. é€‰é¡¹ adviceï¼š"></a>4.3.1. é€‰é¡¹ adviceï¼š</h4><h5 id="4-3-1-1-MADV-DONTFORK"><a href="#4-3-1-1-MADV-DONTFORK" class="headerlink" title="4.3.1.1. MADV_DONTFORK"></a>4.3.1.1. <code>MADV_DONTFORK</code></h5><p><code>MADV_DONTFORK</code> é˜»æ­¢ <code>fork()</code> åçš„å­è¿›ç¨‹çœ‹è§è¿™äº›èŒƒå›´çš„å†…å­˜é¡µã€‚</p><p>è¿™æ„å‘³è¯¥å†…å­˜ä¸ä¼šè¢«å¤åˆ¶ï¼Œå³åœ¨ <code>fork()</code> è°ƒç”¨æ—¶ï¼ŒæŒ‡å®šçš„å†…å­˜åŒºåŸŸä¸ä¼šè¢«å­è¿›ç¨‹ç»§æ‰¿ï¼Œé¿å…å†™æ—¶å¤åˆ¶å¯¼è‡´çš„é¡µç‰©ç†åœ°å€å‘ç”Ÿå˜åŒ–ã€‚åœ¨ fork() ä¹‹åï¼Œå¦‚æœçˆ¶è¿›ç¨‹å¯¹å…±äº«å†…å­˜é¡µè¿›è¡Œå†™æ“ä½œï¼Œå†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰æœºåˆ¶ä¼šå°†è¿™äº›é¡µå¤åˆ¶åˆ°æ–°çš„ç‰©ç†ä½ç½®ã€‚è¿™ä¼šå¯¼è‡´ RDMA æ“ä½œä½¿ç”¨çš„å†…å­˜åœ°å€ä¸ä¸€è‡´ï¼Œä»è€Œå¼•å‘æ•°æ®é”™è¯¯ã€‚</p><p><strong>æ‹“å±•ï¼š</strong> RDMA ä¸­ï¼Œ<code>ibv_fork_init</code> å’Œ <code>RDMAV_HUGEPAGES_SAFE</code> ä¼šè°ƒç”¨ <code>madvise()</code> æ¥ä¸º IB å¡çš„ DMA å†…å­˜é¡µè®¾ç½® <code>MADV_DONTFORK</code> ï¼Œä»¥é¿å…æ•°æ®æŸåã€‚</p><h2 id="5-å‚è€ƒ"><a href="#5-å‚è€ƒ" class="headerlink" title="5. å‚è€ƒ"></a>5. å‚è€ƒ</h2><p><a href="https://serverfault.com/questions/138427/what-does-virtual-memory-size-in-top-mean">what-does-virtual-memory-size-in-top-mean</a><br>[2]: <a href="https://blog.csdn.net/weixin_42319496/article/details/125940896">https://blog.csdn.net/weixin_42319496/article/details/125940896</a><br>[3]: <a href="https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17/ibv_fork_init">https://docs.nvidia.com/networking/display/rdmaawareprogrammingv17/ibv_fork_init</a></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> memory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KiB vs KB vs kB</title>
      <link href="/blog/2023/11/07/misc/KiB-vs-KB-vs-kB/"/>
      <url>/blog/2023/11/07/misc/KiB-vs-KB-vs-kB/</url>
      
        <content type="html"><![CDATA[<p>See the article: <a href="https://physics.nist.gov/cuu/Units/binary.html">Prefixes for binary multiples</a></p><p>Table:</p><table border="0" cellspacing="0" cellpadding="3"><tbody><tr><td colspan="5"><center><hr noshade="" size="2"><b><font face="Myriad Roman,Syntax,Arial,Helvetica"><font color="#006633"><font size="+1">Prefixesfor binary multiples</font></font></font></b><hr></center></td></tr><tr><td colspan="5"><table border="0" cellspacing="0" cellpadding="3"><tbody><tr><td><b>&nbsp;Factor&nbsp;</b></td><td><b>Name&nbsp;</b></td><td><b>Symbol&nbsp;</b></td><td><b>Origin</b></td><td><b>Derivation&nbsp;</b></td></tr><tr bgcolor="#D0F0C8"><td>&nbsp;2<sup>10</sup></td><td>kibi</td><td>Ki</td><td>kilobinary: (2<sup>10</sup>)<sup>1</sup></td><td>kilo: (10<sup>3</sup>)<sup>1</sup></td></tr><tr><td>&nbsp;2<sup>20</sup></td><td>mebi</td><td>Mi</td><td>megabinary: (2<sup>10</sup>)<sup>2&nbsp;</sup></td><td>mega: (10<sup>3</sup>)<sup>2</sup></td></tr><tr bgcolor="#D0F0C8"><td>&nbsp;2<sup>30</sup></td><td>gibi</td><td>Gi</td><td>gigabinary: (2<sup>10</sup>)<sup>3</sup></td><td>giga: (10<sup>3</sup>)<sup>3</sup></td></tr><tr><td>&nbsp;2<sup>40</sup></td><td>tebi</td><td>Ti</td><td>terabinary: (2<sup>10</sup>)<sup>4</sup></td><td>tera: (10<sup>3</sup>)<sup>4</sup></td></tr><tr bgcolor="#D0F0C8"><td>&nbsp;2<sup>50</sup></td><td>pebi</td><td>Pi</td><td>petabinary: (2<sup>10</sup>)<sup>5</sup></td><td>peta: (10<sup>3</sup>)<sup>5</sup></td></tr><tr><td>&nbsp;2<sup>60</sup></td><td>exbi</td><td>Ei</td><td>exabinary: (2<sup>10</sup>)<sup>6</sup></td><td>exa: (10<sup>3</sup>)<sup>6</sup></td></tr></tbody></table></td></tr><tr><td colspan="5"><hr noshade="" size="1"></td></tr><tr><td align="CENTER" colspan="5"><table border="0" cellspacing="0" cellpadding="3" width="100%"><tbody><tr><td align="CENTER" colspan="2"><b>Examples and comparisons with SI prefixes</b></td></tr><tr><td align="RIGHT" bgcolor="#D0F0C8">one <b>kibibit</b></td><td bgcolor="#D0F0C8">&nbsp;1 Kibit = 2<sup>10</sup> bit = <b>1024 bit</b></td></tr><tr><td align="RIGHT">one <b>kilobit</b></td><td>&nbsp;1 kbit = 10<sup>3</sup> bit = <b>1000 bit</b></td></tr><tr>  <td align="RIGHT" bgcolor="#D0F0C8">one <strong>byte</strong></td>    <td bgcolor="#D0F0C8">&nbsp;1 B = 2<sup>3</sup> bit = <strong>8 bit</strong></td></tr><tr><td align="RIGHT">one <b>mebibyte</b></td><td>&nbsp;1 MiB = 2<sup>20</sup> B = <b>1 048 576 B</b></td></tr><tr><td align="RIGHT" bgcolor="#D0F0C8">one <b>megabyte</b></td><td bgcolor="#D0F0C8">&nbsp;1 MB = 10<sup>6</sup> B = <b>1 000 000 B</b></td></tr><tr><td align="RIGHT">one <b>gibibyte</b></td><td>&nbsp;1 GiB = 2<sup>30</sup> B = <b>1 073 741 824B</b></td></tr><tr><td align="RIGHT" bgcolor="#D0F0C8">one <b>gigabyte</b></td><td bgcolor="#D0F0C8">&nbsp;1 GB = 10<sup>9</sup> B = <b>1 000 000 000 B</b></td></tr></tbody></table><hr noshade="" size="1"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Misc </category>
          
      </categories>
      
      
        <tags>
            
            <tag> concepts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å˜å‚å‡½æ•°</title>
      <link href="/blog/2023/11/03/cpp/%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0/"/>
      <url>/blog/2023/11/03/cpp/%E5%8F%98%E5%8F%82%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Variadic-function-in-C"><a href="#Variadic-function-in-C" class="headerlink" title="Variadic function in C"></a>Variadic function in C</h2><p>See more: <a href="https://www.geeksforgeeks.org/variadic-functions-in-c/">Variadic functions in C</a></p><h3 id="vprintf"><a href="#vprintf" class="headerlink" title="vprintf"></a><code>vprintf</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myPrintf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format, ...)</span> </span>&#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    <span class="built_in">va_start</span>(args, format);</span><br><span class="line">    <span class="built_in">vprintf</span>(format, args);</span><br><span class="line">    <span class="built_in">va_end</span>(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">int</span> time = <span class="number">100</span>;</span><br><span class="line">  <span class="built_in">myPrintf</span>(<span class="string">&quot;Elapsed time is: %ld seconds.\n&quot;</span>, time);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./a.out </span><br><span class="line">Elapsed time is: 100 seconds.</span><br></pre></td></tr></table></figure><h3 id="ap-list-vsnprintf"><a href="#ap-list-vsnprintf" class="headerlink" title="ap_list + vsnprintf"></a><code>ap_list</code> + <code>vsnprintf</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span> <span class="comment">// gettimeofday</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span> id, <span class="type">const</span> <span class="type">char</span> *fmt, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="type">int</span> MAXLEN = <span class="number">1024</span>;</span><br><span class="line">    <span class="type">char</span> buf[MAXLEN];</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">    n = <span class="built_in">snprintf</span>(buf, MAXLEN, <span class="string">&quot;INFO(%d): &quot;</span>, id);</span><br><span class="line"></span><br><span class="line">    va_list ap;</span><br><span class="line">    <span class="comment">// ap will be the pointer to the last fixed argument of the variadic function.</span></span><br><span class="line">    <span class="built_in">va_start</span>(ap, fmt);</span><br><span class="line">    n += <span class="built_in">vsnprintf</span>(buf + n, MAXLEN - n, fmt, ap);</span><br><span class="line">    <span class="comment">// This ends the traversal of the variadic function arguments.</span></span><br><span class="line">    <span class="built_in">va_end</span>(ap);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">timeval</span> tv;</span><br><span class="line">    <span class="built_in">gettimeofday</span>(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">tm</span> tm;</span><br><span class="line">    <span class="built_in">localtime_r</span>(&amp;tv.tv_sec, &amp;tm);</span><br><span class="line">    <span class="type">char</span> timebuf[<span class="number">64</span>];</span><br><span class="line">    <span class="comment">// size_t strftime(char *s, size_t max, const char *format, const struct tm *tm);</span></span><br><span class="line">    <span class="built_in">snprintf</span>(timebuf, MAXLEN - n, <span class="string">&quot;%d-%02d-%02d %d:%d:%d.%ld %s&quot;</span>,</span><br><span class="line">             tm.tm_year + <span class="number">1900</span>, tm.tm_mon + <span class="number">1</span>, tm.tm_mday,</span><br><span class="line">             tm.tm_hour, tm.tm_min, tm.tm_sec, tv.tv_usec, tm.tm_zone);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(buf, timebuf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* name = <span class="string">&quot;Tony&quot;</span>;</span><br><span class="line">    <span class="comment">// &quot;%%s&quot; is a placeholder of the timestamp for the vsnprintf function.</span></span><br><span class="line">    <span class="built_in">foo</span>(<span class="number">123</span>, <span class="string">&quot;Hello %s at %%s\n&quot;</span>, name);</span><br><span class="line">    <span class="comment">// Will print:</span></span><br><span class="line">    <span class="comment">// INFO(123): Hello Tony at 2023-10-04 21:25:23.682853 CST</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="va-list-va-arg"><a href="#va-list-va-arg" class="headerlink" title="va_list + va_arg"></a><code>va_list</code> + <code>va_arg</code></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">bool</span> debug = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">printDebugLog</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* fmt, ...)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (debug) &#123;</span><br><span class="line">        <span class="comment">// The first argument doesn&#x27;t need to traverse via va_list.</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fmt=%s\n&quot;</span>, fmt);</span><br><span class="line">        va_list ap;</span><br><span class="line">        <span class="built_in">va_start</span>(ap, fmt);</span><br><span class="line">        <span class="type">long</span> <span class="type">int</span> t = <span class="built_in">va_arg</span>(ap, <span class="type">long</span> <span class="type">int</span>);</span><br><span class="line">        <span class="built_in">va_end</span>(ap);</span><br><span class="line">        <span class="built_in">printf</span>(fmt, t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">int</span> time = <span class="number">100</span>;</span><br><span class="line">  <span class="built_in">printDebugLog</span>(<span class="string">&quot;Elapsed time is: %ld seconds.\n&quot;</span>, time);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ./a.out </span><br><span class="line"><span class="built_in">fmt</span>=Elapsed time is: %ld seconds.</span><br><span class="line"></span><br><span class="line">Elapsed time is: 100 seconds.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ å‘½åç©ºé—´</title>
      <link href="/blog/2023/11/02/cpp/C++%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/"/>
      <url>/blog/2023/11/02/cpp/C++%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<h2 id="inline-namespace"><a href="#inline-namespace" class="headerlink" title="inline namespace"></a>inline namespace</h2><p>You can define and specialize members of an <code>inline namespace</code> as if they were also members of the enclosing namespace.<br><code>inline namespace</code> è¡¨ç¤ºè¯¥å‘½åç©ºé—´ä¹Ÿæ˜¯ä¸Šçº§å‘½åç©ºé—´çš„æˆå‘˜ã€‚<br>å‚è€ƒ: <a href="https://www.ibm.com/docs/en/zos/2.2.0?topic=only-inline-namespace-definitions-c11">Inline namespace definitions (C++11)</a></p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> USE_INLINE_B</span></span><br><span class="line">   <span class="keyword">inline</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">   <span class="keyword">namespace</span> B &#123;</span><br><span class="line">      <span class="function"><span class="type">int</span> <span class="title">foo</span><span class="params">(<span class="type">bool</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="type">int</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> A::<span class="built_in">foo</span>(<span class="literal">true</span>); <span class="comment">// å¦‚æœUSE_INLINE_Bä¸º0ï¼Œåˆ™è¯¥å¥å‡ºé”™ï¼šæ‰¾ä¸åˆ°å®šä¹‰ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Unnamed-anonymous-namespaces-vs-static-in-namespace"><a href="#Unnamed-anonymous-namespaces-vs-static-in-namespace" class="headerlink" title="Unnamed &#x2F; anonymous namespaces vs static in namespace"></a>Unnamed &#x2F; anonymous namespaces vs static in namespace</h2><p>Refer to: <a href="https://medium.com/pranayaggarwal25/unnamed-namespaces-static-f1498741c527">Unnamed &#x2F; anonymous namespaces vs static in namespace</a></p>]]></content>
      
      
      <categories>
          
          <category> c/cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> syntax </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>English idiom</title>
      <link href="/blog/2023/11/02/english/english-idiom/"/>
      <url>/blog/2023/11/02/english/english-idiom/</url>
      
        <content type="html"><![CDATA[<ol><li>at a drop of a hat: æ¯«ä¸çŠ¹è±«ã€‚è§<a href="(https://dictionary.cambridge.org/us/dictionary/english/at-the-drop-of-a-hat)">Cambridge dict</a>.</li><li>beyond your ken: è¶…è¿‡ä½ çš„è®¤çŸ¥èŒƒç•´<br>ken: the range of perception, understanding or knowledge. å‚è€ƒ<a href="https://www.merriam-webster.com/dictionary/ken">è¯å…¸</a>ã€‚</li></ol><blockquote><p>Sheldon: Woman, youâ€™re playing with forces beyond your ken.<br>Penny: Yeah, your ken can kiss my Barbie.</p></blockquote><p>Pennyæƒ³è¦æ°”æ°”Sheldonï¼Œå¥¹æ•…æ„æŠŠkenæ›²è§£æˆç©å¶ï¼Œè¯´ï¼šä½ çš„kenå¯ä»¥å’Œæˆ‘èŠ­æ¯”å¨ƒå¨ƒè°ˆæ‹çˆ±ã€‚<br>å‡ºå¤„: <a href="https://forum.wordreference.com/threads/your-ken-can-kiss-my-barbie.3999874/">word reference</a>ã€‚</p><ol start="3"><li>a rule of thumb: ç»éªŒæ³•åˆ™ã€‚è§<a href="https://www.collinsdictionary.com/zh/dictionary/english/a-rule-of-thumb">æŸ¯æ—æ–¯è¯å…¸</a>ã€‚</li><li>vice versa: åä¹‹äº¦ç„¶ã€‚è¿‘ä¹‰è¯ï¼šconversely.</li><li>on (a) par with: ç›¸å½“ï¼Œå¯¹ç­‰ï¼Œå¯åª²ç¾ã€‚See more: <a href="https://www.merriam-webster.com/dictionary/on%20%28a%29%20par%20with">on (a) par with</a></li><li>IMHO: In my humble opinion æ•æˆ‘ç›´è¨€ã€‚humble è°¦é€Šçš„ã€‚</li><li>AFAIK: As far as I know æ®æˆ‘æ‰€çŸ¥ã€‚</li><li>miss the forest for the trees. &#x2F; not see the forest for the trees. åªè§æ ‘æœ¨ã€ä¸è§æ£®æ—ã€‚å‚è§<a href="https://dictionary.cambridge.org/us/dictionary/english/not-see-the-forest-for-the-trees">å‰‘æ¡¥è¯å…¸</a>ï¼što be unable to get a general understanding of a situation because you are too worried about the details å› å¤ªæ³¨é‡ç»†èŠ‚è€Œæ— æ³•ä»æ•´ä½“è§’åº¦çœ‹å¾…é—®é¢˜ã€‚</li><li>irrespective of ä¸è®º</li><li>sell sb out. å‡ºå–æŸäººã€‚</li><li>mood swings. æƒ…ç»ªæ³¢åŠ¨ã€‚ swing v. æ‘‡æ‘†ï¼›swings n. ç§‹åƒã€‚</li><li>buy thatâ€¦ ç›¸ä¿¡â€¦â€¦ e.g. I didnâ€™t think the doctor was gonna buy thatâ€¦</li><li>Roger that. &#x2F; Copy that. <a href="https://medium.com/@methark/copy-that-or-roger-that-whats-the-difference-63ad1367ff22">å‚è€ƒ</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vocabulary </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Muder on The Orient Express</title>
      <link href="/blog/2023/10/28/english/Muder-on-The-Orient-Express/"/>
      <url>/blog/2023/10/28/english/Muder-on-The-Orient-Express/</url>
      
        <content type="html"><![CDATA[<h2 id="äººç‰©"><a href="#äººç‰©" class="headerlink" title="äººç‰©"></a>äººç‰©</h2><p>Daisy Armstrong<br>Miss Mary Debenham<br>Colonel Arbuthnott<br>Hercule Poirot<br>Lieutenant Dubosc</p><h2 id="å°è¯"><a href="#å°è¯" class="headerlink" title="å°è¯"></a>å°è¯</h2><p>1930<br>The Armstrong Home, Long Island, N.Y.</p><p>Armstrong Baby Kidnapped.<br>Crushed toys, crushed hopes.</p><p>Baby taken in dead of night.<br>Armstrong Household Turmoil.<br>Baby Daisy Taken from Armstrong Home.<br>Staff Wakened But Hopeless.</p><p>DAISY ARMSTRONG - Child of Colonel and Mrs. Hamish Armstrong was dramatically kidnapped last night while her parents were being driven to the airport by their chauffeur.</p><p>The discover of the missing child was made by the chauffeur on returning from the airport where he found the family nurse bound and gagged in the room next to Baby Daisyâ€™s bedroom.</p><p>The police were informed immediately and investigations began at once. They described kidnapping as one of the most vicious crimous that can be commited.</p><p>Daisy found slain.</p><p>5 years later<br>The Asian side of Istanbul.</p><p>Miss Mary Debenham</p><p>Salacak</p><p>Welcome aboard.</p><p>Bosporus Ferry will shortly depart from Istanbul Sirkeci Station, connecting with the Orient Express.</p><p>Hereâ€™s your ticket, Monsieur Poirot. Iâ€™m afraid youâ€™ve still got another hour.</p><p>Well, then, please do not wait.</p><p>Not wait? After all youâ€™ve done for us, Monsieur Poriot? My generalâ€™s orders were to ensure your safe departure. He also wished me to thank you again for saving the honor of the British garrison in Jordan. The brigadierâ€™s confession was opportune. I say, how did you do it? Was it the old thumbscrew, you know, the rack?</p><p>Chop-chop</p><p>I hope we did the right thing booking you into a hotel on the European side rather than the Asia side.<br>æˆ‘å¸Œæœ›æˆ‘ä»¬ç»™ä½ é¢„è®¢çš„æ˜¯æ¬§æ´²é…’åº—è€Œä¸æ˜¯äºšæ´²é…’åº—æ˜¯æ­£ç¡®çš„ã€‚</p><p>I have no prejudice with either continent.</p><p>The crossing should be pleasant. The Borporus is always calm.<br>ç©¿è¡Œåº”è¯¥ä¼šå¾ˆæ„‰å¿«ã€‚åšæ–¯æ™®é²æ–¯æµ·å³¡æ€»æ˜¯å¾ˆå¹³é™ã€‚</p><p>You have crossed by the ferry?<br>ä½ ä¹˜æ¸¡èˆ¹ç©¿æ¸¡è¿‡ï¼Ÿ</p><h2 id="è¯æ±‡"><a href="#è¯æ±‡" class="headerlink" title="è¯æ±‡"></a>è¯æ±‡</h2><p>Daisy: é›èŠï¼›äººåï¼ˆé»›è¥¿ï¼‰ã€‚<br>kidnapped: ç»‘æ¶<br>crushed: ç ´ç­çš„ï¼Œå‹ç¢çš„<br>dead of night: æ·±å¤œæ—¶åˆ†ï¼Œthe quietest, darkest part of the night.<br>household: å®¶åº­ï¼›æˆ·ï¼›å®¶ï¼›å®¶æ—ï¼›å®¶äºº<br>turmoil: n. åŠ¨è¡ï¼›åŠ¨ä¹±<br>staff: å·¥ä½œäººå‘˜ã€‚<br>wakened: waken v. é†’æ¥ã€‚wakened æ˜¯wakençš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ã€‚<br>chauffeur: ç¾&#x2F;ÊƒoÊŠËˆfÉË&#x2F; è‹±&#x2F;ËˆÊƒÉ™ÊŠ.fÉ™r&#x2F; å¸æœºã€‚<br>bound: è¿™é‡Œæ˜¯bindçš„è¿‡å»å¼å’Œè¿‡å»åˆ†è¯ï¼Œç»‘å®šã€æ†ç»‘ã€‚<br>gag: n.&#x2F;v. å µå˜´ï¼›æ’ç§‘æ‰“è¯¨ã€‚<br>vicious: æ¶æ¯’çš„ã€‚<br>slay: To kill in a violent way. æ®‹å¿æ€å®³ã€‚<br>Istanbul: ä¼Šæ–¯å¦å¸ƒå°”ï¼Œä¸ºåœŸè€³å…¶é¦–éƒ½ç›´è‡³1923å¹´ã€‚<br>Salacak: garrison: A group of soliders living in or defending a town or building, or the building that the soliders live in. å®ˆå†›ï¼›å®ˆå¤‡è¥åœ°ã€‚<br>Jordan: çº¦æ—¦ï¼ˆè¥¿äºšå›½å®¶ï¼‰ã€‚<br>brigadier: è‹±&#x2F;ËŒbrÉªÉ¡É™ËˆdÉªÉ™(r)&#x2F; ç¾&#x2F;ËŒbrÉªÉ¡É™ËˆdÉªr&#x2F; å‡†å°†ã€‚<br>confession: n. å¦ç™½ï¼›å¿æ‚”ï¼›è®¤ç½ªã€‚<br>opportune: è‹±&#x2F;ËˆÉ’pÉ™tjuËn&#x2F; ç¾&#x2F;ËŒÉ‘ËpÉ™rËˆtuËn&#x2F; é€‚å½“çš„ï¼›åŠæ—¶çš„ã€‚<br>thumbscrew: èºä¸ï¼›æ‹§ç´§ ã€‚<br>rack: chop-chop: chop v.&#x2F;n. ç ï¼›å‘ä¸‹çŒ›å‡»ã€‚chop-chop èµ¶å¿«ï¼Œå¿«ç‚¹ã€‚<br>Bosporus Strait: åšæ–¯æ™®é²æ–¯æµ·å³¡ï¼Œåˆç§°ä¼Šæ–¯å¦å¸ƒå°”æµ·å³¡ï¼Œä»‹äºæ¬§æ´²ä¸äºšæ´²ä¹‹é—´çš„æµ·å³¡ã€‚å®ƒé•¿çº¦30å…¬é‡Œï¼Œæœ€å®½å¤„å®½çº¦3,700ç±³ï¼Œæœ€çª„å¤„å®½çº¦700ç±³ã€‚åŒ—è¿é»‘æµ·ï¼Œå—é€šé©¬å°”é©¬æ‹‰æµ·ï¼ˆåœŸè€³å…¶å†…æµ·ï¼‰ï¼ŒåœŸè€³å…¶ç¬¬ä¸€å¤§åŸä¼Šæ–¯å¦å ¡å³éš”ç€åšæ–¯æ™®é²æ–¯æµ·å³¡ä¸å°äºšç»†äºšåŠå²›ç›¸æœ›ï¼Œæ˜¯é»‘æµ·æ²¿å²¸å›½å®¶å‡ºæµ·ç¬¬ä¸€å…³å£ï¼Œä¹Ÿæ˜¯è¿æ¥é»‘æµ·ä»¥åŠåœ°ä¸­æµ·çš„å”¯ä¸€èˆªé“ã€‚å› æ­¤ï¼Œä¿„ç½—æ–¯çš„é»‘æµ·èˆ°é˜Ÿå¿…é¡»é€šè¿‡åšæ–¯æ™®é²æ–¯æµ·å³¡æ‰èƒ½å‰å¾€åœ°ä¸­æµ·ã€‚<br>ferry: n.&#x2F;v. æ¸¡èˆ¹ï¼›æ‘†æ¸¡</p>]]></content>
      
      
      <categories>
          
          <category> English </category>
          
      </categories>
      
      
        <tags>
            
            <tag> movie </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
